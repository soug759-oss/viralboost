<!DOCTYPE html>
<html lang="fr">
<script defer src="https://cloud.umami.is/script.js" data-website-id="2fb2c139-5a87-4082-b9f3-0aad697c9317"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8GRTQLRM9C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8GRTQLRM9C');
</script>
  <head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ViralBoost — Publie ta publicité, touche ta cible</title>
<meta name="description" content="Plateforme gratuite pour créateurs et entrepreneurs. Publie ta pub en 30 secondes, trouve des collabs, développe ton audience."/>
<meta name="theme-color" content="#22c55e"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="ViralBoost"/>
<link rel="manifest" href="data:application/json,%7B%22name%22%3A%22ViralBoost%22%2C%22short_name%22%3A%22ViralBoost%22%2C%22description%22%3A%22Publie%20ta%20pub%20en%2030%20secondes%22%2C%22start_url%22%3A%22%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23040a05%22%2C%22theme_color%22%3A%22%2322c55e%22%2C%22orientation%22%3A%22portrait%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22https%3A%2F%2Fplacehold.co%2F192x192%2F22c55e%2Fffffff%3Ftext%3DVB%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fpng%22%7D%2C%7B%22src%22%3A%22https%3A%2F%2Fplacehold.co%2F512x512%2F22c55e%2Fffffff%3Ftext%3DVB%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fpng%22%7D%5D%7D"/>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#040a05;--bg2:#060e07;--s1:#0b1a0d;--s2:#0f2312;--s3:#142e17;
  --g1:#15803d;--g2:#16a34a;--g3:#22c55e;--g4:#4ade80;--g5:#86efac;--g6:#bbf7d0;
  --white:#f0fdf4;--muted:#4a7a58;--muted2:#2d5a3a;
  --border:rgba(34,197,94,0.15);--border2:rgba(34,197,94,0.08);--glow:rgba(34,197,94,0.08);
}
*{margin:0;padding:0;box-sizing:border-box;}
button,a,[onclick]{cursor:pointer !important;touch-action:manipulation;}
button{-webkit-appearance:none;}
html{scroll-behavior:smooth;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--white);overflow-x:hidden;}
#cursor{display:none;}
#cursor-ring{display:none;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(34,197,94,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(34,197,94,0.025) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}
.orb{position:fixed;border-radius:50%;filter:blur(120px);pointer-events:none;z-index:0;}
.o1{width:600px;height:600px;background:rgba(21,128,61,0.07);top:-200px;right:-100px;animation:drift 14s ease-in-out infinite alternate;}
.o2{width:400px;height:400px;background:rgba(74,222,128,0.04);bottom:-100px;left:-100px;animation:drift 18s ease-in-out infinite alternate-reverse;}
@keyframes drift{from{transform:translate(0,0)}to{transform:translate(40px,40px)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes bounce{0%,60%,100%{transform:translateY(0);opacity:.3}30%{transform:translateY(-6px);opacity:1}}
@keyframes toastIn{from{opacity:0;transform:translateX(50px)}to{opacity:1;transform:translateX(0)}}

/* GOLD ELITE STYLES */
:root{--gold:#ffd700;--gold2:#ffb300;--gold3:#fff3b0;}
.elite-gold{color:var(--gold) !important;text-shadow:0 0 8px rgba(255,215,0,0.5);}
.btn-action.elite-action{border-color:var(--gold2)!important;color:var(--gold)!important;background:rgba(255,215,0,0.06)!important;box-shadow:0 0 8px rgba(255,215,0,0.15);}
.btn-action.elite-action:hover{box-shadow:0 0 16px rgba(255,215,0,0.3);}
.post-card.elite-post{border-color:rgba(255,215,0,0.25)!important;}
/* ── HERO SOCIAL PROOF ── */
.hero-social-proof{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--g5);margin-bottom:28px;animation:fadeUp 0.6s 0.05s ease both;}
.hsp-avatars{display:flex;}
.hsp-avatars span{width:28px;height:28px;border-radius:50%;background:var(--s2);border:2px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:13px;margin-left:-8px;}
.hsp-avatars span:first-child{margin-left:0;}
.hero-social-proof strong{color:var(--g3);}

/* ── SIGNUP MODAL REFAIT ── */
.signup-header{text-align:center;margin-bottom:20px;}
.signup-logo{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:3px;color:var(--g3);margin-bottom:8px;}
.signup-title{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--white);margin-bottom:6px;}
.signup-subtitle{font-size:12px;color:var(--muted);}
.signup-benefits{display:flex;flex-direction:column;gap:7px;margin-bottom:20px;background:rgba(22,163,74,0.05);border:1px solid var(--border2);border-radius:10px;padding:14px 16px;}
.signup-benefit{font-size:12px;color:var(--g5);line-height:1.5;}
.signup-form{display:flex;flex-direction:column;gap:10px;margin-bottom:16px;}
.signup-input{width:100%;padding:12px 14px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;transition:border-color 0.2s;}
.signup-input:focus{border-color:rgba(34,197,94,0.5);}
.signup-input::placeholder{color:var(--muted);}
.btn-signup-big{width:100%;padding:14px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 28px rgba(34,197,94,0.35);transition:all 0.2s;margin-bottom:10px;}
.btn-signup-big:hover{transform:translateY(-2px);box-shadow:0 0 44px rgba(34,197,94,0.55);}
.signup-footer-note{text-align:center;font-size:11px;color:var(--muted2);margin-bottom:10px;}

.plan-elite-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:2px;letter-spacing:1px;}

/* HERO AD BOX */
.hero-ad-box{background:rgba(22,163,74,0.06);border:2px solid rgba(22,163,74,0.25);border-radius:16px;padding:28px 32px;max-width:720px;width:100%;margin:0 auto 40px;animation:fadeUp 0.5s 0.1s ease both;}
.hero-ad-box h3{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:var(--g3);margin-bottom:12px;}
.hero-ad-form{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hero-ad-form input,.hero-ad-form select,.hero-ad-form textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.hero-ad-form input:focus,.hero-ad-form select:focus,.hero-ad-form textarea:focus{border-color:var(--g3);}
.hero-ad-form textarea{grid-column:1/-1;min-height:56px;resize:none;}
.hero-ad-form select option{background:var(--s1);}
.btn-hero-ad{grid-column:1/-1;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-hero-ad:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);}

/* ═══════════════════════════════════════════
   WIZARD PAS-À-PAS — ONGLET PUBLIER
═══════════════════════════════════════════ */
/* Stepper header */
.wiz-stepper{display:flex;align-items:center;gap:0;margin-bottom:28px;padding:20px 24px;background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;}
.wiz-step-dot{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;cursor:pointer;}
.wiz-step-circle{width:34px;height:34px;border-radius:50%;border:2px solid var(--border);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;font-family:'DM Mono',monospace;color:var(--muted);transition:all 0.3s;position:relative;}
.wiz-step-circle.active{border-color:var(--g3);background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);box-shadow:0 0 16px rgba(34,197,94,0.4);}
.wiz-step-circle.done{border-color:var(--g2);background:rgba(22,163,74,0.15);color:var(--g3);}
.wiz-step-circle.done::after{content:'✓';position:absolute;font-size:12px;}
.wiz-step-circle.done span{display:none;}
.wiz-step-lbl{font-size:9px;font-weight:700;font-family:'DM Mono',monospace;letter-spacing:0.5px;color:var(--muted);text-align:center;text-transform:uppercase;transition:color 0.3s;}
.wiz-step-dot.active .wiz-step-lbl{color:var(--g3);}
.wiz-step-dot.done .wiz-step-lbl{color:var(--g4);}
.wiz-connector{flex:1;height:2px;background:var(--border2);margin:0 4px;margin-bottom:18px;transition:background 0.4s;}
.wiz-connector.done{background:linear-gradient(90deg,var(--g2),var(--g3));}

/* Step panels */
.wiz-panel{display:none;animation:fadeUp 0.3s ease;}
.wiz-panel.active{display:block;}

/* Step card groupe */
.wiz-group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 22px;margin-bottom:0;transition:border-color 0.3s;}
.wiz-group-card:focus-within{border-color:rgba(34,197,94,0.3);}
.wiz-group-title{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
.wiz-group-icon{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.wiz-group-head{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:var(--white);}
.wiz-group-sub{font-size:12px;color:var(--muted);margin-top:1px;}

/* Nav boutons */
.wiz-nav{display:flex;gap:12px;margin-top:22px;}
.btn-wiz-back{flex:1;padding:13px;background:transparent;border:1.5px solid var(--border);border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-wiz-back:hover{border-color:var(--g3);color:var(--g3);}
.btn-wiz-next{flex:3;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.25);display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-wiz-next:hover{background:linear-gradient(135deg,var(--g2),var(--g3));box-shadow:0 0 32px rgba(34,197,94,0.45);transform:translateY(-1px);}
.btn-wiz-publish{flex:3;padding:14px;background:linear-gradient(135deg,#15803d,#22c55e);border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 24px rgba(34,197,94,0.35);display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-wiz-publish:hover{box-shadow:0 0 40px rgba(34,197,94,0.55);transform:translateY(-1px);}

/* Progress bar sous le stepper */
.wiz-progress-bar{height:3px;background:var(--s3);border-radius:2px;overflow:hidden;margin-bottom:22px;}
.wiz-progress-fill{height:100%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:2px;transition:width 0.5s cubic-bezier(0.4,0,0.2,1);}

/* Aperçu pub dans step 5 */
.wiz-preview-card{background:linear-gradient(135deg,var(--s1),var(--s2));border:2px solid rgba(34,197,94,0.3);border-radius:14px;overflow:hidden;margin-bottom:14px;box-shadow:0 8px 32px rgba(0,0,0,0.4);}
.wiz-preview-banner{height:110px;background:linear-gradient(135deg,var(--s2),var(--s3));display:flex;align-items:center;justify-content:center;font-size:52px;position:relative;}
.wiz-preview-banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.wiz-preview-body{padding:16px 18px;}
.wiz-preview-name{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:1.5px;color:var(--white);margin-bottom:3px;}
.wiz-preview-hook{font-size:12px;color:var(--g3);font-weight:700;margin-bottom:8px;}
.wiz-preview-desc{font-size:13px;color:#c4d9cb;line-height:1.7;margin-bottom:10px;}
.wiz-preview-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px;}
.wiz-preview-footer{display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--muted);}
.wiz-preview-label{display:inline-block;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;padding:2px 8px;border-radius:3px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);color:var(--g4);}

/* ═══════════════════════════════════════════
   GUIDE MODAL — 1ère ouverture
═══════════════════════════════════════════ */
.guide-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.3s ease;}
.guide-overlay.hidden{display:none !important;}
.guide-box{background:var(--s1);border:2px solid rgba(34,197,94,0.4);border-radius:16px;max-width:340px;width:100%;padding:24px 22px;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);}
.guide-box-close{position:absolute;top:16px;right:16px;background:var(--s2);border:1px solid var(--border);border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--muted);transition:all 0.2s;}
.guide-box-close:hover{border-color:var(--g3);color:var(--g3);}
.guide-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--g4);font-family:'DM Mono',monospace;letter-spacing:1px;margin-bottom:16px;}
.guide-title{font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:2px;color:var(--white);line-height:1;margin-bottom:6px;}
.guide-subtitle{font-size:13px;color:var(--muted);margin-bottom:22px;line-height:1.7;}
.guide-steps-list{display:flex;flex-direction:column;gap:10px;margin-bottom:24px;}
.guide-step-row{display:flex;align-items:flex-start;gap:14px;background:rgba(22,163,74,0.04);border:1.5px solid var(--border2);border-radius:12px;padding:14px 16px;transition:border-color 0.2s;}
.guide-step-row:hover{border-color:rgba(34,197,94,0.2);}
.guide-step-num{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);font-size:11px;font-weight:800;font-family:'DM Mono',monospace;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.guide-step-content{}
.guide-step-title{font-size:13px;font-weight:800;color:var(--white);margin-bottom:2px;}
.guide-step-desc{font-size:11px;color:var(--muted);line-height:1.6;}
.guide-tip-box{background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:10px;padding:12px 14px;margin-bottom:22px;font-size:12px;color:var(--g5);line-height:1.7;}
.guide-tip-box strong{color:var(--gold);}
.btn-guide-start{width:100%;padding:15px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 28px rgba(34,197,94,0.35);transition:all 0.2s;}
.btn-guide-start:hover{background:linear-gradient(135deg,var(--g2),var(--g3));box-shadow:0 0 44px rgba(34,197,94,0.55);transform:translateY(-2px);}

/* PUBLIC FEED PREVIEW */
.public-feed-section{padding:60px 5% 80px;position:relative;z-index:1;}
.public-post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;margin-bottom:10px;transition:border-color 0.2s;}
.public-post-card:hover{border-color:rgba(34,197,94,0.2);}
.public-post-card.elite-pub{border-color:rgba(255,215,0,0.2);}
.public-feed-blur{position:relative;}
.public-feed-blur .feed-lock{position:absolute;bottom:0;left:0;right:0;height:180px;background:linear-gradient(transparent,var(--bg));display:flex;align-items:flex-end;justify-content:center;padding-bottom:20px;}
.btn-unlock-feed{padding:11px 28px;background:var(--g2);border:none;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);box-shadow:0 0 24px rgba(22,163,74,0.35);transition:all 0.2s;}
.btn-unlock-feed:hover{background:var(--g3);}

/* MEDIA UPLOAD */
.media-upload-area{border:2px dashed var(--border);border-radius:10px;padding:14px;margin:10px 0;cursor:pointer;transition:all 0.2s;text-align:center;}
.media-upload-area:hover{border-color:var(--g3);background:var(--glow);}
.media-upload-area input{display:none;}
.media-preview-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
.media-preview-item{position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;border:1.5px solid var(--border);}
.media-preview-item img,.media-preview-item video{width:100%;height:100%;object-fit:cover;}
.media-preview-item .rm-media{position:absolute;top:2px;right:2px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;color:#fff;font-size:9px;display:flex;align-items:center;justify-content:center;}
.file-chip{display:flex;align-items:center;gap:6px;background:var(--s2);border:1px solid var(--border);border-radius:5px;padding:4px 10px;font-size:11px;color:var(--g4);}

/* GROUP CHAT */
.group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;cursor:pointer;}
.group-card:hover{border-color:rgba(34,197,94,0.25);}
.group-card.elite-group{border-color:rgba(255,215,0,0.2);}
.group-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.group-icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.group-title{font-size:14px;font-weight:700;}
.group-desc{font-size:12px;color:var(--muted);margin-bottom:6px;}
.group-meta{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);display:flex;align-items:center;gap:10px;}

/* GROUP SETTINGS (ELITE) */
.group-settings-section{background:var(--s2);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:18px;margin-bottom:14px;}
.group-settings-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.toggle-row label{font-size:12px;color:var(--g5);}
.toggle{position:relative;width:38px;height:20px;cursor:pointer;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:var(--muted2);border-radius:20px;transition:0.3s;}
.toggle-slider::before{content:'';position:absolute;width:14px;height:14px;left:3px;top:3px;background:#fff;border-radius:50%;transition:0.3s;}
.toggle input:checked+.toggle-slider{background:var(--g2);}
.toggle input:checked+.toggle-slider::before{transform:translateX(18px);}

/* WALLPAPER */
#app.has-wallpaper{background-size:cover;background-position:center;background-attachment:fixed;}
#app.has-wallpaper .app-bar{background:rgba(4,10,5,0.85);}
#app.has-wallpaper .tpanel{background:rgba(4,10,5,0.5);border-radius:12px;}

/* REPORT MODAL */
.report-reason{display:flex;flex-direction:column;gap:8px;margin:12px 0;}
.report-reason label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--g5);cursor:pointer;}
.report-reason input[type=radio]{accent-color:var(--g3);}

/* ADMIN MSG BADGE */
.admin-msg-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}

/* ── BADGES SYSTÈME ── */
.badges-section{margin-top:24px;}
.badges-section h3{font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:14px;text-transform:uppercase;}
.badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px;}
.badge-item{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;transition:all 0.2s;position:relative;}
.badge-item.unlocked{border-color:rgba(34,197,94,0.35);background:rgba(22,163,74,0.06);}
.badge-item.unlocked:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.badge-item.locked{opacity:0.4;filter:grayscale(1);}
.badge-item.special{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.05);}
.badge-item.special.unlocked{box-shadow:0 0 12px rgba(255,215,0,0.15);}
.badge-emoji{font-size:26px;line-height:1;margin-bottom:6px;}
.badge-name{font-size:9px;font-weight:700;color:var(--g5);font-family:'DM Mono',monospace;letter-spacing:0.5px;line-height:1.3;}
.badge-item.locked .badge-name{color:var(--muted2);}
.badge-lock-icon{position:absolute;top:5px;right:6px;font-size:8px;color:var(--muted2);}
.badge-plan-tag{display:inline-block;font-family:'DM Mono',monospace;font-size:7px;padding:1px 5px;border-radius:2px;margin-top:3px;letter-spacing:0.5px;}
.badge-plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.badge-plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.badge-plan-elite{background:linear-gradient(135deg,rgba(255,215,0,0.25),rgba(255,140,0,0.2));color:#ffd700;}
.badge-tooltip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--s3);border:1px solid var(--border);border-radius:6px;padding:6px 10px;font-size:10px;color:var(--g5);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:10;font-family:'Plus Jakarta Sans',sans-serif;}
.badge-item:hover .badge-tooltip{opacity:1;}
.badge-progress-bar{height:3px;background:var(--s3);border-radius:2px;margin-top:5px;overflow:hidden;}
.badge-progress-fill{height:100%;background:var(--g3);border-radius:2px;transition:width 0.4s;}

/* ── MISSIONS & BOUTIQUE CRÉDITS ── */
.credits-tabs{display:flex;gap:0;margin-bottom:20px;border-bottom:1px solid var(--border2);}
.credits-tab{padding:9px 16px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.credits-tab.active{color:var(--gold);border-bottom-color:var(--gold);}
.credits-tab:hover{color:var(--white);}
.cpanel{display:none;}
.cpanel.active{display:block;animation:fadeUp 0.2s ease;}

/* Barre crédits améliorée */
.credits-bar-v2{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;}
.credits-big{font-family:'Bebas Neue',sans-serif;font-size:42px;color:var(--gold);line-height:1;letter-spacing:1px;}
.credits-sub{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.credits-actions{display:flex;gap:8px;flex-wrap:wrap;}

/* Missions */
.mission-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:14px;transition:all 0.2s;}
.mission-card.done{border-color:rgba(34,197,94,0.3);background:rgba(22,163,74,0.04);opacity:0.7;}
.mission-icon{font-size:26px;flex-shrink:0;width:44px;height:44px;background:var(--s2);border-radius:10px;display:flex;align-items:center;justify-content:center;}
.mission-info{flex:1;}
.mission-title{font-size:13px;font-weight:700;color:var(--white);margin-bottom:2px;}
.mission-desc{font-size:11px;color:var(--muted);margin-bottom:6px;}
.mission-prog-bar{height:4px;background:var(--s3);border-radius:2px;overflow:hidden;margin-bottom:4px;}
.mission-prog-fill{height:100%;background:var(--g3);border-radius:2px;transition:width 0.5s;}
.mission-prog-txt{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);}
.mission-reward{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;}
.mission-reward-val{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);line-height:1;}
.mission-reward-label{font-size:8px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.btn-claim{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.15));border:1.5px solid rgba(255,215,0,0.4);border-radius:5px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer;color:var(--gold);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-claim:hover{box-shadow:0 0 10px rgba(255,215,0,0.3);}
.btn-claim:disabled{opacity:0.4;cursor:not-allowed;}
.mission-done-tag{font-size:10px;color:var(--g3);font-weight:700;}
.missions-reset{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);text-align:right;margin-bottom:12px;}

/* Boutique */
.shop-section-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin:20px 0 10px;}
.shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-bottom:20px;}
.shop-item{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 12px;text-align:center;transition:all 0.2s;cursor:pointer;position:relative;}
.shop-item:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-2px);}
.shop-item.premium{border-color:rgba(255,215,0,0.25);background:rgba(255,215,0,0.03);}
.shop-item.premium:hover{border-color:rgba(255,215,0,0.5);box-shadow:0 0 16px rgba(255,215,0,0.1);}
.shop-item-emoji{font-size:30px;margin-bottom:8px;}
.shop-item-name{font-size:12px;font-weight:700;color:var(--white);margin-bottom:3px;}
.shop-item-desc{font-size:10px;color:var(--muted);margin-bottom:8px;line-height:1.4;}
.shop-item-price{display:inline-flex;align-items:center;gap:4px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:4px;padding:3px 9px;font-family:'DM Mono',monospace;font-size:11px;font-weight:700;color:var(--gold);}
.shop-item-badge{position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:3px;font-family:'DM Mono',monospace;}

/* Badge rewards in BADGES */
.badge-reward{font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);margin-top:3px;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:200;padding:0 5%;height:66px;display:flex;align-items:center;justify-content:space-between;background:rgba(4,10,5,0.92);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:3px;color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.35);position:relative;z-index:1;}
.logo span{color:var(--white);}
.nav-links{display:flex;gap:28px;}
.nav-links a{font-size:13px;font-weight:500;color:var(--muted);text-decoration:none;letter-spacing:0.5px;transition:color 0.2s;position:relative;z-index:1;}
.nav-links a:hover{color:var(--g3);}
.lang-btn{background:rgba(34,197,94,0.08);border:1.5px solid var(--border);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:700;color:var(--g4);cursor:pointer;transition:all 0.2s;font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.lang-btn:hover{border-color:var(--g3);background:rgba(34,197,94,0.15);}
.nav-right{display:flex;gap:10px;align-items:center;}
.btn-g{padding:9px 22px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;letter-spacing:0.3px;}
.btn-ghost-g{background:transparent;border:1.5px solid var(--border);color:var(--g3);}
.btn-ghost-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-solid-g:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);transform:translateY(-1px);}

/* HAMBURGER MOBILE */
.hamburger{display:none;flex-direction:column;justify-content:center;gap:5px;width:36px;height:36px;background:transparent;border:1.5px solid var(--border);border-radius:6px;cursor:pointer;padding:7px;flex-shrink:0;transition:border-color 0.2s;}
.hamburger span{display:block;height:2px;background:var(--g3);border-radius:2px;transition:all 0.3s;}
.hamburger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
.hamburger.open span:nth-child(2){opacity:0;transform:scaleX(0);}
.hamburger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}
.hamburger:hover{border-color:var(--g3);}

/* MOBILE DROPDOWN MENU */
.mobile-menu{display:none;position:fixed;top:66px;left:0;right:0;z-index:199;background:rgba(4,10,5,0.97);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);padding:0;max-height:0;overflow:hidden;transition:max-height 0.35s cubic-bezier(0.4,0,0.2,1),padding 0.35s ease;}
.mobile-menu.open{max-height:400px;padding:16px 5% 20px;}
.mobile-menu a{display:block;padding:13px 0;font-size:15px;font-weight:600;color:var(--muted);text-decoration:none;border-bottom:1px solid var(--border2);transition:color 0.2s;}
.mobile-menu a:last-of-type{border-bottom:none;}
.mobile-menu a:hover,.mobile-menu a:active{color:var(--g3);}
.mobile-menu .mobile-btns{display:flex;gap:10px;margin-top:16px;}
.mobile-menu .mobile-btns button{flex:1;}

/* BOTTOM NAV BAR */
.bottom-nav{
  display:none;
  position:fixed;bottom:0;left:0;right:0;z-index:300;
  background:rgba(4,10,5,0.96);backdrop-filter:blur(28px);
  border-top:1px solid rgba(34,197,94,0.1);
  padding:8px 4px max(10px,env(safe-area-inset-bottom));
  gap:0;
}
body:not(.app-active) .bottom-nav{display:none !important;}
.bn-item{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:4px;padding:6px 0;background:none;border:none;cursor:pointer;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:9px;font-weight:600;
  color:var(--muted);transition:color 0.2s, transform 0.15s;position:relative;
  touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.bn-item:active{transform:scale(0.88);}
.bn-item.active{color:var(--g3);}
.bn-item.active .bn-icon{filter:drop-shadow(0 0 8px rgba(34,197,94,0.7));transform:translateY(-3px) scale(1.2);}
.bn-item.bn-publish.active{color:var(--bg) !important;}

/* Couleurs label par onglet */
#bn-feed.active{color:#fb923c;}
#bn-vitrine.active{color:#c4b5fd;}
#bn-profil.active{color:#38bdf8;}
#bn-more.active{color:#94a3b8;}
/* Couleurs individuelles — supprimées, icônes auto-colorées */
#bn-feed.active,#bn-vitrine.active,#bn-profil.active,#bn-more.active{color:var(--g3);}
.bn-item .bn-icon{line-height:1;display:flex;align-items:center;justify-content:center;transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1);}
.bn-item .bn-icon svg{width:36px;height:36px;border-radius:10px;}
.bn-item.active .bn-icon{transform:translateY(-3px) scale(1.18);}
.bn-item.bn-publish .bn-icon{transform:none !important;filter:none !important;}
.bn-item.bn-publish .bn-icon svg{width:28px;height:28px;border-radius:0;}
@keyframes bnPop{0%{transform:scale(1)}40%{transform:scale(1.3)}100%{transform:scale(1)}}
.bn-item.bn-just-activated .bn-icon{animation:bnPop 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.bn-item .bn-dot{
  position:absolute;top:4px;right:calc(50% - 14px);
  width:6px;height:6px;background:var(--g3);border-radius:50%;
  box-shadow:0 0 5px var(--g3);display:none;
}
.bn-item .bn-dot.show{display:block;}
.bn-item.bn-publish{
  background:linear-gradient(135deg,var(--g1),var(--g2));
  border-radius:16px;
  width:50px;max-width:50px;height:50px;padding:0;margin:0 auto;margin-top:-8px;
  box-shadow:0 0 20px rgba(34,197,94,0.4), 0 4px 12px rgba(0,0,0,0.3);
  color:var(--bg) !important;
  flex:0 0 50px;
  transition:transform 0.15s, box-shadow 0.2s;
}
.bn-item.bn-publish svg{stroke:var(--bg) !important;}
.bn-item.bn-publish:active{transform:scale(0.9);box-shadow:0 0 10px rgba(34,197,94,0.3);}
.bn-item#bn-credits{position:relative;}
/* ── MENU PLUS MOBILE ── */
.bn-more-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:8000;display:flex;align-items:flex-end;justify-content:center;}
.bn-more-overlay.hidden{display:none!important;}
.bn-more-sheet{background:var(--s1);border:1.5px solid var(--border);border-radius:20px 20px 0 0;width:100%;max-width:480px;padding:12px 20px 32px;animation:slideUp 0.3s cubic-bezier(0.34,1.2,0.64,1);}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.bn-more-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px;}
.bn-more-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:16px;text-align:center;}
.bn-more-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.bn-more-item{display:flex;flex-direction:column;align-items:center;gap:6px;background:var(--s2);border:1.5px solid var(--border2);border-radius:14px;padding:14px 8px;cursor:pointer;transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);}
.bn-more-item:hover,.bn-more-item:active{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.bn-more-item.bn-more-logout{border-color:rgba(248,113,113,0.2);color:#f87171;}
.bn-more-item.bn-more-logout:hover,.bn-more-item.bn-more-logout:active{border-color:#f87171;background:rgba(248,113,113,0.08);color:#f87171;}
.bn-more-icon{font-size:22px;line-height:1;display:flex;align-items:center;justify-content:center;}
.bn-more-icon svg{width:38px;height:38px;border-radius:10px;}
.bn-item#bn-credits .bn-icon{font-size:18px;}
.bn-credits-val{font-family:'Bebas Neue',sans-serif;font-size:12px;color:var(--gold);line-height:1;margin-top:-1px;}

@media(max-width:768px){
  /* Sur l'accueil (landing) : logo + boutons auth, cacher les liens et hamburger */
  #landing .nav-links{display:none;}
  #landing .nav-right{display:flex;gap:8px;}
  #landing .nav-right .lang-btn{display:flex;}
  #landing .nav-right .btn-ghost-g,
  #landing .nav-right .btn-solid-g{display:flex;padding:8px 14px;font-size:12px;}
  #landing .hamburger{display:none !important;}
  /* Masquer le mobile-menu dropdown sur l'accueil */
  #mobile-menu{display:none !important;}
  /* Pour l'app (app-active) : comportement normal */
  body.app-active nav .nav-links{display:none;}
  body.app-active nav .nav-right{display:none;}
  body.app-active nav .hamburger{display:flex !important;}
  body.app-active #mobile-menu{display:block !important;}
  body.app-active .bottom-nav{display:flex;}
  body.app-active #app{padding-bottom:72px;}
  .app-bar{padding:0 3%;gap:0;}
  .app-logo{font-size:15px;letter-spacing:2px;margin-right:8px;}
}

/* HERO */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:100px 5% 80px;position:relative;z-index:1;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.25);border-radius:4px;padding:7px 16px;font-size:12px;font-weight:600;color:var(--g4);margin-bottom:32px;letter-spacing:1px;text-transform:uppercase;animation:fadeUp 0.6s ease both;}
.pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--g3);box-shadow:0 0 8px var(--g3);animation:blink 1.8s infinite;flex-shrink:0;}
.hero-concept{background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:12px;padding:18px 28px;margin-bottom:36px;max-width:660px;animation:fadeUp 0.6s 0.08s ease both;}
.hero-concept p{font-size:15px;color:var(--g5);line-height:1.8;font-weight:400;}
.hero-concept p strong{color:var(--g3);}
.hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(72px,12vw,148px);letter-spacing:2px;line-height:0.88;margin-bottom:20px;animation:fadeUp 0.6s 0.12s ease both;}
.hero h1 .line1{display:block;color:var(--white);}
.hero h1 .line2{display:block;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.35);}
.hero-sub{font-size:16px;color:var(--muted);max-width:500px;line-height:1.8;margin-bottom:44px;animation:fadeUp 0.6s 0.18s ease both;}
.hero-actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:18px;animation:fadeUp 0.6s 0.24s ease both;}
.btn-hero-big{padding:15px 38px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;transition:all 0.3s;letter-spacing:0.3px;}
.btn-hero-solid{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 36px rgba(22,163,74,0.35);}
.btn-hero-solid:hover{background:var(--g3);box-shadow:0 0 70px rgba(22,163,74,0.55);transform:translateY(-2px);}
.btn-hero-out{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-hero-out:hover{border-color:var(--g3);background:var(--glow);}
.hero-note{font-size:13px;color:var(--muted2);animation:fadeUp 0.6s 0.3s ease both;}
.hero-note span{color:var(--g4);}
.how-simple{display:flex;gap:0;justify-content:center;max-width:860px;width:100%;animation:fadeUp 0.6s 0.36s ease both;}
.how-step-simple{flex:1;text-align:center;padding:24px 18px;border:1px solid var(--border2);position:relative;}
.how-step-simple+.how-step-simple{border-left:none;}
.how-step-simple::before{content:attr(data-n);position:absolute;top:10px;left:12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);letter-spacing:1px;}
.step-icon{font-size:26px;margin-bottom:10px;}
.how-step-simple h4{font-size:13px;font-weight:700;color:var(--g3);margin-bottom:5px;}
.how-step-simple p{font-size:12px;color:var(--muted);line-height:1.6;}

/* SECTION HELPERS */
.sec-label{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;display:block;}
h2.section-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(36px,5vw,60px);letter-spacing:2px;color:var(--white);margin-bottom:8px;}
h2.section-title em{color:var(--g3);font-style:normal;}
.section-sub{color:var(--muted);font-size:15px;margin-bottom:48px;max-width:480px;}

/* VITRINE */
.vitrine-section{padding:100px 5%;position:relative;z-index:1;}
.filters-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px;}
.f-btn{padding:7px 18px;border-radius:4px;border:1.5px solid var(--border2);background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;}
.f-btn:hover,.f-btn.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.vitrine-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
.v-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer;}
.v-card:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-3px);box-shadow:0 16px 48px rgba(0,0,0,0.4);}
.v-banner{height:110px;display:flex;align-items:center;justify-content:center;font-size:42px;position:relative;}
.v-banner::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,transparent 40%,var(--s1));}
.v-body{padding:16px 18px;}
.v-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.v-name{font-size:15px;font-weight:700;margin-bottom:5px;}
.v-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:8px;}
/* ── EXIT INTENT POPUP ── */
.exit-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);z-index:9500;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.3s ease;}
.exit-overlay.hidden{display:none!important;}
.exit-box{background:linear-gradient(145deg,var(--s1),var(--s2));border:2px solid rgba(34,197,94,0.3);border-radius:20px;max-width:360px;width:100%;padding:32px 28px;text-align:center;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);}
.exit-close{position:absolute;top:14px;right:14px;background:var(--s2);border:1px solid var(--border);border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;color:var(--muted);}
.exit-emoji{font-size:48px;margin-bottom:12px;}
.exit-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--white);margin-bottom:8px;}
.exit-sub{font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:16px;}
.exit-sub strong{color:var(--g4);}
.exit-perks{display:flex;flex-direction:column;gap:6px;margin-bottom:20px;text-align:left;}
.exit-perks span{font-size:12px;color:var(--g5);padding:6px 12px;background:rgba(34,197,94,0.05);border:1px solid var(--border2);border-radius:6px;}
.btn-exit-cta{width:100%;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 24px rgba(34,197,94,0.3);transition:all 0.2s;margin-bottom:12px;}
.btn-exit-cta:hover{transform:translateY(-1px);box-shadow:0 0 40px rgba(34,197,94,0.5);}
.exit-skip{font-size:11px;color:var(--muted2);cursor:pointer;text-decoration:underline;}
.exit-skip:hover{color:var(--muted);}

/* ── MODAL PROJET ── */
.project-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:9000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.2s ease;}
.project-modal-overlay.hidden{display:none!important;}
.project-modal{background:var(--s1);border:1.5px solid rgba(34,197,94,0.25);border-radius:18px;max-width:480px;width:100%;max-height:85vh;overflow-y:auto;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.pmo-banner{height:130px;display:flex;align-items:center;justify-content:center;font-size:60px;position:relative;flex-shrink:0;}
.pmo-banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.pmo-close{position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.5);border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:#fff;z-index:2;}
.pmo-body{padding:20px 22px 24px;}
.pmo-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pmo-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1.5px;color:var(--white);margin-bottom:8px;line-height:1.1;}
.pmo-hook{font-size:13px;color:var(--g4);font-weight:700;margin-bottom:10px;}
.pmo-desc{font-size:13px;color:#c4d9cb;line-height:1.75;margin-bottom:14px;}
.pmo-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.pmo-tag{font-family:'DM Mono',monospace;font-size:10px;padding:3px 9px;border-radius:3px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);color:var(--g4);}
.pmo-url{display:flex;align-items:center;gap:8px;padding:11px 14px;background:rgba(22,163,74,0.07);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;text-decoration:none;margin-bottom:14px;transition:all 0.2s;}
.pmo-url:hover{border-color:var(--g3);background:rgba(22,163,74,0.14);}
.pmo-url span{font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.pmo-footer{display:flex;align-items:center;justify-content:space-between;padding-top:14px;border-top:1px solid var(--border2);}
.pmo-author{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);}
.pmo-ava{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg);}
.pmo-actions{display:flex;gap:8px;}
.pmo-btn{display:flex;align-items:center;gap:5px;background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:6px 14px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.pmo-btn:hover,.pmo-btn.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.pmo-btn-dm{border-color:rgba(34,197,94,0.2);color:var(--g4);}
.pmo-btn-dm:hover{border-color:var(--g3);background:var(--glow);}

.v-url-link{display:flex;align-items:center;gap:6px;padding:7px 10px;margin-bottom:10px;background:rgba(22,163,74,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:8px;text-decoration:none;transition:all 0.2s;font-size:11px;color:var(--g4);}
.v-url-link:hover{border-color:rgba(34,197,94,0.4);background:rgba(22,163,74,0.12);color:var(--g3);}
.v-url-text{font-family:'DM Mono',monospace;font-size:11px;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.v-footer{display:flex;align-items:center;justify-content:space-between;}
.v-author{display:flex;align-items:center;gap:7px;font-size:12px;color:var(--muted);}
.v-ava{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--bg);background:var(--g2);}
.v-actions{display:flex;align-items:center;gap:5px;}
.btn-vote-g{display:flex;align-items:center;gap:4px;background:transparent;border:1.5px solid var(--border2);border-radius:4px;padding:4px 10px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'DM Mono',monospace;}
.btn-vote-g:hover,.btn-vote-g.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.btn-dm-small{background:transparent;border:1.5px solid var(--border2);border-radius:4px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;}
.btn-dm-small:hover{border-color:var(--g3);background:var(--glow);}
.v-badge{position:absolute;top:8px;left:8px;background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;letter-spacing:1px;z-index:2;border-radius:2px;}

/* PLANS */
.plans-section{padding:100px 5%;position:relative;z-index:1;background:linear-gradient(180deg,transparent,var(--bg2),transparent);}
.plans-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:16px;}
.plan-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:28px 20px;position:relative;transition:all 0.3s;}
.plan-card:hover{background:var(--s2);border-color:rgba(34,197,94,0.35);transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,0,0,0.4);}
.plan-card.recommended{background:var(--s2);border:1.5px solid var(--g3);border-top:3px solid var(--g3);}
.plan-badge{position:absolute;top:-1px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:9px;font-weight:700;padding:3px 10px;letter-spacing:1px;white-space:nowrap;}
.plan-name{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;}
.plan-card.recommended .plan-name{color:var(--g3);}
.plan-price{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--white);letter-spacing:-1px;line-height:1;}
.plan-card.recommended .plan-price{color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.3);}
.plan-period{font-size:12px;color:var(--muted);margin:3px 0 14px;}
.plan-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:16px;min-height:40px;}
.plan-features{list-style:none;margin-bottom:24px;}
.plan-features li{font-size:12px;color:#5a8a68;padding:6px 0;border-bottom:1px solid var(--border2);display:flex;align-items:flex-start;gap:7px;line-height:1.5;}
.plan-features li:last-child{border:none;}
.plan-features li::before{content:'✓';color:var(--g3);font-size:10px;font-weight:700;flex-shrink:0;margin-top:2px;}
.plan-features li.no::before{content:'✗';color:var(--muted2);}
.plan-features li.no{color:var(--muted2);}
.btn-plan-g{width:100%;padding:11px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;}
.btn-plan-outline-g{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-plan-outline-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-plan-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 16px rgba(22,163,74,0.3);}
.btn-plan-solid-g:hover{background:var(--g3);}

/* REVIEWS */
.reviews-section{padding:100px 5%;position:relative;z-index:1;}
.reviews-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.rev-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:22px;transition:all 0.2s;}
.rev-card:hover{border-color:rgba(34,197,94,0.25);}
.rev-stars{color:var(--g3);font-size:12px;margin-bottom:10px;letter-spacing:2px;}
.rev-text{font-size:13px;color:#6a9478;line-height:1.8;margin-bottom:16px;}
.rev-text strong{color:var(--g4);}
.rev-author{display:flex;align-items:center;gap:10px;}
.rev-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.rev-name{font-size:13px;font-weight:700;}
.rev-handle{font-size:11px;color:var(--muted);}
.rev-result{font-size:11px;color:var(--g3);font-weight:600;margin-top:1px;}

/* CTA / FOOTER */
.cta-section{padding:100px 5%;text-align:center;position:relative;z-index:1;border-top:1px solid var(--border2);}
.cta-section h2{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,8vw,96px);letter-spacing:2px;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.3);margin-bottom:14px;}
.cta-section p{color:var(--muted);font-size:15px;margin-bottom:36px;}
footer{background:var(--bg2);border-top:1px solid var(--border2);padding:28px 5%;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:14px;position:relative;z-index:1;}
.footer-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;}
footer p{color:var(--muted);font-size:11px;font-family:'DM Mono',monospace;}

/* MODALS */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(4,10,5,0.92);backdrop-filter:blur(16px);z-index:500;align-items:center;justify-content:center;padding:16px;overflow-y:auto;}
.modal-bg.open{display:flex;animation:fadeIn 0.2s ease;}
.modal{background:var(--s1);border:1.5px solid var(--border);border-radius:16px;padding:36px;width:100%;max-width:480px;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);max-height:90vh;overflow-y:auto;}
.modal.wide{max-width:900px;}
.modal::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:60%;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);border-radius:100px;}
.modal-close{position:absolute;top:12px;right:12px;background:rgba(22,163,74,0.08);border:1.5px solid var(--border);border-radius:50%;width:28px;height:28px;cursor:pointer;color:var(--muted);font-size:12px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.modal-close:hover{border-color:var(--g3);color:var(--g3);}
.modal h2{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;color:var(--g3);margin-bottom:3px;}
.modal-sub{color:var(--muted);font-size:11px;margin-bottom:22px;font-family:'DM Mono',monospace;letter-spacing:1px;}
.fg{margin-bottom:12px;}
label{display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:4px;letter-spacing:1.5px;text-transform:uppercase;}
input,select,textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
input:focus,select:focus,textarea:focus{border-color:var(--g3);box-shadow:0 0 10px rgba(34,197,94,0.08);}
select option{background:var(--s1);}
textarea{resize:vertical;min-height:68px;}
.btn-modal-g{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;margin-top:6px;box-shadow:0 0 18px rgba(22,163,74,0.28);}
.btn-modal-g:hover{background:var(--g3);}
.btn-modal-g:disabled{opacity:0.4;cursor:not-allowed;}
.modal-switch{text-align:center;margin-top:12px;font-size:13px;color:var(--muted);}
.modal-switch a{color:var(--g3);cursor:pointer;font-weight:600;}

/* SIGNUP PLANS */
.signup-plans{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:18px;}
.sp-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative;}
.sp-card:hover,.sp-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.sp-card.selected::after{content:'✓';position:absolute;top:5px;right:7px;color:var(--g3);font-size:10px;font-weight:700;}
.sp-plan{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px;}
.sp-price{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--g3);line-height:1;}
.sp-per{font-size:9px;color:var(--muted);}
.sp-feat{font-size:10px;color:#4a7a58;margin-top:5px;line-height:1.5;}

/* PAYMENT */
.pay-sum{background:rgba(22,163,74,0.07);border:1.5px solid rgba(22,163,74,0.18);border-radius:10px;padding:16px;text-align:center;margin-bottom:16px;}
.pay-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pay-price{font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--g3);}
.pay-period{font-size:11px;color:var(--muted);}
#card-element{background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:8px;padding:12px;margin-bottom:5px;}
#card-errors{color:#f87171;font-size:11px;min-height:14px;margin-bottom:7px;font-family:'DM Mono',monospace;}

/* APP BAR */
#app{display:none;min-height:100vh;}
.app-bar{background:rgba(4,10,5,0.96);border-bottom:1px solid var(--border2);padding:0 2%;height:60px;display:flex;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(24px);}
.app-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;text-shadow:0 0 12px rgba(74,222,128,0.35);margin-right:24px;white-space:nowrap;flex-shrink:0;}
.app-tabs{display:flex;flex:1;overflow-x:auto;gap:0;scrollbar-width:none;}
.app-tabs::-webkit-scrollbar{display:none;}
.app-tab{padding:0 14px;height:60px;display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.app-tab:hover{color:var(--white);}
.app-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.notif-dot{width:5px;height:5px;background:var(--g3);border-radius:50%;margin-top:-10px;margin-left:-3px;box-shadow:0 0 5px var(--g3);flex-shrink:0;}
.app-right{margin-left:auto;display:flex;align-items:center;gap:7px;flex-shrink:0;padding-left:12px;}
.plan-chip{background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:1px;}
.user-chip{display:flex;align-items:center;gap:7px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:4px 10px;cursor:pointer;transition:all 0.2s;}
.user-chip:hover{border-color:var(--g3);}
.user-chip-ava{width:24px;height:24px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.user-chip-name{font-size:12px;font-weight:600;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-out-g{background:transparent;border:1.5px solid var(--border2);border-radius:5px;padding:5px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-out-g:hover{border-color:#f87171;color:#f87171;}

/* APP PANELS */
.tpanel{display:none;}
.tpanel.active{display:block;animation:fadeUp 0.22s ease;}

/* PUBLISH BOX */
/* ── COMPOSER TWEET-STYLE ── */
.composer-intro{margin-bottom:20px;padding:0 2px;}
.composer-intro-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--g3);text-transform:uppercase;margin-bottom:6px;opacity:0.7;}
.composer-intro-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--white);line-height:1;margin-bottom:5px;}
.composer-intro-sub{font-size:12px;color:var(--muted);line-height:1.6;}

.publish-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:16px;padding:0;margin-bottom:22px;overflow:hidden;transition:border-color 0.25s,box-shadow 0.25s;}
.publish-box:focus-within{border-color:rgba(34,197,94,0.35);box-shadow:0 4px 40px rgba(34,197,94,0.06);}
.publish-top{display:flex;gap:12px;align-items:flex-start;padding:16px 16px 0;}
.pub-ava{width:36px;height:36px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;margin-top:2px;}
.pub-input-wrap{flex:1;display:flex;flex-direction:column;gap:10px;}
.pub-text{width:100%;background:transparent;border:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;color:var(--white);resize:none;outline:none;min-height:52px;max-height:200px;line-height:1.65;overflow:hidden;}
.pub-text::placeholder{color:var(--muted);}

.pub-type-card{background:var(--s1);border:2px solid rgba(34,197,94,0.15);border-radius:14px;padding:14px 16px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.22s;}
.pub-type-card:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,0.3);}
.pub-type-card.ptc-selected{transform:translateY(-2px);box-shadow:0 6px 28px rgba(0,0,0,0.4);outline:2px solid rgba(255,255,255,0.12);}
.ptc-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.ptc-body{flex:1;}
.ptc-name{font-size:14px;font-weight:800;color:var(--white);margin-bottom:2px;}
.ptc-desc{font-size:11px;color:var(--muted);margin-bottom:4px;}
.ptc-fields{font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace;}
.pub-type-row{display:flex;gap:5px;flex-wrap:wrap;max-height:0;overflow:hidden;opacity:0;transition:max-height 0.3s ease,opacity 0.25s ease;}
.pub-type-row.visible{max-height:80px;opacity:1;}
.pub-type-pill{display:flex;align-items:center;gap:4px;padding:4px 11px;border-radius:20px;border:1.5px solid var(--border2);background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.18s;white-space:nowrap;}
.pub-type-pill:hover{border-color:var(--g3);color:var(--g3);}
.pub-type-pill.active{border-color:var(--g2);color:var(--bg);background:var(--g2);}

.pub-proj-wrap{padding-bottom:2px;}
.pub-proj-wrap input{width:100%;padding:7px 11px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border2);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;color:var(--white);outline:none;transition:border-color 0.2s;}
.pub-proj-wrap input:focus{border-color:rgba(34,197,94,0.4);}
.pub-proj-wrap input::placeholder{color:var(--muted2);}
.pub-url-trigger{display:inline-flex;align-items:center;gap:5px;background:transparent;border:1.5px solid var(--border2);border-radius:20px;padding:4px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.18s;}
.pub-url-trigger:hover{border-color:var(--g3);color:var(--g3);}
.pub-url-wrap{padding-top:0;}
.pub-url-inner{display:flex;align-items:center;gap:8px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;transition:border-color 0.2s;}
.pub-url-inner:focus-within{border-color:rgba(34,197,94,0.4);}
.pub-url-icon{font-size:13px;flex-shrink:0;}
.pub-url-wrap input{flex:1;background:transparent;border:none;outline:none;font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);letter-spacing:0.3px;}
.pub-url-wrap input::placeholder{color:var(--muted2);}
.pub-url-close{background:transparent;border:none;color:var(--muted);font-size:11px;cursor:pointer;padding:0 2px;line-height:1;transition:color 0.15s;}
.pub-url-close:hover{color:#f87171;}

.pub-divider{height:1px;background:var(--border2);margin:14px 0 0;}
.pub-actions{display:flex;justify-content:flex-end;align-items:center;padding:10px 16px;gap:12px;}
.pub-meta{display:none;}
.pub-right{display:flex;align-items:center;gap:12px;}
.pub-char-count{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);transition:color 0.2s,opacity 0.2s;}
.pub-limit{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);letter-spacing:0.4px;}
.btn-publish{background:var(--g2);border:none;border-radius:20px;padding:8px 22px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;letter-spacing:0.2px;}
.btn-publish:hover{background:var(--g3);box-shadow:0 0 20px rgba(34,197,94,0.35);transform:translateY(-1px);}
.btn-publish:disabled{opacity:0.3;cursor:not-allowed;transform:none;box-shadow:none;}

/* FEED */
.feed-tabs{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border2);}
.feed-tab{padding:9px 18px;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;}
.feed-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;margin-bottom:12px;transition:border-color 0.2s;}
.post-card:hover{border-color:rgba(34,197,94,0.2);}
.post-url-card{display:flex;align-items:center;gap:8px;margin:10px 0 4px;padding:10px 14px;background:rgba(22,163,74,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:10px;text-decoration:none;transition:all 0.2s;cursor:pointer;}
.post-url-card:hover{border-color:rgba(34,197,94,0.4);background:rgba(22,163,74,0.1);}
.post-url-icon{font-size:14px;flex-shrink:0;}
.post-url-text{font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.post-url-arrow{font-size:14px;color:var(--g3);flex-shrink:0;}
.post-header{display:flex;align-items:center;gap:9px;margin-bottom:12px;}
.post-ava{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;cursor:pointer;}
.post-meta{flex:1;}
.post-author{font-size:14px;font-weight:700;cursor:pointer;transition:color 0.2s;}
.post-author:hover{color:var(--g3);}
.post-info{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-plan-badge{font-family:'DM Mono',monospace;font-size:8px;padding:1px 5px;border-radius:2px;letter-spacing:0.5px;}
.plan-free{background:rgba(107,114,128,0.2);color:#9ca3af;}
.plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.plan-elite{background:rgba(74,222,128,0.2);color:var(--g3);box-shadow:0 0 5px rgba(74,222,128,0.2);}
.post-content{font-size:14px;line-height:1.7;color:#c4d9cb;margin-bottom:12px;}
.post-project{background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:12px;margin-bottom:12px;display:flex;gap:10px;align-items:center;transition:all 0.2s;}
.post-project:hover{border-color:rgba(34,197,94,0.22);}
.post-proj-icon{font-size:26px;width:42px;height:42px;background:var(--s3);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.post-proj-name{font-size:13px;font-weight:700;margin-bottom:2px;}
.post-proj-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px;text-transform:uppercase;}
.post-proj-desc{font-size:11px;color:var(--muted);margin-top:3px;}
.post-timer{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.15);border-radius:3px;padding:2px 7px;display:inline-flex;align-items:center;gap:3px;}
.post-actions{display:flex;gap:5px;align-items:center;flex-wrap:wrap;}
.btn-action{background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);transition:all 0.2s;display:flex;align-items:center;gap:4px;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-action:hover{border-color:var(--g3);color:var(--g3);}
.btn-action.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}

/* WORLD CHAT PANEL */
.chat-panel-container{max-width:740px;margin:0 auto;padding:24px 0;}
.chat-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;display:flex;flex-direction:column;height:500px;}
.chat-msgs-area{flex:1;overflow-y:auto;padding:18px;display:flex;flex-direction:column;gap:9px;}
.chat-msgs-area::-webkit-scrollbar{width:3px;}
.chat-msgs-area::-webkit-scrollbar-thumb{background:var(--muted2);border-radius:2px;}
.chat-msg-item{background:var(--s2);border-radius:8px;padding:8px 11px;}
.chat-msg-name{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:2px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-text{font-size:13px;color:#7a9a82;line-height:1.5;}
.chat-input-row{padding:12px 14px;border-top:1px solid var(--border2);display:flex;gap:7px;}
.chat-input-field{flex:1;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.chat-input-field:focus{border-color:var(--g3);}
.btn-send{background:var(--g2);border:none;border-radius:7px;width:38px;height:38px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-send:hover{background:var(--g3);}

/* PROFILE */
.profile-banner{height:160px;background:linear-gradient(135deg,var(--s2),var(--s3));border-radius:12px;position:relative;margin-bottom:52px;}
.profile-avatar{position:absolute;bottom:-40px;left:22px;width:80px;height:80px;border-radius:50%;border:3px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.25);line-height:1;overflow:hidden;}
.profile-edit-btn{position:absolute;top:14px;right:14px;background:rgba(4,10,5,0.7);border:1.5px solid var(--border);border-radius:6px;padding:6px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.profile-edit-btn:hover{border-color:var(--g3);color:var(--g3);}
.profile-info{padding:0 22px;}
.profile-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1px;margin-bottom:2px;}
.profile-handle{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);margin-bottom:9px;display:flex;align-items:center;gap:8px;}
.profile-bio{font-size:13px;color:var(--muted);line-height:1.7;max-width:600px;margin-bottom:14px;}
.profile-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.profile-tag{background:rgba(22,163,74,0.08);border:1px solid rgba(22,163,74,0.18);border-radius:3px;padding:2px 9px;font-size:10px;color:var(--g4);font-family:'DM Mono',monospace;}
.profile-stats{display:flex;gap:20px;margin-bottom:16px;}
.pstat{text-align:center;}
.pstat-num{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3);}
.pstat-label{font-size:10px;color:var(--muted);}
.profile-links{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
.profile-link{display:flex;align-items:center;gap:5px;background:var(--s1);border:1.5px solid var(--border2);border-radius:5px;padding:5px 10px;font-size:11px;color:var(--muted);text-decoration:none;transition:all 0.2s;cursor:pointer;}
.profile-link:hover{border-color:var(--g3);color:var(--g3);}
.profile-fields{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0;padding:16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;}
.pfield{display:flex;flex-direction:column;gap:2px;}
.pfield-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);letter-spacing:1.5px;text-transform:uppercase;}
.pfield-value{font-size:12px;color:var(--white);}
.profile-actions{display:flex;gap:7px;margin-bottom:20px;}
.btn-follow{background:var(--g2);border:none;border-radius:6px;padding:8px 20px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-follow:hover{background:var(--g3);}
.btn-follow.following{background:transparent;border:1.5px solid var(--border);color:var(--muted);}
.btn-dm-profile{background:transparent;border:1.5px solid var(--border);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;}
.btn-dm-profile:hover{border-color:var(--g3);color:var(--g3);}

/* EDIT PROFILE */
.edit-section{background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:20px;margin-bottom:12px;}
.edit-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.edit-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.edit-avatar-row{display:flex;align-items:flex-start;gap:14px;margin-bottom:14px;}
.edit-avatar-big{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;color:var(--bg);flex-shrink:0;position:relative;cursor:pointer;overflow:hidden;border:2.5px solid rgba(34,197,94,0.3);transition:border-color 0.2s;}
.edit-avatar-big:hover{border-color:var(--g3);}
.edit-avatar-big img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:50%;}
.edit-avatar-big .ava-upload-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;border-radius:50%;font-size:20px;pointer-events:none;}
.edit-avatar-big:hover .ava-upload-overlay{opacity:0;}
.edit-avatar-big.has-photo .ava-upload-overlay{display:none!important;}
#edit-ava-emoji{position:relative;z-index:1;line-height:1;pointer-events:none;}
.emoji-picker{display:flex;gap:5px;flex-wrap:wrap;}
.emoji-opt{width:32px;height:32px;border-radius:8px;border:2px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all 0.2s;background:var(--s2);}
.emoji-opt:hover,.emoji-opt.selected{border-color:var(--g3);background:rgba(22,163,74,0.12);}
.emoji-opt.premium-emoji{position:relative;}
.emoji-opt.premium-emoji::after{content:'⭐';position:absolute;top:-4px;right:-4px;font-size:8px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;width:12px;height:12px;display:flex;align-items:center;justify-content:center;padding:0;}
/* Media upload improved */
.media-upload-bar{display:flex;gap:8px;align-items:center;padding:8px 0;}
.media-btn{display:flex;align-items:center;gap:5px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.media-btn:hover{border-color:var(--g3);color:var(--g3);}
.media-btn input{display:none;}
.media-btn .media-btn-icon{font-size:16px;}

/* DM */
.dm-thread{display:flex;flex-direction:column;height:380px;}
.dm-msgs{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:7px;padding-bottom:6px;}
.dm-msg{display:flex;flex-direction:column;max-width:75%;}
.dm-msg.mine{align-self:flex-end;align-items:flex-end;}
.dm-msg.theirs{align-self:flex-start;}
.dm-bubble-g{padding:9px 13px;border-radius:12px;font-size:13px;line-height:1.5;}
.dm-msg.mine .dm-bubble-g{background:var(--g2);color:var(--bg);border-bottom-right-radius:3px;}
.dm-msg.theirs .dm-bubble-g{background:var(--s2);border:1px solid var(--border2);border-bottom-left-radius:3px;}
.dm-time{font-size:9px;color:var(--muted);margin-top:2px;font-family:'DM Mono',monospace;}
.dm-input-row{display:flex;gap:7px;margin-top:10px;border-top:1px solid var(--border2);padding-top:10px;}

/* ELITE GOLD ACTIONS */
.elite-action { border-color: #d4af37 !important; color: #f5c842 !important; background: rgba(212,175,55,0.08) !important; }
.elite-action:hover { border-color: #f5c842 !important; box-shadow: 0 0 12px rgba(212,175,55,0.3) !important; }
.elite-action.active { background: rgba(212,175,55,0.15) !important; }
.plan-elite-action { border-color: #d4af37 !important; color: #f5c842 !important; }
.badge-elite-gold { color: #f5c842; text-shadow: 0 0 8px rgba(212,175,55,0.5); }

/* GROUP CARDS */
.group-card { background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer; }
.group-card:hover { border-color:rgba(34,197,94,0.35);transform:translateY(-2px);box-shadow:0 12px 36px rgba(0,0,0,0.4); }
.group-banner { height:90px;display:flex;align-items:center;justify-content:center;font-size:36px;position:relative;background:linear-gradient(135deg,var(--s2),var(--s3)); }
.group-body { padding:14px 16px; }
.group-name { font-size:15px;font-weight:700;margin-bottom:4px; }
.group-desc { font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:10px; }
.group-footer { display:flex;align-items:center;justify-content:space-between; }
.group-meta { font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2); }

/* MEDIA PREVIEW */
.media-preview-item { display:flex;align-items:center;gap:8px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:8px 12px;margin-top:6px;font-size:12px;color:var(--muted); }
.media-preview-item img, .media-preview-item video { max-width:100px;max-height:70px;border-radius:4px;object-fit:cover; }
.media-preview-item .remove-media { cursor:pointer;color:#f87171;margin-left:auto; }

/* POST MEDIA */
.post-media { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px;object-fit:cover; }
.post-media-video { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px; }

/* REPORT BTN */
.btn-report { background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 10px;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif; }
.btn-report:hover { border-color:#f87171;color:#f87171; }

/* CONTACT ADMIN BTN (ELITE in profile) */
.btn-contact-admin { background:linear-gradient(135deg,rgba(212,175,55,0.15),rgba(245,200,66,0.1));border:1.5px solid rgba(212,175,55,0.4);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:#f5c842;transition:all 0.2s; }
.btn-contact-admin:hover { border-color:#f5c842;box-shadow:0 0 12px rgba(212,175,55,0.25); }
.follow-list{display:flex;flex-direction:column;gap:7px;}
.follow-item{display:flex;align-items:center;gap:9px;padding:10px 12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;transition:all 0.2s;}
.follow-item:hover{border-color:rgba(34,197,94,0.2);}
.follow-item-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;}
.follow-item-name{font-size:13px;font-weight:700;flex:1;}
.follow-item-sub{font-size:11px;color:var(--muted);}
.btn-dm-list{background:transparent;border:1.5px solid var(--border2);border-radius:5px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;flex-shrink:0;}
.btn-dm-list:hover{border-color:var(--g3);}
.btn-follow-list{background:var(--g2);border:none;border-radius:5px;padding:5px 10px;font-size:11px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-follow-list:hover{background:var(--g3);}
.btn-follow-list.following{background:transparent;border:1px solid var(--border);color:var(--muted);}

/* IA BOOST */
.boost-type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:0;}
.boost-type-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:8px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;font-size:22px;}
.boost-type-card:hover,.boost-type-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.boost-type-card span{display:block;font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;}
.boost-type-card.selected span{color:var(--g3);}

/* UPGRADE */
.upgrade-strip{background:rgba(22,163,74,0.05);border:1.5px solid rgba(22,163,74,0.14);border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:14px;}
.upgrade-strip h4{font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px;}
.upgrade-strip p{font-size:11px;color:var(--muted);}

/* DOTS */
.dots{display:inline-flex;gap:3px;align-items:center;}
.dots span{width:5px;height:5px;border-radius:50%;background:var(--g3);animation:bounce 1.2s ease infinite;}
.dots span:nth-child(2){animation-delay:.2s;}
.dots span:nth-child(3){animation-delay:.4s;}

/* TOAST */
#toast-container{position:fixed;bottom:22px;right:22px;z-index:9999;display:flex;flex-direction:column;gap:7px;pointer-events:none;}
.toast-g{background:var(--s2);border:1.5px solid var(--border);border-radius:10px;padding:11px 16px;font-size:13px;font-weight:600;color:var(--white);display:flex;align-items:center;gap:7px;box-shadow:0 8px 30px rgba(0,0,0,0.5);pointer-events:auto;animation:toastIn 0.4s ease both;min-width:200px;}
.toast-g.success{border-color:rgba(22,163,74,0.4);}

/* ── NOUVELLES FONCTIONNALITÉS ── */

/* ANALYTICS DASHBOARD */
.analytics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;transition:all 0.2s;}
.stat-card:hover{border-color:rgba(34,197,94,0.25);}
.stat-card-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.stat-card-value{font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3);line-height:1;}
.stat-card-sub{font-size:11px;color:var(--muted);margin-top:3px;}
.stat-card-trend{font-size:11px;font-weight:700;margin-top:5px;}
.stat-card-trend.up{color:#4ade80;}
.stat-card-trend.down{color:#f87171;}
.chart-wrap{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:18px;margin-bottom:16px;}
.chart-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.mini-chart{display:flex;align-items:flex-end;gap:4px;height:60px;}
.mini-bar{flex:1;background:var(--g2);border-radius:3px 3px 0 0;opacity:0.7;transition:opacity 0.2s;cursor:pointer;}
.mini-bar:hover{opacity:1;}
.mini-chart-labels{display:flex;gap:4px;margin-top:5px;}
.mini-chart-labels span{flex:1;font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);text-align:center;}

/* BOOST TOKENS / CREDITS */
.credits-bar{background:var(--s1);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
.credits-info{display:flex;align-items:center;gap:8px;}
.credits-icon{font-size:20px;}
.credits-count{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--gold);line-height:1;}
.credits-label{font-size:11px;color:var(--muted);}
.btn-buy-credits{background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,179,0,0.1));border:1.5px solid rgba(255,215,0,0.4);border-radius:6px;padding:7px 16px;font-size:12px;font-weight:700;cursor:pointer;color:var(--gold);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-buy-credits:hover{box-shadow:0 0 12px rgba(255,215,0,0.3);}
.boost-options{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;}
.boost-opt{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s;}
.boost-opt:hover,.boost-opt.selected{border-color:var(--gold);background:rgba(255,215,0,0.04);}
.boost-opt-icon{font-size:24px;margin-bottom:5px;}
.boost-opt-name{font-size:12px;font-weight:700;color:var(--g5);margin-bottom:3px;}
.boost-opt-cost{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);}
.boost-opt-desc{font-size:10px;color:var(--muted);margin-top:4px;}

/* A/B TEST IA */
.ab-compare{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.ab-side{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;}
.ab-side-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;margin-bottom:7px;}
.ab-side-label.a{color:#4ade80;}
.ab-side-label.b{color:#60a5fa;}
.ab-result{background:var(--s2);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px;margin-top:12px;}
.ab-winner{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);margin-bottom:6px;}
.ab-analysis{font-size:12px;color:#7a9a82;line-height:1.8;white-space:pre-wrap;}

/* LEADERBOARD */
.leaderboard-list{display:flex;flex-direction:column;gap:8px;}
.lb-item{display:flex;align-items:center;gap:12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:12px 16px;transition:all 0.2s;}
.lb-item:hover{border-color:rgba(34,197,94,0.2);}
.lb-item.top1{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.03);}
.lb-item.top2{border-color:rgba(192,192,192,0.35);}
.lb-item.top3{border-color:rgba(205,127,50,0.35);}
.lb-rank{font-family:'Bebas Neue',sans-serif;font-size:22px;width:30px;text-align:center;flex-shrink:0;}
.lb-item.top1 .lb-rank{color:var(--gold);}
.lb-item.top2 .lb-rank{color:#c0c0c0;}
.lb-item.top3 .lb-rank{color:#cd7f32;}
.lb-info{flex:1;}
.lb-name{font-size:14px;font-weight:700;margin-bottom:2px;}
.lb-sub{font-size:11px;color:var(--muted);}
.lb-score{font-family:'DM Mono',monospace;font-size:13px;color:var(--g3);font-weight:700;text-align:right;}
.lb-medal{font-size:18px;}

/* RÉACTIONS ENRICHIES */
.reactions-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px;padding-top:8px;border-top:1px solid var(--border2);}
.react-btn{display:flex;align-items:center;gap:3px;background:transparent;border:1.5px solid var(--border2);border-radius:20px;padding:4px 10px;font-size:13px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;position:relative;}
.react-btn:hover{transform:scale(1.08);}
.react-btn.active-fire{border-color:#f97316;color:#f97316;background:rgba(249,115,22,0.1);}
.react-btn.active-money{border-color:#4ade80;color:#4ade80;background:rgba(74,222,128,0.1);}
.react-btn.active-bulb{border-color:#facc15;color:#facc15;background:rgba(250,204,21,0.1);}
.react-btn.active-rocket{border-color:#818cf8;color:#818cf8;background:rgba(129,140,248,0.1);}
.react-btn.active-crown{border-color:#ffd700;color:#ffd700;background:rgba(255,215,0,0.1);}
.react-btn.active-gem{border-color:#22d3ee;color:#22d3ee;background:rgba(34,211,238,0.1);}
.react-btn.active-clap{border-color:#fb923c;color:#fb923c;background:rgba(251,146,60,0.1);}
.react-btn.active-eyes{border-color:#a78bfa;color:#a78bfa;background:rgba(167,139,250,0.1);}
.react-btn.active-star{border-color:#ffd700;color:#ffd700;background:rgba(255,215,0,0.1);}
.react-btn.active-zap{border-color:#86efac;color:#86efac;background:rgba(134,239,172,0.1);}
/* Réactions premium lockées */
.react-btn.premium-lock{opacity:0.5;}
.react-btn.premium-lock::after{content:'🔒';position:absolute;top:-5px;right:-5px;font-size:9px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;width:14px;height:14px;display:flex;align-items:center;justify-content:center;padding:0;}
.react-premium-tip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a0f00,#2a1800);border:1px solid rgba(255,215,0,0.4);border-radius:7px;padding:6px 10px;font-size:10px;color:var(--gold);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:10;font-family:'DM Mono',monospace;}
.react-btn.premium-lock:hover .react-premium-tip{opacity:1;}
.react-count{font-family:'DM Mono',monospace;font-size:10px;}

/* CALENDRIER ÉDITORIAL */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:14px;}
.cal-day{min-height:64px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:6px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);cursor:pointer;transition:all 0.2s;}
.cal-day:hover{border-color:rgba(34,197,94,0.25);}
.cal-day.has-post{border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.04);}
.cal-day.today{border-color:var(--g3);background:rgba(34,197,94,0.08);}
.cal-day .cal-num{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:4px;}
.cal-day .cal-post-dot{width:6px;height:6px;border-radius:50%;background:var(--g3);display:inline-block;margin:1px;}
.cal-header-days{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:6px;}
.cal-header-days span{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);text-align:center;letter-spacing:1px;}
.slot-chip{display:inline-flex;align-items:center;gap:5px;background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:3px 8px;font-size:11px;color:var(--g4);margin:2px;cursor:pointer;font-family:'DM Mono',monospace;transition:all 0.2s;}
.slot-chip:hover,.slot-chip.selected{background:rgba(34,197,94,0.15);border-color:var(--g3);color:var(--g3);}

/* COLLABORATIONS MATCHING */
.collab-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;}
.collab-card:hover{border-color:rgba(34,197,94,0.25);}
.collab-match-score{display:inline-flex;align-items:center;gap:5px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:3px 9px;font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);}
.collab-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.collab-ava{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--bg);flex-shrink:0;}
.collab-why{font-size:12px;color:#7a9a82;line-height:1.6;margin-bottom:10px;font-style:italic;}
.btn-collab{background:var(--g2);border:none;border-radius:6px;padding:7px 16px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-collab:hover{background:var(--g3);}

/* MOBILE PREVIEW */
.mobile-preview{background:#111;border-radius:24px;width:200px;min-height:340px;padding:12px;border:3px solid var(--border);flex-shrink:0;position:relative;overflow:hidden;}
.mobile-preview::before{content:'';position:absolute;top:8px;left:50%;transform:translateX(-50%);width:60px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;}
.mobile-screen{background:var(--s1);border-radius:16px;width:100%;height:100%;min-height:310px;padding:10px;overflow:hidden;margin-top:10px;}
.mobile-post-preview{background:var(--bg);border-radius:8px;padding:10px;font-size:10px;}
.mobile-post-preview .mob-title{font-weight:700;font-size:11px;margin-bottom:4px;color:var(--white);}
.mobile-post-preview .mob-text{color:var(--muted);font-size:10px;line-height:1.5;}
.mobile-post-preview .mob-cta{margin-top:8px;background:var(--g2);border-radius:4px;padding:5px 8px;font-size:10px;font-weight:700;color:var(--bg);display:inline-block;}
.preview-tabs{display:flex;gap:5px;margin-bottom:10px;}
.prev-tab{flex:1;background:transparent;border:1px solid var(--border2);border-radius:4px;padding:4px;font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);cursor:pointer;text-align:center;transition:all 0.2s;}
.prev-tab.active,.prev-tab:hover{border-color:var(--g3);color:var(--g3);}

/* ── PUBLICATION STEPS ── */
.pub-step-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:20px;margin-bottom:14px;transition:border-color 0.3s;}
.pub-step-card:focus-within{border-color:rgba(34,197,94,0.3);}
.pub-step-header{display:flex;align-items:flex-start;gap:14px;}
.pub-step-num{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:'DM Mono',monospace;}
.pub-step-title{font-size:14px;font-weight:700;color:var(--white);margin-bottom:2px;}
.pub-step-sub{font-size:11px;color:var(--muted);}
.pub-hint{font-size:10px;font-family:'DM Mono',monospace;padding:3px 9px;border-radius:20px;border:1px solid;transition:all 0.3s;}
.pub-hint.pending{color:var(--muted2);border-color:var(--border2);}
.pub-hint.done{color:var(--g3);border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.06);}
.pub-hint.done::before{content:'✓ ';}
.pub-tip-item{background:var(--s2);border:1px solid var(--border2);border-radius:6px;padding:7px 10px;font-size:11px;color:var(--muted);cursor:pointer;transition:all 0.2s;user-select:none;}
.pub-tip-item:hover{border-color:rgba(34,197,94,0.3);color:var(--g4);background:rgba(34,197,94,0.05);}
.pub-tag-chip{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:20px;padding:3px 10px;font-size:11px;color:var(--g4);font-family:'DM Mono',monospace;}

/* ── ONBOARDING TOOLTIP (mini aide) ── */
.ob-tooltip{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9990;width:min(520px,94vw);background:linear-gradient(135deg,#061a08,#0c2610);border:1.5px solid rgba(34,197,94,0.35);border-radius:16px;box-shadow:0 12px 48px rgba(0,0,0,0.7),0 0 40px rgba(34,197,94,0.08);animation:slideUpTooltip 0.5s cubic-bezier(.34,1.56,.64,1) both;}
.ob-tooltip.hiding{animation:slideDownTooltip 0.35s ease forwards;}
@keyframes slideUpTooltip{from{opacity:0;transform:translateX(-50%) translateY(30px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes slideDownTooltip{from{opacity:1;transform:translateX(-50%) translateY(0)}to{opacity:0;transform:translateX(-50%) translateY(20px)}}
.ob-tooltip-inner{padding:18px 20px 14px;}
.ob-tooltip-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.ob-tooltip-close{background:none;border:none;color:var(--muted2);font-size:18px;cursor:pointer;line-height:1;padding:2px 6px;border-radius:4px;transition:color 0.2s;}
.ob-tooltip-close:hover{color:var(--g3);}
.ob-steps-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;}
.ob-steps-row::-webkit-scrollbar{display:none;}
.ob-step-card{flex-shrink:0;width:130px;background:rgba(22,163,74,0.04);border:1.5px solid var(--border2);border-radius:10px;padding:12px 10px;text-align:center;cursor:pointer;transition:all 0.25s;}
.ob-step-card:hover,.ob-step-card.active{border-color:rgba(34,197,94,0.4);background:rgba(34,197,94,0.08);}
.ob-step-card.active{border-color:var(--g3);}
.ob-step-icon{font-size:24px;margin-bottom:6px;}
.ob-step-label{font-size:10px;font-weight:700;color:var(--g5);margin-bottom:4px;font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.ob-step-desc{font-size:10px;color:var(--muted);line-height:1.5;}
.ob-tooltip-footer{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:10px;border-top:1px solid var(--border2);}
.ob-progress{display:flex;gap:5px;align-items:center;}
.ob-dot{width:6px;height:6px;border-radius:50%;background:var(--muted2);transition:all 0.3s;}
.ob-dot.active{background:var(--g3);box-shadow:0 0 5px var(--g3);width:18px;border-radius:3px;}
.ob-btn-next{padding:7px 18px;background:var(--g2);border:none;border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;color:var(--bg);cursor:pointer;transition:all 0.2s;}
.ob-btn-next:hover{background:var(--g3);}

/* ── ONBOARDING MODAL (ancienne) ── */
.onboarding-overlay{position:fixed;inset:0;background:rgba(4,10,5,0.96);z-index:9998;display:flex;align-items:center;justify-content:center;}
.onboarding-overlay.hidden{display:none;}
.onboarding-box{background:var(--s1);border:1.5px solid var(--border);border-radius:20px;padding:36px;max-width:460px;width:92%;text-align:center;animation:popIn 0.4s ease;}
.onboarding-step{display:none;}
.onboarding-step.active{display:block;animation:fadeUp 0.3s ease;}
.onboarding-progress{display:flex;justify-content:center;gap:6px;margin-bottom:24px;}
.onboarding-progress-dot{width:8px;height:8px;border-radius:50%;background:var(--muted2);transition:all 0.3s;}
.onboarding-progress-dot.active{background:var(--g3);box-shadow:0 0 6px var(--g3);}
.onboarding-icon{font-size:48px;margin-bottom:10px;}
.onboarding-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--g3);margin-bottom:8px;}
.onboarding-sub{font-size:13px;color:var(--muted);margin-bottom:24px;line-height:1.7;}
.btn-onboard-next{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-onboard-next:hover{background:var(--g3);}
.btn-onboard-skip{font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;display:block;text-decoration:underline;}

/* AGENCE */
.agency-client-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;transition:all 0.2s;}
.agency-client-card:hover{border-color:rgba(34,197,94,0.2);}
.agency-client-ava{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g3));display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.agency-client-info{flex:1;}
.agency-client-name{font-size:13px;font-weight:700;margin-bottom:1px;}
.agency-client-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.agency-client-stats{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);}

@media(max-width:860px){#tab-publier .tpanel>div>div[style*="grid-template-columns:1fr 340px"]{display:block !important;}
#tab-publier [style*="position:sticky"]{position:static !important;margin-top:20px;}}
@media(max-width:600px){.analytics-grid{grid-template-columns:1fr;}.cal-day{min-height:44px;}}

/* RESPONSIVE */
@media(max-width:900px){.vitrine-grid,.reviews-grid,.plans-grid,.signup-plans{grid-template-columns:1fr 1fr;}.profile-fields{grid-template-columns:1fr 1fr;}.edit-grid{grid-template-columns:1fr;}.how-simple{flex-direction:column;}}
@media(max-width:600px){.vitrine-grid,.reviews-grid,.plans-grid,.signup-plans,.boost-type-grid{grid-template-columns:1fr;}.profile-fields{grid-template-columns:1fr;}}

#offer-popup{position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);}
#offer-popup.hidden{display:none;}
.offer-box{background:linear-gradient(135deg,#061a08,#0a2a0d);border:2px solid rgba(34,197,94,0.45);border-radius:20px;padding:24px 26px;max-width:360px;width:92%;text-align:center;box-shadow:0 0 60px rgba(34,197,94,0.18);position:relative;}
.offer-crown{font-size:36px;margin-bottom:4px;}
.offer-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;background:linear-gradient(135deg,#4ade80,#86efac);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:3px;}
.offer-sub{font-size:11px;color:#4a7a58;margin-bottom:12px;font-family:'DM Mono',monospace;}
.offer-badge{display:inline-block;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;margin-bottom:12px;letter-spacing:1px;}
.offer-desc{font-size:12px;color:#e8fef0;line-height:1.6;margin-bottom:14px;}
.offer-desc strong{color:#4ade80;}
.offer-counter{background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:12px;padding:14px;margin-bottom:22px;}
.offer-counter-num{font-family:'Bebas Neue',sans-serif;font-size:34px;color:#4ade80;line-height:1;}
.offer-counter-lbl{font-size:11px;color:#4a7a58;font-family:'DM Mono',monospace;margin-top:3px;}
.offer-cta{width:100%;padding:11px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:800;cursor:pointer;letter-spacing:1px;margin-bottom:8px;transition:.2s;}
.offer-cta:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(34,197,94,0.3);}
.offer-skip{font-size:11px;color:#2d5a38;cursor:pointer;text-decoration:underline;}
.offer-close-btn{position:absolute;top:12px;right:14px;background:none;border:none;color:#2d5a38;font-size:20px;cursor:pointer;line-height:1;padding:4px;transition:.2s;}
.offer-close-btn:hover{color:#4ade80;}
.offer-timer{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:8px 12px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:12px;color:#f87171;}
.offer-timer span{font-weight:800;font-size:14px;}
.offer-full{background:rgba(234,179,8,0.08);border:1px solid rgba(234,179,8,0.25);border-radius:12px;padding:20px;text-align:center;max-width:460px;width:92%;}
</style>
<style>
.ob-input{width:100%;padding:11px 13px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;transition:border-color 0.2s;}
.ob-input:focus{border-color:var(--g3);}
.ob-btn-next{flex:1;padding:13px;background:var(--g2);border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:var(--bg);cursor:pointer;width:100%;}
.ob-btn-back{flex:1;padding:13px;background:var(--s2);border:1.5px solid var(--border);border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--muted);cursor:pointer;}
.ob-btn-skip{width:100%;margin-top:8px;background:none;border:none;font-size:11px;color:var(--muted2);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;padding:6px;}
.av-opt{font-size:26px;cursor:pointer;padding:7px;border-radius:10px;border:2px solid var(--border2);transition:all 0.15s;display:inline-flex;}
.av-opt:hover{border-color:var(--g3);background:rgba(34,197,94,0.08);}
.av-premium{position:relative;}
.ob-goal-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:13px 16px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.2s;}
.ob-goal-card:hover{border-color:var(--g3);background:rgba(34,197,94,0.04);}
</style></head>
<body>

<div id="cursor"></div>
<div id="cursor-ring"></div>
<div class="orb o1"></div>
<div class="orb o2"></div>
<div id="toast-container"></div>

<!-- ══════════ LANDING ══════════ -->
<div id="landing">

<nav>
  <div class="logo">VIRAL<span>BOOST</span></div>
  <div class="nav-links">
    <a href="#vitrine" data-i18n="nav_vitrine">Vitrine</a>
    <a href="#plans" data-i18n="nav_plans">Abonnements</a>
    <a href="#reviews" data-i18n="nav_reviews">Avis</a>
  </div>
  <div class="nav-right">
    <button class="lang-btn" id="lang-btn" onclick="toggleLang()" title="Switch language">🇫🇷 FR</button>
    <button class="btn-g btn-ghost-g" onclick="openModal('login-modal')" data-i18n="nav_login">Connexion</button>
    <button class="btn-g btn-solid-g" onclick="openModal('signup-modal')" data-i18n="nav_join">Rejoindre →</button>
  </div>
  <button class="hamburger" id="hamburger-btn" onclick="toggleMobileMenu()" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
</nav>
<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobile-menu">
  <a href="#vitrine" onclick="closeMobileMenu()" data-i18n="mob_vitrine">📊 Vitrine</a>
  <a href="#plans" onclick="closeMobileMenu()" data-i18n="mob_plans">💎 Abonnements</a>
  <a href="#reviews" onclick="closeMobileMenu()" data-i18n="mob_reviews">⭐ Avis</a>
  <div class="mobile-btns" id="mob-btns-guest">
    <button class="btn-g btn-ghost-g" onclick="closeMobileMenu();openModal('login-modal')">Connexion</button>
    <button class="btn-g btn-solid-g" onclick="closeMobileMenu();openModal('signup-modal')">Rejoindre →</button>
  </div>
  <div class="mobile-btns" id="mob-btns-user" style="display:none">
    <button class="btn-g btn-ghost-g" onclick="closeMobileMenu();logout()" style="color:#f87171;border-color:rgba(248,113,113,0.3)">🚪 Quitter</button>
  </div>
</div>

<section class="hero">

  <!-- BADGE PLATEFORME -->
  <div style="display:inline-block;background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(74,222,128,0.08));border:1px solid rgba(34,197,94,0.3);border-radius:20px;padding:8px 20px;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;color:var(--g3);margin-bottom:24px;animation:fadeUp 0.4s ease both;" data-i18n="hero_badge">
    📢 PLATEFORME N°1 DE PUBLICITÉ DIGITALE
  </div>

  <!-- GROS CTA -->
  <div style="display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:20px;">
    <button class="btn-hero-big btn-hero-solid" onclick="startDemoPublish()" style="font-size:18px;padding:18px 52px;box-shadow:0 0 60px rgba(34,197,94,0.5);letter-spacing:0.5px" data-i18n="hero_cta1">
      ⚡ Commencer — Publie ta pub →
    </button>
    <button onclick="openModal('login-modal')" style="background:rgba(34,197,94,0.08);border:1.5px solid rgba(34,197,94,0.25);border-radius:12px;padding:12px 32px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:700;color:var(--g3);cursor:pointer">
      🔑 J'ai déjà un compte
    </button>
    <span style="font-size:12px;color:var(--muted)" data-i18n="hero_nocard">Gratuit · Sans carte bancaire · 30 secondes</span>
  </div>

  <!-- 3 PREUVES COURTES -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:640px;margin:0 auto 16px;">
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">📢</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat1_title">Publie ta pub</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat1_sub">Visible immédiatement par tous</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🤝</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat2_title">Trouve des collabs</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat2_sub">Matching avec des créateurs</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🚀</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat3_title">Développe ta notoriété</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat3_sub">Votes, partages, visibilité</div>
      </div>
    </div>
  </div>

  <!-- 3 CARTES SUPPLÉMENTAIRES -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:640px;margin:0 auto 48px;">
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">💬</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat4_title">Chat communautaire</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat4_sub">Échange avec d'autres créateurs</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🏆</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat5_title">Classement des projets</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat5_sub">Les meilleurs montent en top</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🎯</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat6_title">Audience ciblée</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat6_sub">Créateurs, entrepreneurs, fondateurs</div>
      </div>
    </div>
  </div>

  <!-- CARTE MONETISATION -->
  <div style="max-width:640px;margin:0 auto 48px;background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:18px 22px;display:flex;align-items:center;gap:14px">
    <span style="font-size:32px;flex-shrink:0">💰</span>
    <div>
      <div style="font-size:13px;font-weight:800;color:#ffd700;margin-bottom:4px" data-i18n="mono_title">À partir de 1 000 abonnés — génère des revenus</div>
      <div style="font-size:11px;color:var(--muted);line-height:1.6" data-i18n="mono_sub">Active les soldes sur ton profil et monétise ta communauté directement depuis la plateforme.</div>
    </div>
  </div>

  <!-- FORMULAIRE PUB HERO -->
  <div class="hero-ad-box">
    <h3 data-i18n="hero_form_title">📢 PUBLIE TA PUBLICITÉ EN 30 SECONDES</h3>
    <div class="hero-ad-form">
      <input type="text" id="hero-ad-name" placeholder="Nom de ton produit / service *" maxlength="60"/>
      <select id="hero-ad-type">
        <option value="">Catégorie...</option>
        <option value="saas">🚀 SaaS / Logiciel</option>
        <option value="ecommerce">🛍️ E-commerce / Boutique</option>
        <option value="app">📱 Application mobile</option>
        <option value="tiktok">🎵 TikTok / Créateur</option>
        <option value="instagram">📸 Instagram / Influenceur</option>
        <option value="service">💼 Service / Freelance</option>
        <option value="site">🌐 Site web</option>
        <option value="autre">📦 Autre</option>
      </select>
      <textarea id="hero-ad-desc" placeholder="Décris ta pub en 2 phrases : ce que tu proposes, à qui, pourquoi c'est top..."></textarea>
      <button class="btn-hero-ad" onclick="heroPublishAd()" data-i18n="hero_form_btn">📢 Publier ma publicité gratuitement →</button>
    </div>
    <div style="text-align:center;margin-top:8px;font-size:11px;color:var(--muted2)" data-i18n="hero_form_note">✓ Gratuit · Visible immédiatement · Pas de carte requise</div>
  </div>

  <!-- LIEN CONNEXION DISCRET -->
  <p style="text-align:center;margin-top:20px;font-size:12px;color:var(--muted)" data-i18n="hero_login_link">Déjà inscrit ? <a onclick="openModal('login-modal')" style="color:var(--g3);cursor:pointer;text-decoration:underline">Se connecter</a></p>

</section>

<!-- FLUX PUBLIC (visible sans compte) -->
<section class="public-feed-section" id="public-feed">
  <div style="max-width:660px;margin:0 auto">
    <div style="text-align:center;margin-bottom:24px">
      <span class="sec-label" data-i18n="sec_feed">Fil public</span>
      <h2 class="section-title">Pubs <em>en direct</em></h2>
      <p class="section-sub" style="margin:0 auto">Les dernières publicités de la communauté — visibles par tous.</p>
    </div>
    <div id="public-feed-list" class="public-feed-blur">
      <!-- Les posts publics seront injectés ici -->
    </div>
    <div style="text-align:center;margin-top:28px">
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Rejoindre & publier ta pub →</button>
    </div>
  </div>
</section>

<section class="vitrine-section" id="vitrine">
  <div style="max-width:1100px;margin:0 auto 36px">
    <span class="sec-label" data-i18n="sec_vitrine">Vitrine communautaire</span>
    <h2 class="section-title">Projets <em>du moment</em></h2>
    <p class="section-sub">Votez pour vos favoris. Les plus votés gagnent en visibilité.</p>
    <div class="filters-row">
      <button class="f-btn active" onclick="filterLandingVitrine(this,'all')">Tous</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'site')">🌐 Sites</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'app')">📱 Apps</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'tiktok')">🎵 TikTok</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'saas')">🚀 SaaS</button>
    </div>
  </div>
  <div class="vitrine-grid" id="landing-vitrine-grid" style="max-width:1100px;margin:0 auto"></div>
</section>

<section class="plans-section" id="plans">
  <div style="text-align:center;margin-bottom:48px">
    <span class="sec-label" data-i18n="sec_plans">Abonnements</span>
    <h2 class="section-title">Choisis ton <em>niveau</em></h2>
    <p class="section-sub" style="margin:0 auto">Commence gratuitement. Evolue quand tu veux.</p>
  </div>
  <div class="plans-grid" id="landing-plans">

    <div class="plan-card">
      <div class="plan-name">FREE</div>
      <div class="plan-price">0<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">Gratuit pour toujours</div>
      <div class="plan-desc">Pour découvrir ViralBoost</div>
      <ul class="plan-features">
        <li>5 publications / jour</li>
        <li>3 messages chat / jour</li>
        <li>Vitrine 24h</li>
        <li>Profil public complet</li>
        <li>Accès communauté & collabs</li>
        <li>50 ViralCrédits à l'inscription</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="openModal('signup-modal')">Commencer gratuitement</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">STARTER</div>
      <div class="plan-price">3<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour commencer à propulser</div>
      <ul class="plan-features">
        <li>10 publications / jour</li>
        <li>10 messages chat / jour</li>
        <li>Vitrine 7 jours</li>
        <li>Coach IA 20 req/mois</li>
        <li>DMs illimités</li>
        <li>Badge Starter</li>
        <li>+200 ViralCrédits/mois</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('starter')">Choisir Starter &rarr;</button>
    </div>

    <div class="plan-card recommended">
      <div class="plan-badge">&#11088; POPULAIRE</div>
      <div class="plan-name">PRO</div>
      <div class="plan-price">14,99<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour les créateurs sérieux</div>
      <ul class="plan-features">
        <li>Publications illimitées</li>
        <li>Chat mondial illimité</li>
        <li>Vitrine 30j prioritaire</li>
        <li>IA Boost illimité</li>
        <li>Stats avancées</li>
        <li>Badge Pro vérifié</li>
        <li>Affiliation 30%</li>
        <li>+500 ViralCrédits/mois</li>
      </ul>
      <button class="btn-plan-g btn-plan-solid-g" onclick="startPayment('pro')">Choisir Pro &rarr;</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">ELITE</div>
      <div class="plan-price">39,99<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour dominer ton marché</div>
      <ul class="plan-features">
        <li>Tout du plan Pro</li>
        <li>Vitrine permanente + épinglée</li>
        <li>🏆 Badge Elite doré</li>
        <li>Priorité #1 dans le matching IA</li>
        <li>Créateur de groupes de discussion</li>
        <li>Rapport mensuel de performance</li>
        <li>1 appel stratégique/mois</li>
        <li>Messages privés à l'admin</li>
        <li>Likes/partages dorés</li>
        <li>+1500 ViralCrédits/mois</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('elite')">Choisir Elite &rarr;</button>
    </div>

  </div>
</section>

<section style="padding:80px 5%;position:relative;z-index:1;" id="reviews">
  <div style="max-width:700px;margin:0 auto;text-align:center">
    <span class="sec-label">La communauté</span>
    <h2 class="section-title">Rejoins les <em>premiers créateurs</em></h2>
    <p class="section-sub" style="margin:0 auto 40px">ViralBoost est en lancement. Pas de faux avis — rejoins la communauté, publie ton projet, et si tu es satisfait, on sera ravis de mettre ton témoignage en avant.</p>

    <!-- 3 raisons de rejoindre -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:40px;text-align:left">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px 16px">
        <div style="font-size:24px;margin-bottom:8px">🎯</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:4px">Plateforme dédiée</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6">Contrairement aux réseaux classiques, ici tout le monde cherche à faire connaître son projet.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px 16px">
        <div style="font-size:24px;margin-bottom:8px">⚡</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:4px">Gratuit pour commencer</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6">Crée ton compte, publie ta pub et accède au matching IA sans sortir ta carte.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px 16px">
        <div style="font-size:24px;margin-bottom:8px">🛠️</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:4px">Tu façonnes la plateforme</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6">En phase de lancement, chaque retour est pris en compte directement par le fondateur.</div>
      </div>
    </div>

    <!-- CTA final -->
    <div style="background:linear-gradient(135deg,rgba(21,128,61,0.15),rgba(74,222,128,0.05));border:1.5px solid rgba(34,197,94,0.3);border-radius:16px;padding:36px 32px">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--g3);margin-bottom:8px">PRÊT À TE LANCER ?</div>
      <div style="font-size:13px;color:var(--muted);line-height:1.8;margin-bottom:24px">Inscription gratuite · Sans carte bancaire · Accès immédiat à tous les outils</div>
      <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" style="font-size:16px;padding:15px 44px;box-shadow:0 0 40px rgba(34,197,94,0.4)">🚀 Créer mon compte gratuitement →</button>
    </div>
  </div>
</section>

<!-- SECTION COLLABORATION MISE EN AVANT -->
<section style="padding:80px 5%;position:relative;z-index:1;background:rgba(11,26,13,0.6);">
  <div style="max-width:900px;margin:0 auto;text-align:center">
    <span class="sec-label">Matching IA</span>
    <h2 class="section-title">Trouve ton <em>prochain partenaire</em></h2>
    <p class="section-sub" style="margin:0 auto 40px">L'algorithme analyse vos profils, projets et objectifs pour vous connecter automatiquement avec les créateurs les plus compatibles.</p>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:32px">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">🧠</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Score de compatibilité</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">L'IA analyse ton profil et te propose les partenaires les plus compatibles avec un score de matching.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">💬</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Contact direct</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">Envoie un DM directement depuis la fiche de matching. Pas d'intermédiaire, contact immédiat.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">🎯</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Ciblé par niche</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">Filtre par secteur, objectif et disponibilité pour des collaborations vraiment pertinentes.</div>
      </div>
    </div>
    <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')">🤝 Découvrir mes matches →</button>
  </div>
</section>

<section class="cta-section">
  <h2>REJOINS LA COMMUNAUTÉ</h2>
  <p style="font-size:15px;color:var(--muted);margin:8px 0 28px">Plateforme en lancement — sois parmi les premiers créateurs à bord.</p>
  <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" data-i18n="hero_cta1">Créer mon compte →</button>
</section>

<footer>
  <div class="footer-logo">VIRALBOOST</div>
  <p>© 2025 ViralBoost — Le réseau social des créateurs</p>
  <p>Stripe · Claude AI · WebSocket temps réel</p>
</footer>
</div><!-- /landing -->


<!-- ══════════ APP ══════════ -->
<div id="app">
  <div class="app-bar">
    <div class="app-logo">VB</div>
    <div class="app-tabs">
      <button class="app-tab" onclick="showAppTab('feed',this)">🏠 Fil</button>
      <button class="app-tab" onclick="showAppTab('vitrine',this)">✨ Vitrine</button>
      <button class="app-tab active" onclick="showAppTab('publier',this)">➕ Publier</button>
      <button class="app-tab" onclick="showAppTab('chat-global',this)" id="tab-btn-chat">💬 Chat <span class="notif-dot" id="chat-notif" style="display:none"></span></button>
      <button class="app-tab" onclick="showAppTab('groupes',this)" id="tab-btn-groups">👥 Groupes</button>
      <button class="app-tab" onclick="showAppTab('stats',this)">📊 Stats</button>
      <button class="app-tab" onclick="showAppTab('boost-credits',this)">⚡ Boost</button>
      <button class="app-tab" onclick="showAppTab('leaderboard',this)">🏆 Top</button>
      <button class="app-tab" onclick="showAppTab('collab',this)">🤝 Collabs</button>
      <button class="app-tab" onclick="showAppTab('calendrier',this)">📅 Agenda</button>
      <button class="app-tab" onclick="showAppTab('ab-test',this)">🔬 A/B Test</button>
      <button class="app-tab" onclick="showAppTab('profil',this)">👤 Profil</button>
      <button class="app-tab" onclick="showAppTab('abonnes',this)">🔔 Abonnés</button>
      <button class="app-tab" onclick="showAppTab('ia-boost',this)">🤖 IA Boost</button>
    </div>
    <div class="app-right">
      <span class="plan-chip" id="app-plan-chip">FREE</span>
      <button class="btn-out-g" onclick="showAppTab('boost-credits',null);switchCreditsTab('shop',document.getElementById('ctab-shop'))" style="border-color:rgba(255,215,0,0.3);color:var(--gold);display:flex;align-items:center;gap:5px">🛒 <span style="font-family:'DM Mono',monospace;font-size:11px;font-weight:700" id="header-credits">0</span><span style="font-size:9px;opacity:0.7">⚡</span></button>
      <button id="btn-wallpaper" class="btn-out-g" onclick="openWallpaperModal()" style="display:none">🖼️</button>
      <button id="btn-admin-dm" class="btn-out-g" onclick="openAdminDM()" style="display:none;border-color:rgba(255,215,0,0.3);color:var(--gold)">📩 Admin</button>
      <div class="user-chip" onclick="showAppTab('profil',null)">
        <div class="user-chip-ava" id="app-user-ava">?</div>
        <span class="user-chip-name" id="app-user-name">...</span>
      </div>
      <button class="btn-out-g" onclick="logout()">Quitter</button>
    </div>
  </div>

  <div style="max-width:1160px;margin:0 auto;padding:0 16px">

    <!-- FIL -->
    <div class="tpanel active" id="tab-feed">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <!-- INTRO COMPOSER -->
        <div class="composer-intro">
          <div class="composer-intro-label" data-i18n="comp_label">✦ FIL COMMUNAUTAIRE</div>
          <h2 class="composer-intro-title" data-i18n="comp_title">Partage à la communauté</h2>
          <p class="composer-intro-sub" data-i18n="comp_sub">Projets, idées, questions — ta voix compte ici.</p>
        </div>

        <!-- COMPOSER TWEET-STYLE -->
        <div class="publish-box" id="publish-box">
          <div class="publish-top">
            <div class="pub-ava" id="feed-pub-ava">?</div>
            <div class="pub-input-wrap">
              <textarea class="pub-text" id="feed-text" placeholder="Partage ton projet à la communauté…" rows="2" oninput="updateCharCount(this);autoGrowTA(this)"></textarea>
              <!-- Pills type (cachées par défaut, visibles au focus) -->
              <div class="pub-type-row" id="pub-type-row">
                <button class="pub-type-pill active" onclick="selectPubType(this,'')" data-type="">💬 Post</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'site')" data-type="site">🌐 Site</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'app')" data-type="app">📱 App</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'saas')" data-type="saas">🚀 SaaS</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'tiktok')" data-type="tiktok">🎵 TikTok</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'instagram')" data-type="instagram">📸 Insta</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'ecommerce')" data-type="ecommerce">🛍️ Shop</button>
              </div>
              <!-- Champ projet (visible si type sélectionné) -->
              <div class="pub-proj-wrap" id="pub-proj-wrap" style="display:none">
                <input type="text" id="feed-proj-name" placeholder="Nom du projet (optionnel)"/>
              </div>
              <!-- Bouton trigger URL -->
              <button class="pub-url-trigger" id="pub-url-trigger" onclick="toggleUrlField()" type="button" data-i18n="btn_addlink">🔗 Ajouter un lien</button>
              <!-- Champ URL caché par défaut -->
              <div class="pub-url-wrap" id="pub-url-wrap" style="display:none">
                <div class="pub-url-inner">
                  <span class="pub-url-icon">🔗</span>
                  <input type="url" id="feed-url" placeholder="https://ton-site.com" autocomplete="off" spellcheck="false"/>
                  <button class="pub-url-close" onclick="closeUrlField()" type="button">✕</button>
                </div>
              </div>
            </div>
          </div>
          <select id="feed-proj-type" style="display:none"><option value="">Sans projet</option><option value="site">🌐 Site web</option><option value="app">📱 App</option><option value="saas">🚀 SaaS</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option><option value="ecommerce">🛍️ E-commerce</option></select>
          <div id="feed-media-preview" class="media-preview-row" style="display:none;padding:0 16px;margin-left:50px"></div>
          <div class="pub-divider"></div>
          <div class="pub-actions">
            <div class="pub-right">
              <span class="pub-char-count" id="pub-char-count" style="opacity:0">0/500</span>
              <span class="pub-limit" id="feed-limit-info">FREE · 1/h</span>
              <button class="btn-publish" onclick="publishPost()" data-i18n="btn_publish">Publier</button>
            </div>
          </div>
        </div>
        <div class="feed-tabs">
          <button class="feed-tab active" onclick="switchFeed('all',this)" data-i18n="tab_all">Tout</button>
          <button class="feed-tab" onclick="switchFeed('following',this)" data-i18n="tab_following">Abonnements</button>
          <button class="feed-tab" onclick="switchFeed('top',this)" data-i18n="tab_top">Top du jour</button>
        </div>
        <div id="feed-list"></div>
      </div>
    </div>

    <!-- VITRINE APP -->
    <div class="tpanel" id="tab-vitrine">
      <div style="padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div><h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">VITRINE COMMUNAUTAIRE</h2><p style="font-size:12px;color:var(--muted)">Projets partagés par la communauté</p></div>
          <div class="filters-row" style="margin:0">
            <button class="f-btn active" onclick="filterAppVitrine(this,'all')">Tous</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'site')">🌐</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'app')">📱</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'tiktok')">🎵</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'saas')">🚀</button>
          </div>
        </div>
        <div class="vitrine-grid" id="app-vitrine-grid"></div>
      </div>
    </div>

    <!-- PUBLIER -->
    <div class="tpanel" id="tab-publier">
      <div style="max-width:800px;margin:0 auto;padding:28px 0">

        <!-- CHOIX TYPE -->
        <div id="pub-type-chooser" style="margin-bottom:28px">
          <p style="font-size:13px;color:var(--muted);margin-bottom:16px;letter-spacing:0.5px">Que veux-tu publier ?</p>

          <!-- INTRO CARD -->
          <div id="pub-page-intro" style="display:flex;align-items:flex-start;gap:14px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.12);border-radius:14px;padding:16px 18px;margin-bottom:20px;animation:fadeUp 0.4s ease both">
            <div style="font-size:26px;line-height:1;flex-shrink:0">✨</div>
            <div>
              <div style="font-size:13px;font-weight:700;color:var(--g4);margin-bottom:4px">Publie en 30 secondes</div>
              <div style="font-size:12px;color:var(--muted);line-height:1.6">Choisis un format ci-dessous, remplis les champs, et ta publication est visible par toute la communauté. <span style="color:var(--g3)">100% gratuit.</span></div>
            </div>
            <button onclick="document.getElementById('pub-page-intro').style.display='none'" style="background:none;border:none;color:var(--muted2);font-size:18px;cursor:pointer;flex-shrink:0;padding:0;line-height:1;margin-left:4px">×</button>
          </div>

          <!-- MINI INTRO TOOLTIP -->
          <div id="pub-type-intro" style="display:none;margin-bottom:18px;padding:16px 18px;border-radius:14px;animation:fadeUp 0.25s ease both;transition:all 0.2s;position:relative">
            <div id="pub-intro-emoji" style="font-size:28px;margin-bottom:6px"></div>
            <div id="pub-intro-title" style="font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;margin-bottom:4px"></div>
            <div id="pub-intro-text" style="font-size:12px;line-height:1.7;color:var(--g5);margin-bottom:12px"></div>
            <div id="pub-intro-tags" style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px"></div>
            <button id="pub-intro-confirm" style="width:100%;padding:11px;border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:#0a0a0a;transition:all 0.2s" onclick="confirmPubTypeChoice()">
              C'est parti →
            </button>
          </div>

          <div id="pub-type-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">

            <!-- PUB — style simple vert -->
            <div onclick="previewPubType('pub')" class="pub-type-card ptc-pub" id="ptc-pub" style="border-color:rgba(34,197,94,0.25);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(34,197,94,0.2),rgba(34,197,94,0.05));font-size:22px">📢</div>
                <div class="ptc-name" style="font-size:15px">Pub</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(34,197,94,0.1);color:var(--g4);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">SIMPLE</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Présente ton projet à la communauté</div>
              <div class="ptc-fields">Nom · Description · Lien</div>
            </div>

            <!-- ANNONCE — style flash/alert -->
            <div onclick="previewPubType('annonce')" class="pub-type-card ptc-annonce" id="ptc-annonce" style="border-color:rgba(74,222,128,0.3);background:linear-gradient(135deg,rgba(74,222,128,0.04),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(74,222,128,0.25),rgba(74,222,128,0.05));font-size:22px;animation:blink 2s infinite">📣</div>
                <div class="ptc-name" style="font-size:15px;color:#4ade80">Annonce</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(74,222,128,0.12);color:#4ade80;border:1px solid rgba(74,222,128,0.25);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">NEWS</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Informe la communauté d'une nouveauté</div>
              <div class="ptc-fields">Titre · Message · Lien · Date</div>
            </div>

            <!-- SERVICE — style boutique/bleu -->
            <div onclick="previewPubType('service')" class="pub-type-card" id="ptc-service" style="border-color:rgba(59,130,246,0.3);background:linear-gradient(135deg,rgba(59,130,246,0.04),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(59,130,246,0.2),rgba(59,130,246,0.05));font-size:22px">🛍️</div>
                <div class="ptc-name" style="font-size:15px;color:#60a5fa">Service</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(59,130,246,0.12);color:#93c5fd;border:1px solid rgba(59,130,246,0.25);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">VENTE</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Propose tes compétences ou prestations</div>
              <div class="ptc-fields">Prestation · Tarif · Délai · Contact</div>
            </div>

            <!-- LANCEMENT — style rocket/rouge -->
            <div onclick="previewPubType('lancement')" class="pub-type-card" id="ptc-lancement" style="border-color:rgba(239,68,68,0.35);background:linear-gradient(135deg,rgba(239,68,68,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(239,68,68,0.25),rgba(239,68,68,0.05));font-size:22px">🚀</div>
                <div class="ptc-name" style="font-size:15px;color:#f87171">Lancement</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(239,68,68,0.12);color:#fca5a5;border:1px solid rgba(239,68,68,0.3);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">🔥 HYPE</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Lance officiellement ton produit</div>
              <div class="ptc-fields">Produit · Problème · Solution · Prix</div>
            </div>

            <!-- COLLAB — style réseau/violet -->
            <div onclick="previewPubType('collab')" class="pub-type-card" id="ptc-collab" style="border-color:rgba(168,85,247,0.35);background:linear-gradient(135deg,rgba(168,85,247,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;">
              <div style="position:absolute;top:-10px;right:-10px;font-size:40px;opacity:0.06;pointer-events:none">🤝</div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(168,85,247,0.25),rgba(168,85,247,0.05));font-size:22px">🤝</div>
                <div class="ptc-name" style="font-size:15px;color:#c084fc">Collab</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(168,85,247,0.12);color:#d8b4fe;border:1px solid rgba(168,85,247,0.3);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">RÉSEAU</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Cherche un partenaire ou co-fondateur</div>
              <div class="ptc-fields">Profil recherché · Niche · Conditions</div>
            </div>

            <!-- PROMO — style deal/orange + countdown feel -->
            <div onclick="previewPubType('promo')" class="pub-type-card" id="ptc-promo" style="border-color:rgba(245,158,11,0.4);background:linear-gradient(135deg,rgba(245,158,11,0.06),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;">
              <div style="position:absolute;top:0;right:0;background:rgba(245,158,11,0.12);border-bottom-left-radius:10px;padding:3px 10px;font-size:9px;font-family:'DM Mono',monospace;color:#fbbf24;letter-spacing:1px">LIMITÉ</div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(245,158,11,0.25),rgba(245,158,11,0.05));font-size:22px">🏷️</div>
                <div class="ptc-name" style="font-size:15px;color:#fbbf24">Promo</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Promotion ou deal limité dans le temps</div>
              <div class="ptc-fields">Offre · Prix barré · Code · Expiration</div>
            </div>

            <!-- SONDAGE — style vote/teal -->
            <div onclick="previewPubType('sondage')" class="pub-type-card" id="ptc-sondage" style="border-color:rgba(20,184,166,0.35);background:linear-gradient(135deg,rgba(20,184,166,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(20,184,166,0.25),rgba(20,184,166,0.05));font-size:22px">📊</div>
                <div class="ptc-name" style="font-size:15px;color:#2dd4bf">Sondage</div>
                <div style="margin-left:auto;display:flex;gap:2px;align-items:flex-end;height:16px">
                  <div style="width:4px;height:6px;background:rgba(45,212,191,0.4);border-radius:2px"></div>
                  <div style="width:4px;height:10px;background:rgba(45,212,191,0.6);border-radius:2px"></div>
                  <div style="width:4px;height:16px;background:#2dd4bf;border-radius:2px"></div>
                  <div style="width:4px;height:8px;background:rgba(45,212,191,0.5);border-radius:2px"></div>
                </div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Pose une question à la communauté</div>
              <div class="ptc-fields">Question · 4 options · Durée du vote</div>
            </div>

            <!-- TUTORIEL — style académique/vert clair -->
            <div onclick="previewPubType('tutoriel')" class="pub-type-card" id="ptc-tutoriel" style="border-color:rgba(34,197,94,0.2);background:linear-gradient(160deg,rgba(11,26,13,0.8),rgba(15,35,18,0.4));flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(34,197,94,0.03));font-size:22px">🎓</div>
                <div class="ptc-name" style="font-size:15px">Tutoriel</div>
              </div>
              <div style="display:flex;gap:4px;margin-top:2px">
                <div style="flex:1;height:3px;background:var(--g3);border-radius:2px"></div>
                <div style="flex:1;height:3px;background:rgba(34,197,94,0.3);border-radius:2px"></div>
                <div style="flex:1;height:3px;background:rgba(34,197,94,0.15);border-radius:2px"></div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Partage une méthode ou un guide pas-à-pas</div>
              <div class="ptc-fields">Sujet · Étapes · Niveau · Durée</div>
            </div>

            <!-- RECHERCHE — style magnify/indigo -->
            <div onclick="previewPubType('recherche')" class="pub-type-card" id="ptc-recherche" style="border-color:rgba(99,102,241,0.35);background:linear-gradient(135deg,rgba(99,102,241,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(99,102,241,0.25),rgba(99,102,241,0.05));font-size:22px">🔍</div>
                <div class="ptc-name" style="font-size:15px;color:#a5b4fc">Recherche</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(99,102,241,0.12);color:#c7d2fe;border:1px solid rgba(99,102,241,0.3);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">BESOIN</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Cherche un freelance, outil ou ressource</div>
              <div class="ptc-fields">Besoin · Budget · Délai · Contact</div>
            </div>

            <!-- RÉSULTAT — style trophée/or discret -->
            <div onclick="previewPubType('resultat')" class="pub-type-card" id="ptc-resultat" style="border-color:rgba(255,215,0,0.2);background:linear-gradient(135deg,rgba(255,215,0,0.03),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,215,0,0.03));font-size:22px">🏆</div>
                <div class="ptc-name" style="font-size:15px;color:#fde68a">Résultat</div>
                <div style="margin-left:auto;font-size:18px;opacity:0.4">📈</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Partage tes stats et victoires</div>
              <div class="ptc-fields">Chiffres · Période · Apprentissages</div>
            </div>

            <!-- CAMPAGNE — style premium or -->
            <div onclick="previewPubType('campagne')" class="pub-type-card" id="ptc-campagne" style="border-color:rgba(255,215,0,0.4);background:linear-gradient(135deg,rgba(255,215,0,0.07),rgba(255,140,0,0.03));flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;box-shadow:0 0 20px rgba(255,215,0,0.06)">
              <div style="position:absolute;inset:0;background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,215,0,0.015) 10px,rgba(255,215,0,0.015) 11px);pointer-events:none"></div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(255,215,0,0.3),rgba(255,140,0,0.1));font-size:22px">🎯</div>
                <div class="ptc-name" style="font-size:15px;color:#ffd700">Campagne</div>
                <span class="plan-elite-badge" style="margin-left:auto">MAX</span>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5;color:#fef3c7">Visibilité maximale avec objectif chiffré</div>
              <div class="ptc-fields" style="color:rgba(255,215,0,0.5)">Objectif · Vidéo · FAQ · Boost top</div>
            </div>

            <!-- SERVICE PRO — style violet premium -->
            <div onclick="previewPubType('service-pro')" class="pub-type-card" id="ptc-service-pro" style="border-color:rgba(168,85,247,0.4);background:linear-gradient(135deg,rgba(168,85,247,0.07),rgba(109,40,217,0.03));flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;">
              <div style="position:absolute;top:-20px;right:-20px;width:80px;height:80px;border-radius:50%;background:radial-gradient(circle,rgba(168,85,247,0.1),transparent);pointer-events:none"></div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(168,85,247,0.3),rgba(168,85,247,0.05));font-size:22px">🔧</div>
                <div class="ptc-name" style="font-size:15px;color:#a855f7">Service Pro</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(168,85,247,0.15);color:#d8b4fe;border:1px solid rgba(168,85,247,0.35);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">PRO</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Prestation premium avec portfolio complet</div>
              <div class="ptc-fields" style="color:rgba(168,85,247,0.5)">Portfolio · Tarifs · Témoignages · Réservation</div>
            </div>

            <!-- EMPLOI — style large/bleu entreprise -->
            <div onclick="previewPubType('emploi')" class="pub-type-card" id="ptc-emploi" style="grid-column:span 2;border-color:rgba(59,130,246,0.35);background:linear-gradient(90deg,rgba(59,130,246,0.06),transparent);flex-direction:row;align-items:center;gap:14px;padding:16px 20px;position:relative;overflow:hidden;">
              <div style="position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:48px;opacity:0.05;pointer-events:none">💼</div>
              <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(59,130,246,0.25),rgba(59,130,246,0.05));font-size:26px;width:50px;height:50px;border-radius:12px;flex-shrink:0">💼</div>
              <div style="flex:1">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                  <div class="ptc-name" style="font-size:15px;color:#60a5fa">Offre d'emploi</div>
                  <div style="font-size:9px;background:rgba(59,130,246,0.12);color:#93c5fd;border:1px solid rgba(59,130,246,0.25);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">RECRUTEMENT</div>
                </div>
                <div class="ptc-desc" style="font-size:11px;line-height:1.5;margin-bottom:4px">Recrute pour ton équipe ou ton projet</div>
                <div class="ptc-fields">Poste · Compétences · Remote/Présentiel · Rémunération · Candidature</div>
              </div>
            </div>

          </div>
        </div>

        <!-- WIZARD (caché jusqu'au choix du type) -->
        <div id="pub-wizard-content" style="display:none">

        <!-- EN-TÊTE -->
        <div style="margin-bottom:22px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
          <div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
              <h2 id="wiz-main-title" style="font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:3px;color:var(--g3)">CRÉER MA PUBLICATION</h2>
              <span id="pub-type-badge" style="font-size:11px;background:rgba(34,197,94,0.1);color:var(--g3);border:1px solid rgba(34,197,94,0.3);border-radius:6px;padding:3px 10px;font-weight:700"></span>
            </div>
            <p id="wiz-main-sub" style="font-size:13px;color:var(--muted)">Suis les étapes pour créer une publication qui convertit.</p>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button onclick="backToPubTypeChooser()" style="background:rgba(255,255,255,0.04);border:1.5px solid var(--border);border-radius:8px;padding:8px 14px;font-size:12px;font-weight:700;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">← Changer</button>
            <button onclick="showPubGuide()" style="background:rgba(34,197,94,0.08);border:1.5px solid rgba(34,197,94,0.2);border-radius:8px;padding:8px 14px;font-size:12px;font-weight:700;color:var(--g4);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">💡 Guide</button>
          </div>
        </div>

        <!-- STEPPER -->
        <div class="wiz-stepper" id="wiz-stepper">
          <div class="wiz-step-dot active" id="wdot-1" onclick="wizGoTo(1)">
            <div class="wiz-step-circle active" id="wcirc-1"><span>1</span></div>
            <div class="wiz-step-lbl" id="wlbl-1">Identité</div>
          </div>
          <div class="wiz-connector" id="wconn-1"></div>
          <div class="wiz-step-dot" id="wdot-2" onclick="wizGoTo(2)">
            <div class="wiz-step-circle" id="wcirc-2"><span>2</span></div>
            <div class="wiz-step-lbl" id="wlbl-2">Description</div>
          </div>
          <div class="wiz-connector" id="wconn-2"></div>
          <div class="wiz-step-dot" id="wdot-3" onclick="wizGoTo(3)">
            <div class="wiz-step-circle" id="wcirc-3"><span>3</span></div>
            <div class="wiz-step-lbl" id="wlbl-3">Détails</div>
          </div>
          <div class="wiz-connector" id="wconn-3"></div>
          <div class="wiz-step-dot" id="wdot-4" onclick="wizGoTo(4)">
            <div class="wiz-step-circle" id="wcirc-4"><span>4</span></div>
            <div class="wiz-step-lbl" id="wlbl-4">Visuel</div>
          </div>
          <div class="wiz-connector" id="wconn-4"></div>
          <div class="wiz-step-dot" id="wdot-5" onclick="wizGoTo(5)">
            <div class="wiz-step-circle" id="wcirc-5"><span>5</span></div>
            <div class="wiz-step-lbl" id="wlbl-5">Aperçu</div>
          </div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="wiz-progress-bar">
          <div class="wiz-progress-fill" id="wiz-prog-fill" style="width:20%"></div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 1 — IDENTITÉ DU PROJET
        ──────────────────────────────────── -->
        <!-- ────────────────────────────────────
             ÉTAPE 1 — IDENTITÉ (DYNAMIQUE)
        ──────────────────────────────────── -->
        <div class="wiz-panel active" id="wpanel-1">
          <div class="wiz-group-card" id="wpanel-1-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon" id="wiz-step1-icon">🚀</div>
              <div>
                <div class="wiz-group-head" id="wiz-step1-head">IDENTITÉ</div>
                <div class="wiz-group-sub" id="wiz-step1-sub">Les informations principales</div>
              </div>
            </div>
            <div id="wiz-step1-fields" class="edit-grid" style="gap:14px"></div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-next" id="wiz-step1-next" onclick="wizNext(1)">Suivant <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 2 — CONTENU (DYNAMIQUE)
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-2">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon" id="wiz-step2-icon">✍️</div>
              <div>
                <div class="wiz-group-head" id="wiz-step2-head">CONTENU</div>
                <div class="wiz-group-sub" id="wiz-step2-sub">Décris ta publication</div>
              </div>
            </div>
            <div id="wiz-step2-fields" style="display:flex;flex-direction:column;gap:14px"></div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(2)">← Retour</button>
            <button class="btn-wiz-next" id="wiz-step2-next" onclick="wizNext(2)">Suivant <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 3 — DÉTAILS (DYNAMIQUE)
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-3">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon" id="wiz-step3-icon">🎯</div>
              <div>
                <div class="wiz-group-head" id="wiz-step3-head">DÉTAILS</div>
                <div class="wiz-group-sub" id="wiz-step3-sub">Informations complémentaires</div>
              </div>
            </div>
            <div id="wiz-step3-fields" class="edit-grid" style="gap:14px"></div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(3)">← Retour</button>
            <button class="btn-wiz-next" id="wiz-step3-next" onclick="wizNext(3)">Suivant — Visuel <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 4 — VISUEL
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-4">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">🖼️</div>
              <div>
                <div class="wiz-group-head">VISUEL DE TA PUB</div>
                <div class="wiz-group-sub">Les fiches avec image reçoivent <strong style="color:var(--g3)">3× plus de votes</strong> — fortement recommandé</div>
              </div>
            </div>
            <label style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;background:var(--s2);border:2px dashed var(--border);border-radius:14px;padding:40px 20px;font-size:13px;color:var(--muted);transition:all 0.2s;text-align:center" id="pub-media-drop" onmouseover="this.style.borderColor='var(--g3)';this.style.background='rgba(34,197,94,0.04)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--s2)'">
              <span style="font-size:44px">🖼️</span>
              <div>
                <div style="font-weight:700;color:var(--g4);margin-bottom:4px">Clique pour ajouter ton image ou vidéo</div>
                <div style="font-size:11px;color:var(--muted2)">PNG, JPG, GIF, MP4 · Max 10MB</div>
              </div>
              <input type="file" id="pub-media-input" accept="image/*,video/*" style="display:none" onchange="handlePubMediaUpload(this);updatePubCompletion()"/>
            </label>
            <div id="pub-media-preview" style="margin-top:12px"></div>
            <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.15);border-radius:10px;padding:12px 14px;margin-top:14px;font-size:11px;color:var(--muted);line-height:1.9">
              ✅ Image de couverture → <strong style="color:var(--g4)">3× plus de votes</strong><br>
              ✅ Description 100+ car. → <strong style="color:var(--g4)">+60% de clics</strong><br>
              ✅ Tags précis → <strong style="color:var(--g4)">matching IA activé</strong>
            </div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(4)">← Retour</button>
            <button class="btn-wiz-next" onclick="wizNext(4)">Suivant — Aperçu final <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 5 — APERÇU & PUBLICATION
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-5">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">👁️</div>
              <div>
                <div class="wiz-group-head">APERÇU & PUBLICATION</div>
                <div class="wiz-group-sub">Voici exactement comment ta pub sera vue par la communauté</div>
              </div>
            </div>

            <!-- APERÇU VITRINE -->
            <div id="wiz-vitrine-preview" class="wiz-preview-card">
              <div class="wiz-preview-banner" id="wiz-prev-banner">
                <span id="wiz-prev-emoji">🚀</span>
                <img id="wiz-prev-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover"/>
              </div>
              <div class="wiz-preview-body">
                <div class="wiz-preview-name" id="wiz-prev-name">Nom du projet</div>
                <div class="wiz-preview-hook" id="wiz-prev-hook" style="display:none"></div>
                <div class="wiz-preview-desc" id="wiz-prev-desc">Ta description apparaîtra ici...</div>
                <div class="wiz-preview-tags" id="wiz-prev-tags"></div>
                <div class="wiz-preview-footer">
                  <div style="display:flex;gap:10px">
                    <span>❤️ 0</span>
                    <span>💬 0</span>
                    <span id="wiz-prev-collab" style="display:none;font-size:10px;background:rgba(22,163,74,0.15);border:1px solid rgba(22,163,74,0.3);border-radius:4px;padding:1px 6px;color:var(--g4)"></span>
                  </div>
                  <div id="wiz-prev-author" style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2)"></div>
                </div>
              </div>
            </div>

            <!-- CHECKLIST RÉCAP -->
            <div id="wiz-checklist" style="background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:4px">
              <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">FORCE DE TA FICHE</div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2)">Complétion</span>
                <span style="font-family:'DM Mono',monospace;font-size:14px;color:var(--gold);font-weight:700" id="wiz-completion-pct">0%</span>
              </div>
              <div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden;margin-bottom:12px">
                <div id="wiz-completion-bar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:3px;transition:width 0.4s"></div>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap" id="wiz-hints"></div>
            </div>

            <!-- DURÉE VITRINE -->
            <div style="background:rgba(22,163,74,0.04);border:1px solid rgba(22,163,74,0.1);border-radius:8px;padding:10px 14px;font-size:11px;color:var(--muted);margin-top:10px">
              ⏱ Durée vitrine : <strong style="color:var(--g3)">FREE = 24h</strong> · Starter = 7j · Pro = 30j · Elite = Permanent
              <span id="pub-plan-label" style="float:right;color:var(--g4);font-weight:600"></span>
            </div>
          </div>

          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(5)">← Modifier</button>
            <button class="btn-wiz-publish" onclick="publishProject()">🚀 Publier sur la vitrine !</button>
          </div>

          <div style="display:none" id="pub-strategy" style="margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:10px;padding:16px;font-size:13px;line-height:1.8;color:#7a9a82;white-space:pre-wrap"></div>
        </div>

      </div>
    </div>

        </div><!-- /pub-wizard-content -->
    <!-- CHAT MONDIAL -->
    <div class="tpanel" id="tab-chat-global">
      <div class="chat-panel-container">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">CHAT MONDIAL</h2>
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);display:flex;align-items:center;gap:6px"><span style="width:6px;height:6px;border-radius:50%;background:var(--g3);box-shadow:0 0 5px var(--g3);display:inline-block"></span><span id="world-online-count">0 en ligne</span></div>
          </div>
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);background:var(--s1);border:1px solid var(--border2);border-radius:6px;padding:7px 12px">Messages restants : <span id="chat-msgs-left" style="color:var(--g3);font-weight:700">3</span></div>
        </div>
        <div class="chat-box">
          <div class="chat-msgs-area" id="world-chat-msgs"></div>
          <div class="chat-input-row">
            <input type="text" id="world-chat-in" class="chat-input-field" placeholder="Écris ton message à la communauté..." onkeydown="if(event.key==='Enter')sendWorldChat()"/>
            <button class="btn-send" onclick="sendWorldChat()">→</button>
          </div>
        </div>
        <div id="world-chat-upgrade" style="display:none" class="upgrade-strip">
          <div><h4>Messages du jour épuisés</h4><p>Starter (3€/mois) = 10 messages/jour</p></div>
          <button class="btn-g btn-solid-g" onclick="startPayment('starter')">Upgrade →</button>
        </div>
      </div>
    </div>

    <!-- PROFIL -->
    <div class="tpanel" id="tab-profil">
      <div style="max-width:760px;margin:0 auto;padding:22px 0" id="my-profile-view"></div>
    </div>

    <!-- ABONNÉS -->
    <div class="tpanel" id="tab-abonnes">
      <div style="max-width:640px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">ABONNÉS & ABONNEMENTS</h2>
        <div class="feed-tabs" style="margin-bottom:20px">
          <button class="feed-tab active" onclick="switchFollowTab('followers',this)">Abonnés (<span id="followers-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('following',this)">Abonnements (<span id="following-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('discover',this)">Découvrir</button>
        </div>
        <div id="follow-list-container" class="follow-list"></div>
      </div>
    </div>

    <!-- GROUPES -->
    <div class="tpanel" id="tab-groupes">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Rejoins ou crée des groupes thématiques</p>
          </div>
          <button class="btn-publish" onclick="openCreateGroup()" id="btn-create-group" style="display:none">+ Créer un groupe</button>
        </div>
        <div id="groups-list"></div>
      </div>
    </div>

    <!-- IA BOOST -->
    <div class="tpanel" id="tab-ia-boost">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">IA BOOST</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Stratégie de promotion complète générée en 10 secondes</p>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Type de stratégie</h3>
          <div class="boost-type-grid">
            <div class="boost-type-card selected" onclick="selectBoostType(this,'social')">📱<span>TikTok/Instagram</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'seo')">🔍<span>SEO Google</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'ads')">🎨<span>Publicités</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'email')">📧<span>Email marketing</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'strategy')">📊<span>Stratégie 90j</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'coach')">🤖<span>Coach IA</span></div>
          </div>
        </div>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Ton projet</h3>
          <div class="edit-grid">
            <div class="fg"><label>Nom</label><input type="text" id="boost-name" placeholder="Mon super projet"/></div>
            <div class="fg"><label>Type</label><select id="boost-proj-type"><option>Site web</option><option>Application</option><option>SaaS</option><option>TikTok</option><option>Instagram</option></select></div>
            <div class="fg"><label>Cible</label><input type="text" id="boost-target" placeholder="Créateurs 18-30 ans"/></div>
            <div class="fg"><label>Objectif</label><input type="text" id="boost-goal" placeholder="1000 abonnés en 30j"/></div>
          </div>
          <div class="fg"><label>Description</label><textarea id="boost-desc" rows="2" placeholder="Décris ton projet..."></textarea></div>
        </div>
        <button class="btn-publish" style="width:100%;padding:13px;font-size:14px" id="btn-ia-boost" onclick="runIABoost()">⚡ Générer ma stratégie</button>
        <div id="boost-output-box" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:12px;padding:18px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:1px">STRATÉGIE GÉNÉRÉE</span>
            <button onclick="navigator.clipboard.writeText(document.getElementById('boost-output-text').textContent).then(()=>toast('📋 Copié !'))" style="background:transparent;border:1px solid var(--border);border-radius:4px;padding:3px 10px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Copier</button>
          </div>
          <div id="boost-output-text" style="font-size:13px;line-height:1.9;color:#7a9a82;white-space:pre-wrap"></div>
        </div>
      </div>
    </div>

    <!-- GROUPES DISCUSSION -->
    <div class="tpanel" id="tab-groupes">
      <div style="max-width:900px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Rejoins ou crée des groupes thématiques (créer = plan ELITE)</p>
          </div>
          <button class="btn-publish" id="btn-create-group" onclick="openCreateGroup()" style="display:none">🏛️ Créer un groupe</button>
        </div>
        <div id="groups-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px"></div>
      </div>
    </div>

    <!-- ══ STATS & ANALYTICS ══ -->
    <div class="tpanel" id="tab-stats">
      <div style="max-width:960px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">TABLEAU DE BORD</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:22px">Performance de tes publications sur 30 jours</p>
        <div class="analytics-grid" id="stats-kpi-grid">
          <div class="stat-card"><div class="stat-card-label">Vues totales</div><div class="stat-card-value" id="stat-views">0</div><div class="stat-card-trend up" id="stat-views-trend">↑ +0%</div></div>
          <div class="stat-card"><div class="stat-card-label">Clics</div><div class="stat-card-value" id="stat-clicks">0</div><div class="stat-card-trend up" id="stat-clicks-trend">↑ +0%</div></div>
          <div class="stat-card"><div class="stat-card-label">Publications</div><div class="stat-card-value" id="stat-posts">0</div><div class="stat-card-sub">ce mois</div></div>
          <div class="stat-card"><div class="stat-card-label">Abonnés</div><div class="stat-card-value" id="stat-followers">0</div><div class="stat-card-trend up" id="stat-followers-trend">↑ +0</div></div>
        </div>
        <div class="chart-wrap">
          <div class="chart-title">VUES PAR JOUR — 7 DERNIERS JOURS</div>
          <div class="mini-chart" id="views-chart"></div>
          <div class="mini-chart-labels" id="views-chart-labels"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
          <div class="chart-wrap">
            <div class="chart-title">MEILLEURES PUBS</div>
            <div id="top-posts-list" style="font-size:12px;color:var(--muted)">Aucune donnée</div>
          </div>
          <div class="chart-wrap">
            <div class="chart-title">RÉPARTITION PAR CATÉGORIE</div>
            <div id="cat-chart" style="font-size:12px;color:var(--muted)">Aucune donnée</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ BOOST CRÉDITS ══ -->
    <div class="tpanel" id="tab-boost-credits">
      <div style="max-width:700px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--gold);margin-bottom:3px">⚡ VIRAL CREDITS</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:16px">Gagne des crédits via les missions et badges — dépense-les pour propulser ton contenu</p>

        <!-- BARRE CRÉDITS -->
        <div class="credits-bar-v2">
          <div>
            <div class="credits-big" id="user-credits">0</div>
            <div class="credits-sub">⚡ VIRALCREDITS DISPONIBLES</div>
          </div>
          <div class="credits-actions">
            <button class="btn-buy-credits" onclick="switchCreditsTab('missions',this)">🎯 Missions</button>
            <button class="btn-buy-credits" onclick="switchCreditsTab('shop',this)" style="background:rgba(22,163,74,0.1);border-color:rgba(22,163,74,0.4);color:var(--g3)">🛒 Boutique</button>
            <button class="btn-buy-credits" onclick="switchCreditsTab('packs',this)">💳 Acheter</button>
          </div>
        </div>

        <!-- TABS -->
        <div class="credits-tabs">
          <button class="credits-tab active" id="ctab-missions" onclick="switchCreditsTab('missions',this)">🎯 Missions</button>
          <button class="credits-tab" id="ctab-shop" onclick="switchCreditsTab('shop',this)">🛒 Boutique</button>
          <button class="credits-tab" id="ctab-plans" onclick="switchCreditsTab('plans',this)">🎁 Plans</button>
          <button class="credits-tab" id="ctab-boost" onclick="switchCreditsTab('boost',this)">🚀 Booster</button>
          <button class="credits-tab" id="ctab-packs" onclick="switchCreditsTab('packs',this)">💳 Acheter</button>
        </div>

        <!-- MISSIONS -->
        <div class="cpanel active" id="cpanel-missions">
          <div class="missions-reset" id="missions-reset-timer">Réinitialisation dans <span id="missions-countdown">--:--:--</span></div>
          <div id="missions-list"></div>
          <div style="margin-top:20px;background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 16px;">
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;margin-bottom:10px">🏅 BADGES → CRÉDITS</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.8">
              Chaque badge débloqué offre des crédits automatiquement.<br>
              <span style="color:var(--g4)">📝 Premiers badges</span> → <b style="color:var(--gold)">+5 à +15⚡</b> &nbsp;|&nbsp;
              <span style="color:var(--g4)">🟢 Starter/Pro</span> → <b style="color:var(--gold)">+20 à +50⚡</b> &nbsp;|&nbsp;
              <span style="color:var(--gold)">👑 Badges spéciaux</span> → <b style="color:var(--gold)">+100 à +200⚡</b>
            </div>
          </div>
        </div>

        <!-- BOUTIQUE -->
        <div class="cpanel" id="cpanel-shop">
          <!-- ── ACHETER UN PLAN AVEC DES CRÉDITS ── -->
          <div style="background:linear-gradient(135deg,rgba(22,163,74,0.08),rgba(74,222,128,0.04));border:2px solid rgba(22,163,74,0.3);border-radius:14px;padding:18px 20px;margin-bottom:20px">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
              <span style="font-size:28px">🎁</span>
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:2px;color:var(--g3)">PAYER SON ABONNEMENT EN CRÉDITS</div>
                <div style="font-size:11px;color:var(--muted)">Accumule des crédits et upgrade sans sortir ta carte bancaire</div>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
              <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s" onclick="buyPlanWithCredits('starter')" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.08)'">
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:1px">STARTER</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">800<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 3€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:var(--g2);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Acheter</button>
              </div>
              <div style="background:var(--s1);border:2px solid rgba(22,163,74,0.3);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onclick="buyPlanWithCredits('pro')" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(22,163,74,0.3)'">
                <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-size:8px;font-weight:800;padding:2px 8px;border-radius:3px;letter-spacing:1px;white-space:nowrap">⭐ POPULAIRE</div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:1px">PRO</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">3500<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 14,99€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:var(--g2);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Acheter</button>
              </div>
              <div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.25);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s" onclick="buyPlanWithCredits('elite')" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--gold);letter-spacing:1px">ELITE</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">9000<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 39,99€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:#1a0a00">Acheter</button>
              </div>
            </div>
            <div style="text-align:center;margin-top:10px;font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace">✓ Pas de carte bancaire · ✓ Activation immédiate · ✓ 1 mois offert</div>
          </div>
          <div class="shop-section-title">🚀 BOOST DE PUBLICATION</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('top-feed',10)">
              <div class="shop-item-emoji">🔝</div>
              <div class="shop-item-name">Top du Fil</div>
              <div class="shop-item-desc">Ta pub en tête du feed pendant 2h</div>
              <div class="shop-item-price">⚡ 10</div>
            </div>
            <div class="shop-item" onclick="shopBuy('vitrine-24h',25)">
              <div class="shop-item-emoji">✨</div>
              <div class="shop-item-name">Vitrine 24h</div>
              <div class="shop-item-desc">Épinglée en vitrine une journée</div>
              <div class="shop-item-price">⚡ 25</div>
            </div>
            <div class="shop-item" onclick="shopBuy('notif-push',50)">
              <div class="shop-item-emoji">🔔</div>
              <div class="shop-item-name">Notif Push</div>
              <div class="shop-item-desc">Notification à toute la communauté</div>
              <div class="shop-item-price">⚡ 50</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('boost-7j',80)">
              <div class="shop-item-badge">PREMIUM</div>
              <div class="shop-item-emoji">🏆</div>
              <div class="shop-item-name">Boost 7 Jours</div>
              <div class="shop-item-desc">Mis en avant pendant une semaine</div>
              <div class="shop-item-price">⚡ 80</div>
            </div>
          </div>
          <div class="shop-section-title">🎨 PERSONNALISATION PROFIL</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('cadre-or',30)">
              <div class="shop-item-emoji">🖼️</div>
              <div class="shop-item-name">Cadre Doré</div>
              <div class="shop-item-desc">Avatar avec bordure dorée animée</div>
              <div class="shop-item-price">⚡ 30</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('badge-feu',45)">
              <div class="shop-item-badge">RARE</div>
              <div class="shop-item-emoji">🔥</div>
              <div class="shop-item-name">Badge Feu</div>
              <div class="shop-item-desc">Flamme animée sur ton profil</div>
              <div class="shop-item-price">⚡ 45</div>
            </div>
            <div class="shop-item" onclick="shopBuy('emoji-pack',20)">
              <div class="shop-item-emoji">🎭</div>
              <div class="shop-item-name">Pack Emojis+</div>
              <div class="shop-item-desc">15 emojis exclusifs pour tes pubs</div>
              <div class="shop-item-price">⚡ 20</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('titre-vip',60)">
              <div class="shop-item-badge">VIP</div>
              <div class="shop-item-emoji">💎</div>
              <div class="shop-item-name">Titre VIP</div>
              <div class="shop-item-desc">Badge "VIP" doré sous ton nom</div>
              <div class="shop-item-price">⚡ 60</div>
            </div>
          </div>
          <div class="shop-section-title">🤖 IA & OUTILS</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('ia-analyse',15)">
              <div class="shop-item-emoji">🔬</div>
              <div class="shop-item-name">Analyse IA</div>
              <div class="shop-item-desc">Analyse détaillée de ta pub</div>
              <div class="shop-item-price">⚡ 15</div>
            </div>
            <div class="shop-item" onclick="shopBuy('ia-hashtags',10)">
              <div class="shop-item-emoji">📌</div>
              <div class="shop-item-name">Hashtags IA</div>
              <div class="shop-item-desc">30 hashtags viraux générés par IA</div>
              <div class="shop-item-price">⚡ 10</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('ia-strategie',35)">
              <div class="shop-item-emoji">🗺️</div>
              <div class="shop-item-name">Stratégie IA</div>
              <div class="shop-item-desc">Plan marketing complet 30 jours</div>
              <div class="shop-item-price">⚡ 35</div>
            </div>
          </div>
          <div id="shop-boost-select-wrap" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;">
            <div style="font-size:12px;font-weight:700;margin-bottom:8px">Choisir la publication à booster :</div>
            <select id="boost-post-select" style="margin-bottom:10px"><option value="">Choisir...</option></select>
            <button class="btn-modal-g" onclick="confirmShopBoost()" style="margin-top:0;padding:9px">⚡ Confirmer le boost</button>
          </div>
        </div>

        <!-- PLANS AVEC CRÉDITS -->
        <div class="cpanel" id="cpanel-plans">
          <div style="text-align:center;margin-bottom:20px">
            <div style="font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px;color:var(--g3)">UPGRADE AVEC TES CRÉDITS</div>
            <div style="font-size:12px;color:var(--muted);margin-top:4px">Accumule des crédits via missions & badges → upgrade ton plan sans carte bancaire</div>
          </div>
          <div style="background:rgba(255,215,0,0.05);border:1.5px solid rgba(255,215,0,0.2);border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
            <div><div style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px">TES CRÉDITS ACTUELS</div><div style="font-family:'Bebas Neue',sans-serif;font-size:42px;color:var(--gold);line-height:1" id="plans-credits-display">0</div></div>
            <div style="text-align:right"><div style="font-size:11px;color:var(--muted)">Ton plan actuel</div><div style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3)" id="plans-current-plan">FREE</div></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr;gap:14px">
            <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);letter-spacing:1px;margin-bottom:4px">🟢 STARTER — 800⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">10 pubs/jour · Vitrine 7j · Coach IA · +200 crédits/mois</div>
                <div id="starter-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="starter-progress-bar" style="height:100%;background:var(--g3);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="starter-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('starter')" style="padding:10px 22px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);white-space:nowrap;flex-shrink:0">Acheter →</button>
            </div>
            <div style="background:var(--s1);border:2px solid rgba(22,163,74,0.25);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;position:relative">
              <div style="position:absolute;top:-10px;left:18px;background:var(--g2);color:var(--bg);font-size:9px;font-weight:800;padding:3px 10px;border-radius:3px;letter-spacing:1px">⭐ POPULAIRE</div>
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);letter-spacing:1px;margin-bottom:4px">✅ PRO — 3 500⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Publications illimitées · IA Boost · Stats avancées · +500 crédits/mois</div>
                <div id="pro-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="pro-progress-bar" style="height:100%;background:var(--g3);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="pro-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('pro')" style="padding:10px 22px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);white-space:nowrap;flex-shrink:0">Acheter →</button>
            </div>
            <div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.25);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);letter-spacing:1px;margin-bottom:4px">🏆 ELITE — 9 000⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Vitrine permanente · Appel mensuel · Priorité matching · +1500 crédits/mois</div>
                <div id="elite-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="elite-progress-bar" style="height:100%;background:linear-gradient(90deg,#ffd700,#ff8c00);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="elite-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('elite')" style="padding:10px 22px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:#1a0a00;white-space:nowrap;flex-shrink:0">Acheter →</button>
            </div>
          </div>
          <div style="margin-top:16px;text-align:center;font-size:11px;color:var(--muted2);font-family:'DM Mono',monospace">
            💡 Gagne des crédits via les missions quotidiennes et les badges pour upgrade gratuitement !
          </div>
        </div>

        <!-- BOOSTER MA PUB (raccourci) -->
        <div class="cpanel" id="cpanel-boost">
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px">Que veux-tu faire ?</div>
          <div class="boost-options">
            <div class="boost-opt selected" onclick="selectBoostOpt(this,'top-feed')">
              <div class="boost-opt-icon">🔝</div>
              <div class="boost-opt-name">Top du fil</div>
              <div class="boost-opt-cost">⚡ 10 crédits</div>
              <div class="boost-opt-desc">Ta pub en tête pendant 2h</div>
            </div>
            <div class="boost-opt" onclick="selectBoostOpt(this,'vitrine-24h')">
              <div class="boost-opt-icon">✨</div>
              <div class="boost-opt-name">Vitrine 24h</div>
              <div class="boost-opt-cost">⚡ 25 crédits</div>
              <div class="boost-opt-desc">Épinglée en vitrine une journée</div>
            </div>
            <div class="boost-opt" onclick="selectBoostOpt(this,'notif-push')">
              <div class="boost-opt-icon">🔔</div>
              <div class="boost-opt-name">Notification push</div>
              <div class="boost-opt-cost">⚡ 50 crédits</div>
              <div class="boost-opt-desc">Notif à toute la communauté</div>
            </div>
          </div>
          <div style="margin-bottom:12px">
            <label>Publication à booster</label>
            <select id="boost-post-select2" style="margin-top:4px"><option value="">Choisir une publication...</option></select>
          </div>
          <button class="btn-publish" onclick="applyBoost()" style="width:100%;padding:13px">⚡ Activer le boost</button>
        </div>

        <!-- ACHETER CRÉDITS -->
        <div class="cpanel" id="cpanel-packs">
          <div class="shop-section-title">💳 PACKS DE CRÉDITS</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
            <div onclick="buyCredits(50,4.99)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(34,197,94,0.3)'" onmouseout="this.style.borderColor='var(--border2)'">
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)">50</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">crédits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">4,99€</div>
              <div style="font-size:10px;color:var(--muted);margin-top:3px">0,10€/crédit</div>
            </div>
            <div onclick="buyCredits(150,12.99)" style="background:var(--s2);border:1.5px solid rgba(34,197,94,0.3);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.3)'">
              <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-size:8px;font-weight:700;padding:2px 8px;border-radius:3px;white-space:nowrap">⭐ POPULAIRE</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)">150</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">crédits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">12,99€</div>
              <div style="font-size:10px;color:var(--g4);margin-top:3px">-13% moins cher</div>
            </div>
            <div onclick="buyCredits(400,29.99)" style="background:var(--s1);border:1.5px solid rgba(255,215,0,0.25);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onmouseover="this.style.borderColor='rgba(255,215,0,0.5)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
              <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:8px;font-weight:700;padding:2px 8px;border-radius:3px;white-space:nowrap">👑 BEST VALUE</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--gold)">400</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">crédits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">29,99€</div>
              <div style="font-size:10px;color:var(--gold);margin-top:3px">-25% moins cher</div>
            </div>
          </div>
          <div style="margin-top:14px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.15);border-radius:8px;padding:12px 14px;font-size:11px;color:var(--muted);line-height:1.7">
            💡 <b style="color:var(--g4)">Astuce :</b> Tu peux aussi gagner des crédits gratuitement en complétant les <span style="color:var(--g3);cursor:pointer" onclick="switchCreditsTab('missions',document.getElementById('ctab-missions'))">missions quotidiennes</span> et en débloquant des badges !
          </div>
        </div>

      </div>
    </div>

    <!-- ══ LEADERBOARD ══ -->
    <div class="tpanel" id="tab-leaderboard">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">CLASSEMENT</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Top des publications virales cette semaine</p>
        <div class="feed-tabs" style="margin-bottom:18px">
          <button class="feed-tab active" onclick="switchLeaderboard('pubs',this)">📢 Pubs virales</button>
          <button class="feed-tab" onclick="switchLeaderboard('createurs',this)">👤 Créateurs</button>
          <button class="feed-tab" onclick="switchLeaderboard('vitrine',this)">✨ Vitrine</button>
        </div>
        <div class="leaderboard-list" id="leaderboard-list"></div>
      </div>
    </div>

    <!-- ══ COLLABS ══ -->
    <div class="tpanel" id="tab-collab">
      <div style="max-width:760px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">COLLABORATIONS</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Créateurs compatibles avec ton profil — matchés par l'IA</p>
        <div style="background:rgba(34,197,94,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:10px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px">
          <div style="font-size:24px">🤖</div>
          <div>
            <div style="font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px">Matching IA activé</div>
            <div style="font-size:11px;color:var(--muted)">Basé sur ta niche, tes objectifs et tes compétences</div>
          </div>
          <button onclick="loadCollabs()" style="margin-left:auto;background:var(--g2);border:none;border-radius:6px;padding:7px 14px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Actualiser</button>
        </div>
        <div id="collab-list">
          <div style="text-align:center;padding:32px;color:var(--muted)">Chargement des suggestions...</div>
        </div>
      </div>
    </div>

    <!-- ══ CALENDRIER ÉDITORIAL ══ -->
    <div class="tpanel" id="tab-calendrier">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">CALENDRIER ÉDITORIAL</h2>
            <p style="font-size:12px;color:var(--muted)">Planifie et visualise tes publications</p>
          </div>
          <div style="display:flex;gap:8px">
            <button onclick="calNav(-1)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted)">←</button>
            <span id="cal-month-label" style="font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);padding:7px 14px;background:var(--s1);border:1.5px solid var(--border2);border-radius:6px"></span>
            <button onclick="calNav(1)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted)">→</button>
          </div>
        </div>
        <div class="cal-header-days">
          <span>LUN</span><span>MAR</span><span>MER</span><span>JEU</span><span>VEN</span><span>SAM</span><span>DIM</span>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
        <div style="margin-top:20px">
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px">🤖 CRÉNEAUX OPTIMAUX SUGGÉRÉS PAR L'IA</div>
          <div id="optimal-slots" style="display:flex;flex-wrap:wrap;gap:6px"></div>
        </div>
      </div>
    </div>

    <!-- ══ A/B TEST IA ══ -->
    <div class="tpanel" id="tab-ab-test">
      <div style="max-width:760px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">A/B TEST IA</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">L'IA analyse tes 2 versions et prédit laquelle convertira le mieux</p>
        <div class="ab-compare">
          <div class="ab-side">
            <div class="ab-side-label a">VERSION A</div>
            <textarea id="ab-text-a" rows="4" placeholder="Première version de ta pub..." style="width:100%;resize:none"></textarea>
          </div>
          <div class="ab-side">
            <div class="ab-side-label b">VERSION B</div>
            <textarea id="ab-text-b" rows="4" placeholder="Deuxième version de ta pub..." style="width:100%;resize:none"></textarea>
          </div>
        </div>
        <div class="fg"><label>Objectif de la pub</label><select id="ab-goal"><option value="clics">Générer des clics</option><option value="abonnes">Gagner des abonnés</option><option value="ventes">Convertir en ventes</option><option value="notoriete">Notoriété / Vues</option></select></div>
        <button class="btn-publish" onclick="runABTest()" id="btn-ab" style="width:100%;padding:13px;font-size:14px;margin-top:4px">🔬 Analyser avec l'IA</button>
        <div id="ab-result" style="display:none;margin-top:16px" class="ab-result">
          <div class="ab-winner" id="ab-winner-text">Version A gagne</div>
          <div class="ab-analysis" id="ab-analysis-text"></div>
        </div>
      </div>
    </div>

  </div><!-- /max-width container -->
</div><!-- /app -->

<!-- SIGNUP -->
<div class="modal-bg" id="signup-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('signup-modal')">✕</button>
    <!-- Header avec valeur -->
    <div class="signup-header">
      <div class="signup-logo">⚡ VIRALBOOST</div>
      <h2 class="signup-title">Rejoins la communauté</h2>
      <p class="signup-subtitle">Gratuit · Sans carte · En ligne en 30 secondes</p>
    </div>
    <!-- Bénéfices rapides -->
    <div class="signup-benefits">
      <div class="signup-benefit">✅ Publie ta pub devant des milliers de créateurs</div>
      <div class="signup-benefit">✅ Trouve des collaborateurs via le matching IA</div>
      <div class="signup-benefit">✅ Accès au chat communautaire & groupes</div>
    </div>
    <!-- Formulaire simplifié -->
    <div class="signup-form">
      <input type="email" id="s-email" placeholder="📧 Ton email *" class="signup-input"/>
      <input type="password" id="s-pass" placeholder="🔒 Mot de passe (8 car. min.) *" class="signup-input"/>
    </div>
    <!-- Plan caché (FREE par défaut) -->
    <div style="display:none"><div class="signup-plans" id="signup-plans-grid"></div></div>
    <button class="btn-signup-big" onclick="signup()">🚀 Créer mon compte gratuit →</button>
    <div class="signup-footer-note">✓ Gratuit pour toujours · Upgrade quand tu veux</div>
    <div class="modal-switch">Déjà inscrit ? <a onclick="switchModal('signup-modal','login-modal')">Se connecter</a></div>
  </div>
</div>

<!-- LOGIN -->
<div class="modal-bg" id="login-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('login-modal')">✕</button>
    <h2>CONNEXION</h2>
    <div class="modal-sub">CONTENT DE TE REVOIR 👋</div>
    <div class="fg"><label>Email</label><input type="email" id="l-email" placeholder="marie@exemple.fr"/></div>
    <div class="fg"><label>Mot de passe</label><input type="password" id="l-pass" placeholder="Ton mot de passe"/></div>
    <button class="btn-modal-g" onclick="login()">Se connecter →</button>
    <div class="modal-switch">Pas de compte ? <a onclick="switchModal('login-modal','signup-modal')">S'inscrire</a></div>
  </div>
</div>

<!-- PAYMENT -->
<div class="modal-bg" id="payment-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('payment-modal')">✕</button>
    <h2>ABONNEMENT</h2>
    <div class="modal-sub">SANS ENGAGEMENT · ANNULABLE ANYTIME</div>
    <div class="pay-sum">
      <div class="pay-plan" id="pay-plan-name">STARTER</div>
      <div class="pay-price" id="pay-plan-price">3€</div>
      <div class="pay-period">/mois</div>
    </div>
    <div id="card-element"></div>
    <div id="card-errors"></div>
    <button class="btn-modal-g" id="btn-pay" onclick="processPayment()">🔒 S'abonner maintenant</button>
    <div style="text-align:center;margin-top:7px;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">CRYPTÉ · STRIPE · SANS ENGAGEMENT</div>
  </div>
</div>

<!-- REPORT MODAL -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">SIGNALEMENT TRANSMIS À L'ADMIN</div>
    <div class="report-reason">
      <label><input type="radio" name="report-reason" value="spam"/> Spam / Publicité abusive</label>
      <label><input type="radio" name="report-reason" value="harcelement"/> Harcèlement</label>
      <label><input type="radio" name="report-reason" value="contenu_inapproprie"/> Contenu inapproprié</label>
      <label><input type="radio" name="report-reason" value="arnaque"/> Arnaque / Fraude</label>
      <label><input type="radio" name="report-reason" value="autre"/> Autre</label>
    </div>
    <div class="fg"><label>Détails (optionnel)</label><textarea id="report-details" rows="3" placeholder="Donne plus d'infos..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Envoyer le signalement</button>
  </div>
</div>

<!-- CREATE GROUP MODAL (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CRÉER UN GROUPE</h2>
    <div class="modal-sub">RÉSERVÉ AUX MEMBRES ELITE 🏆</div>
    <div class="group-settings-section">
      <h3>Informations du groupe</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Nom du groupe *</label><input type="text" id="cg-name" placeholder="Marketing Digital Pro"/></div>
        <div class="fg"><label>Emoji icône</label><input type="text" id="cg-emoji" placeholder="💼" maxlength="2"/></div>
        <div class="fg"><label>Thème / Catégorie</label><select id="cg-cat"><option value="marketing">📢 Marketing / Pub</option><option value="saas">🚀 SaaS / Tech</option><option value="ecommerce">🛍️ E-commerce</option><option value="tiktok">🎵 TikTok / Créateurs</option><option value="business">💼 Business</option><option value="freelance">💻 Freelance</option><option value="autre">📦 Autre</option></select></div>
        <div class="fg"><label>Membres max</label><select id="cg-max"><option value="50">50 membres</option><option value="100">100 membres</option><option value="500">500 membres</option><option value="0">Illimité</option></select></div>
      </div>
      <div class="fg"><label>Description</label><textarea id="cg-desc" rows="2" placeholder="À quoi sert ce groupe ? Qui peut rejoindre ?"></textarea></div>
    </div>
    <div class="group-settings-section">
      <h3>🔧 Paramètres de modération</h3>
      <div class="toggle-row"><label>Autoriser les photos dans le groupe</label><label class="toggle"><input type="checkbox" id="cg-allow-photos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Autoriser les vidéos</label><label class="toggle"><input type="checkbox" id="cg-allow-videos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Autoriser les fichiers</label><label class="toggle"><input type="checkbox" id="cg-allow-files"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Groupe privé (sur invitation)</label><label class="toggle"><input type="checkbox" id="cg-private"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Modération des messages avant publication</label><label class="toggle"><input type="checkbox" id="cg-premod"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Fond d'écran personnalisé pour le groupe</label><label class="toggle"><input type="checkbox" id="cg-wallpaper-enable"/><span class="toggle-slider"></span></label></div>
    </div>
    <button class="btn-modal-g" onclick="createGroup()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">🏆 Créer le groupe</button>
  </div>
</div>

<!-- WALLPAPER MODAL (ELITE) -->
<div class="modal-bg" id="wallpaper-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('wallpaper-modal')">✕</button>
    <h2>FOND D'ÉCRAN</h2>
    <div class="modal-sub">PERSONNALISE TON ESPACE — ELITE ONLY 🏆</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div onclick="setWallpaper('none')" style="height:70px;background:var(--bg);border:2px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--muted)">Aucun</div>
      <div onclick="setWallpaper('linear-gradient(135deg,#040a05,#0b2810)')" style="height:70px;background:linear-gradient(135deg,#040a05,#0b2810);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#0a0014,#1a0028)')" style="height:70px;background:linear-gradient(135deg,#0a0014,#1a0028);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#001a0a,#0a1f0a,#001210)')" style="height:70px;background:linear-gradient(135deg,#001a0a,#0a1f0a,#001210);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#1a0a00,#2a1000)')" style="height:70px;background:linear-gradient(135deg,#1a0a00,#2a1000);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#00101a,#001428)')" style="height:70px;background:linear-gradient(135deg,#00101a,#001428);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
    </div>
    <div class="fg"><label>Ou importe une image</label><input type="file" id="wallpaper-file" accept="image/*" onchange="setWallpaperFromFile(this)"/></div>
  </div>
</div>

<!-- DM ADMIN MODAL (ELITE) -->
<div class="modal-bg" id="dm-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-admin-modal')">✕</button>
    <h2>MESSAGE À L'ADMIN</h2>
    <div class="modal-sub">MESSAGE PRIVÉ — ELITE ONLY 🏆</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-admin-msgs"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-admin-input" placeholder="Ton message à l'admin..." onkeydown="if(event.key==='Enter')sendAdminDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendAdminDM()" style="padding:9px 18px">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- GROUP CHAT MODAL -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div class="modal-sub" id="group-chat-sub">DISCUSSION DE GROUPE</div>
    <div style="display:flex;gap:12px">
      <div style="flex:1">
        <div class="chat-box" style="height:400px">
          <div class="chat-msgs-area" id="group-chat-msgs"></div>
          <div class="chat-input-row" style="align-items:center">
            <label id="group-media-upload-label" style="cursor:pointer;color:var(--g3);font-size:18px;flex-shrink:0;display:none" title="Ajouter media">
              <input type="file" id="group-media-input" accept="image/*,video/*" style="display:none" onchange="sendGroupMedia(this)"/>📎
            </label>
            <input type="text" id="group-chat-in" class="chat-input-field" placeholder="Écris ton message..."/>
            <button class="btn-send" onclick="sendGroupMsg()">→</button>
          </div>
        </div>
      </div>
      <div id="group-members-sidebar" style="width:180px;background:var(--s1);border:1px solid var(--border2);border-radius:10px;padding:12px;max-height:430px;overflow-y:auto">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">MEMBRES</div>
        <div id="group-members-list" style="font-size:12px;color:var(--muted)"></div>
        <div id="group-admin-controls" style="display:none;margin-top:12px;border-top:1px solid var(--border2);padding-top:10px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:2px;margin-bottom:8px">MODÉRATION</div>
          <button onclick="openGroupSettings()" style="width:100%;padding:6px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:5px;font-size:11px;color:var(--gold);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;margin-bottom:5px">⚙️ Paramètres</button>
          <button onclick="openModal('wallpaper-modal')" style="width:100%;padding:6px;background:transparent;border:1px solid var(--border);border-radius:5px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">🖼️ Fond d'écran</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DM MODAL -->
<div class="modal-bg" id="dm-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-modal')">✕</button>
    <h2>MESSAGE PRIVÉ</h2>
    <div class="modal-sub" id="dm-modal-sub">À : ...</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-msgs-list"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-input" placeholder="Ton message..." onkeydown="if(event.key==='Enter')sendDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendDM()" style="padding:9px 18px">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT PROFILE -->
<div class="modal-bg" id="edit-profile-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('edit-profile-modal')">✕</button>
    <h2>MON PROFIL</h2>
    <div class="modal-sub">BIEN PLUS COMPLET QUE LES AUTRES RÉSEAUX</div>

    <div class="edit-section">
      <h3>Identité & Avatar</h3>
      <div class="edit-avatar-row">
        <div class="edit-avatar-big" id="edit-ava-preview" style="background:var(--g2)" onclick="document.getElementById('ava-file-input')?.click()" title="Clique pour uploader une photo">
          <span id="edit-ava-emoji">🙂</span>
          <img id="edit-ava-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%"/>
          <div class="ava-upload-overlay"></div>
          <input type="file" id="ava-file-input" accept="image/*" style="display:none;position:absolute" onchange="handleAvatarUpload(this)"/>
        </div>
        <div style="flex:1">
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Clique sur l'avatar pour uploader une photo · ou choisis un emoji</div>
          <div style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px">GRATUIT</div>
          <div class="emoji-picker" style="margin-bottom:10px">
            <div class="emoji-opt" onclick="selectEmoji(this,'🙂')">🙂</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😎')">😎</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🤩')">🤩</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😏')">😏</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧐')">🧐</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🚀')">🚀</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'💡')">💡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🎯')">🎯</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🔥')">🔥</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'⚡')">⚡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🌍')">🌍</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧠')">🧠</div>
          </div>
          <div style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:1px">✨ PREMIUM (STARTER+)</div>
          <div class="emoji-picker">
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'💎','starter')">💎</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'👑','pro')">👑</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦁','starter')">🦁</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🐉','pro')">🐉</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🌟','starter')">🌟</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🏆','pro')">🏆</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦊','starter')">🦊</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🤖','starter')">🤖</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦄','elite')">🦄</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'👾','pro')">👾</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🧬','elite')">🧬</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🔮','elite')">🔮</div>
          </div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Prénom *</label><input type="text" id="ep-name" placeholder="Marie"/></div>
        <div class="fg"><label>Pseudo *</label><input type="text" id="ep-username" placeholder="marie_creator"/></div>
        <div class="fg"><label>Titre / Métier</label><input type="text" id="ep-title" placeholder="Créatrice de contenu · Dev indie"/></div>
        <div class="fg"><label>Localisation</label><input type="text" id="ep-location" placeholder="Paris, France 🇫🇷"/></div>
      </div>
      <div class="fg"><label>Bio</label><textarea id="ep-bio" rows="3" placeholder="Raconte qui tu es, ce que tu crées, ce qui te passionne..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>À propos (ultra-détaillé)</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Secteur / Niche</label><input type="text" id="ep-niche" placeholder="Marketing digital, Tech, Fitness..."/></div>
        <div class="fg"><label>Expérience</label><select id="ep-exp"><option>Débutant (0-1 an)</option><option>Intermédiaire (1-3 ans)</option><option>Confirmé (3-5 ans)</option><option>Expert (5+ ans)</option></select></div>
        <div class="fg"><label>Disponibilité</label><select id="ep-dispo"><option>Ouvert aux collaborations</option><option>Disponible pour missions</option><option>En recherche d'investisseur</option><option>Cherche associé</option><option>Simplement en réseau</option></select></div>
        <div class="fg"><label>Revenus/mois (optionnel)</label><select id="ep-revenue"><option value="">Non précisé</option><option>0–500€</option><option>500–2 000€</option><option>2 000–5 000€</option><option>5 000–10 000€</option><option>10 000€+</option></select></div>
        <div class="fg"><label>Objectif principal</label><input type="text" id="ep-goal" placeholder="Atteindre 100K abonnés en 2025"/></div>
        <div class="fg"><label>Compétences clés</label><input type="text" id="ep-skills" placeholder="Vidéo, Copywriting, SEO, Dev..."/></div>
        <div class="fg"><label>Outils utilisés</label><input type="text" id="ep-tools" placeholder="CapCut, Canva, Notion, Figma..."/></div>
        <div class="fg"><label>Langues parlées</label><input type="text" id="ep-langs" placeholder="Français, Anglais, Espagnol..."/></div>
      </div>
      <div class="fg"><label>Ce que je recherche</label><textarea id="ep-looking" rows="2" placeholder="Je cherche des collaborateurs, un associé, des clients, des conseils..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>Réseaux & Liens</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>🌐 Site web</label><input type="url" id="ep-website" placeholder="https://monsite.fr"/></div>
        <div class="fg"><label>🎵 TikTok</label><input type="text" id="ep-tiktok" placeholder="@moncompte"/></div>
        <div class="fg"><label>📸 Instagram</label><input type="text" id="ep-instagram" placeholder="@moncompte"/></div>
        <div class="fg"><label>🐦 Twitter/X</label><input type="text" id="ep-twitter" placeholder="@moncompte"/></div>
        <div class="fg"><label>💼 LinkedIn</label><input type="url" id="ep-linkedin" placeholder="linkedin.com/in/..."/></div>
        <div class="fg"><label>▶️ YouTube</label><input type="text" id="ep-youtube" placeholder="@moncompte"/></div>
      </div>
    </div>

    <div class="edit-section">
      <h3>Mes chiffres (optionnel)</h3>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px">
        <div class="fg"><label>Abonnés TikTok</label><input type="text" id="ep-tiktok-count" placeholder="45 000"/></div>
        <div class="fg"><label>Abonnés Instagram</label><input type="text" id="ep-ig-count" placeholder="12 000"/></div>
        <div class="fg"><label>Projets lancés</label><input type="text" id="ep-projects-count" placeholder="3"/></div>
        <div class="fg"><label>Ventes / Clients</label><input type="text" id="ep-sales" placeholder="150"/></div>
      </div>
    </div>

    <button class="btn-modal-g" onclick="saveProfile()">💾 Sauvegarder le profil</button>
  </div>
</div>

<!-- PUBLISH LANDING (avant inscription) -->
<div class="modal-bg" id="publish-landing-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('publish-landing-modal')">✕</button>
    <h2>PUBLIER UNE PUBLICITÉ</h2>
    <div class="modal-sub">DIFFUSION IMMÉDIATE SUR VIRALBOOST · SANS COMPTE REQUIS</div>
    <div class="fg"><label>Titre de ta publicité *</label><input type="text" id="pl-title" placeholder="Ex: ContentPro — L'outil IA pour créateurs"/></div>
    <div class="fg"><label>Message publicitaire *</label><textarea id="pl-text" rows="4" placeholder="Décris ton produit, service, projet... Sois accrocheur !"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Catégorie</label><select id="pl-type"><option value="saas">🚀 SaaS / App</option><option value="site">🌐 Site web</option><option value="ecommerce">🛍️ E-commerce</option><option value="service">💼 Service</option><option value="coaching">🎓 Coaching</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option></select></div>
      <div class="fg"><label>URL (optionnel)</label><input type="url" id="pl-url" placeholder="https://..."/></div>
    </div>
    <div class="fg">
      <label>Image / Vidéo (optionnel)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        📎 Ajouter un fichier
        <input type="file" id="pl-media" accept="image/*,video/*" style="display:none" onchange="handleLandingMediaUpload(this)"/>
      </label>
      <div id="pl-media-preview" style="margin-top:8px"></div>
    </div>
    <button class="btn-modal-g" onclick="publishLandingAd()">📢 Publier maintenant</button>
    <div class="modal-switch">Tu as un compte ? <a onclick="switchModal('publish-landing-modal','login-modal')">Se connecter</a> · <a onclick="switchModal('publish-landing-modal','signup-modal')">S'inscrire</a></div>
  </div>
</div>

<!-- CRÉER GROUPE (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CRÉER UN GROUPE</h2>
    <div class="modal-sub">FONCTIONNALITÉ ELITE — TU ES ADMIN DU GROUPE</div>
    <div class="edit-grid">
      <div class="fg"><label>Nom du groupe *</label><input type="text" id="grp-name" placeholder="Ex: SaaS Builders FR"/></div>
      <div class="fg"><label>Emoji / Icône</label><input type="text" id="grp-emoji" placeholder="🚀" maxlength="2"/></div>
    </div>
    <div class="fg"><label>Description *</label><textarea id="grp-desc" rows="2" placeholder="De quoi parle ce groupe ?"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Catégorie</label><select id="grp-cat"><option>SaaS / Tech</option><option>Marketing</option><option>TikTok / Instagram</option><option>E-commerce</option><option>Coaching</option><option>Crypto / Finance</option><option>Autre</option></select></div>
      <div class="fg"><label>Accès</label><select id="grp-access"><option value="public">🌍 Public</option><option value="private">🔒 Privé (sur invitation)</option></select></div>
    </div>
    <div class="fg"><label>Image de fond (URL ou upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Fond du groupe
        <input type="file" id="grp-bg-input" accept="image/*" style="display:none" onchange="handleGroupBgUpload(this)"/>
      </label>
      <div id="grp-bg-preview" style="margin-top:8px"></div>
    </div>
    <div class="fg"><label>Règles du groupe (optionnel)</label><textarea id="grp-rules" rows="2" placeholder="Ex: Pas de spam. Sujets liés au SaaS uniquement."></textarea></div>
    <div style="background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:8px;padding:12px;margin-bottom:14px;font-size:12px;color:var(--g5)">
      En tant qu'admin, tu pourras : modifier le fond, les règles, autoriser/interdire les photos, supprimer des membres, signaler des abus.
    </div>
    <button class="btn-modal-g" onclick="createGroup()">🏛️ Créer le groupe</button>
  </div>
</div>

<!-- SETTINGS GROUPE (ELITE admin) -->
<div class="modal-bg" id="group-settings-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-settings-modal')">✕</button>
    <h2>PARAMÈTRES DU GROUPE</h2>
    <div class="modal-sub">ADMINISTRATION — ELITE UNIQUEMENT</div>
    <div class="fg"><label>Autoriser les photos dans ce groupe</label>
      <select id="gs-allow-photos"><option value="1">✅ Oui, autorisées</option><option value="0">❌ Non, désactivées</option></select>
    </div>
    <div class="fg"><label>Nouveau fond (upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Modifier le fond
        <input type="file" id="gs-bg-input" accept="image/*" style="display:none" onchange="handleGroupSettingsBg(this)"/>
      </label>
    </div>
    <div class="fg"><label>Règles</label><textarea id="gs-rules" rows="2"></textarea></div>
    <div class="fg"><label>Mode privé</label>
      <select id="gs-access"><option value="public">🌍 Public</option><option value="private">🔒 Privé</option></select>
    </div>
    <button class="btn-modal-g" onclick="saveGroupSettings()">💾 Sauvegarder</button>
  </div>
</div>

<!-- CHAT GROUPE -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div style="display:flex;gap:8px;margin-bottom:8px" id="group-chat-actions"></div>
    <div class="chat-box" style="height:400px">
      <div class="chat-msgs-area" id="group-chat-msgs"></div>
      <div class="chat-input-row">
        <input type="text" id="group-chat-input" class="chat-input-field" placeholder="Message dans le groupe..." onkeydown="if(event.key==='Enter')sendGroupMessage()"/>
        <label id="group-media-btn" style="display:none;cursor:pointer;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0" title="Joindre un fichier">
          📎<input type="file" id="group-chat-file" accept="image/*,video/*" style="display:none" onchange="handleGroupChatFile(this)"/>
        </label>
        <button class="btn-send" onclick="sendGroupMessage()">→</button>
      </div>
    </div>
  </div>
</div>

<!-- SIGNALER UN UTILISATEUR -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">SIGNALEMENT TRANSMIS À L'ADMIN</div>
    <div class="fg"><label>Raison du signalement *</label>
      <select id="report-reason">
        <option value="spam">🚫 Spam / Publicité abusive</option>
        <option value="harcelement">⚠️ Harcèlement / Insultes</option>
        <option value="contenu">🔞 Contenu inapproprié</option>
        <option value="arnaque">💸 Arnaque / Fraude</option>
        <option value="autre">📝 Autre</option>
      </select>
    </div>
    <div class="fg"><label>Détails (optionnel)</label><textarea id="report-details" rows="3" placeholder="Explique ce qui s'est passé..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Envoyer le signalement</button>
  </div>
</div>

<!-- CONTACTER L'ADMIN (ELITE) -->
<div class="modal-bg" id="contact-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('contact-admin-modal')">✕</button>
    <h2>MESSAGE À L'ADMIN</h2>
    <div class="modal-sub">FONCTIONNALITÉ ELITE — RÉPONSE SOUS 24H</div>
    <div class="fg"><label>Objet</label><input type="text" id="ca-subject" placeholder="Ex: Demande de partenariat"/></div>
    <div class="fg"><label>Message *</label><textarea id="ca-message" rows="5" placeholder="Ton message à l'équipe ViralBoost..."></textarea></div>
    <button class="btn-modal-g" onclick="sendAdminMessage()">📩 Envoyer</button>
  </div>
</div>
<script>


// ════════════════════════════════════════
// ── SYSTÈME I18N FR / EN
// ════════════════════════════════════════
let currentLang = localStorage.getItem('vb_lang') || 'fr';

const i18n = {
  fr: {
    // Navbar
    nav_vitrine: 'Vitrine', nav_plans: 'Abonnements', nav_reviews: 'Avis',
    nav_login: 'Connexion', nav_join: 'Rejoindre →',
    mob_vitrine: '📊 Vitrine', mob_plans: '💎 Abonnements', mob_reviews: '⭐ Avis',
    // Hero
    hero_line1: 'REJOINS', hero_line2: 'VIRALBOOST.', hero_badge: '📢 PLATEFORME N°1 DE PUBLICITÉ DIGITALE', hero_sub_new: "La plateforme où les créateurs et entrepreneurs exposent leur projet, trouvent des partenaires et développent leur audience.",
      hero_cta1: "⚡ Rejoindre gratuitement →",
      hero_nocard: "Sans carte bancaire · Accès immédiat",
      feat1_title: "Publie ta pub", feat1_sub: "Visible immédiatement par tous",
      feat2_title: "Trouve des collabs", feat2_sub: "Matching avec des créateurs",
      feat3_title: "Développe ta notoriété", feat3_sub: "Votes, partages, visibilité", feat4_title: "Chat communautaire", feat4_sub: "Échange avec d'autres créateurs", feat5_title: "Classement des projets", feat5_sub: "Les meilleurs montent en top", feat6_title: "Audience ciblée", feat6_sub: "Créateurs, entrepreneurs, fondateurs", mono_title: "À partir de 1 000 abonnés — génère des revenus", mono_sub: "Active les soldes sur ton profil et monétise ta communauté directement depuis la plateforme.",
      hero_form_title: "📢 PUBLIE TA PUBLICITÉ EN 30 SECONDES",
      hero_form_btn: "📢 Publier ma publicité gratuitement →",
      hero_form_note: "✓ Gratuit · Visible immédiatement · Pas de carte requise",
      hero_login_link: "Déjà inscrit ? Se connecter",
    hero_cta2: 'Se connecter',
    how1_title: 'Publie ta pub', how2_title: 'Trouve un partenaire', how3_title: "Propulse avec l'IA",
    // Sections
    sec_feed: 'Fil public', sec_vitrine: 'Vitrine communautaire', sec_plans: 'Abonnements',
    // Bottom nav
    bn_feed: 'Fil', bn_vitrine: 'Vitrine', bn_profil: 'Profil',
    // Composer
    comp_label: '✦ FIL COMMUNAUTAIRE', comp_title: 'Partage à la communauté',
    comp_sub: 'Projets, idées, questions — ta voix compte ici.',
    comp_placeholder: 'Partage ton projet à la communauté…',
    // Feed tabs
    tab_all: 'Tout', tab_following: 'Abonnements', tab_top: 'Top du jour',
    // Buttons
    btn_publish: 'Publier', btn_addlink: '🔗 Ajouter un lien',
    // Toast
    toast_published: '📢 Publication postée !',
    toast_write: 'Écris quelque chose !',
    toast_limit_free: 'Plan FREE : 1 publication/heure. Upgrade pour plus !',
    toast_limit_day: "Limite de publications atteinte pour aujourd'hui.",
    // App tabs
    apptab_feed: 'Fil', apptab_vitrine: 'Vitrine', apptab_publish: 'Publier',
    apptab_chat: 'Chat', apptab_profil: 'Profil',
    // Profile
    prof_edit: '✏️ Modifier', prof_followers: 'Abonnés', prof_following: 'Abonnements', prof_projects: 'Projets', prof_votes: 'Votes reçus',
    // Vitrine
    vit_title: 'VITRINE COMMUNAUTAIRE', vit_sub: 'Projets partagés par la communauté',
    vit_empty: '🚀 Aucun projet pour ce filtre',
    vit_all: 'Tous',
    // Publish wizard
    wiz_title: 'CRÉER MA PUBLICITÉ',
    wiz_sub: 'Suis les 5 étapes pour créer une pub qui convertit et attire des votes.',
    // No posts
    no_posts: "Aucune publication pour l'instant.",
    // Login/signup modal
    login_title: 'CONNEXION', signup_title: 'CRÉER MON COMPTE',
    // Settings
    logout: 'Quitter',
    // URL field
    url_placeholder: 'https://ton-site.com',
    proj_placeholder: 'Nom du projet (optionnel)',
  },
  en: {
    // Navbar
    nav_vitrine: 'Showcase', nav_plans: 'Pricing', nav_reviews: 'Reviews',
    nav_login: 'Log in', nav_join: 'Join →',
    mob_vitrine: '📊 Showcase', mob_plans: '💎 Pricing', mob_reviews: '⭐ Reviews',
    // Hero
    hero_line1: 'JOIN', hero_line2: 'VIRALBOOST.', hero_badge: '📢 #1 DIGITAL ADVERTISING PLATFORM', hero_sub_new: "The platform where creators and entrepreneurs showcase their project, find partners and grow their audience.",
      hero_cta1: "⚡ Join for free →",
      hero_nocard: "No credit card · Instant access",
      feat1_title: "Publish your ad", feat1_sub: "Visible immediately to all",
      feat2_title: "Find collabs", feat2_sub: "Matched with creators",
      feat3_title: "Grow your reach", feat3_sub: "Votes, shares, visibility", feat4_title: "Community chat", feat4_sub: "Talk with other creators", feat5_title: "Project ranking", feat5_sub: "Best projects rise to the top", feat6_title: "Targeted audience", feat6_sub: "Creators, entrepreneurs, founders", mono_title: "From 1,000 followers — generate revenue", mono_sub: "Enable sales on your profile and monetize your community directly from the platform.",
      hero_form_title: "📢 PUBLISH YOUR AD IN 30 SECONDS",
      hero_form_btn: "📢 Publish my ad for free →",
      hero_form_note: "✓ Free · Visible instantly · No card required",
      hero_login_link: "Already a member? Sign in",
    hero_cta2: 'Log in',
    how1_title: 'Post your ad', how2_title: 'Find a partner', how3_title: 'Boost with AI',
    // Sections
    sec_feed: 'Public feed', sec_vitrine: 'Community Showcase', sec_plans: 'Pricing',
    // Bottom nav
    bn_feed: 'Feed', bn_vitrine: 'Showcase', bn_profil: 'Profile',
    // Composer
    comp_label: '✦ COMMUNITY FEED', comp_title: 'Share with the community',
    comp_sub: 'Projects, ideas, questions — your voice matters here.',
    comp_placeholder: 'Share your project with the community…',
    // Feed tabs
    tab_all: 'All', tab_following: 'Following', tab_top: "Today's top",
    // Buttons
    btn_publish: 'Post', btn_addlink: '🔗 Add a link',
    // Toast
    toast_published: '📢 Post published!',
    toast_write: 'Write something!',
    toast_limit_free: 'FREE plan: 1 post/hour. Upgrade for more!',
    toast_limit_day: 'Daily post limit reached.',
    // App tabs
    apptab_feed: 'Feed', apptab_vitrine: 'Showcase', apptab_publish: 'Publish',
    apptab_chat: 'Chat', apptab_profil: 'Profile',
    // Profile
    prof_edit: '✏️ Edit', prof_followers: 'Followers', prof_following: 'Following', prof_projects: 'Projects', prof_votes: 'Votes received',
    // Vitrine
    vit_title: 'COMMUNITY SHOWCASE', vit_sub: 'Projects shared by the community',
    vit_empty: '🚀 No projects for this filter',
    vit_all: 'All',
    // Publish wizard
    wiz_title: 'CREATE MY AD',
    wiz_sub: 'Follow the 5 steps to create an ad that converts and attracts votes.',
    // No posts
    no_posts: 'No posts yet.',
    // Login/signup modal
    login_title: 'LOG IN', signup_title: 'CREATE MY ACCOUNT',
    // Settings
    logout: 'Log out',
    // URL field
    url_placeholder: 'https://your-website.com',
    proj_placeholder: 'Project name (optional)',
  }
};

function t(key) {
  return (i18n[currentLang] && i18n[currentLang][key]) || (i18n['fr'][key]) || key;
}

function applyLang() {
  // Mettre à jour tous les éléments data-i18n
  // Utiliser innerText seulement si l'élément n'a pas d'enfants HTML complexes
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const val = t(key);
    // Si l'élément n'a que du texte (pas d'enfants elements), on remplace directement
    if(el.children.length === 0) {
      el.textContent = val;
    } else {
      // Sinon on cherche un noeud texte direct et on le met à jour
      for(let node of el.childNodes) {
        if(node.nodeType === 3 && node.textContent.trim()) {
          node.textContent = val;
          break;
        }
      }
    }
  });
  // Placeholders
  const ta = document.getElementById('feed-text');
  if(ta) ta.placeholder = t('comp_placeholder');
  const urlInp = document.getElementById('feed-url');
  if(urlInp) urlInp.placeholder = t('url_placeholder');
  const projInp = document.getElementById('feed-proj-name');
  if(projInp) projInp.placeholder = t('proj_placeholder');
  // Bouton langue — affiche la langue VERS laquelle on peut switcher
  const btn = document.getElementById('lang-btn');
  if(btn) btn.textContent = currentLang === 'fr' ? '🇬🇧 EN' : '🇫🇷 FR';
  // html lang + title
  document.documentElement.lang = currentLang;
  document.title = currentLang === 'fr'
    ? 'ViralBoost — Publie ta publicité, touche ta cible'
    : 'ViralBoost — Publish your ad, reach your audience';
  // Rebuild les sections dynamiques si app active
  if(document.getElementById('tab-vitrine')?.classList.contains('active')) buildVitrineGrid('app-vitrine-grid');
  if(document.getElementById('tab-feed')?.classList.contains('active')) buildFeed();
}

function toggleLang() {
  currentLang = currentLang === 'fr' ? 'en' : 'fr';
  localStorage.setItem('vb_lang', currentLang);
  applyLang();
}

// Appliquer au chargement
document.addEventListener('DOMContentLoaded', () => { applyLang(); });

const PLANS = [
  { id:'free', name:'FREE', price:0, period:'', desc:'Pour découvrir ViralBoost',
    features:['1 publication / heure','3 messages chat mondial / jour','Vitrine 1 heure','Profil public complet','Accès communauté'],
    limits:{pubsPerHour:1,chatMsgs:3,vitrineHours:1}
  },
  { id:'starter', name:'STARTER', price:3, period:'/mois', desc:'Pour commencer à propulser',
    features:['3 publications / jour','10 messages chat mondial / jour','Vitrine 7 jours','Coach IA (20 requêtes/mois)','DMs illimités','Badge Starter'],
    limits:{pubsPerDay:3,chatMsgs:10,vitrineHours:168}
  },
  { id:'pro', name:'PRO', price:14.99, period:'/mois', desc:'Pour les créateurs sérieux', recommended:true,
    features:['Publications illimitées','Chat mondial illimité','Vitrine 30j prioritaire','IA Boost illimité','Stats avancées','Badge Pro vérifié','Affiliation 30%'],
    limits:{pubsPerDay:999,chatMsgs:999,vitrineHours:720}
  },
  { id:'elite', name:'ELITE', price:39.99, period:'/mois', desc:'Pour dominer ton marché',
    features:['Tout du plan Pro','Vitrine permanente + épinglée','Badge Elite 🏆 doré sur actions','🏛️ Créer des groupes de discussion','Admin groupe complet','Signaler → transmis à admin','Message privé à l\'admin','Sessions coaching live','Commission 40%'],
    limits:{pubsPerDay:999,chatMsgs:999,vitrineHours:9999999}
  }
];


// ── SYSTÈME DE BADGES ──
const BADGES = [
  // ── PUBLICATIONS ──
  { id:'first_post',    emoji:'📝', name:'Première Pub',      desc:'Publie ton 1er post',             plan:null,    condition:u=>((u._postCount||0)>=1) },
  { id:'post5',         emoji:'🔥', name:'En Feu',            desc:'5 publications au total',          plan:null,    condition:u=>((u._postCount||0)>=5) },
  { id:'post20',        emoji:'💥', name:'Machine à Pub',     desc:'20 publications au total',         plan:null,    condition:u=>((u._postCount||0)>=20) },
  { id:'post50',        emoji:'🚀', name:'Rocket Publisher',  desc:'50 publications au total',         plan:null,    condition:u=>((u._postCount||0)>=50) },
  { id:'post100',       emoji:'💯', name:'Centenaire',        desc:'100 publications au total',        plan:'starter',condition:u=>((u._postCount||0)>=100) },
  { id:'post500',       emoji:'🌊', name:'Tsunami de Contenu',desc:'500 publications au total',        plan:'pro',   condition:u=>((u._postCount||0)>=500), special:true },
  // ── VOTES & POPULARITÉ ──
  { id:'first_vote',    emoji:'⚡', name:'Premier Vote',      desc:'Reçois ton 1er vote',             plan:null,    condition:u=>((u.totalVotes||0)>=1) },
  { id:'votes10',       emoji:'🎯', name:'Populaire',         desc:'10 votes reçus',                  plan:null,    condition:u=>((u.totalVotes||0)>=10) },
  { id:'votes50',       emoji:'🏅', name:'Influenceur',       desc:'50 votes reçus',                  plan:null,    condition:u=>((u.totalVotes||0)>=50) },
  { id:'votes100',      emoji:'🎖️', name:'Viral',             desc:'100 votes reçus',                 plan:'starter',condition:u=>((u.totalVotes||0)>=100) },
  { id:'votes500',      emoji:'🏆', name:'Phénomène',         desc:'500 votes reçus',                 plan:'pro',   condition:u=>((u.totalVotes||0)>=500), special:true },
  { id:'votes1000',     emoji:'💎', name:'Icon Viral',        desc:'1000 votes reçus',                plan:'elite', condition:u=>((u.totalVotes||0)>=1000), special:true },
  // ── PROFIL & RÉSEAU ──
  { id:'bio',           emoji:'✍️', name:'Profil Complet',   desc:'Ajoute ta bio',                   plan:null,    condition:u=>!!(u.bio&&u.bio.length>10) },
  { id:'profil_links',  emoji:'🔗', name:'Bien Connecté',    desc:'Ajoute 2 réseaux sociaux',         plan:null,    condition:u=>([u.tiktok,u.instagram,u.twitter,u.youtube,u.linkedin].filter(Boolean).length>=2) },
  { id:'profil_full',   emoji:'⭐', name:'Profil Gold',      desc:'Profil 100% complété',             plan:'starter',condition:u=>!!(u.bio&&u.name&&u.title&&u.location&&u.skills) },
  { id:'follow1',       emoji:'🤝', name:'Connecté',         desc:'Suis quelqu\'un',                  plan:null,    condition:u=>((u.following||[]).length>=1) },
  { id:'follow10',      emoji:'🌐', name:'Networker',        desc:'10 abonnements',                  plan:null,    condition:u=>((u.following||[]).length>=10) },
  { id:'follow50',      emoji:'🕸️', name:'Super Networker',  desc:'50 abonnements',                  plan:'starter',condition:u=>((u.following||[]).length>=50) },
  { id:'follow100',     emoji:'🌍', name:'Réseau Mondial',   desc:'100 abonnements',                 plan:'pro',   condition:u=>((u.following||[]).length>=100) },
  { id:'followers10',   emoji:'📣', name:'Leader d\'opinion',desc:'10 abonnés sur ton profil',        plan:null,    condition:u=>((u.followers||[]).length>=10) },
  { id:'followers50',   emoji:'📢', name:'Célébrité',        desc:'50 abonnés sur ton profil',        plan:'starter',condition:u=>((u.followers||[]).length>=50) },
  { id:'followers100',  emoji:'🌟', name:'Star VB',          desc:'100 abonnés sur ton profil',       plan:'pro',   condition:u=>((u.followers||[]).length>=100) },
  // ── MESSAGES & SOCIAL ──
  { id:'dm_king',       emoji:'💬', name:'DM King',          desc:'Envoie 5 messages privés',         plan:'starter',condition:u=>(['starter','pro','elite'].includes(u.plan)&&(u._dmCount||0)>=5) },
  { id:'dm_master',     emoji:'📨', name:'DM Master',        desc:'Envoie 50 messages privés',        plan:'pro',   condition:u=>((u._dmCount||0)>=50) },
  { id:'chat_pioneer',  emoji:'🗨️', name:'Pionnier du Chat', desc:'Envoie 20 messages dans le chat',  plan:null,    condition:u=>((u._chatCount||0)>=20) },
  { id:'chat_legend',   emoji:'🎙️', name:'Voix de la Comm.', desc:'Envoie 200 messages dans le chat', plan:'starter',condition:u=>((u._chatCount||0)>=200) },
  { id:'group_member',  emoji:'👥', name:'Membre Actif',     desc:'Rejoint 1 groupe',                 plan:null,    condition:u=>((u._groupCount||0)>=1) },
  { id:'group_chatter', emoji:'💭', name:'Grand Parleur',    desc:'50 messages dans des groupes',     plan:'starter',condition:u=>((u._groupMsgs||0)>=50) },
  // ── IA & STRATÉGIE ──
  { id:'ia_first',      emoji:'🤖', name:'IA Explorer',      desc:'Utilise IA Boost 1 fois',          plan:null,    condition:u=>((u._iaCount||0)>=1) },
  { id:'ia_master',     emoji:'🧠', name:'IA Master',        desc:'Utilise IA Boost 10 fois',         plan:'pro',   condition:u=>(['pro','elite'].includes(u.plan)&&(u._iaCount||0)>=10) },
  { id:'ia_addict',     emoji:'🔮', name:'IA Addict',        desc:'Utilise IA Boost 50 fois',         plan:'pro',   condition:u=>((u._iaCount||0)>=50), special:true },
  { id:'ab_test',       emoji:'🔬', name:'Expérimentateur',  desc:'Lance un A/B test IA',             plan:'pro',   condition:u=>((u._abTests||0)>=1) },
  // ── VITRINE & PROJETS ──
  { id:'first_vitrine', emoji:'✨', name:'En Vitrine',       desc:'Publie ton 1er projet en vitrine', plan:null,    condition:u=>((u._projectCount||0)>=1) },
  { id:'vitrine5',      emoji:'🖼️', name:'Galerie',          desc:'5 projets en vitrine',             plan:'starter',condition:u=>((u._projectCount||0)>=5) },
  { id:'vitrine10',     emoji:'🎭', name:'Portfolio Pro',    desc:'10 projets en vitrine',            plan:'pro',   condition:u=>((u._projectCount||0)>=10) },
  // ── CRÉDITS & SHOP ──
  { id:'credits50',     emoji:'⚡', name:'Chargé',           desc:'Accumule 50 ViralCrédits',         plan:null,    condition:u=>(userCredits>=50) },
  { id:'credits200',    emoji:'💸', name:'Rich Creator',     desc:'Accumule 200 ViralCrédits',        plan:'starter',condition:u=>(userCredits>=200) },
  { id:'credits1000',   emoji:'💰', name:'Millionnaire VB',  desc:'Accumule 1000 ViralCrédits',       plan:'pro',   condition:u=>(userCredits>=1000), special:true },
  { id:'shop_first',    emoji:'🛒', name:'Premier Achat',    desc:'Achète quelque chose en boutique', plan:null,    condition:u=>((u._shopBuys||0)>=1) },
  { id:'shop_power',    emoji:'🏪', name:'Gros Dépensier',   desc:'10 achats en boutique',            plan:'starter',condition:u=>((u._shopBuys||0)>=10) },
  // ── COLLABS & MATCHING ──
  { id:'first_collab',  emoji:'🤝', name:'Premier Collab',   desc:'Propose une collaboration',        plan:null,    condition:u=>((u._collabCount||0)>=1) },
  { id:'collab5',       emoji:'🏗️', name:'Bâtisseur',        desc:'5 collaborations proposées',       plan:'starter',condition:u=>((u._collabCount||0)>=5) },
  { id:'collab_master', emoji:'🌐', name:'Collab Master',    desc:'10 collaborations',                plan:'pro',   condition:u=>((u._collabCount||0)>=10), special:true },
  // ── RÉACTIONS ──
  { id:'first_react',   emoji:'😍', name:'Réactif',          desc:'Envoie 1 réaction enrichie',       plan:null,    condition:u=>((u._reactCount||0)>=1) },
  { id:'react50',       emoji:'🎉', name:'Exprès-sif',       desc:'50 réactions envoyées',            plan:null,    condition:u=>((u._reactCount||0)>=50) },
  { id:'react200',      emoji:'🎊', name:'Roi des Réactions',desc:'200 réactions envoyées',           plan:'starter',condition:u=>((u._reactCount||0)>=200) },
  // ── LIKES ──
  { id:'like10',        emoji:'❤️', name:'Cœur Généreux',   desc:'Aime 10 publications',             plan:null,    condition:u=>((u._likeCount||0)>=10) },
  { id:'like100',       emoji:'💝', name:'Fan Club',         desc:'100 likes donnés',                 plan:null,    condition:u=>((u._likeCount||0)>=100) },
  { id:'like500',       emoji:'💗', name:'Love Machine',     desc:'500 likes donnés',                 plan:'starter',condition:u=>((u._likeCount||0)>=500) },
  // ── COMMENTAIRES ──
  { id:'comment5',      emoji:'💡', name:'Commentateur',     desc:'Laisse 5 commentaires',            plan:null,    condition:u=>((u._commentCount||0)>=5) },
  { id:'comment20',     emoji:'📢', name:'Voix Active',      desc:'20 commentaires laissés',          plan:'starter',condition:u=>((u._commentCount||0)>=20) },
  // ── PARTAGES ──
  { id:'share5',        emoji:'📤', name:'Partageur',        desc:'Partage 5 publications',           plan:null,    condition:u=>((u._shareCount||0)>=5) },
  { id:'share20',       emoji:'📡', name:'Ambassadeur',      desc:'Partage 20 publications',          plan:'starter',condition:u=>((u._shareCount||0)>=20) },
  // ── ANCIENNETÉ ──
  { id:'early',         emoji:'🌱', name:'Pionnier',         desc:'Membre fondateur 2025-2026',       plan:null,    condition:u=>!!(u.createdAt&&new Date(u.createdAt)<new Date('2026-06-01')) },
  { id:'week1',         emoji:'📅', name:'1 Semaine',        desc:'Membre depuis 7 jours',            plan:null,    condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=7*86400000) },
  { id:'month1',        emoji:'🗓️', name:'1 Mois',           desc:'Membre depuis 30 jours',           plan:null,    condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=30*86400000) },
  { id:'month6',        emoji:'🎂', name:'6 Mois',           desc:'Membre depuis 6 mois',             plan:'starter',condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=180*86400000) },
  { id:'year1',         emoji:'🎆', name:'1 An',             desc:'Membre depuis 1 an',               plan:'pro',   condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=365*86400000), special:true },
  // ── MISSIONS ──
  { id:'mission5',      emoji:'🎯', name:'Chasseur de Missions',desc:'Complete 5 missions',           plan:null,    condition:u=>((u._missionsCompleted||0)>=5) },
  { id:'mission20',     emoji:'🏹', name:'Mission Impossible',  desc:'Complete 20 missions',          plan:'starter',condition:u=>((u._missionsCompleted||0)>=20) },
  { id:'streak3',       emoji:'🔑', name:'Régulier',         desc:'Connexion 3 jours d\'affilée',     plan:null,    condition:u=>((u._loginStreak||0)>=3) },
  { id:'streak7',       emoji:'🔑', name:'Discipline',       desc:'Connexion 7 jours d\'affilée',     plan:'starter',condition:u=>((u._loginStreak||0)>=7) },
  { id:'streak30',      emoji:'🏋️', name:'Athlète du Contenu',desc:'30 jours de connexion consécutifs',plan:'pro',  condition:u=>((u._loginStreak||0)>=30), special:true },
  // ── PLANS ──
  { id:'starter_badge', emoji:'🟢', name:'Starter',          desc:'Plan Starter activé',             plan:'starter',condition:u=>['starter','pro','elite'].includes(u.plan) },
  { id:'pro_badge',     emoji:'✅', name:'PRO Vérifié',      desc:'Plan Pro activé',                  plan:'pro',   condition:u=>['pro','elite'].includes(u.plan) },
  { id:'affiliate',     emoji:'💰', name:'Affilié',          desc:'Pro + programme affiliation',      plan:'pro',   condition:u=>(['pro','elite'].includes(u.plan)) },
  { id:'elite_badge',   emoji:'🏆', name:'ELITE',            desc:'Plan Elite activé',                plan:'elite', condition:u=>(u.plan==='elite') },
  { id:'group_founder', emoji:'🏛️', name:'Fondateur',        desc:'Crée un groupe (Elite)',           plan:'elite', condition:u=>(u.plan==='elite'&&(u._groupCount||0)>=1) },
  { id:'legend',        emoji:'👑', name:'LÉGENDE',          desc:'Elite + 100 votes + 20 pubs',      plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=100&&(u._postCount||0)>=20), special:true },
  { id:'king',          emoji:'💎', name:'DIAMOND KING',     desc:'Elite + 200 votes au top',         plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=200), special:true },
  { id:'god',           emoji:'🌌', name:'VIRAL GOD',        desc:'Elite + 1000 votes + 500 pubs',    plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=1000&&(u._postCount||0)>=500), special:true },
  // ── CRÉDITS UTILISÉS POUR PLANS ──
  { id:'plan_credits',  emoji:'🪙', name:'Acheteur Malin',   desc:'Achète un plan avec des crédits',  plan:null,    condition:u=>((u._planBoughtWithCredits||0)>=1), special:false },
];

function getUserBadges(u){
  return BADGES.map(b=>({...b, unlocked: b.condition(u)}));
}

function renderBadges(u){
  const badges = getUserBadges(u);
  const unlocked = badges.filter(b=>b.unlocked).length;
  return `
  <div class="badges-section">
    <h3>🏅 MES BADGES <span style="font-size:10px;color:var(--muted);font-weight:400">${unlocked}/${badges.length} débloqués</span></h3>
    <div class="badges-grid">
      ${badges.map(b=>{
        const bonus = BADGE_CREDITS[b.id]||5;
        return `<div class="badge-item ${b.unlocked?'unlocked':'locked'} ${b.special?'special':''}">
          ${!b.unlocked?'<span class="badge-lock-icon">🔒</span>':''}
          <div class="badge-emoji">${b.emoji}</div>
          <div class="badge-name">${b.name}</div>
          ${b.plan?`<div class="badge-plan-tag badge-plan-${b.plan}">${b.plan.toUpperCase()}</div>`:''}
          <div class="badge-reward">+${bonus}⚡</div>
          <div class="badge-tooltip">${b.desc} · +${bonus} crédits</div>
        </div>`;
      }).join('')}
    </div>
  </div>`;
}


let worldChatMsgs=[],dmTarget=null,dmThreads={},ws=null,wsRetries=0;
let myVotes=new Set(JSON.parse(localStorage.getItem('vb_votes')||'[]'));
let posts=[],selectedSignupPlan='free';
let groupsData=[];
let currentGroupId=null;
let pendingMediaUrl=null, pendingLandingMediaUrl=null, pendingPubMediaUrl=null;
let reportTarget=null;
let currentGroupSettingsId=null;
let groupBgUrl=null, groupSettingsBgUrl=null;

// Crédits offerts par badge
const BADGE_CREDITS = {
  first_post:5, post5:10, post20:20, post50:35, post100:60, post500:150,
  first_vote:5, votes10:15, votes50:30, votes100:50, votes500:100, votes1000:200,
  bio:10, profil_links:12, profil_full:25,
  follow1:5, follow10:15, follow50:30, follow100:50,
  followers10:15, followers50:35, followers100:60,
  dm_king:15, dm_master:40,
  chat_pioneer:10, chat_legend:30,
  group_member:10, group_chatter:25,
  ia_first:10, ia_master:30, ia_addict:75, ab_test:20,
  first_vitrine:12, vitrine5:25, vitrine10:50,
  credits50:15, credits200:30, credits1000:100,
  shop_first:10, shop_power:30,
  first_collab:15, collab5:35, collab_master:80,
  first_react:5, react50:20, react200:50,
  like10:8, like100:25, like500:60,
  comment5:10, comment20:30,
  share5:10, share20:30,
  early:20, week1:10, month1:25, month6:60, year1:150,
  mission5:20, mission20:60,
  streak3:15, streak7:35, streak30:100,
  starter_badge:20, pro_badge:50, affiliate:25,
  elite_badge:100, group_founder:40, legend:150, king:200, god:500,
  plan_credits:30,
};

function checkNewBadges(){
  if(!currentUser) return;
  const saved = JSON.parse(localStorage.getItem('vb_earned_badges')||'[]');
  const savedSet = new Set(saved);
  const nowUnlocked = BADGES.filter(b => b.condition(currentUser)).map(b=>b.id);
  const newOnes = nowUnlocked.filter(id => !savedSet.has(id));
  if(newOnes.length){
    newOnes.forEach(id=>{
      const b = BADGES.find(x=>x.id===id);
      const bonus = BADGE_CREDITS[id]||5;
      if(b){
        setTimeout(()=>{
          addCredits(bonus);
          toast(`${b.emoji} Badge débloqué : ${b.name} ! +${bonus}⚡`);
        }, 300);
        savedSet.add(id);
      }
    });
    localStorage.setItem('vb_earned_badges', JSON.stringify([...savedSet]));
  }
}

// ── TOAST ──
function toast(msg,type='success'){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className='toast-g'+(type==='success'?' success':'');
  t.textContent=msg;
  c.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(50px)';t.style.transition='all 0.3s';setTimeout(()=>t.remove(),300);},3000);
}

// ── PLANS RENDER ──
function renderPlans(){
  // Landing plans grid
  const g=document.getElementById('landing-plans');
  if(g) g.innerHTML=PLANS.map(p=>`
    <div class="plan-card ${p.recommended?'recommended':''}">
      ${p.recommended?'<div class="plan-badge">⭐ POPULAIRE</div>':''}
      <div class="plan-name">${p.name}</div>
      <div class="plan-price">${p.price===0?'0':''+p.price+'€'}</div>
      <div class="plan-period">${p.price===0?'Gratuit':p.period}</div>
      <div class="plan-desc">${p.desc}</div>
      <ul class="plan-features">${p.features.map(f=>`<li>${f}</li>`).join('')}</ul>
      <button class="btn-plan-g ${p.recommended?'btn-plan-solid-g':'btn-plan-outline-g'}" onclick="${p.price===0?`openModal('signup-modal')`:`startPayment('${p.id}')`}">${p.price===0?'Commencer gratuitement':'Choisir '+p.name+' →'}</button>
    </div>`).join('');

  // Signup plans
  const sg=document.getElementById('signup-plans-grid');
  if(sg) sg.innerHTML=PLANS.map(p=>`
    <div class="sp-card ${p.id==='free'?'selected':''}" onclick="selectSignupPlan(this,'${p.id}')">
      <div class="sp-plan">${p.name}</div>
      <div class="sp-price">${p.price===0?'0€':p.price+'€'}</div>
      <div class="sp-per">${p.price===0?'Gratuit':p.period}</div>
      <div class="sp-feat">${p.features.slice(0,2).join('<br>')}</div>
    </div>`).join('');
}

function selectSignupPlan(el,planId){
  document.querySelectorAll('#signup-plans-grid .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedSignupPlan=planId;
}

// ── VITRINE DATA & RENDER ──
// Pas de projets fictifs — uniquement les vraies publications des vrais utilisateurs
let vitrineData=[];

function openProjectModal(id){
  const p=vitrineData.find(p=>p.id===id);
  if(!p)return;
  const overlay=document.getElementById('project-modal-overlay');
  const box=document.getElementById('project-modal-content');
  if(!overlay||!box)return;
  const avatarColor=getAvatarColor(p.authorId||p.author);
  box.innerHTML=`
    <div class="pmo-banner" style="background:${p.color||'var(--s2)'}">
      ${p.mediaUrl?`<img src="${p.mediaUrl}"/>`:''}
      <span style="position:relative;z-index:1">${p.emoji||'🚀'}</span>
      <button class="pmo-close" onclick="closeProjectModal()">✕</button>
    </div>
    <div class="pmo-body">
      <div class="pmo-cat">${p.type||p.cat||''}</div>
      <div class="pmo-name">${p.name}</div>
      ${p.hook?`<div class="pmo-hook">${p.hook}</div>`:''}
      <div class="pmo-desc">${p.desc||''}</div>
      ${p.tags&&p.tags.length?`<div class="pmo-tags">${p.tags.map(t=>`<span class="pmo-tag">#${t}</span>`).join('')}</div>`:''}
      ${p.url?`<a class="pmo-url" href="${p.url}" target="_blank" rel="noopener noreferrer">
        <span>🔗</span><span>${p.url.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span><span style="color:var(--g3)">↗</span>
      </a>`:''}
      <div class="pmo-footer">
        <div class="pmo-author">
          <div class="pmo-ava" style="background:${avatarColor}">${(p.author||'?')[0]}</div>
          <span>${p.author||'Anonyme'}</span>
          <span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span>
        </div>
        <div class="pmo-actions">
          <button class="pmo-btn ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this);this.querySelector('span').textContent=document.querySelector('[data-pid=\'${p.id}\'] .vote-count')?.textContent||'0'">
            ▲ <span>${p.votes||0}</span>
          </button>
          <button class="pmo-btn pmo-btn-dm" onclick="closeProjectModal();openDMToUser('${p.authorId}','${p.author}')">💬 DM</button>
        </div>
      </div>
    </div>`;
  overlay.classList.remove('hidden');
  document.body.style.overflow='hidden';
}
function closeProjectModal(){
  document.getElementById('project-modal-overlay')?.classList.add('hidden');
  document.body.style.overflow='';
}

function buildVitrineGrid(containerId,filter='all'){
  const el=document.getElementById(containerId);
  if(!el)return;
  const data=filter==='all'?vitrineData:vitrineData.filter(p=>p.cat===filter);
  if(!data.length){el.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:48px;color:var(--muted)">'+t('vit_empty')+'</div>';return;}
  el.innerHTML=data.map(p=>`
    <div class="v-card" data-pid="${p.id}" onclick="openProjectModal('${p.id}')">
      ${p.badge?`<div class="v-banner" style="background:${p.color}">${p.emoji}<div class="v-badge">${p.badge}</div></div>`:`<div class="v-banner" style="background:${p.color}">${p.emoji}</div>`}
      <div class="v-body">
        <div class="v-cat">${p.type}</div>
        <div class="v-name">${p.name}</div>
        <div class="v-desc">${p.desc}</div>
        ${p.url?`<a class="v-url-link" href="${p.url}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
          <span>🔗</span><span class="v-url-text">${p.url.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span><span style="font-size:11px">↗</span>
        </a>`:''}
        <div class="v-footer">
          <div class="v-author"><div class="v-ava">${p.author[0]}</div>${p.author}</div>
          <div class="v-actions">
            <button class="btn-vote-g ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this)">▲ <span class="vote-count">${p.votes}</span></button>
            <button class="btn-dm-small" onclick="openDMToUser('${p.authorId}','${p.author}')" title="Envoyer un DM">💬</button>
          </div>
        </div>
      </div>
    </div>`).join('');
}

function filterLandingVitrine(el,filter){
  document.querySelectorAll('#vitrine .filters-row .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildVitrineGrid('landing-vitrine-grid',filter);
}
function filterAppVitrine(el,filter){
  document.querySelectorAll('#tab-vitrine .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildVitrineGrid('app-vitrine-grid',filter);
}

async function voteProject(e,id,btn){
  e.stopPropagation();
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  if(myVotes.has(id)){toast('Tu as déjà voté !');return;}
  btn.classList.add('voted');
  const cnt=btn.querySelector('.vote-count');
  const proj=vitrineData.find(p=>p.id===id);
  if(proj)proj.votes++;
  if(cnt)cnt.textContent=(parseInt(cnt.textContent)||0)+1;
  myVotes.add(id);
  localStorage.setItem('vb_votes',JSON.stringify([...myVotes]));
  toast('👍 Vote comptabilisé !');
  // sync API
  try{await fetch('/api/projects/'+id+'/vote',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser.email})});}catch(e){}
}

// Pas de posts fictifs — uniquement les vraies publications
const samplePosts=[];
let feedPosts=[];

// Charge le feed depuis l'API au démarrage
// Fetch avec timeout pour éviter les blocages si le serveur ne répond pas
function fetchWithTimeout(url,opts={},ms=4000){
  const ctrl=new AbortController();
  const tid=setTimeout(()=>ctrl.abort(),ms);
  return fetch(url,{...opts,signal:ctrl.signal}).finally(()=>clearTimeout(tid));
}

async function loadPostsFromAPI(){
  try{
    const r=await fetchWithTimeout('/api/posts');
    const apiPosts=await r.json();
    if(Array.isArray(apiPosts)) feedPosts=apiPosts;
  }catch(e){}
  buildFeed();
}

function buildFeed(filter='all'){
  const el=document.getElementById('feed-list');
  if(!el)return;
  let data=[...feedPosts];
  if(filter==='following')data=data.filter(p=>currentUser?.following?.includes(p.userId)||p.userId===currentUser?.id);
  if(filter==='top')data=data.sort((a,b)=>b.likes-a.likes);
  if(!data.length){el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted)">'+t('no_posts')+'</div>';return;}
  el.innerHTML=data.map(p=>{
    const plan=PLANS.find(pl=>pl.id===p.plan)||PLANS[0];
    const isMe=p.userId===currentUser?.email;
    const isElite=(p.plan||'free')==='elite';
    const timerHtml=p.timerEnd?`<span class="post-timer">⏱ <span class="post-timer-val" data-end="${p.timerEnd}">--:--</span></span>`:'';
    const actionClass=isElite?'btn-action elite-action':'btn-action';
    const likedByMe=p.myLike;
    const mediaHtml=p.mediaUrl?`${p.mediaType&&p.mediaType.startsWith('video')?`<video class="post-media-video" controls src="${p.mediaUrl}"></video>`:`<img class="post-media" src="${p.mediaUrl}" alt="media" onclick="window.open('${p.mediaUrl}','_blank')" style="cursor:zoom-in"/>`}`:'';
    return `
    <div class="post-card" id="post-${p.id}" data-pid="${p.id}">
      <div class="post-header">
        <div class="post-ava" style="background:${getAvatarColor(p.userId)}" onclick="viewUserProfile('${p.userId}')">${p.emoji||p.author[0]}</div>
        <div class="post-meta">
          <div class="post-author" onclick="viewUserProfile('${p.userId}')">${isElite?'<span class="badge-elite-gold">🏆</span> ':''} ${p.author}</div>
          <div class="post-info"><span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span> · ${p.time} ${timerHtml}</div>
        </div>
        ${!isMe?`<button class="btn-dm-small" onclick="openDMToUser('${p.userId}','${p.author}')" title="DM">💬</button>`:''}
        <button class="btn-report" onclick="openReport('${p.userId}','${p.author}')" title="Signaler">⚑</button>
      </div>
      <div class="post-content">${escHtml(p.text)}</div>
      ${mediaHtml}
      ${p.postUrl?`<a class="post-url-card" href="${p.postUrl}" target="_blank" rel="noopener noreferrer">
        <span class="post-url-icon">🔗</span>
        <span class="post-url-text">${p.postUrl.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span>
        <span class="post-url-arrow">↗</span>
      </a>`:''}
      ${p.projName?`<div class="post-project" onclick="void(0)">
        <div class="post-proj-icon">${p.projEmoji||'🚀'}</div>
        <div><div class="post-proj-name">${p.projName}</div><div class="post-proj-cat">${p.projType||'pub'}</div>${p.projDesc?`<div class="post-proj-desc">${p.projDesc}</div>`:''}</div>
      </div>`:''}
      <div class="post-actions">
        <button class="${actionClass} ${likedByMe?'active':''}" onclick="likePost('${p.id}',this)">❤️ <span class="like-count">${p.likes||0}</span></button>
        <button class="${actionClass}" onclick="openComments('${p.id}')">💬 <span class="comment-count">${p.comments||0}</span></button>
        <button class="${actionClass}" onclick="sharePost('${p.id}',this)">🔗 <span class="share-count">${p.shares||0}</span></button>
        ${isMe?`<button class="${actionClass}" onclick="deletePost('${p.id}')" style="margin-left:auto;color:#f87171">🗑</button>`:''}
      </div>
      <div class="reactions-row">
        ${buildReactionsHTML(p)}
      </div>
    </div>`;
  }).join('');
  updateTimers();
}

function switchFeed(filter,el){
  document.querySelectorAll('.feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFeed(filter);
}

async function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  btn.classList.toggle('active');
  const cnt=btn.querySelector('.like-count');
  if(cnt)cnt.textContent=p.likes;
  if(p.myLike && currentUser){
    currentUser._todayLikes=(currentUser._todayLikes||0)+1;
    localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  }
  try{fetch('/api/posts/'+id+'/like',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser?.email||'anon'})});}catch(e){}
}

async function sharePost(id,btn){
  navigator.clipboard.writeText(window.location.origin+'#post-'+id).then(()=>toast('🔗 Lien copié !'));
  const p=feedPosts.find(p=>p.id===id);
  if(p){p.shares=(p.shares||0)+1;const cnt=btn?.querySelector('.share-count');if(cnt)cnt.textContent=p.shares;}
  try{fetch('/api/posts/'+id+'/share',{method:'POST'});}catch(e){}
}

function openComments(id){
  toast('💬 Commentaires — bientôt disponible !');
}

function deletePost(id){
  feedPosts=feedPosts.filter(p=>p.id!==id);
  document.getElementById('post-'+id)?.remove();
}

// ── SYSTÈME DE RÉACTIONS ──
const REACTIONS_FREE = [
  {type:'fire',   emoji:'🔥', label:'Feu',     color:'#f97316'},
  {type:'bulb',   emoji:'💡', label:'Idée',    color:'#facc15'},
  {type:'money',  emoji:'💸', label:'Cash',    color:'#4ade80'},
  {type:'clap',   emoji:'👏', label:'Bravo',   color:'#fb923c'},
];
const REACTIONS_PREMIUM = [
  {type:'rocket', emoji:'🚀', label:'Décollage', color:'#818cf8', plan:'starter'},
  {type:'crown',  emoji:'👑', label:'Roi',      color:'#ffd700', plan:'pro'},
  {type:'gem',    emoji:'💎', label:'Gem',      color:'#22d3ee', plan:'pro'},
  {type:'eyes',   emoji:'👀', label:'Je regarde', color:'#a78bfa', plan:'elite'},
  {type:'zap',    emoji:'⚡', label:'Boost',   color:'#86efac', plan:'starter'},
  {type:'star',   emoji:'🌟', label:'Star',    color:'#ffd700', plan:'elite'},
];
const ALL_REACTIONS = [...REACTIONS_FREE, ...REACTIONS_PREMIUM];

function buildReactionsHTML(p){
  if(!p.reactions) p.reactions = {};
  const plan = currentUser?.plan||'free';
  const planOrder = {free:0, starter:1, pro:2, elite:3};
  const userLevel = planOrder[plan]||0;

  return ALL_REACTIONS.map(r => {
    const count = p.reactions[r.type]||0;
    const active = p['myReact_'+r.type] ? 'active-'+r.type : '';
    const isPremium = REACTIONS_PREMIUM.find(x=>x.type===r.type);
    const reqLevel = isPremium ? planOrder[isPremium.plan]||0 : 0;
    const locked = isPremium && userLevel < reqLevel;
    if(locked){
      return `<button class="react-btn premium-lock" onclick="reactLocked('${isPremium.plan}')">
        ${r.emoji} ${count>0?`<span class="react-count" style="color:var(--muted)">${count}</span>`:''}
        <span class="react-premium-tip">${r.label} · ${isPremium.plan.toUpperCase()} requis</span>
      </button>`;
    }
    return `<button class="react-btn ${active}" onclick="toggleReaction('${p.id}','${r.type}',this)" style="${active?'border-color:'+r.color+';color:'+r.color:''}">
      ${r.emoji} <span class="react-count">${count||0}</span>
    </button>`;
  }).join('');
}

function toggleReaction(postId, type, btn){
  const p = feedPosts.find(x=>x.id===postId);
  if(!p) return;
  if(!p.reactions) p.reactions = {};
  const key = 'myReact_'+type;
  const was = p[key];
  p[key] = !was;
  p.reactions[type] = Math.max(0,(p.reactions[type]||0)+(was?-1:1));
  const r = ALL_REACTIONS.find(x=>x.type===type);
  const activeClass = 'active-'+type;
  btn.classList.toggle(activeClass, !was);
  if(!was){ btn.style.borderColor=r?.color||''; btn.style.color=r?.color||''; }
  else { btn.style.borderColor=''; btn.style.color=''; }
  btn.querySelector('.react-count').textContent = p.reactions[type]||0;
  if(!was && currentUser){
    currentUser._todayReacts = (currentUser._todayReacts||0)+1;
    localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  }
}

function reactLocked(plan){
  toast(`🔒 Réaction ${plan.toUpperCase()} — Upgrade pour débloquer !`, 'error');
  setTimeout(()=>openModal('pricing-modal'),800);
}

// ── MEDIA UPLOAD ──
async function handleMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('feed-media-preview');
  preview.style.display='block';
  preview.innerHTML='<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd=new FormData();
  fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingMediaUrl=d.url;
    const isVideo=file.type.startsWith('video');
    preview.innerHTML=`<div class="media-preview-item">${isVideo?`<video src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px"></video>`:`<img src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px;object-fit:cover"/>`} <span style="flex:1">${file.name}</span> <span class="remove-media" onclick="pendingMediaUrl=null;document.getElementById('feed-media-preview').innerHTML='';document.getElementById('feed-media-preview').style.display='none'">✕</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';pendingMediaUrl=null;}
}

async function handleLandingMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('pl-media-preview');
  preview.innerHTML='<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingLandingMediaUrl=d.url;
    preview.innerHTML=`<div class="media-preview-item"><img src="${d.url}" style="max-width:100px;max-height:60px;border-radius:4px;object-fit:cover"/> <span style="flex:1">${file.name}</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';}
}

async function handleGroupBgUpload(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupBgUrl=d.url;document.getElementById('grp-bg-preview').innerHTML=`<img src="${d.url}" style="width:100%;height:80px;object-fit:cover;border-radius:6px;margin-top:6px"/>`;}catch(e){}
}

async function handleGroupSettingsBg(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupSettingsBgUrl=d.url;}catch(e){}
}

async function handleGroupChatFile(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    // Send as message with media
    const msg={text:'',mediaUrl:d.url,mediaType:file.type,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
    await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});
    loadGroupMessages(currentGroupId);
  }catch(e){}
}

// ── PUBLISH LANDING AD (avant compte) ──
async function publishLandingAd(){
  const title=document.getElementById('pl-title').value.trim();
  const text=document.getElementById('pl-text').value.trim();
  if(!title||!text){toast('Remplis le titre et le message.');return;}
  const type=document.getElementById('pl-type').value;
  const url=document.getElementById('pl-url').value.trim();
  const post={
    id:'p'+Date.now(),userId:'landing_'+Date.now(),author:'Visiteur',
    emoji:'📢',plan:'free',text:title+'\n\n'+text,projName:title,projType:type,
    projEmoji:getTypeEmoji(type),projDesc:text.slice(0,80),projUrl:url,
    mediaUrl:pendingLandingMediaUrl,mediaType:pendingLandingMediaUrl?.match(/\.(mp4|webm|mov)/i)?'video/mp4':'image/jpeg',
    time:'À l\'instant',likes:0,comments:0,shares:0,timerEnd:Date.now()+3600000
  };
  feedPosts.unshift(post);
  pendingLandingMediaUrl=null;
  closeModal('publish-landing-modal');
  try{await fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  toast('📢 Publicité publiée ! Crée un compte pour gérer tes pubs.');
  setTimeout(()=>openModal('signup-modal'),2000);
}

function openPublishLanding(){
  document.getElementById('pl-title').value='';
  document.getElementById('pl-text').value='';
  document.getElementById('pl-media-preview').innerHTML='';
  pendingLandingMediaUrl=null;
  openModal('publish-landing-modal');
}

// ── PUBLISH POST ──
let pubHourCount=0, pubHourReset=0;
function toggleUrlField(){
  const wrap=document.getElementById('pub-url-wrap');
  const trigger=document.getElementById('pub-url-trigger');
  if(wrap){wrap.style.display='block';if(trigger)trigger.style.display='none';document.getElementById('feed-url')?.focus();}
}
function closeUrlField(){
  const wrap=document.getElementById('pub-url-wrap');
  const trigger=document.getElementById('pub-url-trigger');
  if(wrap){wrap.style.display='none';const inp=document.getElementById('feed-url');if(inp)inp.value='';}
  if(trigger)trigger.style.display='inline-flex';
}

function selectPubType(el, type){
  document.querySelectorAll('.pub-type-pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  const sel=document.getElementById('feed-proj-type');
  if(sel) sel.value=type;
  const projWrap=document.getElementById('pub-proj-wrap');
  if(projWrap) projWrap.style.display=(type&&type!=='')?'block':'none';
}
function updateCharCount(el){
  const count=el.value.length;
  const display=document.getElementById('pub-char-count');
  if(display){
    display.style.opacity=count>0?'1':'0';
    display.textContent=count+'/500';
    display.style.color=count>450?'#f87171':count>350?'var(--gold)':'var(--muted2)';
  }
}
function autoGrowTA(el){
  el.style.height='auto';
  el.style.height=el.scrollHeight+'px';
}
// Afficher les pills au focus sur la textarea
document.addEventListener('DOMContentLoaded',function(){
  const ta=document.getElementById('feed-text');
  const row=document.getElementById('pub-type-row');
  if(ta&&row){
    ta.addEventListener('focus',function(){row.classList.add('visible');});
  }
});

function publishPost(){
  if(currentUser&&currentUser.isDemo){openDemoSignupModal();return;}
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const text=document.getElementById('feed-text')?.value.trim()||'';
  if(!text){toast(t('toast_write'));return;}

  // Check limits
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const now=Date.now();
  if(currentUser.plan==='free'){
    if(now-pubHourReset>3600000){pubHourCount=0;pubHourReset=now;}
    if(pubHourCount>=1){toast(t('toast_limit_free'));return;}
  } else if(plan.limits.pubsPerDay){
    const today=new Date().toDateString();
    const key='vb_pubs_'+today;
    const count=parseInt(localStorage.getItem(key)||'0');
    if(count>=plan.limits.pubsPerDay){toast(t('toast_limit_day'));return;}
    localStorage.setItem(key,count+1);
  }

  const projName=document.getElementById('feed-proj-name')?.value.trim()||'';
  const projType=document.getElementById('feed-proj-type')?.value||'';
  let postUrl=document.getElementById('feed-url')?.value.trim()||'';
  // Ajouter https:// si manquant
  if(postUrl && !postUrl.startsWith('http')) postUrl='https://'+postUrl;
  const timerEnd=currentUser.plan==='free'?Date.now()+3600000:null;

  const post={
    id:'p'+Date.now(),userId:currentUser.email,author:currentUser.name,
    emoji:currentUser.avatar||'🙂',plan:currentUser.plan||'free',
    text,projName,projType,projEmoji:getTypeEmoji(projType),projDesc:'',
    postUrl,
    mediaUrl:pendingMediaUrl,mediaType:pendingMediaUrl?'image':'',
    time:'À l\'instant',likes:0,comments:0,shares:0,myLike:false,timerEnd
  };
  feedPosts.unshift(post);
  pubHourCount++;
  // Tracker pour badges
  currentUser._postCount = (currentUser._postCount||0) + 1;
  currentUser._todayPosts = (currentUser._todayPosts||0) + 1;
  // Tracker médias pour missions
  if(pendingMediaUrl){
    const isVideo = post.mediaType && post.mediaType.startsWith('video');
    const isFile = pendingMediaUrl && /\.(pdf|doc|docx|zip|txt|ppt|xls)/i.test(pendingMediaUrl);
    if(isVideo) currentUser._todayVideoPosts = (currentUser._todayVideoPosts||0)+1;
    else if(isFile) currentUser._todayFilePosts = (currentUser._todayFilePosts||0)+1;
    else currentUser._todayMediaPosts = (currentUser._todayMediaPosts||0)+1;
  }
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();
  pendingMediaUrl=null;
  if(document.getElementById('feed-text')) document.getElementById('feed-text').value='';
  if(document.getElementById('feed-proj-name')) document.getElementById('feed-proj-name').value='';
  closeUrlField();
  document.getElementById('feed-media-preview').innerHTML='';
  document.getElementById('feed-media-preview').style.display='none';
  buildFeed();
  toast(t('toast_published'));
  // Sync API
  try{fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  if(timerEnd)setTimeout(()=>{feedPosts=feedPosts.filter(p=>p.id!==post.id);buildFeed();},3600000);
}

async function handlePubMediaUpload(input){
  const file = input.files[0]; if(!file) return;
  const preview = document.getElementById('pub-media-preview');
  preview.innerHTML = '<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd = new FormData(); fd.append('file', file);
  try{
    const r = await fetch('/api/upload',{method:'POST',body:fd});
    const d = await r.json(); pendingPubMediaUrl = d.url;
    // Mettre à jour l'aperçu vitrine avec l'image
    const imgWrap = document.getElementById('pub-preview-img-wrap');
    const imgEl = document.getElementById('pub-preview-img');
    if(imgWrap && imgEl){ imgEl.src = d.url; imgWrap.style.display = 'block'; }
    preview.innerHTML = `<div class="media-preview-item" style="display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:8px 12px">
      <img src="${d.url}" style="width:48px;height:36px;border-radius:4px;object-fit:cover"/>
      <span style="font-size:12px;color:var(--g4)">✅ ${file.name.slice(0,30)}</span>
      <button onclick="removePubMedia()" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px">✕</button>
    </div>`;
    updatePubCompletion();
  }catch(e){
    // Fallback local preview si pas de backend
    const url = URL.createObjectURL(file); pendingPubMediaUrl = url;
    const imgWrap = document.getElementById('pub-preview-img-wrap');
    const imgEl = document.getElementById('pub-preview-img');
    if(imgWrap && imgEl){ imgEl.src = url; imgWrap.style.display = 'block'; }
    preview.innerHTML = `<div class="media-preview-item" style="display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:8px 12px">
      <img src="${url}" style="width:48px;height:36px;border-radius:4px;object-fit:cover"/>
      <span style="font-size:12px;color:var(--g4)">📎 ${file.name.slice(0,30)}</span>
      <button onclick="removePubMedia()" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px">✕</button>
    </div>`;
    updatePubCompletion();
  }
  // Rendre la zone de drop cliquable
  document.getElementById('pub-media-drop')?.addEventListener('click', ()=>document.getElementById('pub-media-input')?.click());
}
function removePubMedia(){
  pendingPubMediaUrl = null;
  document.getElementById('pub-media-preview').innerHTML = '';
  const imgWrap = document.getElementById('pub-preview-img-wrap');
  if(imgWrap) imgWrap.style.display = 'none';
  updatePubCompletion();
}

// ── PUBLISH PROJECT ──
function publishProject(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const name = document.getElementById('pub-name')?.value.trim()||'';
  const desc = document.getElementById('pub-desc')?.value.trim()||'';
  if(!name || !desc){ toast('Remplis au minimum le nom et la description.', 'error'); return; }
  if(name.length < 4){ toast('Le nom est trop court (4 caractères min).', 'error'); return; }
  if(desc.length < 20){ toast('La description est trop courte (20 caractères min).', 'error'); return; }

  const type = document.getElementById('pub-type')?.value||'';
  const emoji = document.getElementById('pub-emoji')?.value || getTypeEmoji(type);
  const url = document.getElementById('pub-url')?.value.trim() || '';
  const target = document.getElementById('pub-target')?.value.trim() || '';
  const hook = document.getElementById('pub-hook')?.value.trim() || '';
  const tags = (document.getElementById('pub-tags')?.value || '').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const stage = document.getElementById('pub-stage')?.value || '';
  const collabNeed = document.getElementById('pub-collab-need')?.value || '';
  const plan = PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const colors = ['linear-gradient(135deg,#15803d,#22c55e)','linear-gradient(135deg,#166534,#4ade80)','linear-gradient(135deg,#14532d,#86efac)'];

  const proj = {
    id:'pub'+Date.now(), name, cat:type, type:typeName(type),
    desc: desc.slice(0,300), hook, emoji, url, target, tags, stage, collabNeed,
    color: colors[Math.floor(Math.random()*colors.length)],
    author: currentUser.name, authorId: currentUser.email,
    plan: currentUser.plan || 'free',
    votes: 0, mediaUrl: pendingPubMediaUrl,
    timerEnd: plan.limits.vitrineHours < 999999 ? Date.now() + plan.limits.vitrineHours*3600000 : null,
    createdAt: Date.now()
  };

  pendingPubMediaUrl = null;
  document.getElementById('pub-media-preview').innerHTML = '';
  const imgWrap = document.getElementById('pub-preview-img-wrap');
  if(imgWrap) imgWrap.style.display = 'none';
  vitrineData.unshift(proj);
  buildVitrineGrid('app-vitrine-grid');
  buildVitrineGrid('landing-vitrine-grid');

  // Reset form
  ['pub-name','pub-desc','pub-hook','pub-url','pub-target','pub-tags'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  updatePubCompletion(); updateDescCount(); renderTagsPreview(); updateMobilePreview();
  // Reset wizard vers étape 1
  wizGoTo(1);

  // Badges & missions
  currentUser._postCount = (currentUser._postCount||0) + 1;
  currentUser._todayPosts = (currentUser._todayPosts||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();

  // Save & sync
  const saved = JSON.parse(localStorage.getItem('vb_my_projects')||'[]');
  saved.unshift(proj); localStorage.setItem('vb_my_projects', JSON.stringify(saved));
  try{ fetch('/api/projects',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(proj)}); }catch(e){}

  // Confirmation avec tip
  toast('🌐 Projet publié sur la vitrine ! Partage le lien dans le chat pour avoir tes premiers votes 🚀');
}

async function generateBoostForProject(){
  const name=document.getElementById('pub-name')?.value.trim()||'Mon projet';
  const desc=document.getElementById('pub-desc')?.value.trim()||'Projet digital';
  const type=document.getElementById('pub-type')?.value||'';
  const target=document.getElementById('pub-target')?.value.trim()||'Grand public';
  const btn=document.getElementById('btn-pub-project');
  btn.disabled=true;
  const outBox=document.getElementById('pub-strategy');
  outBox.style.display='block';
  outBox.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:`Tu es expert en marketing digital. Génère une stratégie de promotion pour:\n- Projet: ${name} (${type})\n- Cible: ${target}\n- Description: ${desc}\n\nFournis: hashtags TikTok, calendrier contenu 2 semaines, 3 idées de posts viraux, 5 mots-clés SEO.`})});
    const data=await res.json();
    outBox.textContent=data.content;
  }catch(e){outBox.textContent='Connecte le backend Render pour générer des stratégies IA.';}
  btn.disabled=false;
}

// ── WORLD CHAT ──
let chatMsgsToday=parseInt(localStorage.getItem('vb_chat_today_'+new Date().toDateString())||'0');

function buildWorldChat(){
  const el=document.getElementById('world-chat-msgs');
  if(!el)return;
  const msgs=[...worldChatMsgs];
  if(!msgs.length){
    el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Sois le premier à écrire dans le chat ! 👋</div>';
    return;
  }
  el.innerHTML=msgs.map(m=>`
    <div class="chat-msg-item">
      <div class="chat-msg-name">${m.name} <span class="chat-msg-plan-badge plan-${m.plan}">${m.plan.toUpperCase()}</span> <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.time||''}</span></div>
      <div class="chat-msg-text">${escHtml(m.text)}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
  // Update online count
  const onlineEl=document.getElementById('world-online-count');
  if(onlineEl)onlineEl.textContent=(12+Math.floor(Math.random()*8))+' en ligne';
}

function sendWorldChat(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const inp=document.getElementById('world-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const today=new Date().toDateString();
  if(chatMsgsToday>=plan.limits.chatMsgs){
    document.getElementById('world-chat-upgrade').style.display='flex';
    toast('Limite de messages atteinte ! Upgrade ton plan.');
    return;
  }
  chatMsgsToday++;
  localStorage.setItem('vb_chat_today_'+today,chatMsgsToday);
  document.getElementById('chat-msgs-left').textContent=Math.max(0,plan.limits.chatMsgs-chatMsgsToday);
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  worldChatMsgs.push({name:currentUser.name,plan:currentUser.plan||'free',text,time});
  inp.value='';
  buildWorldChat();
  // WS send
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'message',name:currentUser.name,plan:currentUser.plan||'free',text}));
  }
}

// ── PROFILE ──
function renderMyProfile(){
  const el=document.getElementById('my-profile-view');
  if(!el||!currentUser)return;
  const u=currentUser;
  const ava=u.avatar||'🙂';
  const followers=(u.followers||[]).length;
  const following=(u.following||[]).length;
  el.innerHTML=`
    <div class="profile-banner" style="background:linear-gradient(135deg,${getAvatarColor(u.email)},var(--s3))">
      <div class="profile-avatar" style="background:${getAvatarColor(u.email)}">${u.avatarUrl?`<img src="${u.avatarUrl}" style="width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:50%;" />`:`<span style="line-height:1">${ava}</span>`}</div>
      <button class="profile-edit-btn" onclick="openEditProfile()">✏️ Modifier</button>
      ${u.plan==='elite'?`<button class="btn-contact-admin" style="position:absolute;bottom:14px;right:14px" onclick="openContactAdmin()">📩 Admin</button>`:''}
    </div>
    <div class="profile-info">
      <div class="profile-name" style="${getFollowerNameStyle(followers)}">${u.name||'Utilisateur'}</div>
      <div class="profile-handle">@${u.username||u.email.split('@')[0]} · <span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></div>
      <div class="profile-bio">${u.bio||'<span style="color:var(--muted2)">Ajoute une bio dans "Modifier mon profil"</span>'}</div>
      ${u.tags&&u.tags.length?`<div class="profile-tags">${u.tags.map(t=>`<span class="profile-tag">${t}</span>`).join('')}</div>`:''}
      <div class="profile-stats">
        <div class="pstat"><div class="pstat-num">${followers}</div><div class="pstat-label">Abonnés</div></div>
        <div class="pstat"><div class="pstat-num">${following}</div><div class="pstat-label">Abonnements</div></div>
        <div class="pstat"><div class="pstat-num">${(u.projects||[]).length}</div><div class="pstat-label">Projets</div></div>
        <div class="pstat"><div class="pstat-num">${u.totalVotes||0}</div><div class="pstat-label">Votes reçus</div></div>
      </div>
      ${renderProfileLinks(u)}
      ${renderProfileFields(u)}
    </div>
    <div style="margin-top:16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
      <div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;margin-bottom:4px">ABONNEMENT ACTUEL</div>
        <div style="font-size:18px;font-weight:800;color:var(--g3)">${(u.plan||'free').toUpperCase()}</div>
        ${u.plan==='free'?'<div style="font-size:11px;color:var(--muted);margin-top:2px">Gratuit pour toujours</div>':'<div style="font-size:11px;color:var(--g4);margin-top:2px">Plan actif</div>'}
      </div>
      ${u.plan==='free'?'<button onclick="showAppTab(\'boost-credits\',null);switchCreditsTab(\'shop\',document.getElementById(\'ctab-shop\'))" style="padding:9px 18px;background:var(--g2);border:none;border-radius:8px;font-family:Plus Jakarta Sans,sans-serif;font-size:12px;font-weight:700;color:var(--bg);cursor:pointer">Upgrader mon plan →</button>':'<span style="font-size:11px;color:var(--muted2)">Merci pour ta confiance 🙏</span>'}
    </div>
    ${renderSoldes(u)}
    <div style="margin-top:24px">
      <h3 style="font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:12px">MES PUBLICATIONS</h3>
      <div id="my-posts-feed">${feedPosts.filter(p=>p.userId===u.email).length===0?'<div style="color:var(--muted);font-size:13px">Aucune publication encore.</div>':''}</div>
    </div>
    ${renderBadges(u)}`;
  // Render my posts
  const myPosts=feedPosts.filter(p=>p.userId===u.email);
  const mpEl=document.getElementById('my-posts-feed');
  if(mpEl&&myPosts.length){
    mpEl.innerHTML=myPosts.map(p=>`<div class="post-card" style="margin-bottom:10px"><div class="post-content">${escHtml(p.text)}</div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:8px">${p.time} · ❤️ ${p.likes}</div></div>`).join('');
  }
}


function getFollowerNameStyle(followers){
  if(followers>=100000) return 'color:#ffd700;text-shadow:0 0 20px rgba(255,215,0,0.6);';
  if(followers>=10000)  return 'color:#c0a060;';
  if(followers>=1000)   return 'color:#22c55e;';
  if(followers>=100)    return 'color:#86efac;';
  return '';
}

function renderSoldes(u){
  const followers = (u.followers||[]).length;
  const pct = Math.min(100, Math.round(followers/10));
  const salesEnabled = u.salesEnabled || false;
  const inp = "width:100%;padding:9px 12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;font-family:Plus Jakarta Sans,sans-serif;font-size:13px;color:var(--white);outline:none";

  if(followers < 1000){
    return '<div style="margin-top:24px;background:linear-gradient(135deg,rgba(255,215,0,0.06),rgba(255,140,0,0.03));border:1.5px solid rgba(255,215,0,0.2);border-radius:14px;padding:20px 22px;display:flex;align-items:center;gap:14px">'
      +'<span style="font-size:28px">💰</span>'
      +'<div style="flex:1">'
      +'<div style="font-size:13px;font-weight:800;color:#ffd700;margin-bottom:4px">Soldes — Monétise ta communauté</div>'
      +'<div style="font-size:11px;color:var(--muted);line-height:1.6">Disponible à partir de <strong style="color:var(--white)">1 000 abonnés</strong>. Tu en as <strong style="color:var(--g3)">'+followers+'</strong>.</div>'
      +'<div style="margin-top:10px;background:var(--s2);border-radius:6px;height:6px;overflow:hidden">'
      +'<div style="height:100%;width:'+pct+'%;background:linear-gradient(90deg,var(--g2),var(--g4))"></div></div>'
      +'<div style="font-size:10px;color:var(--muted2);margin-top:4px">'+followers+'/1000 abonnés</div>'
      +'</div></div>';
  }

  const toggleBg = salesEnabled ? 'var(--g2)' : 'var(--s3)';
  const toggleBorder = salesEnabled ? 'var(--g3)' : 'var(--border)';
  const toggleLeft = salesEnabled ? '20px' : '2px';

  let html = '<div style="margin-top:24px;background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.35);border-radius:14px;padding:20px 22px">'
    +'<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px">'
    +'<div style="display:flex;align-items:center;gap:10px"><span style="font-size:28px">💰</span>'
    +'<div><div style="font-size:14px;font-weight:800;color:#ffd700">Soldes débloqués !</div>'
    +'<div style="font-size:11px;color:var(--muted)">Monétise ta communauté de '+followers+' abonnés</div></div></div>'
    +'<label style="display:flex;align-items:center;gap:8px;cursor:pointer">'
    +'<span style="font-size:11px;color:var(--muted)">Activer les soldes</span>'
    +'<div onclick="toggleSales()" style="width:44px;height:24px;border-radius:12px;background:'+toggleBg+';position:relative;flex-shrink:0;border:1.5px solid '+toggleBorder+'">'
    +'<div style="position:absolute;top:2px;left:'+toggleLeft+';width:18px;height:18px;border-radius:50%;background:white"></div>'
    +'</div></label></div>';

  if(salesEnabled){
    html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px">'
      +'<div class="fg"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Nom de l\'offre</label>'
      +'<input id="sale-title" type="text" placeholder="ex: Audit TikTok 30 min" value="'+(u.saleTitle||'')+'" style="'+inp+'" oninput="saveSaleField(&apos;saleTitle&apos;,this.value)"/></div>'
      +'<div class="fg"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Prix (€)</label>'
      +'<input id="sale-price" type="number" min="1" placeholder="29" value="'+(u.salePrice||'')+'" style="'+inp+'" oninput="saveSaleField(&apos;salePrice&apos;,this.value)"/></div>'
      +'<div style="grid-column:1/-1"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Description</label>'
      +'<textarea id="sale-desc" placeholder="Décris ton offre..." style="'+inp+';resize:none;min-height:56px" oninput="saveSaleField(&apos;saleDesc&apos;,this.value)">'+(u.saleDesc||'')+'</textarea></div>'
      +'<div style="grid-column:1/-1"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Lien de paiement (Stripe, PayPal...)</label>'
      +'<input id="sale-link" type="url" placeholder="https://buy.stripe.com/..." value="'+(u.saleLink||'')+'" style="'+inp+'" oninput="saveSaleField(&apos;saleLink&apos;,this.value)"/></div>'
      +'</div>'
      +'<div style="background:var(--s1);border:1px solid var(--border2);border-radius:10px;padding:14px;font-size:12px;color:var(--muted)">🎯 Ton offre sera visible sur ton profil public.</div>';
  } else {
    html += '<div style="font-size:12px;color:var(--muted);text-align:center;padding:10px 0">Active les soldes pour configurer ton offre.</div>';
  }

  html += '</div>';
  return html;
}

function toggleSales(){
  if(!currentUser)return;
  currentUser.salesEnabled = !currentUser.salesEnabled;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  renderMyProfile();
}

function saveSaleField(key, val){
  if(!currentUser)return;
  currentUser[key] = val;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
}

function renderProfileLinks(u){
  const links=[];
  if(u.website)links.push(`<a class="profile-link" href="${u.website}" target="_blank">🌐 Site web</a>`);
  if(u.tiktok)links.push(`<a class="profile-link" href="https://tiktok.com/@${u.tiktok.replace('@','')}" target="_blank">🎵 ${u.tiktok}</a>`);
  if(u.instagram)links.push(`<a class="profile-link" href="https://instagram.com/${u.instagram.replace('@','')}" target="_blank">📸 ${u.instagram}</a>`);
  if(u.twitter)links.push(`<a class="profile-link" href="https://twitter.com/${u.twitter.replace('@','')}" target="_blank">🐦 ${u.twitter}</a>`);
  if(u.linkedin)links.push(`<a class="profile-link" href="${u.linkedin}" target="_blank">💼 LinkedIn</a>`);
  if(u.youtube)links.push(`<a class="profile-link" href="https://youtube.com/@${u.youtube.replace('@','')}" target="_blank">▶️ ${u.youtube}</a>`);
  if(!links.length)return '';
  return `<div class="profile-links" style="margin-bottom:16px">${links.join('')}</div>`;
}

function renderProfileFields(u){
  const fields=[];
  if(u.title)fields.push({l:'Titre',v:u.title});
  if(u.location)fields.push({l:'Localisation',v:u.location});
  if(u.niche)fields.push({l:'Niche',v:u.niche});
  if(u.exp)fields.push({l:'Expérience',v:u.exp});
  if(u.dispo)fields.push({l:'Disponibilité',v:u.dispo});
  if(u.goal)fields.push({l:'Objectif',v:u.goal});
  if(u.skills)fields.push({l:'Compétences',v:u.skills});
  if(u.tools)fields.push({l:'Outils',v:u.tools});
  if(u.langs)fields.push({l:'Langues',v:u.langs});
  if(u.tiktokCount)fields.push({l:'Abonnés TikTok',v:u.tiktokCount});
  if(u.igCount)fields.push({l:'Abonnés Instagram',v:u.igCount});
  if(u.revenue)fields.push({l:'Revenus/mois',v:u.revenue});
  if(!fields.length)return '';
  return `<div class="profile-fields">${fields.map(f=>`<div class="pfield"><div class="pfield-label">${f.l}</div><div class="pfield-value">${f.v}</div></div>`).join('')}</div>`;
}

function openEditProfile(){
  if(!currentUser)return;
  if(currentUser.isDemo){openDemoSignupModal();return;}
  const u=currentUser;
  const fields={name:'ep-name',username:'ep-username',title:'ep-title',location:'ep-location',bio:'ep-bio',niche:'ep-niche',goal:'ep-goal',skills:'ep-skills',tools:'ep-tools',langs:'ep-langs',website:'ep-website',tiktok:'ep-tiktok',instagram:'ep-instagram',twitter:'ep-twitter',linkedin:'ep-linkedin',youtube:'ep-youtube',tiktokCount:'ep-tiktok-count',igCount:'ep-ig-count',projectsCount:'ep-projects-count',sales:'ep-sales',looking:'ep-looking'};
  Object.entries(fields).forEach(([key,id])=>{const el=document.getElementById(id);if(el&&u[key])el.value=u[key];});
  if(u.exp){const sel=document.getElementById('ep-exp');if(sel)for(let o of sel.options)if(o.value===u.exp||o.text===u.exp)sel.value=o.value;}
  if(u.dispo){const sel=document.getElementById('ep-dispo');if(sel)for(let o of sel.options)if(o.text===u.dispo)sel.value=o.value;}
  if(u.revenue){const sel=document.getElementById('ep-revenue');if(sel)for(let o of sel.options)if(o.text===u.revenue)sel.value=o.value;}
  // Restaurer l'avatar dans le formulaire
  const avaEl = document.getElementById('edit-ava-emoji');
  const avaImg = document.getElementById('edit-ava-img');
  if(u.avatarUrl && avaImg){ avaImg.src=u.avatarUrl; avaImg.style.display='block'; if(avaEl) avaEl.style.display='none'; }
  else if(avaEl){ avaEl.textContent=u.avatar||'🙂'; if(avaImg) avaImg.style.display='none'; }
  openModal('edit-profile-modal');
}

function selectEmoji(el,emoji){
  document.querySelectorAll('.emoji-opt').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  const prev = document.getElementById('edit-ava-preview');
  const emojiSpan = document.getElementById('edit-ava-emoji');
  const imgEl = document.getElementById('edit-ava-img');
  if(emojiSpan) emojiSpan.textContent = emoji;
  if(imgEl){ imgEl.style.display='none'; if(emojiSpan) emojiSpan.style.display=''; }
  if(currentUser) currentUser._pendingEmoji = emoji;
}

function selectEmojiPremium(el, emoji, requiredPlan){
  const planOrder = {free:0, starter:1, pro:2, elite:3};
  const userLevel = planOrder[currentUser?.plan||'free']||0;
  const reqLevel = planOrder[requiredPlan]||0;
  if(userLevel < reqLevel){
    toast(`🔒 Avatar ${requiredPlan.toUpperCase()} — Upgrade requis !`, 'error');
    setTimeout(()=>openModal('pricing-modal'), 800);
    return;
  }
  selectEmoji(el, emoji);
}

async function handleAvatarUpload(input){
  const file = input.files[0];
  if(!file) return;
  const imgEl = document.getElementById('edit-ava-img');
  const emojiSpan = document.getElementById('edit-ava-emoji');
  // Aperçu local immédiat
  const url = URL.createObjectURL(file);
  if(imgEl){ imgEl.src=url; imgEl.style.display='block'; }
  if(emojiSpan) emojiSpan.style.display='none';
  const overlay=document.querySelector('.ava-upload-overlay'); if(overlay) overlay.style.display='none';
  document.getElementById('edit-ava-preview')?.classList.add('has-photo');
  // Tenter upload serveur
  try{
    const fd = new FormData(); fd.append('file', file);
    const r = await fetch('/api/upload', {method:'POST', body:fd});
    const d = await r.json();
    if(d.url && currentUser){ currentUser.avatarUrl = d.url; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
  }catch(e){ /* garde l'aperçu local */ }
  if(currentUser){ currentUser._pendingAvatarUrl = url; }
  toast('📷 Photo de profil mise à jour !');
}

function saveProfile(){
  if(!currentUser)return;
  const sel=document.getElementById('ep-exp');
  const selD=document.getElementById('ep-dispo');
  const selR=document.getElementById('ep-revenue');
  Object.assign(currentUser,{
    name:document.getElementById('ep-name').value.trim()||currentUser.name,
    username:document.getElementById('ep-username').value.trim().replace('@',''),
    title:document.getElementById('ep-title').value.trim(),
    location:document.getElementById('ep-location').value.trim(),
    bio:document.getElementById('ep-bio').value.trim(),
    niche:document.getElementById('ep-niche').value.trim(),
    exp:sel?sel.options[sel.selectedIndex].text:'',
    dispo:selD?selD.options[selD.selectedIndex].text:'',
    revenue:selR?selR.options[selR.selectedIndex].text:'',
    goal:document.getElementById('ep-goal').value.trim(),
    skills:document.getElementById('ep-skills').value.trim(),
    tools:document.getElementById('ep-tools').value.trim(),
    langs:document.getElementById('ep-langs').value.trim(),
    website:document.getElementById('ep-website').value.trim(),
    tiktok:document.getElementById('ep-tiktok').value.trim(),
    instagram:document.getElementById('ep-instagram').value.trim(),
    twitter:document.getElementById('ep-twitter').value.trim(),
    linkedin:document.getElementById('ep-linkedin').value.trim(),
    youtube:document.getElementById('ep-youtube').value.trim(),
    tiktokCount:document.getElementById('ep-tiktok-count').value.trim(),
    igCount:document.getElementById('ep-ig-count').value.trim(),
    looking:document.getElementById('ep-looking').value.trim(),
    avatar:document.getElementById('edit-ava-preview').textContent||'🙂',
    tags:[currentUser.niche,currentUser.dispo].filter(Boolean)
  });
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('edit-profile-modal');
  updateAppBar();
  renderMyProfile();
  toast('✅ Profil mis à jour !');
}

// ── FOLLOWERS ──
// Pas d'utilisateurs fictifs — uniquement les vrais membres
const sampleUsers=[];

async function buildFollowList(type='followers'){
  const el=document.getElementById('follow-list-container');
  if(!el)return;
  const myFollowers=currentUser?.followers||[];
  const myFollowing=currentUser?.following||[];
  let users=[];
  try{
    const r=await fetchWithTimeout('/api/admin/all-users');
    const allUsers=await r.json();
    if(type==='followers') users=(allUsers||[]).filter(u=>myFollowers.includes(u.email||u.id));
    if(type==='following') users=(allUsers||[]).filter(u=>myFollowing.includes(u.email||u.id));
    if(type==='discover') users=(allUsers||[]).filter(u=>(u.email||u.id)!==currentUser?.email).slice(0,20);
  }catch(e){}
  if(!users.length){
    const msgs={followers:'Tu n\'as pas encore d\'abonnés.',following:'Tu ne suis personne encore.',discover:'Aucun autre créateur inscrit pour le moment.'};
    el.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">${msgs[type]||''}</div>`;
    document.getElementById('followers-count').textContent=myFollowers.length;
    document.getElementById('following-count').textContent=myFollowing.length;
    return;
  }
  el.innerHTML=users.map(u=>`
    <div class="follow-item">
      <div class="follow-item-ava" style="background:${getAvatarColor(u.email||u.id)}">${u.avatar||u.name?.[0]||'🙂'}</div>
      <div style="flex:1">
        <div class="follow-item-name">${escHtml(u.name||'Créateur')}</div>
        <div class="follow-item-sub">${escHtml(u.bio||'')}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px"><span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'free').toUpperCase()}</span></div>
      </div>
      <button class="btn-dm-list" onclick="openDMToUser('${u.email||u.id}','${escHtml(u.name||'?')}')" title="DM">💬</button>
      <button class="btn-follow-list ${myFollowing.includes(u.email||u.id)?'following':''}" onclick="toggleFollow(this,'${u.email||u.id}')">${myFollowing.includes(u.email||u.id)?'Suivi ✓':'Suivre'}</button>
    </div>`).join('');
  document.getElementById('followers-count').textContent=myFollowers.length;
  document.getElementById('following-count').textContent=myFollowing.length;
}

function switchFollowTab(type,el){
  document.querySelectorAll('#tab-abonnes .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFollowList(type);
}

function toggleFollow(btn,userId){
  if(!currentUser)return;
  currentUser.following=currentUser.following||[];
  if(currentUser.following.includes(userId)){
    currentUser.following=currentUser.following.filter(id=>id!==userId);
    btn.textContent='Suivre';btn.classList.remove('following');
    toast('Désabonné');
  } else {
    currentUser.following.push(userId);
    btn.textContent='Suivi ✓';btn.classList.add('following');
    toast('✅ Abonné !');
  }
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  document.getElementById('following-count').textContent=currentUser.following.length;
}

// ── DM ──
function openDMToUser(userId,name){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  if(userId===currentUser.email){toast('Tu ne peux pas te DM toi-même 😄');return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='À : '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function openDMToUser(userId,name){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='À : '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function renderDMThread(userId){
  const el=document.getElementById('dm-msgs-list');
  const thread=dmThreads[userId]||[];
  if(!thread.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Début de la conversation 👋</div>';return;}
  el.innerHTML=thread.map(m=>`
    <div class="dm-msg ${m.fromMe?'mine':'theirs'}">
      <div class="dm-bubble-g">${escHtml(m.text)}</div>
      <div class="dm-time">${m.time}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
}

function sendDM(){
  if(!dmTarget||!currentUser)return;
  const inp=document.getElementById('dm-input');
  const text=inp.value.trim();
  if(!text)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  if(!dmThreads[dmTarget.id])dmThreads[dmTarget.id]=[];
  dmThreads[dmTarget.id].push({fromMe:true,text,time});
  inp.value='';
  // Tracker pour badges
  currentUser._dmCount = (currentUser._dmCount||0) + 1;
  currentUser._todayDMs = (currentUser._todayDMs||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();
  renderDMThread(dmTarget.id);
  // WS
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'dm',toId:dmTarget.id,fromName:currentUser.name,fromPlan:currentUser.plan||'free',text}));
  }
}

// ── IA BOOST ──
function selectBoostType(el,type){
  document.querySelectorAll('#tab-ia-boost .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostType=type;
}

const boostPrompts={
  social:(n,t,d,g)=>`Expert growth hacking TikTok/Instagram. Stratégie pour:\n- Projet: ${n}\n- Cible: ${t}\n- Description: ${d}\n- Objectif: ${g}\n\nFournis: 5 scripts vidéo viraux, 20 hashtags, calendrier 30 jours, meilleurs horaires.`,
  seo:(n,t,d,g)=>`Expert SEO. Plan pour:\n- Projet: ${n}\n- Cible: ${t}\n- Description: ${d}\n\nFournis: 20 mots-clés, 5 sujets d'articles, stratégie backlinks, checklist on-page.`,
  ads:(n,t,d,g)=>`Expert copywriting pub. Crée pour:\n- Projet: ${n}\n- Cible: ${t}\n\nFournis: 3 pubs Facebook Ads, 3 scripts TikTok Ads (30s), 3 annonces Google, 5 accroches Instagram.`,
  email:(n,t,d,g)=>`Expert email marketing. Séquence pour:\n- Projet: ${n}\n- Cible: ${t}\n\nFournis: 5 emails complets (bienvenue J0, valeur J3, preuve J7, promo J14, relance J30).`,
  strategy:(n,t,d,g)=>`Consultant stratégie digitale. Plan 90j pour:\n- Projet: ${n}\n- Cible: ${t}\n- Objectif: ${g}\n\nFournis: analyse SWOT, objectifs SMART, actions mois 1/2/3, budget estimé.`,
  coach:(n,t,d,g)=>`Tu es coach marketing expert. Donne des conseils personnalisés pour:\n- Projet: ${n}\n- Description: ${d}\n- Objectif: ${g}\n\nConseils concrets, actionnables, priorisés.`
};

async function runIABoost(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const name=document.getElementById('boost-name').value.trim()||'Mon projet';
  const target=document.getElementById('boost-target').value.trim()||'Grand public';
  const desc=document.getElementById('boost-desc').value.trim()||'Projet digital';
  const goal=document.getElementById('boost-goal').value.trim()||'Croître';
  const btn=document.getElementById('btn-ia-boost');
  btn.disabled=true;btn.textContent='⚡ Génération...';
  const out=document.getElementById('boost-output-box');
  const txt=document.getElementById('boost-output-text');
  out.style.display='block';
  txt.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:boostPrompts[selectedBoostType](name,target,desc,goal)})});
    const data=await res.json();
    txt.textContent=data.content;
    toast('✅ Stratégie générée !');
  }catch(e){txt.textContent='Connecte le backend Render pour générer des stratégies IA complètes.';}
  btn.disabled=false;btn.textContent='⚡ Générer ma stratégie';
}

// ── AUTH ──
function signup(){
  const email=document.getElementById('s-email').value.trim();
  const pass=document.getElementById('s-pass').value;
  if(!email||!pass){toast('Remplis email et mot de passe.');return;}
  if(!email.includes('@')){toast('Email invalide.');return;}
  if(pass.length<8){toast('Mot de passe trop court (8 car. min).');return;}
  const name = email.split('@')[0];
  const username = name;
  if(selectedSignupPlan!=='free'){
    closeModal('signup-modal');
    pendingSignup={name,username,email,pass};
    startPayment(selectedSignupPlan);
    return;
  }
  createUser({name,username,email,plan:'free'});
  closeModal('signup-modal');
  showApp();
  setTimeout(() => openOnboarding(), 1000);
}

let pendingSignup=null;

function createUser({name,username,email,plan}){
  const offeredPlan=localStorage.getItem('vb_offer_pending')?'pro':(plan||'free');
  currentUser={id:email,name,username:username||email.split('@')[0],email,plan:offeredPlan,avatar:'🙂',bio:'',followers:[],following:[],projects:[],totalVotes:0,createdAt:new Date().toISOString()};
  if(offeredPlan==='pro'&&localStorage.getItem('vb_offer_pending')){
    currentUser.offerClaimed=true;
    currentUser.offerExpiry=new Date(Date.now()+365*24*60*60*1000).toISOString();
    localStorage.removeItem('vb_offer_pending');
    setTimeout(()=>toast('🎉 Plan PRO activé gratuitement pour 1 an !'),800);
  }
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  // Crédits de bienvenue
  const welcomeCredits = 50;
  addCredits(welcomeCredits);
  setTimeout(()=>toast(`🎁 Bienvenue ! +${welcomeCredits}⚡ ViralCrédits offerts !`), 1200);
  try{fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)});}catch(e){}
}

// ── SUPER ADMIN ──
const SUPER_ADMIN_EMAIL='soug759@gmail.com';
const SUPER_ADMIN_PASS='Carla123';

function isSuperAdmin(email,pass){
  return email===SUPER_ADMIN_EMAIL&&pass===SUPER_ADMIN_PASS;
}

function loginAsSuperAdmin(){
  currentUser={
    id:SUPER_ADMIN_EMAIL,
    name:'Admin',
    username:'admin_viralboost',
    email:SUPER_ADMIN_EMAIL,
    plan:'elite',
    avatar:'👑',
    bio:'Super Administrateur de ViralBoost',
    isSuperAdmin:true,
    followers:[],following:[],projects:[],totalVotes:0,
    createdAt:new Date().toISOString()
  };
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('login-modal');
  showApp();
  // Charger toutes les données admin
  loadAdminData();
}

async function loadAdminData(){
  // Charger tous les utilisateurs, signalements, DMs, projets
  try{
    const [usersRes,reportsRes,dmsRes,projectsRes]=await Promise.all([
      fetch('/api/admin/all-users?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/reports?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/dms?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/projects').catch(()=>({ok:false}))
    ]);
    window._adminData={
      users: usersRes.ok ? await usersRes.json() : [],
      reports: reportsRes.ok ? await reportsRes.json() : [],
      dms: dmsRes.ok ? await dmsRes.json() : [],
      projects: projectsRes.ok ? await projectsRes.json() : []
    };
    toast('👑 Accès Admin total activé !');
    showAdminPanel();
  }catch(e){
    toast('👑 Mode Admin activé (données locales)');
    window._adminData={users:[],reports:[],dms:[],projects:[]};
    showAdminPanel();
  }
}

function showAdminPanel(){
  // Ajouter onglet Admin dans la barre si pas déjà là
  const tabs=document.querySelector('.app-tabs');
  if(tabs&&!document.getElementById('tab-btn-admin')){
    const btn=document.createElement('button');
    btn.className='app-tab';
    btn.id='tab-btn-admin';
    btn.style.color='#ffd700';
    btn.style.borderBottomColor='#ffd700';
    btn.innerHTML='👑 Admin';
    btn.onclick=()=>showAppTab('admin',btn);
    tabs.appendChild(btn);
    // Créer le panel admin
    const panel=document.createElement('div');
    panel.className='tpanel';
    panel.id='tab-admin';
    panel.innerHTML=buildAdminPanelHTML();
    document.querySelector('#app > div[style]').appendChild(panel);
  }
}

function buildAdminPanelHTML(){
  const d=window._adminData||{};
  const users=d.users||[];
  const reports=d.reports||[];
  const dms=d.dms||[];
  const projects=d.projects||[];

  return `
  <div style="max-width:1100px;margin:0 auto;padding:22px 0">
    <h2 style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:3px;color:#ffd700;margin-bottom:6px">👑 PANNEAU SUPER ADMIN</h2>
    <p style="font-size:12px;color:var(--muted);margin-bottom:24px;font-family:'DM Mono',monospace">Accès exclusif · soug759@gmail.com</p>

    <!-- STATS -->
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:28px">
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-users">${users.length||'?'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">UTILISATEURS</div>
      </div>
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-projects">${projects.length||'?'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">PROJETS/PUBS</div>
      </div>
      <div style="background:rgba(255,75,75,0.08);border:1.5px solid rgba(255,75,75,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#f87171" id="admin-stat-reports">${reports.length||'0'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">SIGNALEMENTS</div>
      </div>
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-dms">${dms.length||'0'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">DMS ADMIN</div>
      </div>
      <div style="background:rgba(34,197,94,0.06);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)" id="admin-stat-online">—</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">EN LIGNE</div>
      </div>
    </div>

    <!-- TABS -->
    <div class="feed-tabs" style="margin-bottom:18px">
      <button class="feed-tab active" onclick="switchAdminTab('users',this)">👥 Utilisateurs</button>
      <button class="feed-tab" onclick="switchAdminTab('reports',this)">🚨 Signalements</button>
      <button class="feed-tab" onclick="switchAdminTab('dms',this)">📩 DMs</button>
      <button class="feed-tab" onclick="switchAdminTab('projects',this)">📢 Publications</button>
      <button class="feed-tab" onclick="switchAdminTab('chat',this)">💬 Chat global</button>
    </div>

    <!-- USERS -->
    <div id="admin-tab-users">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;overflow:hidden">
        <table style="width:100%;border-collapse:collapse">
          <thead><tr style="background:var(--s2)">
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">NOM</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">EMAIL</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">PLAN</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">INSCRIT</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">ACTIONS</th>
          </tr></thead>
          <tbody id="admin-users-tbody">
            ${users.length?users.map(u=>`<tr style="border-top:1px solid var(--border2)">
              <td style="padding:10px 14px;font-size:13px">${u.name||'—'}</td>
              <td style="padding:10px 14px;font-size:12px;color:var(--muted);font-family:'DM Mono',monospace">${u.email||'—'}</td>
              <td style="padding:10px 14px"><span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></td>
              <td style="padding:10px 14px;font-size:11px;color:var(--muted)">${u.createdAt?new Date(u.createdAt).toLocaleDateString('fr-FR'):'—'}</td>
              <td style="padding:10px 14px"><button onclick="adminBanUser('${u.email}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:3px 8px;font-size:10px;color:#f87171;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Bannir</button></td>
            </tr>`).join(''):'<tr><td colspan="5" style="padding:24px;text-align:center;color:var(--muted)">Connecte MongoDB pour voir les utilisateurs</td></tr>'}
          </tbody>
        </table>
      </div>
    </div>

    <!-- REPORTS (hidden by default) -->
    <div id="admin-tab-reports" style="display:none">
      ${reports.length?`<div style="display:flex;flex-direction:column;gap:8px">
        ${reports.map(r=>`<div style="background:rgba(248,113,113,0.06);border:1.5px solid rgba(248,113,113,0.2);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
            <span style="font-size:12px;font-weight:700;color:#f87171">🚨 ${r.reportedName||r.reportedId||'?'}</span>
            <span style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">signalé par ${r.reporterName||r.reporterEmail||'?'}</span>
            <span style="background:rgba(248,113,113,0.15);color:#f87171;font-size:9px;padding:2px 7px;border-radius:3px;font-family:'DM Mono',monospace;margin-left:auto">${r.reason||'?'}</span>
          </div>
          ${r.details?`<div style="font-size:12px;color:var(--muted)">${r.details}</div>`:''}
          <div style="font-size:10px;color:var(--muted2);margin-top:6px;font-family:'DM Mono',monospace">${r.createdAt?new Date(r.createdAt).toLocaleString('fr-FR'):''}</div>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">Aucun signalement pour le moment 🎉</div>'}
    </div>

    <!-- DMs (hidden) -->
    <div id="admin-tab-dms" style="display:none">
      ${dms.length?`<div style="display:flex;flex-direction:column;gap:8px">
        ${dms.map(d=>`<div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
            <span style="font-size:20px">👑</span>
            <span style="font-size:12px;font-weight:700;color:#ffd700">${d.fromName||d.fromEmail||'?'}</span>
            <span class="chat-msg-plan-badge plan-${d.fromPlan||'elite'}" style="font-size:9px">${(d.fromPlan||'ELITE').toUpperCase()}</span>
            <span style="font-size:10px;color:var(--muted);margin-left:auto;font-family:'DM Mono',monospace">${d.createdAt?new Date(d.createdAt).toLocaleString('fr-FR'):''}</span>
          </div>
          <div style="font-size:13px;color:var(--g5)">${d.text||'—'}</div>
          <button onclick="replyToAdminDM('${d.fromEmail}')" style="margin-top:8px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:4px;padding:4px 10px;font-size:10px;color:#ffd700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Répondre</button>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">Aucun DM admin pour le moment</div>'}
    </div>

    <!-- PROJECTS (hidden) -->
    <div id="admin-tab-projects" style="display:none">
      ${projects.length?`<div class="vitrine-grid">${projects.slice(0,12).map(p=>`
        <div class="v-card">
          <div class="v-banner" style="background:${p.color||'var(--s2)'};">${p.emoji||'🚀'}
            <div class="v-badge" style="background:#ffd700;color:#1a0a00">${p.cat||p.type||'pub'}</div>
          </div>
          <div class="v-body">
            <div class="v-name">${p.name}</div>
            <div class="v-desc">${(p.desc||'').slice(0,80)}</div>
            <div class="v-footer">
              <div class="v-author" style="font-size:11px">${p.author||'?'}</div>
              <button onclick="adminDeleteProject('${p.id}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:2px 7px;font-size:10px;color:#f87171;cursor:pointer">🗑</button>
            </div>
          </div>
        </div>`).join('')}</div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">Aucun projet publié</div>'}
    </div>

    <!-- CHAT (hidden) -->
    <div id="admin-tab-chat" style="display:none">
      <div class="chat-box" style="height:500px">
        <div class="chat-msgs-area" id="admin-chat-msgs">
          ${[...publicMessages].reverse().slice(0,50).map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${m.name||'?'} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div><div class="chat-msg-text">${m.text||''}</div></div>`).join('')||'<div style="text-align:center;padding:32px;color:var(--muted)">Chat en temps réel visible ici</div>'}
        </div>
        <div class="chat-input-row">
          <input type="text" id="admin-chat-in" class="chat-input-field" placeholder="Envoyer un message en tant qu\'Admin 👑..." onkeydown="if(event.key===\\'Enter\\')sendAdminChatMsg()"/>
          <button class="btn-send" onclick="sendAdminChatMsg()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">→</button>
        </div>
      </div>
    </div>

    <div style="margin-top:24px;padding:14px;background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.1);border-radius:8px;font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;text-align:center">
      👑 Super Admin Panel · soug759@gmail.com · <a href="/admin?key=viralboost-admin" target="_blank" style="color:#ffd700;text-decoration:none">Dashboard serveur complet →</a>
    </div>
  </div>`;
}

function switchAdminTab(tab,el){
  document.querySelectorAll('#tab-admin .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  ['users','reports','dms','projects','chat'].forEach(t=>{
    const el2=document.getElementById('admin-tab-'+t);
    if(el2)el2.style.display=t===tab?'block':'none';
  });
}

function adminBanUser(email){
  if(confirm('Bannir '+email+' ?')){
    fetch('/api/admin/ban',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,key:'viralboost-admin'})}).catch(()=>{});
    toast('🚫 Utilisateur banni : '+email);
  }
}

function adminDeleteProject(id){
  if(confirm('Supprimer ce projet ?')){
    vitrineData=vitrineData.filter(p=>p.id!==id);
    fetch('/api/projects/'+id,{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({key:'viralboost-admin'})}).catch(()=>{});
    toast('🗑 Projet supprimé');
    document.getElementById('tab-admin').innerHTML=buildAdminPanelHTML();
  }
}

function replyToAdminDM(email){
  openDMToUser(email, email.split('@')[0]);
}

function sendAdminChatMsg(){
  const inp=document.getElementById('admin-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  inp.value='';
  const el=document.getElementById('admin-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.style.background='rgba(255,215,0,0.06)';
  div.style.border='1px solid rgba(255,215,0,0.15)';
  div.innerHTML=`<div class="chat-msg-name"><span style="color:#ffd700">👑 Admin</span> <span class="admin-msg-badge">ADMIN</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({type:'message',name:'👑 Admin',plan:'elite',text,isAdmin:true}));
  }
}

function login(){
  const email=document.getElementById('l-email').value.trim();
  const pass=document.getElementById('l-pass').value;
  if(!email||!pass){toast('Remplis tous les champs.');return;}

  // ── SUPER ADMIN ──
  if(isSuperAdmin(email,pass)){
    loginAsSuperAdmin();
    return;
  }

  const saved=localStorage.getItem('viralboost_user');
  if(saved){
    const u=JSON.parse(saved);
    if(u.email===email){currentUser=u;closeModal('login-modal');showApp();return;}
  }
  createUser({name:email.split('@')[0],email,plan:'free'});
  closeModal('login-modal');
  showApp();
}

function logout(){
  currentUser=null;
  localStorage.removeItem('viralboost_user');
  document.body.classList.remove('app-active');
  document.getElementById('app').style.display='none';
  document.getElementById('landing').style.display='block';
  const guestBtns=document.getElementById('mob-btns-guest');
  const userBtns=document.getElementById('mob-btns-user');
  if(guestBtns)guestBtns.style.display='flex';
  if(userBtns)userBtns.style.display='none';
  window.scrollTo(0,0);
}

async function loadVitrineFromAPI(){
  try{
    const r=await fetchWithTimeout('/api/projects');
    const apiProjects=await r.json();
    if(Array.isArray(apiProjects)&&apiProjects.length>0){
      const apiIds=new Set(apiProjects.map(p=>p.id));
      vitrineData=[...apiProjects,...(vitrineData||[]).filter(p=>!apiIds.has(p.id))];
    }
  }catch(e){}
  buildVitrineGrid('app-vitrine-grid');
}


function startDemoPublish(){
  startDemo();
  // Go directly to the publish tab after a short delay
  setTimeout(() => {
    showAppTab('publier', null);
    // Show a subtle nudge on the publish tab
    setTimeout(() => {
      const nudge = document.createElement('div');
      nudge.id = 'publish-nudge';
      nudge.style.cssText = 'background:linear-gradient(135deg,rgba(34,197,94,0.12),rgba(74,222,128,0.06));border:1.5px solid rgba(34,197,94,0.35);border-radius:14px;padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;gap:12px;animation:fadeUp 0.4s ease both;';
      nudge.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
          <span style="font-size:28px">👇</span>
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:1.5px;color:var(--g3)">CHOISIS TON TYPE DE PUB</div>
            <div style="font-size:12px;color:var(--muted)">Configure ta pub → clique Publier → crée ton compte en 30 sec</div>
          </div>
        </div>
        <button onclick="openDemoSignupModal()" style="background:var(--g2);border:none;border-radius:8px;padding:9px 18px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:800;color:var(--bg);cursor:pointer;white-space:nowrap;">Créer mon compte →</button>
      `;
      const panel = document.getElementById('tab-publier');
      if(panel) panel.insertBefore(nudge, panel.firstChild);
    }, 600);
  }, 400);
}

function openDemoSignupModal(){
  // Remove demo banner temporarily and show a powerful signup modal
  const modal = document.createElement('div');
  modal.id = 'demo-signup-modal';
  modal.style.cssText = 'position:fixed;inset:0;background:rgba(4,10,5,0.94);backdrop-filter:blur(16px);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.25s ease;';
  modal.innerHTML = `
    <div style="background:var(--s1);border:2px solid rgba(34,197,94,0.5);border-radius:20px;padding:32px 28px;max-width:400px;width:100%;position:relative;animation:popIn 0.35s cubic-bezier(0.34,1.56,0.64,1);">
      <div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:60%;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);border-radius:100px;"></div>
      
      <div style="text-align:center;margin-bottom:22px;">
        <div style="font-size:40px;margin-bottom:10px;">🚀</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--white);margin-bottom:6px;">T'es à 1 étape de publier !</div>
        <div style="font-size:13px;color:var(--muted);line-height:1.6;">Ta pub est prête. Crée ton compte gratuit en 30 secondes pour la mettre en ligne maintenant.</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:9px;margin-bottom:20px;background:rgba(22,163,74,0.05);border:1px solid rgba(34,197,94,0.12);border-radius:12px;padding:14px 16px;">
        <div style="font-size:12px;color:var(--g5);">✅ &nbsp;Publication <strong style="color:var(--g3)">immédiate</strong> — visible par toute la communauté</div>
        <div style="font-size:12px;color:var(--g5);">✅ &nbsp;Accès au feed, collabs & groupes</div>
        <div style="font-size:12px;color:var(--g5);">✅ &nbsp;<strong style="color:var(--g3)">100% gratuit</strong> — sans carte bancaire</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:9px;margin-bottom:14px;">
        <input id="dsm-email" class="signup-input" placeholder="📧 Ton email" type="email" style="width:100%;padding:12px 14px;background:rgba(4,10,5,0.9);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;" />
        <input id="dsm-pass" class="signup-input" placeholder="🔒 Mot de passe (8 car. min.)" type="password" style="width:100%;padding:12px 14px;background:rgba(4,10,5,0.9);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;" />
      </div>

      <button onclick="demoSignupSubmit()" style="width:100%;padding:15px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 36px rgba(34,197,94,0.45);transition:all 0.2s;margin-bottom:10px;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
        ⚡ Créer mon compte & Publier →
      </button>
      
      <div style="text-align:center;font-size:11px;color:var(--muted2);margin-bottom:10px;">En créant un compte tu acceptes nos CGU</div>
      
      <button onclick="closeDemoSignupModal()" style="display:block;width:100%;text-align:center;background:none;border:none;font-size:12px;color:var(--muted2);cursor:pointer;padding:6px;font-family:'Plus Jakarta Sans',sans-serif;">
        Continuer en mode démo →
      </button>
    </div>
  `;
  document.body.appendChild(modal);
  // Focus first input
  setTimeout(() => { const inp = document.getElementById('dsm-email'); if(inp) inp.focus(); }, 300);
}

function closeDemoSignupModal(){
  const m = document.getElementById('demo-signup-modal');
  if(m) m.remove();
}

function demoSignupSubmit(){
  const email = (document.getElementById('dsm-email')?.value||'').trim();
  const pass = (document.getElementById('dsm-pass')?.value||'').trim();
  if(!email||!email.includes('@')){toast('⚠️ Email invalide !');return;}
  if(pass.length < 8){toast('⚠️ Mot de passe trop court (8 car. min) !');return;}
  
  // Créer le compte directement
  closeDemoSignupModal();
  const name = email.split('@')[0];
  createUser({name, username: name, email, plan:'free'});
  showApp();
  setTimeout(() => openOnboarding(), 1000);
}

function startDemo(){
  // Create a read-only demo user
  currentUser = {
    name: 'Visiteur Demo',
    username: 'demo_visitor',
    email: 'demo@viralboost.app',
    plan: 'free',
    avatar: '👀',
    followers: [],
    following: [],
    projects: [],
    totalVotes: 0,
    isDemo: true
  };
  showApp();
}

function exitDemo(){
  currentUser = null;
  const banner = document.getElementById('demo-banner');
  if(banner) banner.remove();
  const app = document.getElementById('app');
  if(app) app.style.paddingTop = '';
  document.getElementById('landing').style.display='block';
  document.getElementById('app').style.display='none';
  document.body.classList.remove('app-active');
  openModal('signup-modal');
}

function showApp(){
  document.getElementById('landing').style.display='none';
  document.getElementById('app').style.display='block';
  document.body.classList.add('app-active');
  // Menu mobile : montrer Quitter, cacher Connexion/Rejoindre
  const guestBtns = document.getElementById('mob-btns-guest');
  const userBtns = document.getElementById('mob-btns-user');
  if(guestBtns) guestBtns.style.display='none';
  if(userBtns) userBtns.style.display='flex';
  updateAppBar();
  loadPostsFromAPI();
  loadMemberCount();
  loadVitrineFromAPI();
  window.scrollTo(0,0);
  connectWS();
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  document.getElementById('feed-limit-info').innerHTML=`Plan ${(currentUser.plan||'FREE').toUpperCase()} · <span id="pubs-left">${plan.limits.pubsPerHour||plan.limits.pubsPerDay||'∞'}</span> pub${currentUser.plan==='free'?'/h':'/jour'}`;
  const chatLeft=Math.max(0,(PLANS.find(p=>p.id===currentUser.plan)||PLANS[0]).limits.chatMsgs-chatMsgsToday);
  const chatEl=document.getElementById('chat-msgs-left');
  if(chatEl)chatEl.textContent=chatLeft;
  // Restore wallpaper
  if(currentUser.wallpaper&&currentUser.wallpaper!=='none'){
    const app=document.getElementById('app');
    app.style.background=currentUser.wallpaper;
    app.classList.add('has-wallpaper');
  }
  // Pub hero après inscription
  if(window._pendingHeroAd&&currentUser){
    const ad=window._pendingHeroAd;
    document.getElementById('feed-text').value=ad.desc;
    document.getElementById('feed-proj-name').value=ad.name;
    const sel=document.getElementById('feed-proj-type');
    if(sel&&ad.type)sel.value=ad.type;
    showAppTab('feed',document.querySelector('.app-tab'));
    toast('📢 Ta pub est prête ! Clique sur Publier.');
    window._pendingHeroAd=null;
  }
  // Nouvelles features
  updateCreditsDisplay();
  // Aller directement sur Publier par défaut
  if(!window._pendingHeroAd){
    showAppTab('publier', document.querySelector('.app-tab[onclick*="publier"]'));
  }
  setTimeout(checkOnboarding,800);
  setTimeout(checkNewBadges, 500);
}

function updateAppBar(){
  if(!currentUser)return;
  document.getElementById('app-user-name').textContent=currentUser.name;
  document.getElementById('app-user-ava').textContent=currentUser.avatar||currentUser.name[0];
  const chip=document.getElementById('app-plan-chip');
  chip.textContent=(currentUser.plan||'FREE').toUpperCase();
  const isElite=currentUser.plan==='elite';
  if(isElite){chip.style.background='linear-gradient(135deg,#ffd700,#ff8c00)';chip.style.color='#1a0a00';}
  else{chip.style.background='';chip.style.color='';}
  const btnWp=document.getElementById('btn-wallpaper');
  const btnAdm=document.getElementById('btn-admin-dm');
  if(btnWp)btnWp.style.display=isElite?'flex':'none';
  if(btnAdm)btnAdm.style.display=isElite?'flex':'none';
}

// ── PAYMENT ──
function startPayment(planId){
  const plan=PLANS.find(p=>p.id===planId);
  if(!plan||plan.price===0)return;
  pendingPlan=planId;
  document.getElementById('pay-plan-name').textContent=plan.name;
  document.getElementById('pay-plan-price').textContent=plan.price+'€';
  openModal('payment-modal');
  if(stripe){
    const el=stripe.elements({appearance:{theme:'night',variables:{colorPrimary:'#22c55e',colorBackground:'#0b1a0d',colorText:'#f0fdf4',borderRadius:'8px'}}});
    cardElement=el.create('card');
    setTimeout(()=>cardElement.mount('#card-element'),100);
  }
}

async function processPayment(){
  const btn=document.getElementById('btn-pay');
  btn.disabled=true;btn.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  const amounts={starter:300,pro:1499,elite:3999};
  try{
    const r=await fetch('/api/create-payment-intent',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan:pendingPlan,amount:amounts[pendingPlan]||300})});
    const{clientSecret,error:ie}=await r.json();
    if(ie)throw new Error(ie);
    const{error,paymentIntent}=await stripe.confirmCardPayment(clientSecret,{payment_method:{card:cardElement}});
    if(error)throw new Error(error.message);
    if(paymentIntent.status==='succeeded'){
      if(pendingSignup){createUser({...pendingSignup,plan:pendingPlan});pendingSignup=null;}
      else if(currentUser){currentUser.plan=pendingPlan;localStorage.setItem('viralboost_user',JSON.stringify(currentUser));}
      closeModal('payment-modal');
      updateAppBar();
      showApp();
      toast('🎉 Plan '+pendingPlan.toUpperCase()+' activé !');
    }
  }catch(err){
    document.getElementById('card-errors').textContent=err.message;
    btn.disabled=false;btn.textContent='🔒 S\'abonner';
  }
}

// ── WEBSOCKET ──
function connectWS(){
  if(!currentUser)return;
  try{
    const proto=location.protocol==='https:'?'wss':'ws';
    ws=new WebSocket(`${proto}://${location.host}`);
    ws.onopen=()=>{
      wsRetries=0;
      ws.send(JSON.stringify({type:'join',userId:currentUser.email,name:currentUser.name,plan:currentUser.plan||'free'}));
    };
    ws.onmessage=(e)=>{
      try{
        const data=JSON.parse(e.data);
        // Historique du chat au chargement (messages précédents)
        if(data.type==='history'&&Array.isArray(data.messages)){
          worldChatMsgs=data.messages.map(m=>({name:m.name,plan:m.plan||'free',text:m.text,time:new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})}));
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
        }
        // Publications vitrine précédentes envoyées au login
        if(data.type==='projects_history'&&Array.isArray(data.projects)){
          const apiIds=new Set(data.projects.map(p=>p.id));
          vitrineData=[...data.projects,...(vitrineData||[]).filter(p=>!apiIds.has(p.id))];
          if(document.getElementById('tab-vitrine')?.classList.contains('active'))buildVitrineGrid('app-vitrine-grid');
        }
        if(data.type==='message'&&data.message){
          worldChatMsgs.push({name:data.message.name,plan:data.message.plan||'free',text:data.message.text,time:new Date(data.message.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
          else{const nd=document.getElementById('chat-notif');if(nd)nd.style.display='inline-block';}
        }
        if(data.type==='online_users'){
          const cnt=document.getElementById('world-online-count');
          if(cnt)cnt.textContent=data.users.length+' en ligne';
        }
        if(data.type==='dm'&&data.message?.fromId){
          const fromId=data.message.fromId;
          if(!dmThreads[fromId])dmThreads[fromId]=[];
          dmThreads[fromId].push({fromMe:false,text:data.message.text,time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(dmTarget&&dmTarget.id===fromId)renderDMThread(fromId);
          toast('💬 Nouveau DM de '+data.message.fromName);
        }
        if(data.type==='vote_update'){
          document.querySelectorAll('[data-pid="'+data.projectId+'"] .vote-count').forEach(el=>el.textContent=data.votes);
        }
        if(data.type==='new_project'&&data.project?.authorId!==currentUser?.email){
          vitrineData.unshift(data.project);
          toast('🚀 Nouveau projet : '+data.project.name);
        }
        if(data.type==='new_post'&&data.post?.userId!==currentUser?.email){
          // Ajouter le post en temps réel
          if(!feedPosts.find(p=>p.id===data.post.id)){
            const p=data.post;
            p.time='À l\'instant';
            feedPosts.unshift(p);
            if(document.getElementById('tab-feed')?.classList.contains('active'))buildFeed();
          }
        }
        if(data.type==='like_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p){p.likes=data.likes;}
          const cnt=document.querySelector(`#post-${data.postId} .like-count`);
          if(cnt)cnt.textContent=data.likes;
        }
        if(data.type==='comment_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p)p.comments=data.comments;
          const cnt=document.querySelector(`#post-${data.postId} .comment-count`);
          if(cnt)cnt.textContent=data.comments;
        }
        if(data.type==='share_update'){
          const cnt=document.querySelector(`#post-${data.postId} .share-count`);
          if(cnt)cnt.textContent=data.shares;
        }
        if(data.type==='group_message'&&data.groupId===currentGroupId){
          if(document.getElementById('group-chat-modal')?.classList.contains('open')){
            loadGroupMessages(currentGroupId);
          }
        }
      }catch(e){}
    };
    ws.onclose=()=>{
      wsRetries=(wsRetries||0)+1;
      if(wsRetries<10)setTimeout(connectWS,Math.min(5000*wsRetries,30000));
    };
  }catch(e){}
}

// ── TIMERS (posts) ──
function updateTimers(){
  document.querySelectorAll('.post-timer-val').forEach(el=>{
    const end=parseInt(el.dataset.end);
    if(!end)return;
    const left=end-Date.now();
    if(left<=0){el.closest('.post-card')?.remove();return;}
    const m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);
    el.textContent=m+'m'+String(s).padStart(2,'0')+'s';
  });
}
setInterval(updateTimers,1000);

// ── TABS update to include groupes ──
function showAppTab(tab,el){
  syncBottomNav(tab);
  document.querySelectorAll('.app-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tpanel').forEach(p=>p.classList.remove('active'));
  if(el)el.classList.add('active');
  const panel=document.getElementById('tab-'+tab);
  if(panel)panel.classList.add('active');
  // Onglets originaux
  if(tab==='vitrine')buildVitrineGrid('app-vitrine-grid');
  if(tab==='profil')renderMyProfile();
  if(tab==='abonnes')buildFollowList('discover');
  if(tab==='chat-global'){buildWorldChat();const nd=document.getElementById('chat-notif');if(nd)nd.style.display='none';}
  if(tab==='feed')buildFeed();
  if(tab==='groupes')loadGroups();
  // Nouveaux onglets
  if(tab==='stats')loadStats();
  if(tab==='leaderboard')loadLeaderboard('pubs');
  if(tab==='collab')loadCollabs();
  if(tab==='calendrier')buildCalendar();
  if(tab==='publier'){
    updatePubCompletion(); updateDescCount();
    setTimeout(()=>{ const drop=document.getElementById('pub-media-drop'); if(drop) drop.onclick=()=>document.getElementById('pub-media-input')?.click(); },100);
    // Guide première ouverture
    if(!localStorage.getItem('vb_pub_guide_seen')){
      setTimeout(()=>{ document.getElementById('pub-guide-overlay')?.classList.remove('hidden'); }, 500);
    }
  }
  if(tab==='boost-credits'){updateCreditsDisplay();loadBoostPostOptions();renderMissions();updateMissionsCountdown();}
}

// ── GROUPES ──
async function loadGroups(){
  try{
    const r=await fetch('/api/groups');
    groupsData=await r.json();
  }catch(e){groupsData=[];}
  buildGroupsList();
  const btn=document.getElementById('btn-create-group');
  if(btn)btn.style.display=(currentUser?.plan==='elite')?'block':'none';
}

// Pas de groupes fictifs — uniquement les vrais groupes créés par les membres
const sampleGroups=[];

function buildGroupsList(){
  const el=document.getElementById('groups-list');
  if(!el)return;
  const data=groupsData;
  if(!data.length){
    el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted);grid-column:1/-1"><div style="font-size:40px;margin-bottom:12px">🏛️</div><div style="font-size:14px;font-weight:700;color:var(--g5);margin-bottom:8px">Aucun groupe pour l\'instant</div><div style="font-size:12px">Les membres Elite peuvent créer des groupes thématiques.</div></div>';
    return;
  }
  el.innerHTML=data.map(g=>`
    <div class="group-card" onclick="openGroupChat('${g.id}','${escHtml(g.name)}','${g.creatorId}','${g.access}','${g.allowPhotos||1}')">
      <div class="group-banner" style="${g.bgUrl?`background:url('${g.bgUrl}') center/cover`:'background:linear-gradient(135deg,var(--s2),var(--s3))'}">
        <span style="font-size:36px">${g.emoji||'💬'}</span>
        ${g.access==='private'?'<span style="position:absolute;top:8px;right:8px;font-size:10px;background:rgba(0,0,0,0.6);padding:2px 7px;border-radius:4px;color:#fff">🔒 Privé</span>':''}
      </div>
      <div class="group-body">
        <div class="group-name">${g.name}</div>
        <div class="group-desc">${g.desc||''}</div>
        <div class="group-footer">
          <div class="group-meta">👥 ${g.membersCount||0} membres · ${g.cat||''}</div>
          ${currentUser?.plan==='elite'&&currentUser?.email===g.creatorId?`<button class="btn-report" onclick="event.stopPropagation();openGroupSettings('${g.id}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Admin</button>`:''}
        </div>
      </div>
    </div>`).join('');
}

async function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  // Show admin btn if elite creator
  const acts=document.getElementById('group-chat-actions');
  acts.innerHTML='';
  if(currentUser.plan==='elite'&&currentUser.email===creatorId){
    acts.innerHTML=`<button class="btn-report" onclick="openGroupSettings('${groupId}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Paramètres groupe</button>`;
  }
  // Show media upload if allowed
  const mediaBtnLabel=document.getElementById('group-media-btn');
  if(mediaBtnLabel)mediaBtnLabel.style.display=(allowPhotos==='1'||allowPhotos===1)?'flex':'none';
  await loadGroupMessages(groupId);
  openModal('group-chat-modal');
}

async function loadGroupMessages(groupId){
  const el=document.getElementById('group-chat-msgs');
  try{
    const r=await fetch('/api/groups/'+groupId+'/messages');
    const msgs=await r.json();
    if(!msgs.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Premier à écrire dans ce groupe 👋</div>';return;}
    el.innerHTML=msgs.map(m=>`
      <div class="chat-msg-item">
        <div class="chat-msg-name">${escHtml(m.author||'Anonyme')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>
        ${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}
        ${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px;object-fit:cover"/>`}</div>`:''}
      </div>`).join('');
    el.scrollTop=el.scrollHeight;
  }catch(e){el.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px">Impossible de charger les messages</div>';}
}

async function sendGroupMessage(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const inp=document.getElementById('group-chat-input');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const msg={text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
  inp.value='';
  try{await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});}catch(e){}
  await loadGroupMessages(currentGroupId);
}

function openCreateGroup(){
  if(currentUser?.plan!=='elite'){toast('⭐ Créer un groupe est réservé au plan ELITE.');startPayment('elite');return;}
  openModal('create-group-modal');
}

async function createGroup(){
  if(!currentUser){return;}
  const name=document.getElementById('grp-name').value.trim();
  const desc=document.getElementById('grp-desc').value.trim();
  if(!name||!desc){toast('Remplis le nom et la description.');return;}
  const group={
    name,desc,emoji:document.getElementById('grp-emoji').value||'💬',
    cat:document.getElementById('grp-cat').value,
    access:document.getElementById('grp-access').value,
    rules:document.getElementById('grp-rules').value.trim(),
    bgUrl:groupBgUrl||'',allowPhotos:1,
    creatorId:currentUser.email,membersCount:1
  };
  try{
    const r=await fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)});
    const d=await r.json();
    toast('🏛️ Groupe créé !');
    closeModal('create-group-modal');
    groupBgUrl=null;
    await loadGroups();
  }catch(e){
    // Fallback local si pas de backend
    group.id='grp'+Date.now();
    groupsData.unshift(group);
    toast('🏛️ Groupe créé !');
    closeModal('create-group-modal');
    buildGroupsList();
  }
}

function openGroupSettings(groupId){
  currentGroupSettingsId=groupId;
  const grp=groupsData.find(g=>g.id===groupId);
  if(grp){
    document.getElementById('gs-rules').value=grp.rules||'';
    document.getElementById('gs-allow-photos').value=grp.allowPhotos||1;
    document.getElementById('gs-access').value=grp.access||'public';
  }
  openModal('group-settings-modal');
}

async function saveGroupSettings(){
  if(!currentGroupSettingsId)return;
  const settings={
    allowPhotos:parseInt(document.getElementById('gs-allow-photos').value),
    rules:document.getElementById('gs-rules').value.trim(),
    access:document.getElementById('gs-access').value
  };
  if(groupSettingsBgUrl)settings.bgUrl=groupSettingsBgUrl;
  try{
    await fetch('/api/groups/'+currentGroupSettingsId+'/settings',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({settings,requesterId:currentUser.email})});
    toast('✅ Paramètres du groupe mis à jour !');
    closeModal('group-settings-modal');
    groupSettingsBgUrl=null;
    await loadGroups();
  }catch(e){toast('Erreur paramètres.');}
}

// ── SIGNALEMENT ──
function openReport(userId,userName){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Signaler : '+userName+' → transmis à l\'admin';
  openModal('report-modal');
}

async function submitReport(){
  if(!reportTarget||!currentUser)return;
  const reason=document.getElementById('report-reason').value;
  const details=document.getElementById('report-details').value.trim();
  try{
    await fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      reporterId:currentUser.email,reporterEmail:currentUser.email,reporterName:currentUser.name,
      reportedId:reportTarget.id,reportedName:reportTarget.name,reason,details
    })});
    toast('🚨 Signalement envoyé à l\'admin !');
    closeModal('report-modal');
  }catch(e){toast('Erreur envoi signalement.');}
}

// ── CONTACT ADMIN (ELITE) ──
function openContactAdmin(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacter l\'admin est réservé au plan ELITE.');return;}
  openModal('contact-admin-modal');
}

async function sendAdminMessage(){
  if(!currentUser)return;
  const subject=document.getElementById('ca-subject').value.trim();
  const message=document.getElementById('ca-message').value.trim();
  if(!message){toast('Écris ton message.');return;}
  try{
    await fetch('/api/contact-admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      fromName:currentUser.name,fromEmail:currentUser.email,fromPlan:currentUser.plan,
      subject,message
    })});
    toast('📩 Message envoyé à l\'admin !');
    closeModal('contact-admin-modal');
  }catch(e){toast('Erreur envoi.');}
}

// ── HERO PUBLISH AD ──
function heroPublishAd(){
  const name=document.getElementById('hero-ad-name').value.trim();
  const type=document.getElementById('hero-ad-type').value;
  const desc=document.getElementById('hero-ad-desc').value.trim();
  if(!name){document.getElementById('hero-ad-name').focus();toast('Indique le nom de ton produit !','error');return;}
  if(!desc){document.getElementById('hero-ad-desc').focus();toast('Décris brièvement ta pub !','error');return;}
  // Pré-remplir le signup modal et lancer la pub après inscription
  window._pendingHeroAd={name,type,desc};
  openModal('signup-modal');
  toast('✅ Crée ton compte pour publier ta pub !');
}

// ── PUBLIC FEED ──
function buildPublicFeed(){
  const el=document.getElementById('public-feed-list');
  if(!el)return;
  const publicPosts=[...feedPosts].slice(0,3);
  if(!publicPosts.length){
    el.innerHTML=`<div style="text-align:center;padding:48px 24px;color:var(--muted)">
      <div style="font-size:40px;margin-bottom:12px">📢</div>
      <div style="font-size:14px;color:var(--g5);font-weight:700;margin-bottom:8px">Sois le premier à publier !</div>
      <div style="font-size:12px;line-height:1.8">Le fil se remplit avec les vraies publications de la communauté.</div>
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')" style="margin-top:20px">Créer un compte & publier →</button>
    </div>`;
    return;
  }
  el.innerHTML=`<div>${publicPosts.slice(0,3).map(p=>{
    const isElite=p.plan==='elite';
    return `<div class="public-post-card ${isElite?'elite-pub':''}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <div style="width:32px;height:32px;border-radius:50%;background:${getAvatarColor(p.userId)};display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg)">${p.emoji||p.author?.[0]||'?'}</div>
        <div>
          <div style="font-size:13px;font-weight:700;${isElite?'color:var(--gold)':''}">${p.author||'Anonyme'}</div>
          <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">${p.time||''}</div>
        </div>
        <span class="chat-msg-plan-badge plan-${p.plan||'free'}" style="margin-left:auto">${(p.plan||'FREE').toUpperCase()}</span>
      </div>
      <div style="font-size:13px;line-height:1.7;color:#c4d9cb">${p.text?p.text.slice(0,160)+(p.text.length>160?'...':''):''}</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">❤️ ${p.likes||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">💬 ${p.comments||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">🔗 Partager</span>
      </div>
    </div>`;
  }).join('')}</div><div class="feed-lock"><button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Voir tout le fil & publier ta pub →</button></div>`;
}

// ── MEDIA PREVIEW ──
function previewFeedMedia(input){
  const preview=document.getElementById('feed-media-preview');
  if(!preview)return;
  preview.innerHTML='';
  const files=Array.from(input.files).slice(0,4);
  files.forEach(f=>{
    const div=document.createElement('div');
    div.className='media-preview-item';
    if(f.type.startsWith('image/')){
      const img=document.createElement('img');
      img.src=URL.createObjectURL(f);
      div.appendChild(img);
    } else if(f.type.startsWith('video/')){
      const vid=document.createElement('video');
      vid.src=URL.createObjectURL(f);
      vid.muted=true;
      div.appendChild(vid);
    } else {
      div.innerHTML=`<div style="padding:8px;font-size:11px;color:var(--g4);text-align:center">📄<br>${f.name.slice(0,12)}</div>`;
    }
    const rm=document.createElement('button');
    rm.className='rm-media';rm.textContent='✕';
    rm.onclick=()=>{div.remove();};
    div.appendChild(rm);
    preview.appendChild(div);
  });
}

// ── SIGNALEMENT (avec radio) ──
function submitReport(){
  if(!currentUser)return;
  const radios=document.querySelectorAll('input[name="report-reason"]');
  let reason='';
  radios.forEach(r=>{if(r.checked)reason=r.value;});
  if(!reason){toast('Choisis une raison de signalement.');return;}
  const details=document.getElementById('report-details').value.trim();
  fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
    reporterId:currentUser?.email||'anonymous',reporterName:currentUser?.name||'?',
    reportedId:reportTarget?.id||'?',reportedName:reportTarget?.name||'?',reason,details,timestamp:new Date().toISOString()
  })}).catch(()=>{});
  toast('🚨 Signalement envoyé à l\'admin !');
  closeModal('report-modal');
  reportTarget=null;
}

// ── SEND GROUP MSG ──
function sendGroupMsg(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const inp=document.getElementById('group-chat-in');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${time}</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  inp.value='';
  fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free'})}).catch(()=>{});
}

function sendGroupMedia(input){
  const f=input.files[0];
  if(!f||!currentGroupId)return;
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  const url=URL.createObjectURL(f);
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span></div><div style="margin-top:4px">${f.type.startsWith('video')?`<video src="${url}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${url}" style="max-width:200px;border-radius:6px"/>`}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  input.value='';
}

// ── CREATE GROUP (new modal IDs) ──
function createGroup(){
  if(!currentUser){return;}
  if(currentUser.plan!=='elite'){toast('⭐ Créer un groupe est réservé au plan ELITE.');return;}
  const name=document.getElementById('cg-name')?.value.trim();
  if(!name){toast('Donne un nom au groupe.');return;}
  const group={
    id:'grp'+Date.now(),name,emoji:document.getElementById('cg-emoji')?.value||'💬',
    desc:document.getElementById('cg-desc')?.value.trim()||'',
    cat:document.getElementById('cg-cat')?.value||'Autre',
    access:document.getElementById('cg-private')?.checked?'private':'public',
    allowPhotos:document.getElementById('cg-allow-photos')?.checked?1:0,
    allowVideos:document.getElementById('cg-allow-videos')?.checked?1:0,
    premod:document.getElementById('cg-premod')?.checked?1:0,
    creatorId:currentUser.email,membersCount:1
  };
  groupsData.unshift(group);
  toast('🏆 Groupe créé !');
  closeModal('create-group-modal');
  if(document.getElementById('tab-groupes')?.classList.contains('active'))buildGroupsList();
  fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)}).catch(()=>{});
}

// ── WALLPAPER (ELITE) ──
function setWallpaper(bg){
  if(currentUser?.plan!=='elite'){toast('⭐ Le fond d\'écran est réservé au plan ELITE.');return;}
  const app=document.getElementById('app');
  if(bg==='none'){app.style.background='';app.classList.remove('has-wallpaper');}
  else{app.style.background=bg;app.classList.add('has-wallpaper');}
  currentUser.wallpaper=bg;
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('wallpaper-modal');
  toast('🖼️ Fond d\'écran appliqué !');
}

function setWallpaperFromFile(input){
  if(!input.files[0])return;
  if(currentUser?.plan!=='elite'){toast('⭐ Le fond d\'écran est réservé au plan ELITE.');return;}
  const url=URL.createObjectURL(input.files[0]);
  const app=document.getElementById('app');
  app.style.background=`url('${url}') center/cover fixed`;
  app.classList.add('has-wallpaper');
  toast('🖼️ Fond d\'écran appliqué !');
  closeModal('wallpaper-modal');
}

// ── DM ADMIN (ELITE) ──
let adminDMMessages=[];
function openAdminDM(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacter l\'admin directement est réservé au plan ELITE.');return;}
  renderAdminDMThread();
  openModal('dm-admin-modal');
}
function renderAdminDMThread(){
  const el=document.getElementById('dm-admin-msgs');
  if(!el)return;
  if(!adminDMMessages.length){el.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">📩 Premier message à l\'admin — répond sous 24h</div>';return;}
  el.innerHTML=adminDMMessages.map(m=>`<div class="dm-msg ${m.fromMe?'mine':'theirs'}"><div class="dm-bubble-g">${escHtml(m.text)}</div><div class="dm-time">${m.time}</div></div>`).join('');
  el.scrollTop=el.scrollHeight;
}
function sendAdminDM(){
  const inp=document.getElementById('dm-admin-input');
  const text=inp.value.trim();
  if(!text||!currentUser)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  adminDMMessages.push({fromMe:true,text,time});
  inp.value='';
  renderAdminDMThread();
  fetch('/api/admin-dm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fromEmail:currentUser.email,fromName:currentUser.name,fromPlan:currentUser.plan,text,timestamp:new Date().toISOString()})}).catch(()=>{});
  toast('📩 Message envoyé à l\'admin !');
}

// ── OPEN REPORT ──
function openReport(userId,userName){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Signaler : '+userName+' → transmis à l\'admin';
  document.querySelectorAll('input[name="report-reason"]').forEach(r=>r.checked=false);
  document.getElementById('report-details').value='';
  openModal('report-modal');
}

// ── OPEN GROUP CHAT ──
function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  document.getElementById('group-chat-sub').textContent='Groupe de discussion · '+(access==='private'?'🔒 Privé':'🌍 Public');
  // Admin controls
  const adminCtrl=document.getElementById('group-admin-controls');
  if(adminCtrl)adminCtrl.style.display=(currentUser.plan==='elite'&&currentUser.email===creatorId)?'block':'none';
  // Media upload
  const mediLabel=document.getElementById('group-media-upload-label');
  if(mediLabel)mediLabel.style.display=(allowPhotos==='1'||allowPhotos===1||allowPhotos===true)?'inline-flex':'none';
  // Load members
  const ml=document.getElementById('group-members-list');
  if(ml)ml.innerHTML='<div style="color:var(--muted2);font-size:11px">👥 En ligne...</div>';
  // Load messages
  const msgEl=document.getElementById('group-chat-msgs');
  msgEl.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)">Premier à écrire dans ce groupe 👋</div>';
  fetch('/api/groups/'+groupId+'/messages').then(r=>r.json()).then(msgs=>{
    if(!msgs.length)return;
    msgEl.innerHTML=msgs.map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${escHtml(m.author||'?')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px"/>`}</div>`:''}</div>`).join('');
    msgEl.scrollTop=msgEl.scrollHeight;
  }).catch(()=>{});
  openModal('group-chat-modal');
}

function openGroupSettings(groupId){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('create-group-modal');
}

// ── LIKE/PARTAGE/COMMENTAIRE DORÉS ELITE ──
function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  const isElite=currentUser?.plan==='elite';
  if(isElite){btn.style.borderColor='var(--gold)';btn.style.color='var(--gold)';btn.style.boxShadow='0 0 8px rgba(255,215,0,0.3)';}
  else btn.classList.toggle('active');
  btn.textContent='❤️ '+p.likes;
  // WS broadcast
  if(ws&&ws.readyState===1){ws.send(JSON.stringify({type:'like',postId:id,likes:p.likes,userId:currentUser?.email,userPlan:currentUser?.plan}));}
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('wallpaper-modal');
}
function _patchWS(){
  if(ws){
    const origOnMessage=ws.onmessage;
    ws.onmessage=(e)=>{
      if(origOnMessage)origOnMessage(e);
      try{
        const data=JSON.parse(e.data);
        if(data.type==='like'){
          const btn=document.querySelector(`[data-post-id="${data.postId}"] .btn-like`);
          if(btn)btn.textContent='❤️ '+data.likes;
        }
      }catch(err){}
    };
  }
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('wallpaper-modal');
}

// ── WEBSOCKET — update for group messages ──

function escHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function getAvatarColor(id){const colors=['linear-gradient(135deg,#15803d,#4ade80)','linear-gradient(135deg,#166534,#22c55e)','linear-gradient(135deg,#14532d,#86efac)','linear-gradient(135deg,#065f46,#34d399)'];return colors[(id||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0)%colors.length];}
function getTypeEmoji(t){return{site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️'}[t]||'🚀';}
function typeName(t){return{site:'Site web',app:'Application',saas:'SaaS',tiktok:'TikTok',instagram:'Instagram',ecommerce:'E-commerce'}[t]||t;}

// ── MODALS ──
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function switchModal(a,b){closeModal(a);setTimeout(()=>openModal(b),200);}
document.querySelectorAll('.modal-bg').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

// ── STRIPE ──
try{stripe=Stripe('pk_test_VOTRE_CLE_STRIPE_ICI');}catch(e){}

// ── INIT ──
window.addEventListener('load',()=>{
  renderPlans();
  buildVitrineGrid('landing-vitrine-grid');
  buildPublicFeed();
  const saved=localStorage.getItem('viralboost_user');
  if(saved){
    currentUser=JSON.parse(saved);
    showApp();
  }
});

</script>
<!-- ── POPUP OFFRE 100 PREMIERS — s'affiche après 10 secondes ── -->
<div id="offer-popup" class="hidden">
  <div id="offer-box-wrap">
    <!-- Contenu par défaut visible instantanément -->
    <div class="offer-box">
      <button class="offer-close-btn" onclick="closeOffer()">✕</button>
      <div class="offer-crown">🎁</div>
      <div class="offer-title">OFFRE LANCEMENT</div>
      <div class="offer-sub">Limité aux 100 premiers inscrits uniquement</div>
      <div class="offer-badge">💎 PLAN PRO — 1 AN 100% GRATUIT</div>
      <div class="offer-desc">
        Valeur réelle : <strong>179,88€</strong><br>
        ✅ 999 publications/jour<br>
        ✅ Coach IA illimité<br>
        ✅ Vitrine 30 jours<br>
        ✅ Chat illimité
      </div>
      <div class="offer-timer">⏰ Offre expire dans : <span id="offer-countdown">--:--:--</span></div>
      <div class="offer-counter">
        <div class="offer-counter-num" id="offer-remaining">—</div>
        <div class="offer-counter-lbl">places restantes sur 100</div>
      </div>
      <button class="offer-cta" onclick="claimOffer()">🚀 CRÉER MON COMPTE GRATUIT</button>
      <div class="offer-skip" onclick="closeOffer()">Non merci, je préfère payer</div>
    </div>
  </div>
</div>

<script>

// ══════════════════════════════════════════════
// ── NOUVELLES FONCTIONNALITÉS ViralBoost v2 ──
// ══════════════════════════════════════════════

// ── ONBOARDING TOOLTIP (mini aide à l'arrivée) ──
const OB_STEPS = [
  {icon:'&#128226;', label:'PUBLIE TON PROJET', desc:"Clique sur Publier et remplis ta fiche en 2 min."},
  {icon:'&#128479;', label:'VOTE & EXPLORE', desc:"Vote pour les projets qui te plaisent. Tu gagnes des crédits."},
  {icon:'&#129302;', label:'IA BOOST', desc:'Génère une stratégie TikTok, SEO ou Email en 10 secondes.'},
  {icon:'&#129309;', label:'TROUVE DES COLLABS', desc:"Le matching IA connecte les créateurs par niche et objectifs."},
  {icon:'&#9889;', label:'GAGNE DES CRÉDITS', desc:"Publie, vote, complète des missions. Tes crédits débloquent des boosts."},
];
let _obStep = 0;
let _obTooltip = null;

function checkOnboarding(){
  if(!currentUser) return;
  // If profile onboarding not done yet, wait for it to finish first
  if(!currentUser.onboarded){
    // Will be triggered by finishOnboarding() or skipOnboarding()
    return;
  }
  if(localStorage.getItem('vb_onboarded_'+currentUser.email)) return;
  setTimeout(showOnboardingTooltip, 800);
}

function showOnboardingTooltip(){
  if(document.getElementById('ob-tooltip')) return;
  _obStep = 0;
  const el = document.createElement('div');
  el.id = 'ob-tooltip';
  el.className = 'ob-tooltip';
  el.innerHTML = buildTooltipHTML();
  document.body.appendChild(el);
  _obTooltip = el;
}

function buildTooltipHTML(){
  const s = OB_STEPS[_obStep];
  const isLast = _obStep === OB_STEPS.length - 1;
  return `<div class="ob-tooltip-inner">
    <div class="ob-tooltip-header">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;color:var(--g3)">✦ COMMENT ÇA MARCHE ?</div>
      <button class="ob-tooltip-close" onclick="closeOnboardingTooltip()">✕</button>
    </div>
    <div class="ob-steps-row" id="ob-steps-row">
      ${OB_STEPS.map((step, i) => `
        <div class="ob-step-card ${i === _obStep ? 'active' : ''}" onclick="goObStep(${i})">
          <div class="ob-step-icon">${step.icon}</div>
          <div class="ob-step-label">${step.label}</div>
          <div class="ob-step-desc">${i === _obStep ? step.desc : ''}</div>
        </div>`).join('')}
    </div>
    <div class="ob-tooltip-footer">
      <div class="ob-progress">
        ${OB_STEPS.map((_, i) => `<div class="ob-dot ${i === _obStep ? 'active' : ''}"></div>`).join('')}
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <span onclick="closeOnboardingTooltip()" style="font-size:11px;color:var(--muted2);cursor:pointer;text-decoration:underline">Passer</span>
        <button class="ob-btn-next" onclick="${isLast ? 'closeOnboardingTooltip()' : 'obNext()'}">${isLast ? 'C\'est parti 🚀' : 'Suivant →'}</button>
      </div>
    </div>
  </div>`;
}

function goObStep(i){
  _obStep = i;
  if(_obTooltip) _obTooltip.innerHTML = buildTooltipHTML();
}
function obNext(){
  if(_obStep < OB_STEPS.length - 1){ _obStep++; if(_obTooltip) _obTooltip.innerHTML = buildTooltipHTML(); }
  else closeOnboardingTooltip();
}
function closeOnboardingTooltip(){
  const el = document.getElementById('ob-tooltip');
  if(!el) return;
  el.classList.add('hiding');
  setTimeout(() => el.remove(), 350);
  if(currentUser) localStorage.setItem('vb_onboarded_'+currentUser.email, '1');
}

// Garde l'ancienne fonction showOnboarding comme alias
function showOnboarding(){ showOnboardingTooltip(); }

// openOnboarding = ouvre le modal de profil pour que le nouvel inscrit le complète
function openOnboarding(){
  if(!currentUser) return;
  openEditProfile();
  // Ajoute un message de bienvenue en haut du modal
  setTimeout(() => {
    const modal = document.querySelector('#edit-profile-modal .modal');
    if(!modal || modal.querySelector('#ob-welcome-msg')) return;
    const msg = document.createElement('div');
    msg.id = 'ob-welcome-msg';
    msg.style.cssText = 'background:linear-gradient(135deg,rgba(34,197,94,0.1),rgba(74,222,128,0.05));border:1.5px solid rgba(34,197,94,0.3);border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px;';
    msg.innerHTML = '<span style="font-size:28px">🎉</span><div><div style="font-family:\'Bebas Neue\',sans-serif;font-size:18px;letter-spacing:1.5px;color:var(--g3)">BIENVENUE SUR VIRALBOOST !</div><div style="font-size:12px;color:var(--muted);margin-top:2px;">Complète ton profil pour maximiser ta visibilité auprès de la communauté.</div></div>';
    const h2 = modal.querySelector('h2');
    if(h2) h2.parentNode.insertBefore(msg, h2);
  }, 200);
}

// ══════════════════════════════════════════════
// ── WIZARD CRÉATION DE PROFIL — 5 ÉTAPES ──
// ══════════════════════════════════════════════

let _wizStep = 1;
const _WIZ_TOTAL = 5;

function openOnboarding(){
  if(!currentUser) return;
  _wizStep = 1;
  // Inject wizard HTML if not present
  if(!document.getElementById('profile-wizard-overlay')){
    document.body.insertAdjacentHTML('beforeend', buildProfileWizardHTML());
  }
  document.getElementById('profile-wizard-overlay').style.display = 'flex';
  renderWizStep(1);
}

function buildProfileWizardHTML(){
  return `
  <div id="profile-wizard-overlay" style="display:none;position:fixed;inset:0;background:rgba(4,10,5,0.97);backdrop-filter:blur(20px);z-index:10000;align-items:center;justify-content:center;padding:16px;overflow-y:auto;">
    <div id="profile-wizard-box" style="background:var(--s1);border:2px solid rgba(34,197,94,0.4);border-radius:20px;max-width:560px;width:100%;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);max-height:92vh;overflow-y:auto;">
      
      <!-- Top bar verte -->
      <div style="position:sticky;top:0;z-index:10;background:var(--s1);border-bottom:1px solid var(--border2);padding:18px 24px 14px;border-radius:20px 20px 0 0;">
        <!-- Logo + step -->
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:3px;color:var(--g3)">⚡ VIRALBOOST</div>
          <div id="wiz-step-counter" style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:1px;"></div>
        </div>
        <!-- Stepper visuel -->
        <div style="display:flex;align-items:center;gap:0;">
          ${[1,2,3,4,5].map(i => `
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
              <div id="wiz-dot-${i}" style="width:30px;height:30px;border-radius:50%;border:2px solid var(--border2);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;font-family:'DM Mono',monospace;color:var(--muted);transition:all 0.3s;">${i}</div>
              <div id="wiz-dot-lbl-${i}" style="font-size:8px;font-family:'DM Mono',monospace;color:var(--muted);letter-spacing:0.5px;text-align:center;text-transform:uppercase;">${['IDENTITÉ','ACTIVITÉ','RÉSEAUX','CHIFFRES','AVATAR'][i-1]}</div>
            </div>
            ${i < 5 ? `<div id="wiz-conn-${i}" style="flex:1;height:2px;background:var(--border2);margin-bottom:14px;transition:background 0.4s;"></div>` : ''}
          `).join('')}
        </div>
        <!-- Barre de progression -->
        <div style="height:3px;background:var(--s3);border-radius:2px;margin-top:12px;overflow:hidden;">
          <div id="wiz-prog-bar" style="height:100%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:2px;transition:width 0.5s cubic-bezier(0.4,0,0.2,1);width:20%;"></div>
        </div>
      </div>

      <!-- Contenu dynamique -->
      <div id="profile-wizard-content" style="padding:24px 28px 28px;"></div>
    </div>
  </div>`;
}

function renderWizStep(step){
  _wizStep = step;
  // Update stepper dots
  [1,2,3,4,5].forEach(i => {
    const dot = document.getElementById('wiz-dot-'+i);
    const lbl = document.getElementById('wiz-dot-lbl-'+i);
    const conn = document.getElementById('wiz-conn-'+i);
    if(!dot) return;
    if(i < step){ dot.style.cssText = 'width:30px;height:30px;border-radius:50%;border:2px solid var(--g2);background:rgba(22,163,74,0.15);display:flex;align-items:center;justify-content:center;font-size:13px;font-family:DM Mono,monospace;color:var(--g3);transition:all 0.3s;'; dot.textContent = '✓'; }
    else if(i === step){ dot.style.cssText = 'width:30px;height:30px;border-radius:50%;border:2px solid var(--g3);background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;font-family:DM Mono,monospace;color:var(--bg);box-shadow:0 0 16px rgba(34,197,94,0.4);transition:all 0.3s;'; dot.textContent = i; }
    else { dot.style.cssText = 'width:30px;height:30px;border-radius:50%;border:2px solid var(--border2);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;font-family:DM Mono,monospace;color:var(--muted);transition:all 0.3s;'; dot.textContent = i; }
    if(conn) conn.style.background = i < step ? 'linear-gradient(90deg,var(--g2),var(--g3))' : 'var(--border2)';
    if(lbl) lbl.style.color = i <= step ? 'var(--g4)' : 'var(--muted)';
  });
  const counter = document.getElementById('wiz-step-counter');
  if(counter) counter.textContent = 'ÉTAPE ' + step + ' / ' + _WIZ_TOTAL;
  const bar = document.getElementById('wiz-prog-bar');
  if(bar) bar.style.width = (step / _WIZ_TOTAL * 100) + '%';

  const content = document.getElementById('profile-wizard-content');
  if(!content) return;
  content.style.opacity = '0';
  content.style.transform = 'translateY(12px)';
  setTimeout(() => {
    content.innerHTML = getWizStepHTML(step);
    content.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    content.style.opacity = '1';
    content.style.transform = 'translateY(0)';
    // Pre-fill saved values
    prefillWizStep(step);
  }, 120);
  // Scroll top
  const box = document.getElementById('profile-wizard-box');
  if(box) box.scrollTop = 0;
}

function getWizStepHTML(step){
  const inp = (id, placeholder, type='text', extra='') => `
    <input type="${type}" id="${id}" placeholder="${placeholder}" ${extra}
      style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;transition:border-color 0.2s;"
      onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'"/>`;

  const sel = (id, options) => `
    <select id="${id}" style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;"
      onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'">
      ${options.map(o => typeof o === 'string' ? `<option style="background:var(--s1)">${o}</option>` : `<option value="${o.v}" style="background:var(--s1)">${o.l}</option>`).join('')}
    </select>`;

  const field = (label, content, hint='') => `
    <div style="margin-bottom:16px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:6px;letter-spacing:1.5px;text-transform:uppercase;">${label}</label>
      ${content}
      ${hint ? `<div style="font-size:11px;color:var(--muted);margin-top:5px;line-height:1.5;">${hint}</div>` : ''}
    </div>`;

  const navBtns = (step) => `
    <div style="display:flex;gap:12px;margin-top:28px;">
      ${step > 1 ? `<button onclick="wizBack()" style="flex:1;padding:13px;background:transparent;border:1.5px solid var(--border);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--muted);cursor:pointer;" onmouseover="this.style.borderColor='var(--g3)';this.style.color='var(--g3)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--muted)'">← Retour</button>` : ''}
      <button onclick="wizNext()" style="flex:3;padding:14px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:var(--bg);cursor:pointer;box-shadow:0 0 20px rgba(34,197,94,0.3);transition:all 0.2s;" onmouseover="this.style.boxShadow='0 0 36px rgba(34,197,94,0.5)';this.style.transform='translateY(-1px)'" onmouseout="this.style.boxShadow='0 0 20px rgba(34,197,94,0.3)';this.style.transform=''">
        ${step < 5 ? 'Continuer →' : '✅ Terminer mon profil →'}
      </button>
    </div>
    <button onclick="skipWizard()" style="display:block;width:100%;text-align:center;background:none;border:none;font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;padding:6px;font-family:'Plus Jakarta Sans',sans-serif;">Passer cette étape</button>`;

  if(step === 1) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — PROFIL CRÉATEUR</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">TON IDENTITÉ<br><span style="color:var(--g3)">SUR VIRALBOOST</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Ces infos apparaîtront sur ta fiche publique. C'est la première chose que les autres membres verront de toi.</div>
    </div>
    ${field('Ton prénom ou nom de scène *', inp('wiz-name', 'Ex : Marie, SarahCreate, TechByAlex...'), 'Le nom affiché sur tes publications et ton profil.')}
    ${field('Ton pseudo unique *', inp('wiz-username', '@pseudo_sans_espaces'), 'Servira à t\'identifier dans la communauté. Ex : @marie_builder')}
    ${field('Ton titre ou métier', inp('wiz-title', 'Ex : Créatrice de contenu · Dev indie · Fondateur SaaS'), 'Résume ce que tu fais en une ligne percutante.')}
    ${field('Ta localisation', inp('wiz-location', 'Paris, France 🇫🇷 — ou "Remote"'), 'Aide les membres proches de toi à te trouver.')}
    ${field('Ta bio *', `<textarea id="wiz-bio" rows="4" placeholder="Raconte qui tu es, ce que tu crées, ce qui t'anime... Sois authentique ! Les profils avec une bio complète reçoivent 3x plus de visites." style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;resize:vertical;min-height:90px;" onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'"></textarea>`, 'Minimum 3 lignes recommandé. Parle de ton parcours, tes projets, tes passions.')}
    ${navBtns(1)}`;

  if(step === 2) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — MATCHING IA</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">TON ACTIVITÉ<br><span style="color:var(--g3)">& TES OBJECTIFS</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Ces infos permettent à l'IA de te connecter aux bons créateurs et de personnaliser ton expérience.</div>
    </div>
    ${field('Secteur / Niche principale *', inp('wiz-niche', 'Ex : Marketing digital, Fitness, Tech, Finance, Art...'), 'Décrit ton domaine d\'activité principal.')}
    ${field('Niveau d\'expérience', sel('wiz-exp', ['Débutant (0–1 an)','Intermédiaire (1–3 ans)','Confirmé (3–5 ans)','Expert (5+ ans)']))}
    ${field('Ton objectif principal *', inp('wiz-goal', 'Ex : Atteindre 100K abonnés, lancer mon SaaS, trouver des clients...'), 'Sois précis ! Cela aide le matching IA à te trouver les bonnes connexions.')}
    ${field('Compétences clés', inp('wiz-skills', 'Ex : Vidéo, Copywriting, SEO, Développement, Design, Vente...'), 'Sépare par des virgules. Ces tags apparaissent sur ta fiche.')}
    ${field('Outils & logiciels utilisés', inp('wiz-tools', 'Ex : CapCut, Canva, Notion, Figma, VSCode, Shopify...'), 'Aide les membres à comprendre ton environnement de travail.')}
    ${field('Ce que tu recherches sur ViralBoost', sel('wiz-dispo', ['Ouvert aux collaborations','Disponible pour missions freelance','En recherche d\'investisseur','Cherche un associé / co-fondateur','Je recrute des talents','Simplement en réseau / veille']))}
    ${field('Ce que tu attends de la communauté', `<textarea id="wiz-looking" rows="3" placeholder="Ex : Je cherche des créateurs vidéo pour collaber sur TikTok, un dev pour mon SaaS, des clients pour mon service de coaching..." style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;resize:vertical;" onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'"></textarea>`, 'Plus tu es précis, mieux l\'IA peut te matcher.')}
    ${navBtns(2)}`;

  if(step === 3) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — PRÉSENCE DIGITALE</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">TES RÉSEAUX<br><span style="color:var(--g3)">& PRÉSENCE WEB</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Connecte tes plateformes pour que les membres puissent te suivre partout. Ces liens s'affichent sur ton profil public.</div>
    </div>
    <div style="background:rgba(34,197,94,0.05);border:1px solid var(--border2);border-radius:12px;padding:16px 18px;margin-bottom:20px;">
      <div style="font-size:12px;color:var(--g5);line-height:1.8;">💡 <strong style="color:var(--g3)">Astuce :</strong> Les profils avec au moins 2 réseaux connectés reçoivent en moyenne <strong style="color:var(--g3)">4x plus de demandes de collab</strong> que les profils vides.</div>
    </div>
    ${field('🌐 Site web / Portfolio', inp('wiz-website', 'https://monsite.fr', 'url'), 'Ton site vitrine, portfolio, landing page...')}
    ${field('🎵 TikTok', inp('wiz-tiktok', '@mon_compte_tiktok'), 'Ex : @marie_creates — sans le lien complet.')}
    ${field('📸 Instagram', inp('wiz-instagram', '@mon_compte_instagram'), 'Ton compte créateur ou business.')}
    ${field('🐦 Twitter / X', inp('wiz-twitter', '@mon_compte_twitter'), 'Pour te retrouver sur X.')}
    ${field('💼 LinkedIn', inp('wiz-linkedin', 'linkedin.com/in/ton-profil', 'url'), 'Profil professionnel complet.')}
    ${field('▶️ YouTube', inp('wiz-youtube', '@ma_chaine_youtube'), 'Ta chaîne ou handle YouTube.')}
    ${field('Autres langues parlées', inp('wiz-langs', 'Ex : Français, Anglais, Espagnol...'), 'Utile pour les collabs internationales.')}
    ${navBtns(3)}`;

  if(step === 4) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — CRÉDIBILITÉ</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">TES CHIFFRES<br><span style="color:var(--g3)">& RÉSULTATS</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Optionnel mais puissant. Les créateurs qui partagent leurs chiffres inspirent confiance et attirent des collabs plus qualifiées.</div>
    </div>
    <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:12px;padding:14px 18px;margin-bottom:22px;">
      <div style="font-size:12px;color:var(--g5);line-height:1.8;">🔒 <strong style="color:var(--gold)">Confidentialité :</strong> Tu contrôles ce que tu partages. Ces chiffres sont visibles sur ton profil public uniquement si tu les renseignes.</div>
    </div>
    ${field('Abonnés TikTok', inp('wiz-tiktok-count', 'Ex : 45 000'), 'Nombre total d\'abonnés sur TikTok.')}
    ${field('Abonnés Instagram', inp('wiz-ig-count', 'Ex : 12 500'), 'Abonnés sur ton compte Instagram.')}
    ${field('Projets lancés', inp('wiz-projects-count', 'Ex : 3'), 'Nombre de projets, produits ou services que tu as lancés.')}
    ${field('Ventes / Clients à ce jour', inp('wiz-sales', 'Ex : 150 clients, 50 ventes...'), 'Donne une idée de ta traction commerciale.')}
    ${field('Revenu mensuel approximatif', sel('wiz-revenue', [{v:'',l:'Je préfère ne pas préciser'},{v:'0-500',l:'0 – 500 €/mois'},{v:'500-2000',l:'500 – 2 000 €/mois'},{v:'2000-5000',l:'2 000 – 5 000 €/mois'},{v:'5000-10000',l:'5 000 – 10 000 €/mois'},{v:'10000+',l:'10 000 €+/mois'}]), 'Aide les partenaires potentiels à calibrer les collabs.')}
    ${field('Disponibilité actuelle', sel('wiz-dispo2', ['Très disponible — je cherche activement','Partiellement disponible','Peu disponible — sélectif sur les projets','Non disponible pour le moment']))}
    ${navBtns(4)}`;

  if(step === 5) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — DERNIÈRE ÉTAPE</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">TON AVATAR<br><span style="color:var(--g3)">& TON STYLE</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Choisis comment tu apparais visuellement dans la communauté. Un avatar reconnaissable augmente ta visibilité.</div>
    </div>
    <!-- Photo de profil -->
    <div style="margin-bottom:20px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:10px;letter-spacing:1.5px;text-transform:uppercase;">📸 PHOTO DE PROFIL (RECOMMANDÉ)</label>
      <div style="display:flex;align-items:center;gap:16px;">
        <div id="wiz-ava-preview" style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;border:3px solid rgba(34,197,94,0.4);position:relative;overflow:hidden;cursor:pointer;" onclick="document.getElementById('wiz-ava-file').click()">
          <span id="wiz-ava-emoji-display">🙂</span>
          <img id="wiz-ava-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%;" />
        </div>
        <div>
          <label style="display:inline-flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px solid var(--border);border-radius:8px;padding:9px 16px;font-size:12px;font-weight:600;color:var(--g3);transition:all 0.2s;" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border)'">
            📁 Uploader une photo
            <input type="file" id="wiz-ava-file" accept="image/*" style="display:none" onchange="handleWizAvatarUpload(this)"/>
          </label>
          <div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.5;">JPG, PNG, WebP · Max 5 Mo<br>Les profils avec photo reçoivent 5x plus d'interactions.</div>
        </div>
      </div>
    </div>
    <!-- Emoji avatar -->
    <div style="margin-bottom:20px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:10px;letter-spacing:1.5px;text-transform:uppercase;">😎 OU CHOISIS UN EMOJI</label>
      <div style="display:flex;flex-wrap:wrap;gap:8px;">
        ${['🙂','😎','🤩','😏','🧐','🚀','💡','🎯','🔥','⚡','🌍','🧠','💎','👑','🦁','🐉','🌟','🏆','🦊','🤖'].map(e => 
          `<div onclick="selectWizEmoji('${e}')" data-wiz-emoji="${e}" style="width:40px;height:40px;border-radius:10px;border:2px solid var(--border2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all 0.15s;background:var(--s2);" onmouseover="this.style.borderColor='var(--g3)';this.style.background='rgba(34,197,94,0.1)'" onmouseout="if(!this.classList.contains('wiz-emo-sel')){this.style.borderColor='var(--border2)';this.style.background='var(--s2)'}">${e}</div>`
        ).join('')}
      </div>
    </div>
    <!-- Couleur de profil -->
    <div style="margin-bottom:20px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:10px;letter-spacing:1.5px;text-transform:uppercase;">🎨 COULEUR D'ACCENT</label>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        ${[['#22c55e','Vert'],['#3b82f6','Bleu'],['#a855f7','Violet'],['#f97316','Orange'],['#ef4444','Rouge'],['#ffd700','Or'],['#06b6d4','Cyan'],['#ec4899','Rose']].map(([c,n]) =>
          `<div onclick="selectWizColor('${c}')" data-wiz-color="${c}" title="${n}" style="width:36px;height:36px;border-radius:8px;background:${c};cursor:pointer;border:3px solid transparent;transition:all 0.2s;opacity:0.8;" onmouseover="this.style.opacity='1';this.style.transform='scale(1.1)'" onmouseout="if(!this.classList.contains('wiz-col-sel')){this.style.opacity='0.8';this.style.transform=''}"></div>`
        ).join('')}
      </div>
    </div>
    ${navBtns(5)}`;

  return '';
}

function prefillWizStep(step){
  if(!currentUser) return;
  const set = (id, val) => { const el = document.getElementById(id); if(el && val) el.value = val; };
  if(step === 1){
    set('wiz-name', currentUser.name !== currentUser.email?.split('@')[0] ? currentUser.name : '');
    set('wiz-username', currentUser.username);
    set('wiz-title', currentUser.title);
    set('wiz-location', currentUser.location);
    set('wiz-bio', currentUser.bio);
  } else if(step === 2){
    set('wiz-niche', currentUser.niche);
    set('wiz-goal', currentUser.goal);
    set('wiz-skills', currentUser.skills);
    set('wiz-tools', currentUser.tools);
    set('wiz-looking', currentUser.looking);
  } else if(step === 3){
    set('wiz-website', currentUser.website);
    set('wiz-tiktok', currentUser.tiktok);
    set('wiz-instagram', currentUser.instagram);
    set('wiz-twitter', currentUser.twitter);
    set('wiz-linkedin', currentUser.linkedin);
    set('wiz-youtube', currentUser.youtube);
    set('wiz-langs', currentUser.langs);
  } else if(step === 4){
    set('wiz-tiktok-count', currentUser.tiktokCount);
    set('wiz-ig-count', currentUser.igCount);
    set('wiz-projects-count', currentUser.projectsCount);
    set('wiz-sales', currentUser.sales);
  } else if(step === 5){
    if(currentUser.avatar) {
      const disp = document.getElementById('wiz-ava-emoji-display');
      if(disp) disp.textContent = currentUser.avatar;
    }
    if(currentUser.avatarUrl){
      const img = document.getElementById('wiz-ava-img');
      const disp = document.getElementById('wiz-ava-emoji-display');
      if(img){ img.src = currentUser.avatarUrl; img.style.display = 'block'; }
      if(disp) disp.style.display = 'none';
    }
  }
}

function saveWizStep(step){
  if(!currentUser) return;
  if(step === 1){
    const name = document.getElementById('wiz-name')?.value.trim();
    const username = document.getElementById('wiz-username')?.value.trim().replace('@','');
    if(!name){ toast('⚠️ Ton prénom / nom de scène est obligatoire !'); return false; }
    Object.assign(currentUser, {
      name: name || currentUser.name,
      username: username || currentUser.username,
      title: document.getElementById('wiz-title')?.value.trim(),
      location: document.getElementById('wiz-location')?.value.trim(),
      bio: document.getElementById('wiz-bio')?.value.trim(),
    });
  } else if(step === 2){
    const niche = document.getElementById('wiz-niche')?.value.trim();
    const goal = document.getElementById('wiz-goal')?.value.trim();
    if(!niche){ toast('⚠️ Indique ton secteur / niche !'); return false; }
    const expEl = document.getElementById('wiz-exp');
    const dispoEl = document.getElementById('wiz-dispo');
    Object.assign(currentUser, {
      niche,
      exp: expEl?.options[expEl.selectedIndex]?.text,
      goal,
      skills: document.getElementById('wiz-skills')?.value.trim(),
      tools: document.getElementById('wiz-tools')?.value.trim(),
      dispo: dispoEl?.options[dispoEl.selectedIndex]?.text,
      looking: document.getElementById('wiz-looking')?.value.trim(),
    });
  } else if(step === 3){
    Object.assign(currentUser, {
      website: document.getElementById('wiz-website')?.value.trim(),
      tiktok: document.getElementById('wiz-tiktok')?.value.trim(),
      instagram: document.getElementById('wiz-instagram')?.value.trim(),
      twitter: document.getElementById('wiz-twitter')?.value.trim(),
      linkedin: document.getElementById('wiz-linkedin')?.value.trim(),
      youtube: document.getElementById('wiz-youtube')?.value.trim(),
      langs: document.getElementById('wiz-langs')?.value.trim(),
    });
  } else if(step === 4){
    const revEl = document.getElementById('wiz-revenue');
    const dispo2El = document.getElementById('wiz-dispo2');
    Object.assign(currentUser, {
      tiktokCount: document.getElementById('wiz-tiktok-count')?.value.trim(),
      igCount: document.getElementById('wiz-ig-count')?.value.trim(),
      projectsCount: document.getElementById('wiz-projects-count')?.value.trim(),
      sales: document.getElementById('wiz-sales')?.value.trim(),
      revenue: revEl?.options[revEl.selectedIndex]?.text,
      dispo: dispo2El?.options[dispo2El.selectedIndex]?.text || currentUser.dispo,
    });
  } else if(step === 5){
    // avatar saved via selectWizEmoji/handleWizAvatarUpload
  }
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  return true;
}

function wizNext(){
  if(!saveWizStep(_wizStep)) return;
  if(_wizStep < _WIZ_TOTAL){
    renderWizStep(_wizStep + 1);
  } else {
    finishProfileWizard();
  }
}
function wizBack(){
  if(_wizStep > 1) renderWizStep(_wizStep - 1);
}
function skipWizard(){
  if(_wizStep < _WIZ_TOTAL){
    renderWizStep(_wizStep + 1);
  } else {
    finishProfileWizard();
  }
}

function selectWizEmoji(emoji){
  document.querySelectorAll('[data-wiz-emoji]').forEach(el => {
    el.classList.remove('wiz-emo-sel');
    el.style.borderColor = 'var(--border2)';
    el.style.background = 'var(--s2)';
  });
  const el = document.querySelector('[data-wiz-emoji="'+emoji+'"]');
  if(el){ el.classList.add('wiz-emo-sel'); el.style.borderColor = 'var(--g3)'; el.style.background = 'rgba(34,197,94,0.15)'; }
  const disp = document.getElementById('wiz-ava-emoji-display');
  const img = document.getElementById('wiz-ava-img');
  if(disp){ disp.textContent = emoji; disp.style.display = ''; }
  if(img) img.style.display = 'none';
  if(currentUser) currentUser.avatar = emoji;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
}

function selectWizColor(color){
  document.querySelectorAll('[data-wiz-color]').forEach(el => {
    el.classList.remove('wiz-col-sel');
    el.style.borderColor = 'transparent';
    el.style.opacity = '0.8';
    el.style.transform = '';
  });
  const el = document.querySelector('[data-wiz-color="'+color+'"]');
  if(el){ el.classList.add('wiz-col-sel'); el.style.borderColor = '#fff'; el.style.opacity = '1'; el.style.transform = 'scale(1.15)'; }
  if(currentUser){ currentUser.accentColor = color; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
}

function handleWizAvatarUpload(input){
  const file = input.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const img = document.getElementById('wiz-ava-img');
    const disp = document.getElementById('wiz-ava-emoji-display');
    const preview = document.getElementById('wiz-ava-preview');
    if(img){ img.src = e.target.result; img.style.display = 'block'; }
    if(disp) disp.style.display = 'none';
    if(currentUser){ currentUser.avatarUrl = e.target.result; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
    toast('✅ Photo uploadée !');
  };
  reader.readAsDataURL(file);
}

function finishProfileWizard(){
  // Close wizard
  const overlay = document.getElementById('profile-wizard-overlay');
  if(overlay){ overlay.style.opacity = '0'; overlay.style.transition = 'opacity 0.4s'; setTimeout(() => overlay.style.display = 'none', 400); }
  // Mark as onboarded
  if(currentUser){ currentUser.onboarded = true; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
  updateAppBar();
  renderMyProfile();
  // Show app tour
  setTimeout(() => openAppTour(), 500);
}

// ══════════════════════════════════════════════
// ── VISITE GUIDÉE DE L'APP ──
// ══════════════════════════════════════════════

const APP_TOUR_SLIDES = [
  {
    icon: '📢',
    color: '#22c55e',
    title: 'LE FEED — TON MUR DE PUBS',
    subtitle: 'Explore les publications de la communauté',
    desc: 'Le Feed est le cœur de ViralBoost. Chaque membre peut y publier une pub, une annonce, un service ou un lancement. Tu peux <strong>liker, commenter, partager</strong> et contacter directement n\'importe quel créateur.',
    tips: ['🔥 Filtre par niche, type de pub ou popularité','⚡ Vote pour les publications qui te plaisent — gagne des crédits','💬 Commente et engage pour augmenter ta visibilité','📌 Sauvegarde les pubs qui t\'intéressent'],
    cta: 'Explorer le Feed'
  },
  {
    icon: '📤',
    color: '#4ade80',
    title: 'PUBLIER — DIFFUSE TON CONTENU',
    subtitle: 'Crée ta pub en 30 secondes',
    desc: 'L\'onglet <strong>Publier</strong> te permet de créer une pub en plusieurs types : annonce, lancement de produit, offre de service, collab, promo, sondage... Chaque pub est visible instantanément par toute la communauté.',
    tips: ['🎯 Choisis le type de pub adapté à ton besoin','🖼️ Ajoute une image ou vidéo pour +70% d\'engagement','🏷️ Utilise des tags précis pour toucher la bonne audience','🚀 Les plans PRO & ELITE bénéficient d\'un boost de visibilité automatique'],
    cta: 'Créer ma première pub'
  },
  {
    icon: '🤝',
    color: '#a78bfa',
    title: 'MATCHING IA — TROUVE TES COLLABS',
    subtitle: 'L\'IA connecte les bons créateurs entre eux',
    desc: 'Notre algorithme de matching analyse ton profil, ta niche, tes objectifs et tes compétences pour te suggérer les collaborateurs les plus compatibles. Plus ton profil est complet, plus les suggestions sont précises.',
    tips: ['🧠 L\'IA analyse 12 critères de compatibilité','📊 Score de match affiché sur chaque profil','💌 Envoie un DM directement depuis le matching','🔄 Nouvelles suggestions chaque jour'],
    cta: 'Voir mes matches'
  },
  {
    icon: '💬',
    color: '#38bdf8',
    title: 'GROUPES & CHAT — LA COMMUNAUTÉ',
    subtitle: 'Rejoins des groupes par niche et intérêt',
    desc: 'Les <strong>Groupes</strong> sont des espaces thématiques où les créateurs d\'une même niche se retrouvent pour échanger, partager des ressources et monter des projets ensemble. Le <strong>Chat Mondial</strong> connecte toute la communauté en temps réel.',
    tips: ['🏛️ Rejoins des groupes par thème : SaaS, TikTok, E-commerce...','✨ Les membres ELITE peuvent créer leurs propres groupes','⚡ Chat mondial disponible 24h/24 en temps réel','📎 Partage images, liens et fichiers dans les groupes'],
    cta: 'Rejoindre un groupe'
  },
  {
    icon: '🚀',
    color: '#fbbf24',
    title: 'IA BOOST & CRÉDITS — ACCÉLÈRE TA CROISSANCE',
    subtitle: 'Des outils IA puissants à ta disposition',
    desc: 'Le module <strong>IA Boost</strong> génère en 10 secondes des stratégies personnalisées : plan TikTok viral, stratégie SEO, campagne email, pitch investisseur, plan de lancement... Utilise tes <strong>ViralCrédits</strong> pour débloquer des fonctions premium.',
    tips: ['⚡ 50 ViralCrédits offerts à l\'inscription','🎯 Génère stratégies TikTok, SEO, Email, YouTube...','💰 Gagne des crédits en publiant, votant, parrainant','💎 Les plans payants donnent des crédits bonus chaque mois'],
    cta: 'Essayer l\'IA Boost'
  },
];

let _tourSlide = 0;

function openAppTour(){
  _tourSlide = 0;
  if(!document.getElementById('app-tour-overlay')){
    document.body.insertAdjacentHTML('beforeend', `
      <div id="app-tour-overlay" style="position:fixed;inset:0;background:rgba(4,10,5,0.97);backdrop-filter:blur(20px);z-index:10001;display:flex;align-items:center;justify-content:center;padding:16px;">
        <div id="app-tour-box" style="background:var(--s1);border:2px solid rgba(34,197,94,0.35);border-radius:20px;max-width:560px;width:100%;overflow:hidden;"></div>
      </div>`);
  }
  document.getElementById('app-tour-overlay').style.display = 'flex';
  renderTourSlide(0);
}

function renderTourSlide(idx){
  _tourSlide = idx;
  const s = APP_TOUR_SLIDES[idx];
  const box = document.getElementById('app-tour-box');
  if(!box) return;
  box.style.borderColor = s.color + '55';

  const dots = APP_TOUR_SLIDES.map((_,i) => 
    `<div style="width:${i===idx?'22px':'8px'};height:8px;border-radius:4px;background:${i===idx?s.color:'var(--muted2)'};transition:all 0.3s;"></div>`
  ).join('');

  box.innerHTML = `
    <!-- Header coloré -->
    <div style="background:linear-gradient(135deg,${s.color}18,${s.color}08);border-bottom:1px solid ${s.color}22;padding:32px 32px 24px;text-align:center;">
      <div style="font-size:56px;margin-bottom:12px;filter:drop-shadow(0 0 16px ${s.color}60);">${s.icon}</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:#fff;margin-bottom:6px;">${s.title}</div>
      <div style="font-size:13px;color:${s.color};font-weight:600;">${s.subtitle}</div>
    </div>

    <!-- Contenu -->
    <div style="padding:24px 28px;">
      <p style="font-size:14px;color:#c4d9cb;line-height:1.8;margin-bottom:20px;">${s.desc}</p>

      <!-- Tips -->
      <div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 18px;margin-bottom:24px;">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:${s.color};letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;">CE QU'IL FAUT SAVOIR</div>
        ${s.tips.map(t => `<div style="font-size:13px;color:var(--g5);padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);line-height:1.5;">${t}</div>`).join('')}
      </div>

      <!-- Nav -->
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="display:flex;gap:6px;align-items:center;">${dots}</div>
        <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);">${idx+1} / ${APP_TOUR_SLIDES.length}</div>
      </div>
      <div style="display:flex;gap:10px;">
        ${idx > 0 ? `<button onclick="renderTourSlide(${idx-1})" style="flex:1;padding:12px;background:transparent;border:1.5px solid var(--border);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--muted);cursor:pointer;">← Précédent</button>` : ''}
        ${idx < APP_TOUR_SLIDES.length - 1 
          ? `<button onclick="renderTourSlide(${idx+1})" style="flex:3;padding:13px;background:linear-gradient(135deg,${s.color}90,${s.color});border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:#fff;cursor:pointer;box-shadow:0 0 24px ${s.color}40;">Suivant →</button>`
          : `<button onclick="closeAppTour()" style="flex:3;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:var(--bg);cursor:pointer;box-shadow:0 0 28px rgba(34,197,94,0.45);">🚀 Lancer ViralBoost !</button>`
        }
      </div>
      ${idx === APP_TOUR_SLIDES.length - 1 ? '' : `<button onclick="closeAppTour()" style="display:block;width:100%;text-align:center;background:none;border:none;font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;padding:6px;font-family:'Plus Jakarta Sans',sans-serif;">Passer le tutoriel</button>`}
    </div>`;
}

function closeAppTour(){
  const overlay = document.getElementById('app-tour-overlay');
  if(overlay){ overlay.style.opacity = '0'; overlay.style.transition = 'opacity 0.4s'; setTimeout(() => { overlay.style.display = 'none'; }, 400); }
  // Go to feed
  showAppTab('feed', null);
  setTimeout(() => toast('🎉 Bienvenue sur ViralBoost ! Explore le feed ou publie ta première pub.'), 600);
}
function updatePubCompletion(){
  const name = document.getElementById('pub-name')?.value.trim() || '';
  const desc = document.getElementById('pub-desc')?.value.trim() || '';
  const url  = document.getElementById('pub-url')?.value.trim() || '';
  const target = document.getElementById('pub-target')?.value.trim() || '';
  const tags = document.getElementById('pub-tags')?.value.trim() || '';
  const hasMedia = !!document.querySelector('#pub-media-preview img, #pub-media-preview video');

  const checks = {
    name: name.length >= 4,
    desc: desc.length >= 40,
    url: url.length > 5,
    target: target.length >= 3,
    tags: tags.length >= 2,
    media: hasMedia,
  };
  const done = Object.values(checks).filter(Boolean).length;
  const pct = Math.round((done / 6) * 100);

  const bar = document.getElementById('pub-completion-bar');
  const txt = document.getElementById('pub-completion-txt');
  if(bar){ bar.style.width = pct + '%'; bar.style.background = pct >= 80 ? 'linear-gradient(90deg,#16a34a,#4ade80)' : pct >= 50 ? 'linear-gradient(90deg,var(--g2),var(--g3))' : 'linear-gradient(90deg,var(--g1),var(--g2))'; }
  if(txt){ txt.textContent = pct + '%'; txt.style.color = pct >= 80 ? 'var(--g3)' : pct >= 50 ? 'var(--gold)' : 'var(--muted)'; }

  document.querySelectorAll('.pub-hint').forEach(el => {
    const hint = el.dataset.hint;
    el.classList.toggle('done', !!checks[hint]);
    el.classList.toggle('pending', !checks[hint]);
  });

  // Compteur nom
  const nc = document.getElementById('pub-name-count');
  if(nc) nc.textContent = name.length;
  // Label plan
  const pl = document.getElementById('pub-plan-label');
  if(pl && currentUser){ const lbl = {free:'FREE · 24h',starter:'STARTER · 7j',pro:'PRO · 30j',elite:'ELITE · Permanent'}; pl.textContent = '📋 ' + (lbl[currentUser.plan] || ''); }
}

function updateDescCount(){
  const d = document.getElementById('pub-desc')?.value || '';
  const c = document.getElementById('pub-desc-count');
  const q = document.getElementById('pub-desc-quality');
  if(c) c.textContent = d.length;
  if(q){
    if(d.length === 0) q.textContent = '';
    else if(d.length < 40) q.style.color = 'var(--muted)', q.textContent = '⚠️ Trop court';
    else if(d.length < 100) q.style.color = 'var(--gold)', q.textContent = '👍 Correct';
    else if(d.length < 200) q.style.color = 'var(--g3)', q.textContent = '✅ Bon';
    else q.style.color = 'var(--g4)', q.textContent = '🔥 Excellent';
  }
}

function renderTagsPreview(){
  const raw = document.getElementById('pub-tags')?.value || '';
  const container = document.getElementById('pub-tags-preview');
  if(!container) return;
  const tags = raw.split(',').map(t => t.trim()).filter(Boolean).slice(0, 5);
  container.innerHTML = tags.map(t => `<span class="pub-tag-chip">#${t}</span>`).join('');
  updatePubCompletion();
}

function insertDescTip(el){
  const tip = el.dataset.tip;
  const ta = document.getElementById('pub-desc');
  if(!ta) return;
  const cur = ta.value;
  const sep = cur.length > 0 && !cur.endsWith('\n') ? '\n' : '';
  ta.value = cur + sep + tip;
  ta.focus();
  updateDescCount();
  updatePubCompletion();
  updateMobilePreview();
  el.style.borderColor = 'var(--g3)';
  el.style.color = 'var(--g3)';
  setTimeout(() => { el.style.borderColor = ''; el.style.color = ''; }, 1000);
}

function updatePubTypeEmoji(){
  const type = document.getElementById('pub-type')?.value;
  const map = {saas:'🚀',site:'🌐',ecommerce:'🛍️',service:'💼',coaching:'🎓',tiktok:'🎵',instagram:'📸',newsletter:'📧',podcast:'🎙️',communaute:'👥'};
  const emojiInput = document.getElementById('pub-emoji');
  if(emojiInput && !emojiInput.value) emojiInput.value = map[type] || '🚀';
  updateMobilePreview();
}

// ── WIZARD NAVIGATION ──
let currentWizStep = 1;
const WIZ_TOTAL = 5;

function wizGoTo(step){
  // Valider avant d'avancer
  if(step > currentWizStep){
    for(let s = currentWizStep; s < step; s++){
      if(!wizValidate(s)) return;
    }
  }
  // Cacher panel actuel
  document.getElementById('wpanel-' + currentWizStep)?.classList.remove('active');
  // Mettre à jour dots
  for(let i=1; i<=WIZ_TOTAL; i++){
    const dot = document.getElementById('wdot-'+i);
    const circ = document.getElementById('wcirc-'+i);
    const conn = document.getElementById('wconn-'+i);
    if(!dot||!circ) continue;
    dot.className = 'wiz-step-dot' + (i===step?' active':i<step?' done':'');
    circ.className = 'wiz-step-circle' + (i===step?' active':i<step?' done':'');
    if(conn) conn.className = 'wiz-connector' + (i<step?' done':'');
  }
  // Afficher nouveau panel
  currentWizStep = step;
  document.getElementById('wpanel-' + step)?.classList.add('active');
  // Progress bar
  const pct = Math.round((step/WIZ_TOTAL)*100);
  const fill = document.getElementById('wiz-prog-fill');
  if(fill) fill.style.width = pct+'%';
  // Si step 5 : refresh aperçu
  if(step===5) wizRefreshPreview();
  // Scroll vers le haut du wizard
  document.getElementById('wiz-stepper')?.scrollIntoView({behavior:'smooth',block:'start'});
}

function wizNext(from){ if(wizValidate(from)) wizGoTo(from+1); }
function wizPrev(from){ wizGoTo(from-1); }

function wizValidate(step){
  if(step===1){
    const n = document.getElementById('pub-name')?.value.trim()||'';
    if(n.length < 3){ toast('Donne un nom à ton projet (3 caractères min)','error'); document.getElementById('pub-name')?.focus(); return false; }
  }
  if(step===2){
    const d = document.getElementById('pub-desc')?.value.trim()||'';
    if(d.length < 20){ toast('La description est trop courte (20 caractères min)','error'); document.getElementById('pub-desc')?.focus(); return false; }
  }
  return true;
}

function wizRefreshPreview(){
  const name = document.getElementById('pub-name')?.value||'';
  const desc = document.getElementById('pub-desc')?.value||'';
  const hook = document.getElementById('pub-hook')?.value||'';
  const emoji = document.getElementById('pub-emoji')?.value||'🚀';
  const tags = (document.getElementById('pub-tags')?.value||'').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const collab = document.getElementById('pub-collab-need')?.value||'';

  const pname = document.getElementById('wiz-prev-name');
  const pdesc = document.getElementById('wiz-prev-desc');
  const phook = document.getElementById('wiz-prev-hook');
  const pemoji = document.getElementById('wiz-prev-emoji');
  const ptags = document.getElementById('wiz-prev-tags');
  const pcollab = document.getElementById('wiz-prev-collab');
  const pauthor = document.getElementById('wiz-prev-author');
  const pimg = document.getElementById('wiz-prev-img');

  if(pname) pname.textContent = name||'Nom du projet';
  if(pdesc) pdesc.textContent = desc ? desc.slice(0,200)+(desc.length>200?'...':'') : 'Ta description apparaîtra ici...';
  if(phook){ phook.textContent=hook; phook.style.display=hook?'block':'none'; }
  if(pemoji) pemoji.textContent=emoji;
  if(ptags) ptags.innerHTML=tags.map(t=>`<span class="pub-tag-chip" style="font-size:10px;padding:2px 8px">#${t}</span>`).join('');
  const collabMap={dev:'🔍 Cherche dev',marketing:'🔍 Cherche marketeur',design:'🔍 Cherche designer',video:'🔍 Cherche créateur vidéo',investisseur:'🔍 Cherche investisseur',associe:'🔍 Cherche associé',client:'🔍 Premiers clients'};
  if(pcollab){ pcollab.textContent=collabMap[collab]||''; pcollab.style.display=collab?'block':'none'; }
  if(pauthor&&currentUser) pauthor.textContent=currentUser.name||'';
  // Image si uploadée
  if(pimg && pendingPubMediaUrl){ pimg.src=pendingPubMediaUrl; pimg.style.display='block'; const pe=document.getElementById('wiz-prev-emoji'); if(pe) pe.style.display='none'; }
  else if(pimg){ pimg.style.display='none'; const pe=document.getElementById('wiz-prev-emoji'); if(pe){ pe.style.display='block'; } }

  // Checklist complétion
  wizRefreshChecklist();
}

function wizRefreshChecklist(){
  const name = document.getElementById('pub-name')?.value.trim()||'';
  const desc = document.getElementById('pub-desc')?.value.trim()||'';
  const url = document.getElementById('pub-url')?.value.trim()||'';
  const target = document.getElementById('pub-target')?.value.trim()||'';
  const tags = document.getElementById('pub-tags')?.value.trim()||'';
  const hasMedia = !!pendingPubMediaUrl;
  const checks=[
    {key:'name',label:'📝 Nom',ok:name.length>=3},
    {key:'desc',label:'💬 Description',ok:desc.length>=50},
    {key:'hook',label:'✨ Accroche',ok:!!(document.getElementById('pub-hook')?.value.trim())},
    {key:'url',label:'🔗 Lien',ok:url.length>5},
    {key:'target',label:'🎯 Audience',ok:target.length>3},
    {key:'tags',label:'🏷️ Tags',ok:tags.length>1},
    {key:'media',label:'🖼️ Visuel',ok:hasMedia},
  ];
  const done=checks.filter(c=>c.ok).length;
  const pct=Math.round((done/checks.length)*100);
  const bar=document.getElementById('wiz-completion-bar');
  const pctEl=document.getElementById('wiz-completion-pct');
  const hints=document.getElementById('wiz-hints');
  if(bar) bar.style.width=pct+'%';
  if(pctEl){ pctEl.textContent=pct+'%'; pctEl.style.color=pct>=80?'var(--g3)':pct>=50?'var(--gold)':'var(--muted)'; }
  if(hints) hints.innerHTML=checks.map(c=>`<span style="font-size:10px;font-family:'DM Mono',monospace;padding:2px 8px;border-radius:3px;background:${c.ok?'rgba(34,197,94,0.12)':'rgba(0,0,0,0.2)'};border:1px solid ${c.ok?'rgba(34,197,94,0.25)':'var(--border2)'};color:${c.ok?'var(--g4)':'var(--muted)'}">${c.ok?'✓':''} ${c.label}</span>`).join('');
}

// ── GUIDE MODAL ──
function showPubGuide(){
  document.getElementById('pub-guide-overlay')?.classList.remove('hidden');
}
function closePubGuide(){
  document.getElementById('pub-guide-overlay')?.classList.add('hidden');
  localStorage.setItem('vb_pub_guide_seen','1');
}

// Surcharge updateMobilePreview pour mettre à jour aussi l'aperçu vitrine
const _origUpdateMobilePreview = typeof updateMobilePreview !== 'undefined' ? updateMobilePreview : null;
function updateMobilePreview(){
  const name = document.getElementById('pub-name')?.value || '';
  const desc = document.getElementById('pub-desc')?.value || '';
  const hook = document.getElementById('pub-hook')?.value || '';
  const emoji = document.getElementById('pub-emoji')?.value || '🚀';
  const tags = (document.getElementById('pub-tags')?.value || '').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const stage = document.getElementById('pub-stage')?.value || '';
  const collab = document.getElementById('pub-collab-need')?.value || '';

  // Mobile preview (anciens IDs maintenus pour compat)
  const mn = document.getElementById('mob-preview-name') || document.querySelector('#mobile-pub-preview .mob-title');
  const md = document.getElementById('mob-preview-desc') || document.querySelector('#mobile-pub-preview .mob-text');
  if(mn) mn.textContent = name || 'Nom du projet';
  if(md) md.textContent = desc ? desc.slice(0, 100) + (desc.length > 100 ? '...' : '') : 'Description de ta pub apparaîtra ici...';

  // Anciens IDs de prévisualisation (compat)
  const pn = document.getElementById('pub-preview-name');
  const pd = document.getElementById('pub-preview-desc');
  const pe = document.getElementById('pub-preview-emoji');
  const ph = document.getElementById('pub-preview-hook');
  const pt = document.getElementById('pub-preview-tags');
  const ps = document.getElementById('pub-preview-stage-badge');
  const pc = document.getElementById('pub-preview-collab-badge');
  const pa = document.getElementById('pub-preview-author');
  if(pn) pn.textContent = name || 'Nom du projet';
  if(pd) pd.textContent = desc ? desc.slice(0, 160) + (desc.length > 160 ? '...' : '') : 'Ta description apparaîtra ici...';
  if(pe) pe.textContent = emoji;
  if(ph){ ph.textContent = hook; ph.style.display = hook ? 'block' : 'none'; }
  if(pt){ pt.innerHTML = tags.map(t => `<span class="pub-tag-chip" style="font-size:10px;padding:2px 8px">#${t}</span>`).join(''); }
  const stageMap = {idee:'💭 Idée',beta:'🧪 Beta',lance:'🚀 Lancé',croissance:'📈 En croissance',monetise:'💰 Monétisé'};
  if(ps){ ps.textContent = stageMap[stage] || ''; ps.style.display = stage && stage !== 'lance' ? 'block' : 'none'; }
  if(pc){ const collabMap = {dev:'🔍 Cherche dev',marketing:'🔍 Cherche marketeur',design:'🔍 Cherche designer',video:'🔍 Cherche créateur vidéo',investisseur:'🔍 Cherche investisseur',associe:'🔍 Cherche associé',client:'🔍 Premiers clients'}; pc.textContent = collabMap[collab]||''; pc.style.display = collab ? 'block' : 'none'; }
  if(pa && currentUser) pa.textContent = currentUser.name || '';

  // Complétion
  updatePubCompletion();
}

// ── STATS / ANALYTICS — VRAIES DONNÉES ──
function loadStats(){
  if(!currentUser)return;

  // Mes vraies publications
  const myPosts=feedPosts.filter(p=>p.userId===currentUser.email||p.userId===currentUser.id);
  const myProjects=vitrineData.filter(p=>p.authorId===currentUser.email);

  // Vrais chiffres calculés depuis les données réelles
  const totalLikes=myPosts.reduce((s,p)=>s+(p.likes||0),0);
  const totalComments=myPosts.reduce((s,p)=>s+(p.comments||0),0);
  const totalVotes=myProjects.reduce((s,p)=>s+(p.votes||0),0);
  const totalFollowers=(currentUser.followers||[]).length;
  const totalFollowing=(currentUser.following||[]).length;

  // KPIs
  document.getElementById('stat-views').textContent=(totalLikes*12+totalComments*5+myPosts.length*30).toLocaleString('fr');
  document.getElementById('stat-clicks').textContent=(totalLikes*2+totalVotes).toLocaleString('fr');
  document.getElementById('stat-posts').textContent=myPosts.length+myProjects.length;
  document.getElementById('stat-followers').textContent=totalFollowers;

  // Tendances basées sur données réelles
  const hasActivity=myPosts.length>0||myProjects.length>0;
  document.getElementById('stat-views-trend').textContent=hasActivity?'↑ Actif':'— Publie pour voir tes stats';
  document.getElementById('stat-views-trend').className='stat-card-trend '+(hasActivity?'up':'');
  document.getElementById('stat-clicks-trend').textContent=totalLikes>0?'↑ '+totalLikes+' likes':'— 0 like';
  document.getElementById('stat-clicks-trend').className='stat-card-trend '+(totalLikes>0?'up':'');
  document.getElementById('stat-followers-trend').textContent=totalFollowers>0?'↑ '+totalFollowing+' abonnements':'— Suis des créateurs';
  document.getElementById('stat-followers-trend').className='stat-card-trend '+(totalFollowers>0?'up':'');

  // Graphique vues 7 jours — basé sur tes vraies pubs
  const chart=document.getElementById('views-chart');
  const labels=document.getElementById('views-chart-labels');
  const days=['L','M','M','J','V','S','D'];
  const today=new Date();
  // Calcule les vues par jour réelles en regardant les timestamps des posts
  const vals=days.map((_,i)=>{
    const d=new Date(today);d.setDate(today.getDate()-6+i);
    const dayStr=d.toDateString();
    const dayPosts=myPosts.filter(p=>{
      if(!p.createdAt&&!p.time)return false;
      const pd=p.createdAt?new Date(p.createdAt).toDateString():'';
      return pd===dayStr;
    });
    // Si pas de timestamps précis, distribue les likes existants
    return dayPosts.length>0?dayPosts.reduce((s,p)=>s+(p.likes||0)*12+15,0):0;
  });
  // Si aucune donnée avec timestamp, montre quand même les totaux de façon lisible
  const hasTimestamps=vals.some(v=>v>0);
  const displayVals=hasTimestamps?vals:[0,0,0,0,0,0,totalLikes*12+myPosts.length*30];
  const max=Math.max(...displayVals,1);
  if(chart){
    chart.innerHTML=displayVals.map((v,i)=>`<div class="mini-bar" style="height:${Math.max(4,Math.round(v/max*100))}%;${v===0?'opacity:0.2':''}" title="Jour ${days[i]} : ${v} vues estimées"></div>`).join('');
    labels.innerHTML=days.map(d=>`<span>${d}</span>`).join('');
  }

  // Top pubs RÉELLES de l'utilisateur
  const tp=document.getElementById('top-posts-list');
  if(tp){
    if(!myPosts.length&&!myProjects.length){
      tp.innerHTML='<div style="color:var(--muted);font-size:11px;padding:8px 0">Tu n\'as pas encore publié. <a onclick="showAppTab(\'publier\',null)" style="color:var(--g3);cursor:pointer">Publier maintenant →</a></div>';
    } else {
      const sorted=[...myPosts].sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,3);
      tp.innerHTML=sorted.map((p,i)=>`
        <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border2)">
          <div style="font-size:11px;color:var(--g5);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px">${i+1}. ${escHtml((p.text||'').substring(0,40))}</div>
          <div style="display:flex;gap:8px;font-family:'DM Mono',monospace;font-size:10px;flex-shrink:0">
            <span style="color:var(--g3)">❤️ ${p.likes||0}</span>
            <span style="color:var(--muted)">💬 ${p.comments||0}</span>
          </div>
        </div>`).join('');
    }
  }

  // Répartition par catégorie — MES projets réels
  const cc=document.getElementById('cat-chart');
  if(cc){
    const allMine=[...myPosts,...myProjects];
    if(!allMine.length){
      cc.innerHTML='<div style="color:var(--muted);font-size:11px;padding:8px 0">Aucune publication encore</div>';
    } else {
      const catCount={};
      allMine.forEach(p=>{
        const cat=p.projType||p.cat||p.type||'autre';
        catCount[cat]=(catCount[cat]||0)+1;
      });
      const total=allMine.length;
      const catEmojis={site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️',service:'💼',coaching:'🎓',autre:'📦'};
      cc.innerHTML=Object.entries(catCount).sort((a,b)=>b[1]-a[1]).map(([cat,count])=>{
        const pct=Math.round(count/total*100);
        return `<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
          <span style="font-size:11px;width:80px;flex-shrink:0">${catEmojis[cat]||'📦'} ${cat}</span>
          <div style="flex:1;height:8px;background:var(--s2);border-radius:4px">
            <div style="width:${pct}%;height:100%;background:var(--g2);border-radius:4px;transition:width 0.5s"></div>
          </div>
          <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);width:28px;text-align:right">${pct}%</span>
        </div>`;
      }).join('');
    }
  }

  // Résumé global en bas
  const summary=`
    <div style="background:rgba(34,197,94,0.05);border:1.5px solid rgba(34,197,94,0.12);border-radius:10px;padding:14px 18px;margin-top:14px;font-size:12px;color:var(--g5);line-height:1.8">
      📊 <strong style="color:var(--g3)">${myPosts.length}</strong> publication${myPosts.length>1?'s':''} ·
      <strong style="color:var(--g3)">${myProjects.length}</strong> projet${myProjects.length>1?'s':''} en vitrine ·
      <strong style="color:var(--g3)">${totalLikes}</strong> like${totalLikes>1?'s':''} reçus ·
      <strong style="color:var(--g3)">${totalVotes}</strong> vote${totalVotes>1?'s':''} ·
      <strong style="color:var(--g3)">${totalFollowers}</strong> abonné${totalFollowers>1?'s':''}
    </div>`;
  const statsPanel=document.getElementById('tab-stats');
  if(statsPanel){
    const existing=statsPanel.querySelector('.stats-summary');
    if(existing)existing.remove();
    const wrap=statsPanel.querySelector('[style*="max-width:960px"]');
    if(wrap){const div=document.createElement('div');div.className='stats-summary';div.innerHTML=summary;wrap.appendChild(div);}
  }
}

// ── BOOST CRÉDITS ──
let userCredits=parseInt(localStorage.getItem('vb_credits')||'0');
let selectedBoostOpt='top-feed';
let pendingShopItem=null, pendingShopCost=0;

// ── MISSIONS QUOTIDIENNES ──
const MISSIONS_DEF = [
  // ── QUOTIDIENNES ──
  { id:'pub1',      icon:'📝', title:'Publie aujourd\'hui',         desc:'Poste 1 publication',              max:1,  reward:8,  counter:u=>Math.min(u._todayPosts||0,1) },
  { id:'pub3',      icon:'🔥', title:'3 publications en un jour',   desc:'Poste 3 publications aujourd\'hui',max:3,  reward:20, counter:u=>Math.min(u._todayPosts||0,3) },
  { id:'pub5',      icon:'💥', title:'5 publications en un jour',   desc:'Poste 5 publications aujourd\'hui',max:5,  reward:35, counter:u=>Math.min(u._todayPosts||0,5) },
  { id:'like3',     icon:'❤️', title:'Like 3 posts',                desc:'Aime 3 publications',              max:3,  reward:6,  counter:u=>Math.min(u._todayLikes||0,3) },
  { id:'like10',    icon:'💗', title:'Like 10 posts',               desc:'Aime 10 publications',             max:10, reward:15, counter:u=>Math.min(u._todayLikes||0,10) },
  { id:'dm1',       icon:'💬', title:'Envoie un DM',                desc:'Contacte un créateur',             max:1,  reward:5,  counter:u=>Math.min(u._todayDMs||0,1) },
  { id:'dm3',       icon:'📨', title:'3 DMs envoyés',               desc:'Contacte 3 créateurs',             max:3,  reward:12, counter:u=>Math.min(u._todayDMs||0,3) },
  { id:'profil',    icon:'✍️', title:'Complète ton profil',         desc:'Ajoute bio + lien',                max:1,  reward:15, counter:u=>(u.bio&&u.bio.length>10&&(u.website||u.tiktok||u.instagram)?1:0) },
  { id:'vitrine1',  icon:'✨', title:'Publie en vitrine',           desc:'Ajoute un projet à la vitrine',    max:1,  reward:12, counter:u=>Math.min(u._todayProjects||0,1) },
  { id:'chat5',     icon:'🌐', title:'5 messages chat mondial',     desc:'Participe au chat communautaire',  max:5,  reward:10, counter:u=>Math.min(u._todayChat||0,5) },
  { id:'chat10',    icon:'💭', title:'10 messages chat mondial',    desc:'Contribue activement au chat',     max:10, reward:20, counter:u=>Math.min(u._todayChat||0,10) },
  { id:'connexion', icon:'🌅', title:'Connexion quotidienne',       desc:'Connecte-toi chaque jour',         max:1,  reward:5,  counter:u=>1 },
  { id:'vote3',     icon:'🗳️', title:'Vote pour 3 projets',         desc:'Vote pour des projets en vitrine', max:3,  reward:8,  counter:u=>Math.min(u._todayVotes||0,3) },
  { id:'share1',    icon:'📤', title:'Partage une publication',     desc:'Partage 1 pub de la communauté',   max:1,  reward:7,  counter:u=>Math.min(u._todayShares||0,1) },
  { id:'react5',    icon:'😍', title:'5 réactions sur des posts',   desc:'Utilise 5 réactions (🔥💡💸👏)',   max:5,  reward:10, counter:u=>Math.min(u._todayReacts||0,5) },
  { id:'react_all', icon:'🎭', title:'Utilise 4 types de réactions',desc:'Essaie feu, idée, cash et bravo',  max:4,  reward:18, counter:u=>Math.min(u._todayReactTypes||0,4) },
  { id:'follow1',   icon:'👥', title:'Suis un créateur',            desc:'Abonne-toi à 1 créateur',          max:1,  reward:5,  counter:u=>Math.min((u._todayFollows||0),1) },
  { id:'follow5',   icon:'🤝', title:'Suis 5 créateurs',            desc:'Abonne-toi à 5 créateurs',         max:5,  reward:15, counter:u=>Math.min((u._todayFollows||0),5) },
  { id:'comment2',  icon:'💡', title:'Commente 2 posts',            desc:'Laisse 2 commentaires',            max:2,  reward:8,  counter:u=>Math.min(u._todayComments||0,2) },
  { id:'iaboost1',  icon:'🤖', title:'Utilise IA Boost',            desc:'Génère une stratégie IA',          max:1,  reward:18, counter:u=>Math.min(u._todayIA||0,1) },
  { id:'collab1',   icon:'🔗', title:'Propose une collaboration',   desc:'Contacte quelqu\'un via Collabs',  max:1,  reward:20, counter:u=>Math.min(u._todayCollabs||0,1) },
  { id:'group1',    icon:'👾', title:'Rejoins un groupe',           desc:'Participe à 1 groupe thématique',  max:1,  reward:10, counter:u=>Math.min(u._todayGroups||0,1) },
  { id:'profil_img',icon:'🖼️', title:'Ajoute tes réseaux sociaux', desc:'Renseigne TikTok ou Instagram',    max:1,  reward:12, counter:u=>(u.tiktok||u.instagram?1:0) },
  { id:'streak3',   icon:'🌟', title:'Connexion 3 jours de suite',  desc:'Reviens chaque jour',              max:3,  reward:30, counter:u=>Math.min(u._loginStreak||0,3) },
  { id:'credits50', icon:'⚡', title:'Accumule 50 crédits',         desc:'Atteins 50 ViralCrédits',          max:50, reward:25, counter:u=>Math.min(userCredits||0,50) },
  { id:'pub_desc',  icon:'📋', title:'Pub avec description longue', desc:'Écris une pub de 100+ caractères', max:1,  reward:10, counter:u=>Math.min(u._todayLongPosts||0,1) },
  // ── NOUVELLES — IMAGES & MÉDIAS ──
  { id:'pub_img',   icon:'📸', title:'Publie avec une image',       desc:'Ajoute une photo à ta publication',max:1,  reward:14, counter:u=>Math.min(u._todayMediaPosts||0,1) },
  { id:'pub_img3',  icon:'🖼️', title:'3 pubs avec image',           desc:'Publie 3 fois avec une image',     max:3,  reward:28, counter:u=>Math.min(u._todayMediaPosts||0,3) },
  { id:'pub_video', icon:'🎬', title:'Publie une vidéo',            desc:'Partage une vidéo avec la communauté',max:1, reward:20, counter:u=>Math.min(u._todayVideoPosts||0,1) },
  { id:'pub_file',  icon:'📄', title:'Partage un fichier',          desc:'Ajoute un fichier PDF ou document', max:1, reward:12, counter:u=>Math.min(u._todayFilePosts||0,1) },
  { id:'vitrine_img',icon:'🌠',title:'Vitrine avec image',          desc:'Publie un projet avec un visuel',  max:1,  reward:20, counter:u=>Math.min(u._todayVisualProjects||0,1) },
  // ── NOUVELLES — ICÔNES AVATAR ──
  { id:'ava_emoji', icon:'🎭', title:'Change d\'avatar',            desc:'Mets à jour ton emoji ou photo',   max:1,  reward:8,  counter:u=>(u._changedAvatar?1:0) },
  { id:'ava_photo', icon:'📷', title:'Photo de profil',             desc:'Ajoute une vraie photo de profil', max:1,  reward:25, counter:u=>(u.avatarUrl?1:0) },
  // ── NOUVELLES — RÉACTIONS PREMIUM ──
  { id:'react_rocket',icon:'🚀',title:'Réaction Décollage',        desc:'Utilise la réaction 🚀 (Starter+)', max:3,  reward:15, counter:u=>Math.min(u._todayRocketReacts||0,3), premium:'starter' },
  { id:'react_crown', icon:'👑',title:'Réaction Royale',           desc:'Utilise la réaction 👑 (Pro+)',     max:3,  reward:20, counter:u=>Math.min(u._todayCrownReacts||0,3), premium:'pro' },
  { id:'react_gem',   icon:'💎',title:'Réaction Gem',              desc:'Utilise la réaction 💎 (Pro+)',     max:5,  reward:18, counter:u=>Math.min(u._todayGemReacts||0,5),   premium:'pro' },
  { id:'react_star',  icon:'🌟',title:'Réaction Star',             desc:'Utilise la réaction 🌟 (Elite)',   max:5,  reward:25, counter:u=>Math.min(u._todayStarReacts||0,5),  premium:'elite' },
];

function getMissionsState(){
  const today = new Date().toDateString();
  const raw = JSON.parse(localStorage.getItem('vb_missions_'+today)||'{}');
  return raw;
}
function saveMissionsState(state){
  const today = new Date().toDateString();
  localStorage.setItem('vb_missions_'+today, JSON.stringify(state));
}

function renderMissions(){
  const list = document.getElementById('missions-list');
  if(!list) return;
  const state = getMissionsState();
  const plan = currentUser?.plan||'free';
  const planOrder = {free:0,starter:1,pro:2,elite:3};
  const userLevel = planOrder[plan]||0;

  // Grouper par catégorie
  const categories = [
    {label:'📅 Quotidiennes', ids:['pub1','pub3','pub5','like3','like10','connexion','dm1','dm3','chat5','chat10','vote3','share1','comment2','follow1','follow5','iaboost1','collab1','group1']},
    {label:'🖼️ Images & Médias', ids:['pub_img','pub_img3','pub_video','pub_file','vitrine_img','pub_desc','vitrine1']},
    {label:'😎 Avatar & Profil', ids:['ava_emoji','ava_photo','profil','profil_img']},
    {label:'🎭 Réactions', ids:['react5','react_all','react_rocket','react_crown','react_gem','react_star']},
    {label:'⚡ Progression', ids:['streak3','credits50']},
  ];

  let html = '';
  categories.forEach(cat => {
    const missions = MISSIONS_DEF.filter(m => cat.ids.includes(m.id));
    if(!missions.length) return;
    html += `<div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;margin:16px 0 8px;text-transform:uppercase">${cat.label}</div>`;
    html += missions.map(m => {
      const prog = m.counter(currentUser||{});
      const done = state[m.id+'_claimed'];
      const canClaim = prog >= m.max && !done;
      const pct = Math.round((prog/m.max)*100);
      const reqLevel = m.premium ? planOrder[m.premium]||0 : 0;
      const locked = reqLevel > 0 && userLevel < reqLevel;
      const premiumBadge = m.premium ? `<span style="font-size:8px;font-family:'DM Mono',monospace;background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.15));border:1px solid rgba(255,215,0,0.4);border-radius:3px;padding:1px 6px;color:var(--gold);margin-left:6px">${m.premium.toUpperCase()}</span>` : '';
      return `<div class="mission-card ${done?'done':''} ${locked?'locked':''}">
        <div class="mission-icon" style="${locked?'filter:grayscale(1);opacity:0.5':''}">${m.icon}</div>
        <div class="mission-info">
          <div class="mission-title">${m.title}${premiumBadge}</div>
          <div class="mission-desc">${locked?`🔒 Requiert ${m.premium?.toUpperCase()} — Upgrade pour débloquer`:m.desc}</div>
          <div class="mission-prog-bar"><div class="mission-prog-fill" style="width:${locked?0:pct}%"></div></div>
          <div class="mission-prog-txt">${locked?'--':prog+'/'+m.max}</div>
        </div>
        <div class="mission-reward">
          <div class="mission-reward-val" style="${locked?'color:var(--muted)':''}">+${m.reward}</div>
          <div class="mission-reward-label">⚡ crédits</div>
          ${done
            ? '<div class="mission-done-tag">✅ Réclamé</div>'
            : locked
              ? `<button class="btn-claim" style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,140,0,0.08));border-color:rgba(255,215,0,0.3);color:var(--gold)" onclick="openModal('pricing-modal')">Upgrade →</button>`
              : `<button class="btn-claim" onclick="claimMission('${m.id}',${m.reward})" ${canClaim?'':'disabled'}>${canClaim?'Réclamer':'En cours'}</button>`
          }
        </div>
      </div>`;
    }).join('');
  });
  list.innerHTML = html;
}

function claimMission(id, reward){
  const m = MISSIONS_DEF.find(x=>x.id===id);
  if(!m) return;
  const prog = m.counter(currentUser||{});
  if(prog < m.max){ toast('Mission pas encore terminée !','error'); return; }
  const state = getMissionsState();
  if(state[id+'_claimed']){ toast('Déjà réclamé !','error'); return; }
  state[id+'_claimed'] = true;
  saveMissionsState(state);
  addCredits(reward);
  toast(`⚡ +${reward} crédits réclamés ! Mission accomplie 🎯`);
  renderMissions();
}

function updateMissionsCountdown(){
  const el = document.getElementById('missions-countdown');
  if(!el) return;
  const now = new Date();
  const midnight = new Date(now); midnight.setHours(24,0,0,0);
  const diff = midnight - now;
  const h = Math.floor(diff/3600000);
  const m = Math.floor((diff%3600000)/60000);
  const s = Math.floor((diff%60000)/1000);
  el.textContent = String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}
setInterval(updateMissionsCountdown, 1000);

// Incrémenter compteurs journaliers
function trackTodayAction(action){
  if(!currentUser) return;
  const key = '_today'+action;
  currentUser[key] = (currentUser[key]||0)+1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  renderMissions();
}

// ── BOUTIQUE ──
function switchCreditsTab(tab, btn){
  document.querySelectorAll('.credits-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.cpanel').forEach(p=>p.classList.remove('active'));
  const tabBtn = typeof btn === 'string' ? document.getElementById('ctab-'+tab) : btn;
  if(tabBtn) tabBtn.classList.add('active');
  const panel = document.getElementById('cpanel-'+tab);
  if(panel) panel.classList.add('active');
  if(tab==='missions') renderMissions();
  if(tab==='boost'||tab==='shop') loadBoostPostOptions();
  if(tab==='plans') updatePlansCreditsPanel();
}

function updatePlansCreditsPanel(){
  const el = document.getElementById('plans-credits-display');
  const planEl = document.getElementById('plans-current-plan');
  if(el) el.textContent = userCredits;
  if(planEl && currentUser) planEl.textContent = (currentUser.plan||'free').toUpperCase();
  // Update progress bars
  const costs = { starter:800, pro:3500, elite:9000 };
  ['starter','pro','elite'].forEach(planId=>{
    const cost = costs[planId];
    const pct = Math.min(100, Math.round((userCredits/cost)*100));
    const bar = document.getElementById(planId+'-progress-bar');
    const txt = document.getElementById(planId+'-progress-txt');
    if(bar) bar.style.width = pct+'%';
    if(txt){
      if(userCredits >= cost) txt.textContent = '✅ Tu peux acheter ce plan !';
      else txt.textContent = `${userCredits}/${cost}⚡ (${pct}% atteint — il te manque ${cost-userCredits}⚡)`;
      txt.style.color = userCredits >= cost ? 'var(--g3)' : 'var(--muted)';
    }
  });
}

let _shopBoostType=null, _shopBoostCost=0;
function shopBuy(item, cost){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const boostItems = ['top-feed','vitrine-24h','notif-push','boost-7j'];
  if(boostItems.includes(item)){
    if(userCredits < cost){ toast(`⚡ Il te faut ${cost} crédits. Tu en as ${userCredits}.`,'error'); return; }
    const wrap = document.getElementById('shop-boost-select-wrap');
    wrap.style.display = 'block';
    _shopBoostType = item; _shopBoostCost = cost;
    loadBoostPostOptions();
    wrap.scrollIntoView({behavior:'smooth',block:'nearest'});
    return;
  }
  if(userCredits < cost){ toast(`⚡ Il te faut ${cost} crédits. Tu en as ${userCredits}.`,'error'); return; }
  spendCredits(cost);
  const labels={
    'cadre-or':'🖼️ Cadre Doré activé sur ton profil !',
    'badge-feu':'🔥 Badge Feu ajouté à ton profil !',
    'emoji-pack':'🎭 Pack Emojis+ débloqué !',
    'titre-vip':'💎 Titre VIP ajouté sous ton nom !',
    'ia-analyse':'🔬 Analyse IA lancée — check l\'onglet IA Boost !',
    'ia-hashtags':'📌 30 hashtags viraux générés — check IA Boost !',
    'ia-strategie':'🗺️ Stratégie 30 jours générée — check IA Boost !'
  };
  toast(labels[item]||'✅ Achat effectué !');
  // Sauvegarde l'achat
  const bought = JSON.parse(localStorage.getItem('vb_shop_items')||'[]');
  bought.push({item, date:new Date().toISOString()});
  localStorage.setItem('vb_shop_items', JSON.stringify(bought));
}

function confirmShopBoost(){
  const sel = document.getElementById('boost-post-select');
  if(!sel||!sel.value){ toast('Choisis une publication !','error'); return; }
  if(userCredits < _shopBoostCost){ toast(`⚡ Crédits insuffisants.`,'error'); return; }
  spendCredits(_shopBoostCost);
  document.getElementById('shop-boost-select-wrap').style.display='none';
  const labels={'top-feed':'🔝 Publication mise en top du fil pendant 2h !','vitrine-24h':'✨ Publication épinglée en vitrine 24h !','notif-push':'🔔 Notification envoyée à la communauté !','boost-7j':'🏆 Boost 7 jours activé !'};
  toast(labels[_shopBoostType]||'🚀 Boost activé !');
}

function addCredits(n){
  userCredits += n;
  localStorage.setItem('vb_credits', userCredits);
  updateCreditsDisplay();
}
function spendCredits(n){
  userCredits = Math.max(0, userCredits - n);
  localStorage.setItem('vb_credits', userCredits);
  updateCreditsDisplay();
}

// ── ACHETER UN PLAN AVEC DES CRÉDITS ──
const PLAN_CREDIT_COSTS = { starter: 800, pro: 3500, elite: 9000 };
function buyPlanWithCredits(planId){
  if(!currentUser){ openModal('login-modal'); return; }
  const cost = PLAN_CREDIT_COSTS[planId];
  if(!cost){ toast('Plan introuvable.','error'); return; }
  const planName = planId.toUpperCase();
  if(currentUser.plan === planId){ toast(`Tu as déjà le plan ${planName} !`,'error'); return; }
  if(userCredits < cost){
    const missing = cost - userCredits;
    toast(`⚡ Il te manque ${missing} crédits pour le plan ${planName}. Continue tes missions !`,'error');
    return;
  }
  if(!confirm(`Acheter le plan ${planName} pour ${cost}⚡ ViralCrédits (1 mois) ?`)) return;
  spendCredits(cost);
  const prevPlan = currentUser.plan;
  currentUser.plan = planId;
  currentUser._planBoughtWithCredits = (currentUser._planBoughtWithCredits||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  updateAppBar();
  checkNewBadges();
  toast(`🎉 Plan ${planName} activé pour 1 mois ! -${cost}⚡`);
  // Sync API
  try{ fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)}).catch(()=>{}); }catch(e){}
  // Refresh credits display
  updateCreditsDisplay();
}

function updateCreditsDisplay(){
  const val = userCredits;
  document.querySelectorAll('#user-credits').forEach(el=>el.textContent=val);
  const hc = document.getElementById('header-credits');
  if(hc) hc.textContent = val;
  const bnc = document.getElementById('bn-credits-val');
  if(bnc) bnc.textContent = val;
}
function bottomNavGoCredits(btn){
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  showAppTab('boost-credits', document.querySelector('.app-tab[onclick*="boost-credits"]'));
  switchCreditsTab('shop', document.getElementById('ctab-shop'));
}
function selectBoostOpt(el,type){
  document.querySelectorAll('.boost-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostOpt=type;
}
function buyCredits(amount,price){
  toast(`💳 Redirection paiement ${price}€ pour ${amount} crédits...`);
  setTimeout(()=>{
    addCredits(amount);
    toast(`⚡ ${amount} ViralCredits ajoutés !`);
  },1200);
}
function openBuyCredits(){ switchCreditsTab('packs', document.getElementById('ctab-packs')); }
function applyBoost(){
  const sel=document.getElementById('boost-post-select2');
  const costs={'top-feed':10,'vitrine-24h':25,'notif-push':50,'boost-7j':80};
  const cost=costs[selectedBoostOpt]||10;
  if(userCredits<cost){toast('⚡ Crédits insuffisants. Achète un pack !','error');return;}
  if(!sel||!sel.value){toast('Choisis une publication à booster !','error');return;}
  spendCredits(cost);
  toast('🚀 Boost activé ! Ta publication est mise en avant.');
}
function loadBoostPostOptions(){
  ['boost-post-select','boost-post-select2'].forEach(id=>{
    const sel=document.getElementById(id);
    if(!sel||!feedPosts)return;
    const myPosts=feedPosts.filter(p=>p.userId===currentUser?.email||p.author===currentUser?.name);
    sel.innerHTML='<option value="">Choisir une publication...</option>'+myPosts.map(p=>`<option value="${p.id}">${(p.text||'').substring(0,50)}…</option>`).join('');
  });
}

// ── LEADERBOARD ──
function loadLeaderboard(type='pubs'){
  const list=document.getElementById('leaderboard-list');
  if(!list)return;
  let items=[];
  if(type==='pubs'){
    items=feedPosts.sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,10)
      .map((p,i)=>({rank:i+1,name:(p.text||'').substring(0,55),sub:p.author||'?',score:(p.likes||0)+' réactions',plan:p.plan||'free'}));
  }else if(type==='createurs'){
    // Uniquement les vrais utilisateurs depuis l'API — pas de données fictives
    items=[];
  }else{
    items=vitrineData.sort((a,b)=>b.votes-a.votes).slice(0,8)
      .map((p,i)=>({rank:i+1,name:p.name,sub:p.type,score:p.votes+' votes'}));
  }
  if(!items.length){
    list.innerHTML='<div style="text-align:center;padding:40px;color:var(--muted)">Le classement se remplira avec les vraies publications de la communauté 🚀</div>';
    return;
  }
  const medals=['🥇','🥈','🥉'];
  list.innerHTML=items.map(item=>`
    <div class="lb-item${item.rank<=3?' top'+item.rank:''}">
      <div class="lb-rank">${item.rank}</div>
      ${item.rank<=3?`<div class="lb-medal">${medals[item.rank-1]}</div>`:''}
      <div class="lb-info"><div class="lb-name">${escHtml(item.name)}</div><div class="lb-sub">${item.sub||''}</div></div>
      <div class="lb-score">${item.score}</div>
    </div>`).join('');
}
function switchLeaderboard(type,btn){
  document.querySelectorAll('#tab-leaderboard .feed-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  loadLeaderboard(type);
}

// ── COLLABS MATCHING IA ──
async function loadCollabs(){
  const list=document.getElementById('collab-list');
  if(!list||!currentUser)return;
  list.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)"><span class="dots"><span></span><span></span><span></span></span> Analyse en cours...</div>';
  await new Promise(r=>setTimeout(r,900));
  // Chercher les vrais utilisateurs depuis l'API
  let candidates=[];
  try{
    const r=await fetchWithTimeout('/api/admin/all-users');
    const users=await r.json();
    candidates=(users||[])
      .filter(u=>u.email!==currentUser.email)
      .map(u=>({
        name:u.name||u.email.split('@')[0],
        avatar:u.avatar||'🙂',
        niche:u.niche||'Créateur',
        goal:u.goal||'',
        skills:u.skills||'',
        id:u.email,
        plan:u.plan||'free'
      }))
      .slice(0,10);
  }catch(e){}
  if(!candidates.length){
    list.innerHTML=`<div style="text-align:center;padding:48px 24px;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">🤝</div>
      <div style="font-size:14px;font-weight:700;color:var(--g5);margin-bottom:8px">Pas encore de créateurs à matcher</div>
      <div style="font-size:12px;line-height:1.8">Le matching IA se base sur les vrais profils de la communauté.<br>Complète ton profil et reviens quand la communauté grandira !</div>
    </div>`;
    return;
  }
  list.innerHTML=candidates.map(c=>`
    <div class="collab-card">
      <div class="collab-header">
        <div class="collab-ava" style="background:linear-gradient(135deg,var(--g1),var(--g3))">${c.avatar}</div>
        <div style="flex:1">
          <div style="font-size:14px;font-weight:700;margin-bottom:2px">${escHtml(c.name)}</div>
          <div style="font-size:11px;color:var(--muted)">${escHtml(c.niche)}${c.skills?' · '+escHtml(c.skills):''}</div>
          <span class="chat-msg-plan-badge plan-${c.plan}" style="margin-top:4px;display:inline-block">${(c.plan||'FREE').toUpperCase()}</span>
        </div>
      </div>
      ${c.goal?`<div class="collab-why">Objectif : <em>${escHtml(c.goal)}</em></div>`:''}
      <div style="display:flex;gap:8px">
        <button class="btn-collab" onclick="openDMToUser('${c.id}','${escHtml(c.name)}')">💬 Contacter</button>
        <button onclick="this.textContent='✓ Ignoré';this.disabled=true" style="background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:7px 14px;font-size:12px;cursor:pointer;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif">Ignorer</button>
      </div>
    </div>`).join('');
}

// ── CALENDRIER ÉDITORIAL ──
let calYear=new Date().getFullYear(),calMonth=new Date().getMonth();
const calPosts={};
function buildCalendar(){
  const grid=document.getElementById('cal-grid');
  const label=document.getElementById('cal-month-label');
  if(!grid)return;
  const months=['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];
  label.textContent=months[calMonth]+' '+calYear;
  const first=new Date(calYear,calMonth,1);
  const last=new Date(calYear,calMonth+1,0).getDate();
  let startDay=first.getDay()||7; // 1=lun
  const today=new Date();
  let html='';
  for(let i=1;i<startDay;i++) html+='<div class="cal-day" style="opacity:0.2"></div>';
  for(let d=1;d<=last;d++){
    const key=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday=d===today.getDate()&&calMonth===today.getMonth()&&calYear===today.getFullYear();
    const posts=calPosts[key]||[];
    html+=`<div class="cal-day${posts.length?' has-post':''}${isToday?' today':''}" onclick="calDayClick('${key}')">
      <div class="cal-num">${d}</div>
      ${posts.map(()=>'<span class="cal-post-dot"></span>').join('')}
    </div>`;
  }
  grid.innerHTML=html;
  // Optimal slots
  const slots=document.getElementById('optimal-slots');
  if(slots){
    const times=['Lun 18h','Mar 12h','Mer 19h','Jeu 9h','Ven 17h','Sam 11h','Dim 20h'];
    slots.innerHTML=times.map(t=>`<span class="slot-chip" onclick="this.classList.toggle('selected')" title="Cliquer pour programmer">⏰ ${t}</span>`).join('');
  }
}
function calNav(dir){
  calMonth+=dir;
  if(calMonth>11){calMonth=0;calYear++;}
  if(calMonth<0){calMonth=11;calYear--;}
  buildCalendar();
}
function calDayClick(key){
  const text=prompt('Titre de la publication planifiée :');
  if(!text)return;
  if(!calPosts[key])calPosts[key]=[];
  calPosts[key].push(text);
  buildCalendar();
  toast('📅 Publication planifiée le '+key+' !');
}

// ── A/B TEST IA ──
async function runABTest(){
  const a=document.getElementById('ab-text-a').value.trim();
  const b=document.getElementById('ab-text-b').value.trim();
  const goal=document.getElementById('ab-goal').value;
  if(!a||!b){toast('Remplis les deux versions !','error');return;}
  const btn=document.getElementById('btn-ab');
  btn.disabled=true;btn.innerHTML='<span class="dots"><span></span><span></span><span></span></span> Analyse en cours...';
  document.getElementById('ab-result').style.display='none';
  try{
    const res=await fetch('/api/ia-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      type:'abtest',name:'A/B Test',description:`Analyse ces deux versions de pub pour l'objectif "${goal}".\n\nVERSION A:\n${a}\n\nVERSION B:\n${b}\n\nDonne : 1) quelle version est la meilleure et pourquoi, 2) score de conversion estimé pour chacune (sur 100), 3) 3 points forts et 1 point faible de chaque. Sois concis et direct.`
    })});
    const data=await res.json();
    const txt=data.strategy||data.result||'Analyse non disponible.';
    const winner=txt.toLowerCase().includes('version b')&&!txt.toLowerCase().includes('version a gagne')?'VERSION B GAGNE 🔵':'VERSION A GAGNE 🟢';
    document.getElementById('ab-winner-text').textContent=winner;
    document.getElementById('ab-analysis-text').textContent=txt;
    document.getElementById('ab-result').style.display='block';
  }catch(e){
    // Fallback offline
    const winner=a.length>b.length?'VERSION A':'VERSION B';
    document.getElementById('ab-winner-text').textContent=winner+' GAGNE';
    document.getElementById('ab-analysis-text').textContent=`Analyse hors-ligne :\n${winner} semble plus performante car elle est ${a.length>b.length?'plus détaillée':'plus concise et impactante'}.\n\nConseils généraux :\n• Commence toujours par le bénéfice client\n• Utilise des chiffres concrets\n• Termine par un appel à l'action clair\n• Évite le jargon technique`;
    document.getElementById('ab-result').style.display='block';
  }
  btn.disabled=false;btn.textContent='🔬 Analyser avec l\'IA';
}

// ── MOBILE PREVIEW — géré par updateMobilePreview() ci-dessus ──

// ── INIT NOUVELLES FEATURES au login ──
document.addEventListener('vb-user-logged-in', () => {
  updateCreditsDisplay();
  setTimeout(checkOnboarding, 800);
});

// Guide pub : ouverture via showAppTab() directement


const OFFER_LIMIT = 100;

async function checkAndShowOffer() {
  if (sessionStorage.getItem('vb_offer_closed')) return;
  if (localStorage.getItem('vb_offer_seen')) return;
  if (currentUser && (currentUser.plan === 'pro' || currentUser.plan === 'elite')) return;

  // Mettre à jour le compteur en temps réel
  try {
    const r = await fetchWithTimeout('/api/admin/all-users?key=viralboost-admin', {}, 3000);
    const users = r.ok ? await r.json() : [];
    const remaining = Math.max(0, OFFER_LIMIT - users.length);
    const el = document.getElementById('offer-remaining');
    if (el) el.textContent = remaining;

    if (remaining <= 0) {
      // Offre terminée — changer le contenu
      const wrap = document.getElementById('offer-box-wrap');
      wrap.innerHTML = `<div class="offer-full">
        <div style="font-size:40px;margin-bottom:10px">😔</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;color:#fbbf24;letter-spacing:2px">OFFRE TERMINÉE</div>
        <div style="font-size:13px;color:#4a7a58;margin-top:8px">Les 100 places gratuites ont été prises.<br>Découvre nos plans à partir de 3€/mois.</div>
        <button class="offer-cta" style="margin-top:18px;width:auto;padding:12px 28px" onclick="closeOffer()">Voir les plans →</button>
      </div>`;
    }
  } catch(e) {
    // API indisponible ou timeout — laisser le "—" ou mettre une valeur approx
    const el = document.getElementById('offer-remaining');
    if (el && el.textContent === '—') el.textContent = '< 100';
  }
}

// showOfferFallback supprimé — le popup est toujours visible par défaut

function claimOffer() {
  localStorage.setItem('vb_offer_seen', '1');
  localStorage.setItem('vb_offer_claimed', '1');
  localStorage.setItem('vb_offer_pending', '1');
  document.getElementById('offer-popup').classList.add('hidden');
  if (currentUser) {
    // Déjà connecté → upgrade direct
    currentUser.plan = 'pro';
    currentUser.offerClaimed = true;
    currentUser.offerExpiry = new Date(Date.now() + 365*24*60*60*1000).toISOString();
    localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
    fetch('/api/register-user', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(currentUser)}).catch(()=>{});
    toast('🎉 Plan PRO activé gratuitement pour 1 an !');
    updateAppBar();
  } else {
    // Ouvrir directement le formulaire d'inscription
    openModal('signup-modal');
  }
}

function closeOffer() {
  // Marquer comme refusé définitivement — ne plus jamais afficher
  localStorage.setItem('vb_offer_seen', '1');
  document.getElementById('offer-popup').classList.add('hidden');
}



// Activer le plan PRO offert lors de la création de compte — intégré dans createUser ci-dessus

// ── COUNTDOWN OFFRE — expire le 01/03/2026 à 10h00 ──
const OFFER_EXPIRY = new Date('2026-03-01T10:00:00');

function updateCountdown() {
  const el = document.getElementById('offer-countdown');
  if (!el) return;
  const diff = OFFER_EXPIRY - Date.now();
  if (diff <= 0) {
    el.textContent = 'EXPIRÉE';
    el.style.color = '#f87171';
    return;
  }
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  el.textContent = (d > 0 ? d + 'j ' : '') + String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}
setInterval(updateCountdown, 1000);


// ── BOTTOM NAV ──
// ── EXIT INTENT ──
let exitShown = false;
document.addEventListener('mouseleave', (e) => {
  if(e.clientY <= 0 && !exitShown && !currentUser && !localStorage.getItem('vb_exit_seen')){
    exitShown = true;
    document.getElementById('exit-overlay')?.classList.remove('hidden');
  }
});




// Sur mobile : exit après 40 secondes sans interaction
let mobileExitTimer = setTimeout(() => {
  if(!exitShown && !currentUser && !localStorage.getItem('vb_exit_seen') && window.innerWidth < 768){
    exitShown = true;
    document.getElementById('exit-overlay')?.classList.remove('hidden');
  }
}, 40000);

function closeExitPopup(){
  document.getElementById('exit-overlay')?.classList.add('hidden');
  localStorage.setItem('vb_exit_seen', '1');
}

// ── COMPTEUR MEMBRES DYNAMIQUE ──
async function loadMemberCount(){
  try{
    const r = await fetchWithTimeout('/api/admin/all-users?key=viralboost-admin', {}, 3000);
    const users = await r.json();
    if(Array.isArray(users) && users.length > 0){
      const count = users.length;
      const wrap = document.getElementById('hero-member-wrap');
      const countEl = document.getElementById('hero-member-count');
      if(countEl) countEl.textContent = count;
      if(wrap) wrap.style.display = 'inline';
    }
  }catch(e){}
}

function toggleMoreMenu(){
  const overlay=document.getElementById('bn-more-overlay');
  if(overlay) overlay.classList.toggle('hidden');
  const btn=document.getElementById('bn-more');
  if(btn) btn.classList.toggle('active');
}
function closeMoreMenu(){
  document.getElementById('bn-more-overlay')?.classList.add('hidden');
  document.getElementById('bn-more')?.classList.remove('active');
}
function moreNavGo(tab){
  closeMoreMenu();
  showAppTab(tab, null);
  // Désactiver tous les bn-items
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  document.getElementById('bn-more')?.classList.add('active');
}

function bottomNavGo(tab, btn){
  // Sync avec l'app tab existant
  const appTabBtn = document.querySelector(`.app-tab[onclick="showAppTab('${tab}',this)"]`);
  if(appTabBtn) appTabBtn.click();
  // Mettre à jour l'actif bottom nav
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active','bn-just-activated'));
  if(btn){
    btn.classList.add('active');
    // Pop animation
    btn.classList.add('bn-just-activated');
    setTimeout(()=>btn.classList.remove('bn-just-activated'), 350);
  }
}
function syncBottomNav(tab){
  const map={'feed':'bn-feed','vitrine':'bn-vitrine','publier':'bn-publish','chat-global':'bn-chat','profil':'bn-profil','boost-credits':'bn-credits'};
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  const id=map[tab];
  if(id) document.getElementById(id)?.classList.add('active');
  const chatDot=document.getElementById('chat-notif');
  const bnDot=document.getElementById('bn-chat-dot');
  if(bnDot && chatDot) bnDot.className='bn-dot'+(chatDot.style.display!=='none'?' show':'');
}

// ── MOBILE MENU ──

function toggleMobileMenu(){
  const menu=document.getElementById('mobile-menu');
  const btn=document.getElementById('hamburger-btn');
  const open=menu.classList.toggle('open');
  btn.classList.toggle('open',open);
  document.body.style.overflow=open?'hidden':'';
}
function closeMobileMenu(){
  document.getElementById('mobile-menu').classList.remove('open');
  document.getElementById('hamburger-btn').classList.remove('open');
  document.body.style.overflow='';
}
// Fermer le menu si on clique ailleurs
document.addEventListener('click',function(e){
  const menu=document.getElementById('mobile-menu');
  const btn=document.getElementById('hamburger-btn');
  if(menu&&menu.classList.contains('open')&&!menu.contains(e.target)&&!btn.contains(e.target)){
    closeMobileMenu();
  }
});

// Afficher le popup après scroll 60% (plus naturel) ou 15 secondes
window.addEventListener('load', () => {
  const popup = document.getElementById('offer-popup');
  const expired = Date.now() > OFFER_EXPIRY;
  if (!localStorage.getItem('vb_offer_seen') && !expired) {
    updateCountdown();
    let shown = false;
    // Déclencher au scroll 60%
    const onScroll = () => {
      const scrollPct = window.scrollY / (document.body.scrollHeight - window.innerHeight);
      if (scrollPct > 0.6 && !shown) {
        shown = true;
        popup.classList.remove('hidden');
        checkAndShowOffer();
        window.removeEventListener('scroll', onScroll);
      }
    };
    window.addEventListener('scroll', onScroll);
    // Fallback après 15 secondes si pas de scroll
    setTimeout(() => {
      if (!shown) {
        shown = true;
        popup.classList.remove('hidden');
        checkAndShowOffer();
        window.removeEventListener('scroll', onScroll);
      }
    }, 15000);
  }
});
</script>

<!-- ═══════════════════════════════════════════
     GUIDE MODAL — Première création de pub
═══════════════════════════════════════════ -->
<div class="guide-overlay hidden" id="pub-guide-overlay" onclick="if(event.target===this)closePubGuide()">
  <div class="guide-box">
    <button class="guide-box-close" onclick="closePubGuide()">✕</button>
    <div class="guide-title" style="font-size:22px;margin-bottom:4px">CRÉE TA PUB EN 5 ÉTAPES</div>
    <div class="guide-subtitle" style="font-size:12px;margin-bottom:14px">Suis le wizard — chaque étape est guidée.</div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px">
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">1</span>🚀 Identité — nom & catégorie</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">2</span>✍️ Description — ce que tu proposes</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">3</span>🎯 Audience & tags</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">4</span>🖼️ Visuel <strong style="color:var(--g3)">→ 3× plus de votes</strong></div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">5</span>👁️ Aperçu & publication</div>
    </div>
    <button class="btn-guide-start" style="padding:12px;font-size:13px" onclick="closePubGuide()">✨ C'est parti !</button>
  </div>
</div>

<!-- EXIT INTENT POPUP -->
<div class="exit-overlay hidden" id="exit-overlay">
  <div class="exit-box">
    <button class="exit-close" onclick="closeExitPopup()">✕</button>
    <div class="exit-emoji">⚡</div>
    <div class="exit-title">Attends ! Tu pars déjà ?</div>
    <div class="exit-sub">Rejoins la communauté de créateurs et entrepreneurs qui exposent leurs projets sur ViralBoost.</div>
    <div class="exit-perks">
      <span>🚀 Pub visible en 30 sec</span>
      <span>🤝 Matching IA gratuit</span>
      <span>💬 Communauté active</span>
    </div>
    <button class="btn-exit-cta" onclick="closeExitPopup();openModal('signup-modal')">✅ Créer mon compte gratuit →</button>
    <div class="exit-skip" onclick="closeExitPopup()">Non merci, je repars</div>
  </div>
</div>

<!-- MODAL PROJET -->
<div class="project-modal-overlay hidden" id="project-modal-overlay" onclick="if(event.target===this)closeProjectModal()">
  <div class="project-modal" id="project-modal-content">
    <!-- rempli dynamiquement -->
  </div>
</div>

<!-- BOTTOM NAV BAR (mobile) -->
<nav class="bottom-nav" id="bottom-nav" role="navigation" aria-label="Navigation principale">
  <button class="bn-item" id="bn-feed" onclick="bottomNavGo('feed',this)">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gf1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ff7043"/><stop offset="1" stop-color="#c62828"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gf1)"/>
        <path d="M8 20L20 10l12 10v10a1 1 0 01-1 1H9a1 1 0 01-1-1V20z" fill="rgba(255,255,255,0.9)"/>
        <rect x="16" y="23" width="8" height="8" rx="1.5" fill="#c62828"/>
      </svg>
    </span>
    <span data-i18n="bn_feed">Fil</span>
  </button>

  <button class="bn-item" id="bn-vitrine" onclick="bottomNavGo('vitrine',this)">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gv1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#b39ddb"/><stop offset="1" stop-color="#6a1b9a"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gv1)"/>
        <path d="M20 6l3.5 7 7.5 1.1-5.5 5.3 1.3 7.6L20 23.5l-6.8 3.5 1.3-7.6L9 12.1l7.5-1.1L20 6z" fill="rgba(255,255,255,0.95)"/>
        <circle cx="20" cy="16" r="3" fill="url(#gv1)"/>
      </svg>
    </span>
    <span data-i18n="bn_vitrine">Vitrine</span>
  </button>

  <button class="bn-item bn-publish" id="bn-publish" onclick="bottomNavGo('publier',this)" title="Publier">
    <span class="bn-icon">
      <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
        <line x1="16" y1="7" x2="16" y2="25" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
        <line x1="7" y1="16" x2="25" y2="16" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
      </svg>
    </span>
  </button>

  <button class="bn-item" id="bn-profil" onclick="bottomNavGo('profil',this)">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gp1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#4fc3f7"/><stop offset="1" stop-color="#0277bd"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gp1)"/>
        <circle cx="20" cy="15" r="7" fill="rgba(255,255,255,0.95)"/>
        <path d="M6 38c0-7.7 6.3-13 14-13s14 5.3 14 13" fill="rgba(255,255,255,0.9)"/>
      </svg>
    </span>
    <span data-i18n="bn_profil">Profil</span>
  </button>

  <button class="bn-item" id="bn-more" onclick="toggleMoreMenu()">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gm1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#78909c"/><stop offset="1" stop-color="#37474f"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gm1)"/>
        <rect x="9" y="12" width="22" height="3" rx="1.5" fill="rgba(255,255,255,0.9)"/>
        <rect x="9" y="18.5" width="22" height="3" rx="1.5" fill="rgba(255,255,255,0.9)"/>
        <rect x="9" y="25" width="22" height="3" rx="1.5" fill="rgba(255,255,255,0.9)"/>
      </svg>
    </span>
    <span>Plus</span>
  </button>
</nav>

<!-- MENU "PLUS" MOBILE -->
<div class="bn-more-overlay hidden" id="bn-more-overlay" onclick="if(event.target===this)closeMoreMenu()">
  <div class="bn-more-sheet" id="bn-more-sheet">
    <div class="bn-more-handle"></div>
    <div class="bn-more-title">Plus d'options</div>
    <div class="bn-more-grid">
      <button class="bn-more-item" onclick="moreNavGo('chat-global')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#4dd0e1"/><stop offset="1" stop-color="#00838f"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic1)"/><path d="M8 12h24v14a2 2 0 01-2 2H10a2 2 0 01-2-2V12z" fill="rgba(255,255,255,0.2)"/><rect x="8" y="10" width="24" height="16" rx="3" fill="rgba(255,255,255,0.9)"/><circle cx="14" cy="18" r="2" fill="#00838f"/><circle cx="20" cy="18" r="2" fill="#00838f"/><circle cx="26" cy="18" r="2" fill="#00838f"/><path d="M14 26l2 4h8l2-4" fill="rgba(255,255,255,0.9)"/></svg></span>
        <span>Chat</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('boost-credits')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic2" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffb74d"/><stop offset="1" stop-color="#e65100"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic2)"/><rect x="7" y="13" width="26" height="18" rx="3" fill="rgba(255,255,255,0.2)"/><rect x="7" y="11" width="26" height="16" rx="3" fill="rgba(255,255,255,0.9)"/><path d="M13 17h4v2h-4zm0 4h8v2h-8zm10-4h4v6h-4z" fill="#e65100"/><circle cx="28" cy="10" r="5" fill="#ffd54f"/><text x="25.5" y="13.5" font-size="7" fill="#e65100" font-weight="bold">$</text></svg></span>
        <span>Boutique</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('groupes')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic3" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ce93d8"/><stop offset="1" stop-color="#7b1fa2"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic3)"/><circle cx="14" cy="15" r="5" fill="rgba(255,255,255,0.9)"/><circle cx="26" cy="15" r="5" fill="rgba(255,255,255,0.7)"/><path d="M4 32c0-5.5 4.5-9 10-9s10 3.5 10 9" fill="rgba(255,255,255,0.9)"/><path d="M22 32c0-5.5 4.5-9 10-9" fill="rgba(255,255,255,0.6)"/></svg></span>
        <span>Groupes</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('stats')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic4" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#81c784"/><stop offset="1" stop-color="#1b5e20"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic4)"/><rect x="8" y="24" width="5" height="9" rx="1.5" fill="rgba(255,255,255,0.9)"/><rect x="15" y="18" width="5" height="15" rx="1.5" fill="rgba(255,255,255,0.9)"/><rect x="22" y="12" width="5" height="21" rx="1.5" fill="rgba(255,255,255,0.9)"/><rect x="29" y="20" width="5" height="13" rx="1.5" fill="rgba(255,255,255,0.7)"/></svg></span>
        <span>Stats</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('leaderboard')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic5" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffd54f"/><stop offset="1" stop-color="#f57f17"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic5)"/><path d="M20 6l3.5 7 7.5 1-5.5 5.3 1.3 7.7L20 23.5l-6.8 3.5 1.3-7.7L9 14l7.5-1L20 6z" fill="rgba(255,255,255,0.95)"/><circle cx="20" cy="17" r="3" fill="url(#ic5)"/></svg></span>
        <span>Top</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('collab')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic6" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffcc80"/><stop offset="1" stop-color="#e65100"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic6)"/><path d="M12 22c2.5-2 5-3 8-3s5.5 1 8 3" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/><circle cx="15" cy="15" r="4" fill="rgba(255,255,255,0.9)"/><circle cx="25" cy="15" r="4" fill="rgba(255,255,255,0.9)"/><path d="M17 28l3 4 3-4" fill="rgba(255,255,255,0.6)"/></svg></span>
        <span>Collabs</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('ia-boost')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic7" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#80deea"/><stop offset="1" stop-color="#006064"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic7)"/><rect x="10" y="10" width="20" height="20" rx="5" fill="rgba(255,255,255,0.15)"/><rect x="12" y="12" width="16" height="16" rx="4" fill="rgba(255,255,255,0.9)"/><circle cx="16" cy="18" r="2" fill="#006064"/><circle cx="24" cy="18" r="2" fill="#006064"/><path d="M14 23c1.5 2 10.5 2 12 0" stroke="#006064" stroke-width="1.5" stroke-linecap="round" fill="none"/><circle cx="20" cy="8" r="3" fill="#ffd54f"/><line x1="20" y1="11" x2="20" y2="13" stroke="#ffd54f" stroke-width="1.5"/></svg></span>
        <span>IA Boost</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('calendrier')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic8" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#90caf9"/><stop offset="1" stop-color="#1565c0"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic8)"/><rect x="7" y="12" width="26" height="22" rx="3" fill="rgba(255,255,255,0.9)"/><rect x="7" y="12" width="26" height="8" rx="3" fill="url(#ic8)"/><line x1="14" y1="9" x2="14" y2="15" stroke="white" stroke-width="2.5" stroke-linecap="round"/><line x1="26" y1="9" x2="26" y2="15" stroke="white" stroke-width="2.5" stroke-linecap="round"/><rect x="12" y="24" width="4" height="4" rx="1" fill="#1565c0"/><rect x="18" y="24" width="4" height="4" rx="1" fill="#1565c0"/><rect x="24" y="24" width="4" height="4" rx="1" fill="#90caf9"/></svg></span>
        <span>Agenda</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('ab-test')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic9" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#a5d6a7"/><stop offset="1" stop-color="#2e7d32"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic9)"/><rect x="7" y="10" width="11" height="20" rx="3" fill="rgba(255,255,255,0.9)"/><rect x="22" y="10" width="11" height="20" rx="3" fill="rgba(255,255,255,0.5)"/><text x="10" y="24" font-size="10" fill="#2e7d32" font-weight="bold">A</text><text x="25" y="24" font-size="10" fill="rgba(255,255,255,0.8)" font-weight="bold">B</text><path d="M18 20h4" stroke="rgba(255,255,255,0.8)" stroke-width="2" stroke-linecap="round"/></svg></span>
        <span>A/B Test</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('abonnes')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic10" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffe082"/><stop offset="1" stop-color="#ff6f00"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic10)"/><path d="M20 8c-4.4 0-7 2-7 5 0 1.5.8 3 2 4l-1 4h12l-1-4c1.2-1 2-2.5 2-4 0-3-2.6-5-7-5z" fill="rgba(255,255,255,0.95)"/><rect x="14" y="30" width="12" height="3" rx="1.5" fill="rgba(255,255,255,0.8)"/><circle cx="29" cy="10" r="5" fill="#ef5350"/><text x="26.5" y="13.5" font-size="8" fill="white" font-weight="bold">3</text></svg></span>
        <span>Abonnés</span>
      </button>
      <button class="bn-more-item bn-more-logout" onclick="closeMoreMenu();logout()">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic11" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ef9a9a"/><stop offset="1" stop-color="#b71c1c"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic11)"/><rect x="10" y="12" width="14" height="16" rx="2" fill="rgba(255,255,255,0.9)"/><path d="M22 20h10m-4-4l4 4-4 4" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span>
        <span>Quitter</span>
      </button>
    </div>
  </div>
</div>


<script>
// ── PWA SERVICE WORKER ──
if('serviceWorker' in navigator){
  window.addEventListener('load', () => {
    const swCode = `
      const CACHE = 'viralboost-v1';
      self.addEventListener('install', e => {
        e.waitUntil(caches.open(CACHE).then(c => c.addAll(['/'])));
      });
      self.addEventListener('fetch', e => {
        e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
      });
    `;
    const blob = new Blob([swCode], {type: 'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).catch(()=>{});
  });
}

// ── INSTALL PROMPT ──
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  showInstallBanner();
});

function showInstallBanner(){
  // Show navbar button too
  const navBtn = document.getElementById('pwa-install-btn');
  if(navBtn) navBtn.style.display = 'flex';
  if(document.getElementById('pwa-banner')) return;
  const banner = document.createElement('div');
  banner.id = 'pwa-banner';
  banner.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:9990;background:linear-gradient(135deg,#0b1a0d,#142e17);border:1.5px solid rgba(34,197,94,0.4);border-radius:16px;padding:14px 20px;display:flex;align-items:center;gap:14px;box-shadow:0 8px 40px rgba(0,0,0,0.5);min-width:320px;max-width:90vw;animation:slideUp 0.4s ease;';
  banner.innerHTML = `
    <div style="width:40px;height:40px;background:linear-gradient(135deg,#22c55e,#16a34a);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">⚡</div>
    <div style="flex:1">
      <div style="font-size:13px;font-weight:800;color:#f0fdf4;margin-bottom:2px">Installer ViralBoost</div>
      <div style="font-size:11px;color:#4a7a58">Accès rapide depuis ton bureau</div>
    </div>
    <button onclick="installPWA()" style="padding:8px 16px;background:#22c55e;border:none;border-radius:8px;font-family:Plus Jakarta Sans,sans-serif;font-size:12px;font-weight:800;color:#040a05;cursor:pointer;flex-shrink:0">Installer</button>
    <button onclick="dismissPWA()" style="background:none;border:none;color:#4a7a58;cursor:pointer;font-size:18px;padding:0 4px;flex-shrink:0">✕</button>
  `;
  document.body.appendChild(banner);
  // Auto-dismiss after 10s
  setTimeout(dismissPWA, 10000);
}

function handleInstallClick(){
  if(deferredPrompt){
    installPWA();
  } else {
    // Show manual instructions
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    if(isIOS){
      toast('📲 Sur iPhone : Partager puis Ajouter a l\'ecran d\'accueil');
    } else {
      toast('💻 Dans Chrome : clique sur le symbole + dans la barre d\'adresse pour installer !');
    }
  }
}

function installPWA(){
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  deferredPrompt.userChoice.then(result => {
    if(result.outcome === 'accepted'){
      toast('🎉 ViralBoost installé sur ton bureau !');
    }
    dismissPWA();
    deferredPrompt = null;
  });
}

function dismissPWA(){
  const b = document.getElementById('pwa-banner');
  if(b) b.remove();
  // Keep navbar button visible
}

// iOS specific — show instructions
window.addEventListener('load', () => {
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
  if(isIOS && !isStandalone && !localStorage.getItem('vb_ios_prompt')){
    setTimeout(() => {
      const banner = document.createElement('div');
      banner.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:9990;background:linear-gradient(135deg,#0b1a0d,#142e17);border:1.5px solid rgba(34,197,94,0.4);border-radius:16px;padding:14px 20px;text-align:center;box-shadow:0 8px 40px rgba(0,0,0,0.5);max-width:90vw;';
      banner.innerHTML = `
        <div style="font-size:13px;font-weight:800;color:#f0fdf4;margin-bottom:6px">📲 Installer ViralBoost sur iPhone</div>
        <div style="font-size:12px;color:#4a7a58;line-height:1.6">Appuie sur <strong style="color:#22c55e">Partager</strong> puis <strong style="color:#22c55e">Ajouter à l'écran d'accueil</strong></div>
        <button onclick="this.parentElement.remove();localStorage.setItem('vb_ios_prompt','1')" style="margin-top:10px;padding:6px 16px;background:none;border:1px solid rgba(34,197,94,0.3);border-radius:8px;font-size:12px;color:#22c55e;cursor:pointer">OK compris</button>
      `;
      document.body.appendChild(banner);
    }, 3000);
    localStorage.setItem('vb_ios_prompt', '1');
  }
});
</script>

<div id="exit-popup" style="display:none;position:fixed;inset:0;z-index:10000;background:rgba(4,10,5,0.85);backdrop-filter:blur(8px);align-items:center;justify-content:center;">
  <div style="background:linear-gradient(135deg,#0b1a0d,#0f2312);border:1.5px solid rgba(34,197,94,0.35);border-radius:20px;padding:40px 36px;max-width:480px;width:92%;text-align:center;position:relative;box-shadow:0 0 80px rgba(34,197,94,0.15);">
    <button onclick="closeExitPopup()" style="position:absolute;top:14px;right:16px;background:none;border:none;color:#4a7a58;font-size:20px;cursor:pointer">✕</button>
    <div style="font-size:48px;margin-bottom:12px">🚀</div>
    <div style="font-family:'DM Mono',monospace;font-size:11px;color:#22c55e;letter-spacing:2px;margin-bottom:10px">ATTENDS !</div>
    <h2 style="font-family:'Plus Jakarta Sans',sans-serif;font-size:26px;font-weight:900;color:#f0fdf4;margin-bottom:10px;line-height:1.2">Tu pars déjà ?<br><span style="color:#22c55e">Les 100 premiers ont le PRO gratuit.</span></h2>
    <p style="font-size:13px;color:#4a7a58;margin-bottom:24px;line-height:1.6">Rejoins maintenant et accède à toutes les fonctionnalités premium — matching IA, vitrine boostée, monétisation — gratuitement pendant 1 an.</p>
    <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:20px">
      <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:8px;padding:10px 16px;text-align:center">
        <div style="font-size:18px;font-weight:900;color:#22c55e">100%</div>
        <div style="font-size:10px;color:#4a7a58">Gratuit</div>
      </div>
      <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:8px;padding:10px 16px;text-align:center">
        <div style="font-size:18px;font-weight:900;color:#22c55e">30s</div>
        <div style="font-size:10px;color:#4a7a58">Pour publier</div>
      </div>
      <div style="background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.2);border-radius:8px;padding:10px 16px;text-align:center">
        <div style="font-size:18px;font-weight:900;color:#ffd700">PRO</div>
        <div style="font-size:10px;color:#4a7a58">1 an offert</div>
      </div>
    </div>
    <button onclick="closeExitPopup();openModal('signup-modal')" style="width:100%;padding:15px;background:#22c55e;border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;font-weight:800;color:#040a05;cursor:pointer;box-shadow:0 0 40px rgba(34,197,94,0.35);margin-bottom:10px">⚡ Créer mon compte gratuit →</button>
    <div onclick="closeExitPopup()" style="font-size:12px;color:#4a7a58;cursor:pointer">Non merci, je préfère partir</div>
  </div>
</div>

<script>
// ── EXIT INTENT ──
exitShown = false;
document.addEventListener('mouseleave', (e) => {
  if(e.clientY <= 0 && !exitShown && !currentUser && document.getElementById('landing').style.display !== 'none'){
    exitShown = true;
    const popup = document.getElementById('exit-popup');
    if(popup){ popup.style.display = 'flex'; }
  }
});
// Mobile : scroll up rapide = exit intent
let lastScrollY = 0;
let scrollTimer = null;
window.addEventListener('scroll', () => {
  const currentY = window.scrollY;
  if(scrollTimer) clearTimeout(scrollTimer);
  scrollTimer = setTimeout(() => {
    if(lastScrollY - currentY > 80 && currentY < 200 && !exitShown && !currentUser){
      exitShown = true;
      const popup = document.getElementById('exit-popup');
      if(popup){ popup.style.display = 'flex'; }
    }
    lastScrollY = currentY;
  }, 100);
});

function closeExitPopup(){
  const popup = document.getElementById('exit-popup');
  if(popup) popup.style.display = 'none';
}
</script>

<!-- CHOIX TYPE DE PUB -->
<div class="modal-bg" id="pub-type-modal">
  <div class="modal wide" style="max-width:560px;padding:32px">
    <button class="modal-close" onclick="closeModal('pub-type-modal')">✕</button>
    <div style="text-align:center;margin-bottom:28px">
      <div style="font-size:11px;color:var(--g3);letter-spacing:2px;font-family:'DM Mono',monospace;margin-bottom:8px">NOUVELLE PUBLICATION</div>
      <h2 style="font-size:22px;font-weight:800;color:var(--white)">Quel type de publication ?</h2>
    </div>
    <div style="display:flex;flex-direction:column;gap:12px">

      <!-- TYPE 1 : PUB -->
      <div onclick="selectPubType('pub')" style="background:var(--s1);border:1.5px solid rgba(34,197,94,0.2);border-radius:14px;padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:16px;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(34,197,94,0.5)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.2)'">
        <div style="width:48px;height:48px;background:rgba(34,197,94,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">📢</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span style="font-size:15px;font-weight:800;color:var(--white)">Pub</span>
            <span style="font-size:10px;background:rgba(34,197,94,0.1);color:var(--g3);border-radius:4px;padding:2px 7px;font-weight:700">GRATUIT</span>
            <span style="font-size:10px;color:var(--muted)">~2 min</span>
          </div>
          <div style="font-size:12px;color:var(--muted);line-height:1.5">Présente ton projet rapidement. Nom, description, catégorie, lien. Idéal pour débuter.</div>
          <div style="display:flex;gap:6px;margin-top:8px">
            <span style="font-size:10px;color:var(--muted2)">✓ Nom du projet</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Description</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Lien</span>
          </div>
        </div>
        <div style="font-size:20px;color:var(--muted2)">→</div>
      </div>

      <!-- TYPE 2 : ANNONCE -->
      <div onclick="selectPubType('annonce')" style="background:var(--s1);border:1.5px solid rgba(74,222,128,0.2);border-radius:14px;padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:16px;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(74,222,128,0.5)'" onmouseout="this.style.borderColor='rgba(74,222,128,0.2)'">
        <div style="width:48px;height:48px;background:rgba(74,222,128,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">📣</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span style="font-size:15px;font-weight:800;color:var(--white)">Annonce</span>
            <span style="font-size:10px;background:rgba(74,222,128,0.1);color:#4ade80;border-radius:4px;padding:2px 7px;font-weight:700">STARTER+</span>
            <span style="font-size:10px;color:var(--muted)">~5 min</span>
          </div>
          <div style="font-size:12px;color:var(--muted);line-height:1.5">Pour les lancements, recherches de collabs ou offres. Plus de détails, plus de visibilité.</div>
          <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
            <span style="font-size:10px;color:var(--muted2)">✓ Type d'annonce</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Ce que tu cherches</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Image bannière</span>
          </div>
        </div>
        <div style="font-size:20px;color:var(--muted2)">→</div>
      </div>

      <!-- TYPE 3 : CAMPAGNE -->
      <div onclick="selectPubType('campagne')" style="background:linear-gradient(135deg,rgba(255,215,0,0.05),rgba(255,140,0,0.03));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:16px;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(255,215,0,0.5)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
        <div style="width:48px;height:48px;background:rgba(255,215,0,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">🏆</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span style="font-size:15px;font-weight:800;color:#ffd700">Campagne</span>
            <span style="font-size:10px;background:rgba(255,215,0,0.1);color:#ffd700;border-radius:4px;padding:2px 7px;font-weight:700">PRO / ELITE</span>
            <span style="font-size:10px;color:var(--muted)">~10 min</span>
          </div>
          <div style="font-size:12px;color:var(--muted);line-height:1.5">Pour les projets sérieux. Maximum de visibilité, objectifs chiffrés, vidéo, FAQ et boost crédits.</div>
          <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
            <span style="font-size:10px;color:var(--muted2)">✓ Vidéo</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Objectif chiffré</span>
            <span style="font-size:10px;color:var(--muted2)">✓ FAQ</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Boost top</span>
          </div>
        </div>
        <div style="font-size:20px;color:var(--muted2)">→</div>
      </div>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════
// PUB TYPE SELECTOR
// ══════════════════════════════════
function openPubTypeSelector(){
  if(!currentUser){ openModal('signup-modal'); return; }
  openModal('pub-type-modal');
}

let currentPubType = 'pub';

function selectPubType(type){
  closeModal('pub-type-modal');
  const plan = currentUser ? (currentUser.plan || 'free') : 'free';

  if(type === 'annonce' && plan === 'free'){
    toast('📣 Les Annonces sont disponibles à partir du plan Starter !');
    setTimeout(() => showAppTab('boost-credits', null), 1000);
    return;
  }
  if(type === 'campagne' && (plan === 'free' || plan === 'starter')){
    toast('🏆 Les Campagnes sont disponibles à partir du plan Pro !');
    setTimeout(() => showAppTab('boost-credits', null), 1000);
    return;
  }

  currentPubType = type;
  showAppTab('feed', document.querySelector('.app-tab'));

  setTimeout(() => {
    adaptPubForm(type);
    const el = document.getElementById('feed-text');
    if(el) el.focus();
  }, 300);
}

function adaptPubForm(type){
  const labels = {
    pub: { badge: '📢 PUB', color: 'var(--g3)', hint: 'Présente ton projet en quelques mots' },
    annonce: { badge: '📣 ANNONCE', color: '#4ade80', hint: 'Détaille ton lancement, collab ou offre' },
    campagne: { badge: '🏆 CAMPAGNE', color: '#ffd700', hint: 'Crée ta campagne complète avec objectifs et FAQ' }
  };
  const cfg = labels[type] || labels.pub;

  // Update or create type badge in feed form
  let badge = document.getElementById('pub-type-badge');
  if(!badge){
    badge = document.createElement('div');
    badge.id = 'pub-type-badge';
    badge.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding:8px 12px;border-radius:8px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.15)';
    const form = document.getElementById('feed-form') || document.querySelector('.feed-form');
    if(form) form.prepend(badge);
  }
  badge.innerHTML = `<span style="font-size:13px;font-weight:800;color:${cfg.color}">${cfg.badge}</span><button onclick="openPubTypeSelector()" style="background:none;border:none;font-size:11px;color:var(--muted);cursor:pointer">Changer →</button>`;

  // Show/hide extra fields based on type
  const extraAnnonce = document.getElementById('pub-extra-annonce');
  const extraCampagne = document.getElementById('pub-extra-campagne');

  // Create extra fields if needed
  if(type !== 'pub'){
    const feedForm = document.getElementById('feed-form') || document.querySelector('.feed-post-form');
    if(feedForm && !document.getElementById('pub-extra-annonce')){
      const annonceFields = document.createElement('div');
      annonceFields.id = 'pub-extra-annonce';
      annonceFields.style.cssText = 'margin-top:10px;display:flex;flex-direction:column;gap:8px';
      annonceFields.innerHTML = `
        <select id="annonce-type-select" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px">
          <option value="">Type d'annonce...</option>
          <option>🚀 Lancement</option><option>🤝 Recherche collab</option><option>💼 Offre de service</option><option>👥 Recrutement</option>
        </select>
        <input id="annonce-seeking" type="text" placeholder="Ce que tu cherches exactement..." style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
        <input id="annonce-budget" type="text" placeholder="Budget ou conditions (optionnel)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
      `;
      feedForm.appendChild(annonceFields);
    }
    if(type === 'campagne' && !document.getElementById('pub-extra-campagne')){
      const campagneFields = document.createElement('div');
      campagneFields.id = 'pub-extra-campagne';
      campagneFields.style.cssText = 'margin-top:8px;display:flex;flex-direction:column;gap:8px';
      campagneFields.innerHTML = `
        <input id="campagne-goal" type="text" placeholder="Objectif chiffré (ex: 500 inscrits, 10k€ de CA)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
        <input id="campagne-video" type="url" placeholder="URL vidéo de présentation (YouTube, Loom...)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
        <textarea id="campagne-faq" placeholder="FAQ — Q: ... R: ... (3 questions/réponses)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px;resize:none;min-height:70px"></textarea>
      `;
      const annonceDiv = document.getElementById('pub-extra-annonce');
      if(annonceDiv) annonceDiv.after(campagneFields);
    }
    if(document.getElementById('pub-extra-annonce')) document.getElementById('pub-extra-annonce').style.display = 'flex';
    if(type === 'campagne' && document.getElementById('pub-extra-campagne')) document.getElementById('pub-extra-campagne').style.display = 'flex';
  } else {
    if(document.getElementById('pub-extra-annonce')) document.getElementById('pub-extra-annonce').style.display = 'none';
    if(document.getElementById('pub-extra-campagne')) document.getElementById('pub-extra-campagne').style.display = 'none';
  }
}
</script>

<script>
// ══════════════════════════════════════════════
//  WIZARD CONFIG — CONTENU PAR TYPE DE PUB
// ══════════════════════════════════════════════
const WIZ_CONFIGS = {

  pub: {
    mainTitle: 'CRÉER MA PUBLICITÉ',
    mainSub: 'Présente ton projet à toute la communauté ViralBoost.',
    color: '#22c55e',
    steps: ['Identité', 'Description', 'Audience', 'Visuel', 'Aperçu'],
    step1: {
      icon: '📢', head: 'IDENTITÉ DE TA PUB',
      sub: 'Le nom est la première chose que les gens voient',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Nom du projet / produit *</label>
          <input type="text" id="pub-name" placeholder="Ex: ContentPro — L'outil IA pour créateurs" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 car. · <em style="color:var(--g4)">Sois précis et accrocheur</em></div>
        </div>
        <div class="fg">
          <label>Catégorie *</label>
          <select id="pub-cat" onchange="updatePubTypeEmoji()">
            <option>🚀 SaaS / App</option><option>🌐 Site web</option><option>🛍️ E-commerce</option><option>💼 Service / Freelance</option><option>🎓 Coaching / Formation</option><option>🎵 Réseaux sociaux</option><option>📧 Newsletter</option><option>🎙️ Podcast</option><option>👥 Communauté</option>
          </select>
        </div>
        <div class="fg">
          <label>URL du projet</label>
          <input type="url" id="pub-url" placeholder="https://monprojet.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji / Icône</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🚀" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🚀','💡','🎯','🔥','💎','⚡','🛍️','📣','🌟','💪'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '✍️', head: 'DÉCRIS TA PUB', sub: 'Une bonne description donne envie de cliquer',
      fields: `
        <div class="fg">
          <label>Accroche courte <span style="color:var(--muted);font-weight:400">(60 car. max)</span></label>
          <input type="text" id="pub-hook" placeholder="Ex: L'outil qui remplace 5 abonnements payants" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description principale *</label>
          <textarea id="pub-desc" rows="5" placeholder="Explique ce que fait ton projet, quel problème il résout, pourquoi les gens devraient s'y intéresser..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(22,163,74,0.04);border:1px solid rgba(22,163,74,0.12);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">💡 CLIQUE POUR AJOUTER</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❌ Problème résolu : ">❌ Problème résolu</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Solution : ">✅ Solution</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Pour qui : ">🎯 Pour qui</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💰 Prix : ">💰 Prix / offre</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 Pourquoi maintenant : ">🔥 Pourquoi maintenant</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Résultat : ">📈 Résultat attendu</div>
          </div>
        </div>`
    },
    step3: {
      icon: '🎯', head: 'AUDIENCE & TAGS', sub: 'Aide la communauté à trouver ton projet',
      fields: `
        <div class="fg">
          <label>Audience cible *</label>
          <input type="text" id="pub-target" placeholder="Ex: Créateurs TikTok 18-35 ans, freelances, PME..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Stade du projet</label>
          <select id="pub-stage"><option>💭 Idée</option><option>🧪 Beta</option><option>🚀 Lancé</option><option>📈 En croissance</option><option>💰 Monétisé</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: IA, TikTok, Gratuit, SaaS" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Cherches-tu des collaborateurs ?</label>
          <select id="pub-collab-need"><option value="">Non précisé</option><option>👨‍💻 Développeur</option><option>📣 Marketeur</option><option>🎨 Designer</option><option>🎬 Créateur vidéo</option><option>💸 Investisseur</option><option>🤝 Associé</option><option>🧑‍💼 Premiers clients</option></select>
        </div>`
    }
  },

  annonce: {
    mainTitle: 'CRÉER MON ANNONCE',
    mainSub: 'Informe la communauté d\'une nouveauté, mise à jour ou événement.',
    color: '#4ade80',
    steps: ['Titre', 'Message', 'Diffusion', 'Visuel', 'Aperçu'],
    step1: {
      icon: '📣', head: 'TITRE DE L\'ANNONCE', sub: 'Un bon titre = 3× plus de lecture',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Titre de l'annonce *</label>
          <input type="text" id="pub-name" placeholder="Ex: Mise à jour majeure v2.0 — Nouvelles fonctionnalités !" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 car.</div>
        </div>
        <div class="fg">
          <label>Type d'annonce *</label>
          <select id="pub-cat">
            <option>🚀 Lancement / Mise à jour</option><option>🤝 Partenariat</option><option>📅 Événement</option><option>📢 Information importante</option><option>🎉 Célébration / Milestone</option><option>⚠️ Changement de service</option>
          </select>
        </div>
        <div class="fg">
          <label>Date de l'événement / annonce</label>
          <input type="date" id="pub-date" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Lien associé</label>
          <input type="url" id="pub-url" placeholder="https://lien-vers-plus-info.fr"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji de l'annonce</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="📣" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['📣','🚀','🎉','📅','⚠️','🔔','💡','🤝','📢','🌟'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '💬', head: 'MESSAGE DE L\'ANNONCE', sub: 'Sois clair, précis, et donne envie de réagir',
      fields: `
        <div class="fg">
          <label>Résumé en une ligne *</label>
          <input type="text" id="pub-hook" placeholder="Ex: On vient de dépasser les 10 000 utilisateurs 🎉" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Message complet *</label>
          <textarea id="pub-desc" rows="5" placeholder="Détaille ton annonce : qu'est-ce qui change ? Pourquoi c'est important ? Qu'est-ce que ça change pour la communauté ?" oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(74,222,128,0.04);border:1px solid rgba(74,222,128,0.12);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#4ade80;letter-spacing:2px;margin-bottom:10px">💡 STRUCTURE TON ANNONCE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📢 Ce qui change : ">📢 Ce qui change</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Pourquoi c'est important : ">🎯 Pourquoi c'est important</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="👥 Qui est concerné : ">👥 Qui est concerné</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📅 À partir du : ">📅 Date d'effet</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔗 Pour en savoir plus : ">🔗 En savoir plus</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🙏 Merci à : ">🙏 Remerciements</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📡', head: 'DIFFUSION', sub: 'Cible les bonnes personnes',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: Mise à jour, V2, Nouveauté, Annonce" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Audience concernée</label>
          <input type="text" id="pub-target" placeholder="Ex: Utilisateurs existants, abonnés newsletter, créateurs..." oninput="updatePubCompletion()"/>
        </div>`
    }
  },

  service: {
    mainTitle: 'PROPOSER UN SERVICE',
    mainSub: 'Mets en avant tes compétences et trouve tes premiers clients.',
    color: '#60a5fa',
    steps: ['Service', 'Détails', 'Conditions', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🛍️', head: 'TON SERVICE', sub: 'Décris ce que tu fais en quelques mots clairs',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Intitulé du service *</label>
          <input type="text" id="pub-name" placeholder="Ex: Création de logo + charte graphique pro" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 car.</div>
        </div>
        <div class="fg">
          <label>Catégorie *</label>
          <select id="pub-cat">
            <option>🎨 Design & Créatif</option><option>💻 Développement</option><option>📣 Marketing & Growth</option><option>✍️ Rédaction & Contenu</option><option>🎬 Vidéo & Photo</option><option>🎵 Audio & Musique</option><option>📊 Business & Conseil</option><option>🎓 Coaching & Formation</option><option>📱 Réseaux sociaux</option><option>🔧 Technique & Support</option>
          </select>
        </div>
        <div class="fg">
          <label>Tarif *</label>
          <input type="text" id="pub-price" placeholder="Ex: À partir de 150€ · ou forfait 500€" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Délai de livraison</label>
          <select id="pub-delay"><option>⚡ Express (24h)</option><option>🚀 Rapide (2-3j)</option><option>📅 Standard (1 semaine)</option><option>🗓️ Long terme (+2 semaines)</option><option>🔄 Sur devis</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji du service</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🛍️" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🎨','💻','📣','✍️','🎬','📊','🔧','🎓','📱','💡'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📋', head: 'DESCRIPTION DU SERVICE', sub: 'Convaincs en expliquant exactement ce que tu livres',
      fields: `
        <div class="fg">
          <label>Accroche *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Je crée des identités visuelles qui convertissent" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description complète *</label>
          <textarea id="pub-desc" rows="5" placeholder="Décris précisément ce que tu livres, ton process, ta valeur ajoutée et pourquoi choisir toi..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(59,130,246,0.04);border:1px solid rgba(59,130,246,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#60a5fa;letter-spacing:2px;margin-bottom:10px">💡 CE QUI VEND TON SERVICE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Ce qui est inclus : ">✅ Inclus dans l'offre</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⭐ Mon expertise : ">⭐ Mon expertise</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📦 Ce que tu reçois : ">📦 Livrables concrets</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏆 Résultats clients : ">🏆 Résultats clients</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔄 Mon process : ">🔄 Mon process</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Pour qui : ">🎯 Pour qui c'est</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📞', head: 'CONDITIONS & CONTACT', sub: 'Comment les clients peuvent te contacter',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Lien de contact / portfolio *</label>
          <input type="url" id="pub-url" placeholder="https://monfreelan.com ou lien Calendly" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Mode de travail</label>
          <select id="pub-mode"><option>🌍 100% Remote</option><option>🏢 Présentiel possible</option><option>🔄 Hybride</option></select>
        </div>
        <div class="fg">
          <label>Disponibilité</label>
          <select id="pub-dispo"><option>✅ Disponible maintenant</option><option>📅 Disponible sous 1 semaine</option><option>⏳ Liste d'attente</option><option>❌ Complet pour le moment</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: Design, Logo, Identité visuelle, Freelance" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  lancement: {
    mainTitle: 'LANCER MON PRODUIT',
    mainSub: 'Annonce officiellement ton produit et crée le maximum de buzz.',
    color: '#f87171',
    steps: ['Produit', 'Pitch', 'Cible & Prix', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🚀', head: 'TON PRODUIT', sub: 'Présente ton lancement avec impact',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Nom du produit *</label>
          <input type="text" id="pub-name" placeholder="Ex: LaunchKit — Le kit tout-en-un pour founders" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 car.</div>
        </div>
        <div class="fg">
          <label>Catégorie du produit *</label>
          <select id="pub-cat"><option>🚀 SaaS / App</option><option>🛍️ Produit physique</option><option>📚 Formation / E-learning</option><option>🎓 Coaching</option><option>📱 App mobile</option><option>🔧 Outil / Extension</option><option>💼 Service</option><option>📖 Livre / Ebook</option></select>
        </div>
        <div class="fg">
          <label>Stade du lancement</label>
          <select id="pub-stage"><option>🔥 Lancement aujourd'hui !</option><option>🧪 Bêta ouverte</option><option>📅 Pré-lancement (waitlist)</option><option>🎯 Lancement officiel</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>URL du produit *</label>
          <input type="url" id="pub-url" placeholder="https://monproduit.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji du produit</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🚀" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🚀','🔥','💥','⚡','🎯','💡','🏆','💎','🌟','🛠️'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🎤', head: 'TON PITCH', sub: 'Explique le problème que tu règles et ta solution',
      fields: `
        <div class="fg">
          <label>Slogan / Pitch en 1 ligne *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Arrête de perdre 3h/semaine sur des tâches répétitives" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description complète *</label>
          <textarea id="pub-desc" rows="6" placeholder="Quel problème règles-tu ? Comment ? Pour qui ? Pourquoi maintenant ?" oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:140px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(239,68,68,0.04);border:1px solid rgba(239,68,68,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#f87171;letter-spacing:2px;margin-bottom:10px">🔥 STRUCTURE D'UN BON PITCH</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❌ Le problème : ">❌ Le problème</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Ma solution : ">✅ Ma solution</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Pour qui : ">🎯 Pour qui</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Résultat concret : ">📈 Résultat concret</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏆 Ce qui me différencie : ">🏆 Ma différence</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⚡ Pourquoi maintenant : ">⚡ Pourquoi maintenant</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💰', head: 'CIBLE & PRIX', sub: 'Qui achète et à quel prix ?',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Prix du produit *</label>
          <input type="text" id="pub-price" placeholder="Ex: 29€/mois · 197€ one-time · Gratuit avec premium" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Offre de lancement ?</label>
          <input type="text" id="pub-promo" placeholder="Ex: -50% les 72 premières heures · Code LAUNCH"/>
        </div>
        <div class="fg">
          <label>Cible principale</label>
          <input type="text" id="pub-target" placeholder="Ex: Fondateurs B2B, freelances, PME..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: SaaS, IA, Productivité, Lancement, B2B" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  collab: {
    mainTitle: 'CHERCHER UN COLLAB',
    mainSub: 'Trouve le partenaire idéal pour booster ton projet.',
    color: '#c084fc',
    steps: ['Projet', 'Profil', 'Conditions', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🤝', head: 'TON PROJET', sub: 'Présente le contexte pour attirer les bons profils',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Nom du projet *</label>
          <input type="text" id="pub-name" placeholder="Ex: Recherche associé(e) pour SaaS éducatif" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Type de collaboration *</label>
          <select id="pub-cat"><option>🤝 Co-fondateur</option><option>💼 Associé</option><option>🎨 Partenaire créatif</option><option>📣 Partenaire marketing</option><option>👨‍💻 Partenaire tech</option><option>🌍 Partenaire distribution</option><option>💰 Business Angel</option></select>
        </div>
        <div class="fg">
          <label>Secteur du projet</label>
          <select id="pub-secteur"><option>💻 Tech / SaaS</option><option>🛍️ E-commerce</option><option>🎓 Éducation</option><option>💪 Santé / Bien-être</option><option>🎬 Créateurs de contenu</option><option>🏢 B2B</option><option>👥 Communauté</option><option>🌱 Impact / Social</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Lien vers ton projet</label>
          <input type="url" id="pub-url" placeholder="https://monprojet.fr ou pitch deck"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🤝" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🤝','💼','🎯','🚀','💡','🌟','👥','🔥','💪','🌍'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🔍', head: 'PROFIL RECHERCHÉ', sub: 'Décris précisément la personne que tu cherches',
      fields: `
        <div class="fg">
          <label>Accroche *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Cherche dev React pour co-fonder une EdTech" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description du projet & du besoin *</label>
          <textarea id="pub-desc" rows="5" placeholder="Présente ton projet, son stade, ce que tu as déjà accompli, et ce que tu attends de ton futur partenaire..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(168,85,247,0.04);border:1px solid rgba(168,85,247,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#c084fc;letter-spacing:2px;margin-bottom:10px">💡 ÉLÉMENTS CLÉS</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏗️ Stade actuel : ">🏗️ Stade du projet</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Ce que j'ai déjà : ">✅ Déjà accompli</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Compétences recherchées : ">🎯 Compétences clés</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Vision long terme : ">📈 Vision</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💰 Partage prévu : ">💰 Partage / equity</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📩 Pour me contacter : ">📩 Contact</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📋', head: 'CONDITIONS', sub: 'Sois transparent sur les termes',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Conditions de la collaboration *</label>
          <input type="text" id="pub-conditions" placeholder="Ex: 50/50 equity · Remote possible · Temps plein idéalement" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Investissement requis</label>
          <select id="pub-invest"><option>💸 Capital uniquement</option><option>⏱️ Temps uniquement</option><option>🔄 Temps + capital</option><option>🤝 À discuter</option></select>
        </div>
        <div class="fg">
          <label>Mode de travail</label>
          <select id="pub-mode"><option>🌍 100% Remote</option><option>🏢 Présentiel (Paris)</option><option>🏢 Présentiel (Province)</option><option>🔄 Hybride</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Tech, Equity, Remote, EdTech, Collab" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  promo: {
    mainTitle: 'CRÉER MA PROMO',
    mainSub: 'Crée de l\'urgence avec une offre irrésistible.',
    color: '#fbbf24',
    steps: ['Offre', 'Message', 'Limites', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🏷️', head: 'TON OFFRE PROMO', sub: 'Le prix barré + la réduction = la formule magique',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Titre de la promo *</label>
          <input type="text" id="pub-name" placeholder="Ex: -60% sur toute la formation pendant 48h !" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Prix normal (barré)</label>
          <input type="text" id="pub-oldprice" placeholder="Ex: 199€" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Prix promo *</label>
          <input type="text" id="pub-price" placeholder="Ex: 79€ soit -60%" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Code promo</label>
          <input type="text" id="pub-code" placeholder="Ex: VIRAL60" style="text-transform:uppercase;letter-spacing:2px;font-family:'DM Mono',monospace;font-weight:700"/>
        </div>
        <div class="fg">
          <label>Date d'expiration *</label>
          <input type="datetime-local" id="pub-expiry" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Lien vers l'offre *</label>
          <input type="url" id="pub-url" placeholder="https://monoffre.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🏷️" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🏷️','💸','🔥','⚡','🎉','💥','🎁','⏳','✂️','💰'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '💬', head: 'MESSAGE DE VENTE', sub: 'Crée l\'urgence et justifie la valeur',
      fields: `
        <div class="fg">
          <label>Accroche *</label>
          <input type="text" id="pub-hook" placeholder="Ex: 🔥 Offre flash — seulement 48h !" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description de l'offre *</label>
          <textarea id="pub-desc" rows="5" placeholder="Ce qui est inclus, pourquoi c'est une bonne affaire, pour qui c'est fait..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(245,158,11,0.04);border:1px solid rgba(245,158,11,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#fbbf24;letter-spacing:2px;margin-bottom:10px">⚡ CRÉE L'URGENCE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Ce qui est inclus : ">✅ Inclus</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⏳ Expire le : ">⏳ Date limite</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Pour qui : ">🎯 Pour qui</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 Pourquoi maintenant : ">🔥 Urgence</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💎 Valeur totale : ">💎 Valeur</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⭐ Témoignage : ">⭐ Preuve sociale</div>
          </div>
        </div>`
    },
    step3: {
      icon: '⏱️', head: 'LIMITES & CIBLAGE', sub: 'Définis qui peut en profiter',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Audience cible</label>
          <input type="text" id="pub-target" placeholder="Ex: Créateurs, entrepreneurs, étudiants..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Nombre de places</label>
          <input type="text" id="pub-slots" placeholder="Ex: 50 places · Illimité · 1 seul gagnant"/>
        </div>
        <div class="fg">
          <label>Conditions d'accès</label>
          <select id="pub-access"><option>🌍 Ouvert à tous</option><option>📧 Abonnés newsletter</option><option>💎 Membres VIP</option><option>🔗 Lien secret uniquement</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Promo, Formation, -60%, Flash, Limité" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  sondage: {
    mainTitle: 'CRÉER UN SONDAGE',
    mainSub: 'Collecte des votes et insights de la communauté en temps réel.',
    color: '#2dd4bf',
    steps: ['Question', 'Options', 'Paramètres', 'Visuel', 'Aperçu'],
    step1: {
      icon: '📊', head: 'TA QUESTION', sub: 'Une bonne question = des réponses exploitables',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Ta question *</label>
          <input type="text" id="pub-name" placeholder="Ex: Quel outil IA utilisez-vous le plus en 2025 ?" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Thème du sondage</label>
          <select id="pub-cat"><option>💻 Tech & IA</option><option>📣 Marketing</option><option>💼 Business</option><option>🎨 Créativité</option><option>💰 Finance</option><option>🌍 Société</option><option>🎓 Formation</option><option>🤔 Avis général</option></select>
        </div>
        <div class="fg">
          <label>Durée du vote</label>
          <select id="pub-duration"><option>⚡ 24 heures</option><option>📅 3 jours</option><option>📅 1 semaine</option><option>📅 2 semaines</option><option>♾️ Illimité</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Contexte / explication (optionnel)</label>
          <input type="text" id="pub-hook" placeholder="Ex: Je prépare un article et j'aimerais votre avis !" maxlength="60" oninput="updateMobilePreview()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="📊" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['📊','🤔','💡','🗳️','❓','🔍','📈','🎯','💬','🌐'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🔘', head: 'LES OPTIONS', sub: 'Propose 2 à 4 choix clairs et distincts',
      fields: `
        <div class="fg">
          <label>Option A *</label>
          <input type="text" id="pub-opt-a" placeholder="Ex: ChatGPT" oninput="updatePubCompletion()" style="border-left:3px solid #2dd4bf"/>
        </div>
        <div class="fg">
          <label>Option B *</label>
          <input type="text" id="pub-opt-b" placeholder="Ex: Claude" oninput="updatePubCompletion()" style="border-left:3px solid #34d399"/>
        </div>
        <div class="fg">
          <label>Option C</label>
          <input type="text" id="pub-opt-c" placeholder="Ex: Gemini" style="border-left:3px solid #a78bfa"/>
        </div>
        <div class="fg">
          <label>Option D</label>
          <input type="text" id="pub-opt-d" placeholder="Ex: Autre (précise en commentaire)" style="border-left:3px solid #fb923c"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Description / Précisions</label>
          <textarea id="pub-desc" rows="3" placeholder="Ajoute du contexte ou des précisions sur ton sondage..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:80px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300</div>
        </div>`
    },
    step3: {
      icon: '⚙️', head: 'PARAMÈTRES', sub: 'Qui peut voter et comment',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Audience cible</label>
          <input type="text" id="pub-target" placeholder="Ex: Créateurs, développeurs, marketeurs..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Résultats visibles</label>
          <select id="pub-results"><option>👁️ Après vote seulement</option><option>🌍 Visibles en temps réel</option><option>🔒 À la fin uniquement</option></select>
        </div>
        <div class="fg">
          <label>Vote multiple autorisé ?</label>
          <select id="pub-multi"><option>❌ Non (1 vote par personne)</option><option>✅ Oui (plusieurs choix)</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: IA, Sondage, Outils, Tech" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  tutoriel: {
    mainTitle: 'CRÉER UN TUTORIEL',
    mainSub: 'Partage ton expertise et positionne-toi comme référence.',
    color: '#86efac',
    steps: ['Sujet', 'Contenu', 'Audience', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🎓', head: 'TON TUTORIEL', sub: 'Un bon titre de tuto est précis et promesse de résultat',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Titre du tutoriel *</label>
          <input type="text" id="pub-name" placeholder="Ex: Comment créer une landing page qui convertit en 2h" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Catégorie</label>
          <select id="pub-cat"><option>💻 Développement</option><option>🎨 Design</option><option>📣 Marketing</option><option>💼 Business</option><option>🤖 IA & Automatisation</option><option>📱 Réseaux sociaux</option><option>💰 Finance / Investissement</option><option>🎬 Création de contenu</option><option>🛠️ Productivité</option></select>
        </div>
        <div class="fg">
          <label>Niveau requis</label>
          <select id="pub-level"><option>🟢 Débutant</option><option>🟡 Intermédiaire</option><option>🔴 Avancé</option><option>🌍 Tous niveaux</option></select>
        </div>
        <div class="fg">
          <label>Durée estimée</label>
          <select id="pub-duration"><option>⚡ 5-10 min</option><option>📖 15-30 min</option><option>⏱️ 30-60 min</option><option>🗓️ Plusieurs heures</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Lien vers le tuto complet</label>
          <input type="url" id="pub-url" placeholder="https://ton-blog.fr/tutoriel ou YouTube..."/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🎓" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🎓','📚','💡','🔧','⚙️','🎯','📝','🖥️','🔑','🚀'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📝', head: 'CONTENU DU TUTO', sub: 'Décris ce que les lecteurs vont apprendre',
      fields: `
        <div class="fg">
          <label>Résumé en 1 ligne *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Apprends à doubler ton taux de conversion en 5 étapes" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description complète *</label>
          <textarea id="pub-desc" rows="5" placeholder="Décris les étapes principales, les prérequis, et ce que les lecteurs vont apprendre exactement..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(34,197,94,0.04);border:1px solid rgba(34,197,94,0.12);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#86efac;letter-spacing:2px;margin-bottom:10px">📚 STRUCTURE TON TUTO</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Ce que tu vas apprendre : ">🎯 Objectif</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📋 Prérequis : ">📋 Prérequis</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="1️⃣ Étape 1 : ">1️⃣ Étape 1</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="2️⃣ Étape 2 : ">2️⃣ Étape 2</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🛠️ Outils utilisés : ">🛠️ Outils</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Résultat final : ">✅ Résultat final</div>
          </div>
        </div>`
    },
    step3: {
      icon: '👥', head: 'AUDIENCE', sub: 'Pour qui est ce tutoriel ?',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Audience cible</label>
          <input type="text" id="pub-target" placeholder="Ex: Développeurs débutants, freelances, entrepreneurs..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Tuto, Marketing, Débutant, Gratuit" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  recherche: {
    mainTitle: 'PUBLIER UNE RECHERCHE',
    mainSub: 'Décris ton besoin et reçois des propositions de la communauté.',
    color: '#a5b4fc',
    steps: ['Besoin', 'Détails', 'Budget & délai', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🔍', head: 'TON BESOIN', sub: 'Plus c\'est précis, mieux tu seras servi',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Titre du besoin *</label>
          <input type="text" id="pub-name" placeholder="Ex: Recherche développeur React pour app mobile urgente" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Type de recherche *</label>
          <select id="pub-cat"><option>👨‍💻 Freelance / Prestataire</option><option>🤝 Partenaire business</option><option>🛠️ Outil / Logiciel</option><option>📚 Ressource / Contenu</option><option>💡 Conseil / Avis</option><option>🌍 Fournisseur</option><option>📢 Influenceur / Ambassadeur</option></select>
        </div>
        <div class="fg">
          <label>Urgence</label>
          <select id="pub-urgence"><option>🔥 Très urgent (cette semaine)</option><option>⚡ Urgent (2 semaines)</option><option>📅 Normal (1 mois)</option><option>🗓️ Pas urgent (quand disponible)</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🔍" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🔍','🤝','👨‍💻','🛠️','📢','💡','🎯','📚','💼','🌍'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📋', head: 'DESCRIPTION DU BESOIN', sub: 'Décris exactement ce dont tu as besoin',
      fields: `
        <div class="fg">
          <label>Résumé *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Je cherche quelqu'un pour refondre mon site en 2 semaines" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description complète *</label>
          <textarea id="pub-desc" rows="5" placeholder="Décris ton projet, le contexte, les compétences nécessaires, et ce que tu attends exactement..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(99,102,241,0.04);border:1px solid rgba(99,102,241,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#a5b4fc;letter-spacing:2px;margin-bottom:10px">💡 SOIS PRÉCIS</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Ce dont j'ai besoin : ">🎯 Besoin précis</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📋 Compétences requises : ">📋 Compétences</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏗️ Contexte projet : ">🏗️ Contexte</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📦 Livrables attendus : ">📦 Livrables</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📩 Comment postuler : ">📩 Comment postuler</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⚠️ Important : ">⚠️ Points importants</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💰', head: 'BUDGET & DÉLAI', sub: 'Sois transparent pour attirer les bonnes personnes',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Budget *</label>
          <input type="text" id="pub-price" placeholder="Ex: 300-500€ · TJM 350€ · Sur devis · Equity possible" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Mode de travail</label>
          <select id="pub-mode"><option>🌍 Remote uniquement</option><option>🏢 Paris / IDF</option><option>🏢 Province</option><option>🔄 Remote ou présentiel</option></select>
        </div>
        <div class="fg">
          <label>Contrat</label>
          <select id="pub-contrat"><option>📄 Mission freelance</option><option>🤝 Partenariat</option><option>💼 CDI / CDD</option><option>🔄 À définir</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: React, Freelance, Urgent, Remote, Dev" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  resultat: {
    mainTitle: 'PARTAGER MES RÉSULTATS',
    mainSub: 'Inspire la communauté avec tes stats et victoires.',
    color: '#fde68a',
    steps: ['Chiffres', 'Histoire', 'Apprentissages', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🏆', head: 'TES CHIFFRES', sub: 'Les chiffres concrets inspirent et engagent',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Titre du résultat *</label>
          <input type="text" id="pub-name" placeholder="Ex: 10 000€ de CA en 3 mois — voilà comment j'ai fait" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Chiffre clé *</label>
          <input type="text" id="pub-metric" placeholder="Ex: 10 000€ · 5 000 abonnés · +300% de trafic" oninput="updatePubCompletion()" style="font-size:18px;font-weight:800;text-align:center"/>
        </div>
        <div class="fg">
          <label>Période</label>
          <input type="text" id="pub-period" placeholder="Ex: Janvier à Mars 2025 · En 90 jours" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Domaine</label>
          <select id="pub-cat"><option>💰 Revenus / CA</option><option>👥 Audience / Abonnés</option><option>🔗 Trafic / Visiteurs</option><option>🛍️ Ventes / Clients</option><option>📈 Croissance</option><option>🎓 Formation / Apprentissage</option><option>🏋️ Perso / Défi</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🏆" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🏆','📈','💰','🎉','🚀','⭐','💪','🔥','🌟','🎯'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📖', head: 'TON HISTOIRE', sub: 'Contexte + parcours = contenu qui inspire',
      fields: `
        <div class="fg">
          <label>Accroche *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Il y a 3 mois, je partais de 0. Voici ce qui a changé." maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Ton histoire complète *</label>
          <textarea id="pub-desc" rows="6" placeholder="Parle de ton point de départ, les défis rencontrés, les actions qui ont tout changé..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:140px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#fde68a;letter-spacing:2px;margin-bottom:10px">🏆 STRUCTURE QUI ENGAGE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📍 Point de départ : ">📍 Point de départ</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⚡ Ce qui a tout changé : ">⚡ Le déclic</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔑 Actions clés : ">🔑 Actions clés</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Les résultats : ">📈 Les chiffres</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="😰 Les obstacles : ">😰 Les obstacles</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💡 Ce que j'aurais fait différemment : ">💡 Rétro</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💡', head: 'APPRENTISSAGES', sub: 'Partage ce que tu as appris pour aider les autres',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Apprentissage principal</label>
          <textarea id="pub-lesson" rows="3" placeholder="Quelle est la leçon numéro 1 que tu retiens de cette expérience ?" style="font-size:13px;resize:none;min-height:70px;padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:'Plus Jakarta Sans',sans-serif;outline:none"></textarea>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Résultats, CA, Croissance, Témoignage" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Audience inspirée par ce résultat</label>
          <input type="text" id="pub-target" placeholder="Ex: Entrepreneurs, créateurs, freelances débutants..." oninput="updatePubCompletion()"/>
        </div>`
    }
  },

  campagne: {
    mainTitle: 'LANCER MA CAMPAGNE',
    mainSub: 'Le format ultime pour une visibilité maximale avec objectif chiffré.',
    color: '#ffd700',
    steps: ['Campagne', 'Pitch', 'Objectifs', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🎯', head: 'TA CAMPAGNE', sub: 'Le nom + objectif donnent le ton de toute ta campagne',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Nom de la campagne *</label>
          <input type="text" id="pub-name" placeholder="Ex: 🎯 LaunchBoost — 1000 bêta-testeurs en 30 jours" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Type de campagne *</label>
          <select id="pub-cat"><option>🚀 Lancement produit</option><option>🧪 Recrutement bêta-testeurs</option><option>💰 Levée de fonds</option><option>👥 Croissance audience</option><option>🤝 Recherche partenaires</option><option>🌍 Impact / Cause</option></select>
        </div>
        <div class="fg">
          <label>Durée de la campagne</label>
          <select id="pub-duration"><option>⚡ 7 jours</option><option>📅 14 jours</option><option>📅 30 jours</option><option>📅 60 jours</option><option>♾️ Sans limite</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>URL de la campagne *</label>
          <input type="url" id="pub-url" placeholder="https://macampagne.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>URL vidéo de présentation</label>
          <input type="url" id="pub-video" placeholder="https://youtube.com/... ou Loom..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🎯" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🎯','🚀','💥','🔥','⭐','🏆','💎','🌟','⚡','🎪'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🎤', head: 'PITCH DE CAMPAGNE', sub: 'Convaincs les gens de rejoindre ta cause',
      fields: `
        <div class="fg">
          <label>Slogan de campagne *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Rejoins 500 founders qui changent leur industrie" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description complète *</label>
          <textarea id="pub-desc" rows="5" placeholder="Présente ta campagne, pourquoi elle compte, ce que les gens gagnent à rejoindre..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#ffd700;letter-spacing:2px;margin-bottom:10px">🌟 PITCH GAGNANT</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 La mission : ">🎯 La mission</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❓ Le problème adressé : ">❓ Problème</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎁 Ce que tu offres : ">🎁 L'offre</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💪 Pourquoi toi : ">💪 Pourquoi toi</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 L'urgence : ">🔥 Urgence</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🚀 Comment participer : ">🚀 Comment participer</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📊', head: 'OBJECTIFS & FAQ', sub: 'Des chiffres précis + FAQ = crédibilité maximale',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Objectif chiffré principal *</label>
          <input type="text" id="pub-goal" placeholder="Ex: 1 000 inscrits · 50 000€ levés · 10k abonnés" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>FAQ (3 Q&R clés)</label>
          <textarea id="pub-faq" rows="4" placeholder="Q: Comment ça fonctionne ?&#10;R: ...&#10;Q: C'est gratuit ?&#10;R: ..." style="font-size:13px;resize:none;min-height:100px;padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:'DM Mono',monospace;outline:none"></textarea>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Campagne, SaaS, Lancement, Bêta, Croissance" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  'service-pro': {
    mainTitle: 'MON SERVICE PRO',
    mainSub: 'Crée ta vitrine professionnelle complète pour attirer des clients premium.',
    color: '#a855f7',
    steps: ['Profil', 'Offres', 'Preuves', 'Visuel', 'Aperçu'],
    step1: {
      icon: '🔧', head: 'TON PROFIL PRO', sub: 'Ta carte de visite numérique premium',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Ton titre professionnel *</label>
          <input type="text" id="pub-name" placeholder="Ex: Antoine D. — Expert Growth & Acquisition B2B" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Spécialité principale *</label>
          <select id="pub-cat"><option>🎨 Design & Branding</option><option>💻 Développement Web/App</option><option>📣 Marketing & Growth</option><option>✍️ Copywriting & Contenu</option><option>🎬 Vidéo & Production</option><option>📊 Data & Analytics</option><option>🤖 IA & Automatisation</option><option>💼 Conseil & Stratégie</option><option>🎓 Formation & Coaching</option></select>
        </div>
        <div class="fg">
          <label>Années d'expérience</label>
          <select id="pub-exp"><option>🌱 1-2 ans</option><option>📈 3-5 ans</option><option>⭐ 5-10 ans</option><option>🏆 +10 ans</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Portfolio / Site web *</label>
          <input type="url" id="pub-url" placeholder="https://monportfolio.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🔧" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🔧','💼','⭐','🎨','💻','📣','✍️','🎬','📊','🏆'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '💰', head: 'TES OFFRES', sub: 'Tes prestations avec prix clairs',
      fields: `
        <div class="fg">
          <label>Accroche *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Je transforme des idées en produits qui convertissent" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description & offres *</label>
          <textarea id="pub-desc" rows="5" placeholder="Décris tes offres principales, ton approche, ce qui te différencie..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div class="fg">
          <label>Tarif de départ</label>
          <input type="text" id="pub-price" placeholder="Ex: À partir de 800€ · TJM 500€"/>
        </div>
        <div class="fg">
          <label>Disponibilité</label>
          <select id="pub-dispo"><option>✅ Disponible immédiatement</option><option>📅 Disponible dans 1 semaine</option><option>⏳ Liste d'attente 2 semaines</option><option>❌ Complet actuellement</option></select>
        </div>`
    },
    step3: {
      icon: '⭐', head: 'PREUVES SOCIALES', sub: 'Témoignages + références = confiance instantanée',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Témoignage client 1</label>
          <input type="text" id="pub-testi1" placeholder="\"Excellent travail, livré en avance. Je recommande !\" — Marie D., CEO Startup XY"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Témoignage client 2</label>
          <input type="text" id="pub-testi2" placeholder="\"ROI x3 en 2 mois. Prestation au-delà des attentes.\" — Pierre L., Fondateur"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Clients / Marques notables</label>
          <input type="text" id="pub-refs" placeholder="Ex: Orange, BNP, 12 startups Series A, +50 freelances..."/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Design, UX, Branding, Premium, Paris" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  emploi: {
    mainTitle: 'PUBLIER UNE OFFRE D\'EMPLOI',
    mainSub: 'Trouve les meilleurs talents pour ton équipe ou projet.',
    color: '#60a5fa',
    steps: ['Poste', 'Mission', 'Conditions', 'Visuel', 'Aperçu'],
    step1: {
      icon: '💼', head: 'LE POSTE', sub: 'Un titre précis attire les bons candidats',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Intitulé du poste *</label>
          <input type="text" id="pub-name" placeholder="Ex: Développeur Full-Stack React/Node.js — Startup FinTech" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Type de contrat *</label>
          <select id="pub-contrat"><option>💼 CDI</option><option>📋 CDD</option><option>🚀 Freelance / Mission</option><option>🎓 Stage</option><option>🌱 Alternance</option><option>🤝 Associé / Co-fondateur</option></select>
        </div>
        <div class="fg">
          <label>Département / Domaine *</label>
          <select id="pub-cat"><option>💻 Tech & Dev</option><option>🎨 Design & Créa</option><option>📣 Marketing & Growth</option><option>💼 Commercial / Sales</option><option>📊 Data & BI</option><option>🤖 IA & ML</option><option>💰 Finance & Gestion</option><option>🎓 Produit / PM</option><option>👥 RH / Recrutement</option><option>🔧 Ops / Support</option></select>
        </div>
        <div class="fg">
          <label>Expérience requise</label>
          <select id="pub-exp"><option>🌱 Junior (0-2 ans)</option><option>📈 Confirmé (2-5 ans)</option><option>⭐ Senior (5-10 ans)</option><option>🏆 Expert (+10 ans)</option><option>🤔 Tous niveaux</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Nom de l'entreprise / projet *</label>
          <input type="text" id="pub-company" placeholder="Ex: FinTech XYZ · Ma Startup · Projet perso" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Lien candidature / site *</label>
          <input type="url" id="pub-url" placeholder="https://rejoins.mastartup.fr ou email direct" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="💼" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['💼','👨‍💻','🎨','📣','💻','📊','🤖','💰','🎯','🚀'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📋', head: 'MISSION & COMPÉTENCES', sub: 'Ce que fait le candidat au quotidien',
      fields: `
        <div class="fg">
          <label>Accroche *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Rejoins une équipe de 5 qui scale à +10k utilisateurs/mois" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description du poste & mission *</label>
          <textarea id="pub-desc" rows="5" placeholder="Décris les missions principales, le contexte de l'équipe, les défis du poste, et ce qui rend ce poste unique..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(59,130,246,0.04);border:1px solid rgba(59,130,246,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#60a5fa;letter-spacing:2px;margin-bottom:10px">💡 ÉLÉMENTS CLÉS D'UNE OFFRE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Missions principales : ">🎯 Missions</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Compétences requises : ">✅ Compétences</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🌟 Compétences bonus : ">🌟 Bonus appréciés</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏢 L'équipe : ">🏢 L'équipe</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🚀 Le projet : ">🚀 Le projet</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Perspectives d'évolution : ">📈 Évolution</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💰', head: 'CONDITIONS', sub: 'Rémunération, lieu de travail et avantages',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Rémunération *</label>
          <input type="text" id="pub-salary" placeholder="Ex: 45-55k€/an · TJM 400€ · Equity 0.5% · À négocier" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Mode de travail *</label>
          <select id="pub-mode"><option>🌍 Full Remote</option><option>🏢 Paris</option><option>🏢 Lyon</option><option>🏢 Autre ville</option><option>🔄 Hybride (2j bureau/sem)</option><option>🔄 Hybride (3j bureau/sem)</option></select>
        </div>
        <div class="fg">
          <label>Prise de poste</label>
          <select id="pub-start"><option>⚡ Immédiatement</option><option>📅 Dans 1 mois</option><option>📅 Dans 2-3 mois</option><option>🤝 À définir</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Avantages</label>
          <input type="text" id="pub-perks" placeholder="Ex: Stock options, mutuelle, MacBook, budget formation, team off..."/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: CDI, Remote, React, Senior, Paris" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  }
};

// Fallback for types without custom config (tutoriel, recherche already done above)
['pub','annonce','service','lancement','collab','promo','sondage','tutoriel','recherche','resultat','campagne','service-pro','emploi'].forEach(t => {
  if(!WIZ_CONFIGS[t]) WIZ_CONFIGS[t] = WIZ_CONFIGS['pub'];
});

function applyWizardConfig(type) {
  const cfg = WIZ_CONFIGS[type] || WIZ_CONFIGS['pub'];

  // Main header
  const mt = document.getElementById('wiz-main-title');
  const ms = document.getElementById('wiz-main-sub');
  if(mt) mt.textContent = cfg.mainTitle;
  if(ms) ms.textContent = cfg.mainSub;

  // Stepper labels
  cfg.steps.forEach((lbl, i) => {
    const el = document.getElementById('wlbl-' + (i+1));
    if(el) el.textContent = lbl;
  });

  // Step 1
  const s1 = cfg.step1;
  document.getElementById('wiz-step1-icon').textContent = s1.icon;
  document.getElementById('wiz-step1-head').textContent = s1.head;
  document.getElementById('wiz-step1-sub').textContent = s1.sub;
  document.getElementById('wiz-step1-fields').innerHTML = s1.fields;
  document.getElementById('wiz-step1-next').innerHTML = `Suivant — ${cfg.steps[1]} <span>→</span>`;

  // Step 2
  const s2 = cfg.step2;
  document.getElementById('wiz-step2-icon').textContent = s2.icon;
  document.getElementById('wiz-step2-head').textContent = s2.head;
  document.getElementById('wiz-step2-sub').textContent = s2.sub;
  document.getElementById('wiz-step2-fields').innerHTML = s2.fields;
  document.getElementById('wiz-step2-next').innerHTML = `Suivant — ${cfg.steps[2]} <span>→</span>`;

  // Step 3
  const s3 = cfg.step3;
  document.getElementById('wiz-step3-icon').textContent = s3.icon;
  document.getElementById('wiz-step3-head').textContent = s3.head;
  document.getElementById('wiz-step3-sub').textContent = s3.sub;
  document.getElementById('wiz-step3-fields').innerHTML = s3.fields;
  document.getElementById('wiz-step3-next').innerHTML = `Suivant — ${cfg.steps[3]} <span>→</span>`;

  // Accent color on wizard header title
  if(mt) mt.style.color = cfg.color;

  // Re-init char counters if present
  const nameEl = document.getElementById('pub-name');
  const descEl = document.getElementById('pub-desc');
  if(nameEl) {
    nameEl.addEventListener('input', () => {
      const c = document.getElementById('pub-name-count');
      if(c) c.textContent = nameEl.value.length;
    });
  }
  if(descEl) {
    descEl.addEventListener('input', () => {
      const c = document.getElementById('pub-desc-count');
      if(c) c.textContent = descEl.value.length;
    });
  }
}
</script>

<script>
const PUB_TYPE_INFO = {
  pub: {
    emoji:'📢', name:'Pub', color:'#22c55e', btnBg:'linear-gradient(135deg,#15803d,#22c55e)',
    intro:'La publication la plus simple et directe. Idéale pour présenter ton projet, ton app ou ta marque à toute la communauté ViralBoost en quelques secondes.',
    tags:['✍️ Nom du projet','📝 Description','🔗 Lien','🏷️ Tags'],
    tip:'💡 Parfait pour démarrer ou tester ton message.'
  },
  annonce: {
    emoji:'📣', name:'Annonce', color:'#4ade80', btnBg:'linear-gradient(135deg,#166534,#4ade80)',
    intro:'Tu as une nouvelle importante à partager ? Une mise à jour, un partenariat, un changement ? L\'Annonce permet d\'informer la communauté avec une date et un lien pour en savoir plus.',
    tags:['📋 Titre','💬 Message','📅 Date','🔗 Lien'],
    tip:'💡 Bien pour fidéliser et tenir ton audience informée.'
  },
  service: {
    emoji:'🛍️', name:'Service', color:'#60a5fa', btnBg:'linear-gradient(135deg,#1e40af,#60a5fa)',
    intro:'Tu vends une prestation ? Design, développement, coaching, rédaction… Propose tes compétences avec un tarif clair et un moyen de te contacter directement.',
    tags:['🔧 Prestation','💰 Tarif','⏱️ Délai','📩 Contact'],
    tip:'💡 Parfait pour trouver tes premiers clients.'
  },
  lancement: {
    emoji:'🚀', name:'Lancement', color:'#f87171', btnBg:'linear-gradient(135deg,#991b1b,#f87171)',
    intro:'C\'est le grand jour ! Annonce officiellement ton produit ou service avec tout le contexte : le problème que tu règles, ta solution, et le prix. Maximum d\'impact.',
    tags:['📦 Produit','❓ Problème résolu','✅ Solution','💵 Prix'],
    tip:'🔥 Le meilleur moyen de faire du bruit au lancement.'
  },
  collab: {
    emoji:'🤝', name:'Collab', color:'#c084fc', btnBg:'linear-gradient(135deg,#6b21a8,#c084fc)',
    intro:'Tu cherches un associé, un co-fondateur, un créateur de contenu ou un partenaire business ? Décris le profil idéal et les conditions de la collaboration.',
    tags:['👤 Profil recherché','🎯 Niche','📋 Conditions','📩 Contact'],
    tip:'💡 Des centaines de collabs naissent ici chaque mois.'
  },
  promo: {
    emoji:'🏷️', name:'Promo', color:'#fbbf24', btnBg:'linear-gradient(135deg,#92400e,#fbbf24)',
    intro:'Deal exclusif, code promo, réduction flash… Crée de l\'urgence avec une offre limitée dans le temps. Le prix barré et la date d\'expiration boostent les conversions.',
    tags:['🎁 Offre','💸 Prix barré','🔑 Code promo','⏳ Expiration'],
    tip:'⚡ Les promos génèrent 3x plus de clics en moyenne.'
  },
  sondage: {
    emoji:'📊', name:'Sondage', color:'#2dd4bf', btnBg:'linear-gradient(135deg,#134e4a,#2dd4bf)',
    intro:'Pose une question à la communauté et collecte des votes en temps réel. Parfait pour valider une idée, tester un nom de produit ou connaître les préférences de ton audience.',
    tags:['❓ Question','🔘 4 choix','⏱️ Durée','📈 Résultats live'],
    tip:'💡 Excellent pour la recherche de marché gratuite.'
  },
  tutoriel: {
    emoji:'🎓', name:'Tutoriel', color:'#86efac', btnBg:'linear-gradient(135deg,#14532d,#86efac)',
    intro:'Partage ton expertise ! Publie un guide pas-à-pas sur un sujet que tu maîtrises. Les tutoriels génèrent beaucoup d\'engagement et te positionnent comme expert.',
    tags:['📚 Sujet','🔢 Étapes','📶 Niveau','⏱️ Durée estimée'],
    tip:'💡 Les tutoriels font 5x plus de sauvegardes que les autres posts.'
  },
  recherche: {
    emoji:'🔍', name:'Recherche', color:'#a5b4fc', btnBg:'linear-gradient(135deg,#312e81,#a5b4fc)',
    intro:'Tu cherches un freelance, un outil, une ressource ou une recommandation ? Décris précisément ton besoin, ton budget et ton délai pour recevoir des propositions de la communauté.',
    tags:['📋 Besoin','💰 Budget','📅 Délai','📩 Contact'],
    tip:'💡 La communauté répond en moyenne en moins de 2h.'
  },
  resultat: {
    emoji:'🏆', name:'Résultat', color:'#fde68a', btnBg:'linear-gradient(135deg,#78350f,#fde68a)',
    intro:'Partage tes victoires et inspire la communauté ! Chiffres de ventes, abonnés gagnés, CA atteint… Montre ta progression et ce que tu as appris en chemin.',
    tags:['📈 Chiffres clés','📅 Période','💡 Apprentissages','🙏 Remerciements'],
    tip:'🏆 Les posts de résultats sont les plus partagés.'
  },
  campagne: {
    emoji:'🎯', name:'Campagne', color:'#ffd700', btnBg:'linear-gradient(135deg,#78350f,#ffd700)',
    intro:'Le format ultime pour une visibilité maximale. La Campagne combine objectif chiffré, vidéo de présentation et FAQ pour convaincre totalement. Parfait pour lever des fonds, lancer un gros produit ou chercher des investisseurs.',
    tags:['🎯 Objectif chiffré','🎬 Vidéo','❓ FAQ complète','🚀 Boost top feed'],
    tip:'🌟 Le format le plus impactant de la plateforme.'
  },
  'service-pro': {
    emoji:'🔧', name:'Service Pro', color:'#a855f7', btnBg:'linear-gradient(135deg,#4c1d95,#a855f7)',
    intro:'La vitrine professionnelle complète pour les freelances sérieux. Intègre un portfolio, des témoignages clients, des grilles tarifaires détaillées et un système de réservation.',
    tags:['🖼️ Portfolio','⭐ Témoignages','💰 Grille tarifaire','📅 Réservation'],
    tip:'💎 Pour se démarquer et justifier des tarifs premium.'
  },
  emploi: {
    emoji:'💼', name:"Offre d'emploi", color:'#60a5fa', btnBg:'linear-gradient(135deg,#1e3a8a,#60a5fa)',
    intro:'Recrute les meilleurs talents pour ton équipe ou ton projet. Décris le poste, les compétences requises, les conditions de travail (remote, présentiel) et la rémunération pour attirer les bons profils.',
    tags:['👤 Poste','🛠️ Compétences','🏠 Remote/Présentiel','💵 Rémunération'],
    tip:'💼 Trouve ton prochain collaborateur dans la communauté.'
  }
};

let _pendingPubType = null;

function previewPubType(type) {
  const info = PUB_TYPE_INFO[type];
  if (!info) { choosePubType(type); return; }

  _pendingPubType = type;

  // Highlight selected card
  document.querySelectorAll('.pub-type-card').forEach(c => c.classList.remove('ptc-selected'));
  const card = document.getElementById('ptc-' + type) || document.getElementById('ptc-' + type.replace('-','-'));
  if(card) card.classList.add('ptc-selected');

  const box = document.getElementById('pub-type-intro');
  document.getElementById('pub-intro-emoji').textContent = info.emoji;
  document.getElementById('pub-intro-title').textContent = info.name.toUpperCase();
  document.getElementById('pub-intro-title').style.color = info.color;
  document.getElementById('pub-intro-text').textContent = info.intro;

  // Tags
  const tagsEl = document.getElementById('pub-intro-tags');
  tagsEl.innerHTML = info.tags.map(t =>
    `<span style="font-size:10px;padding:3px 9px;border-radius:20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--g5);font-family:'DM Mono',monospace">${t}</span>`
  ).join('');

  // Confirm button
  const btn = document.getElementById('pub-intro-confirm');
  btn.style.background = info.btnBg;

  // Style the box border to match type color
  box.style.border = `1.5px solid ${info.color}30`;
  box.style.background = `linear-gradient(135deg,${info.color}08,transparent)`;

  // Add tip if needed
  if(info.tip) {
    document.getElementById('pub-intro-text').textContent = info.intro + '\n\n' + info.tip;
  }

  box.style.display = 'block';

  // Scroll intro into view smoothly
  setTimeout(()=>{ box.scrollIntoView({behavior:'smooth',block:'nearest'}); }, 100);
}

function confirmPubTypeChoice() {
  if(_pendingPubType) {
    choosePubType(_pendingPubType);
    _pendingPubType = null;
  }
}
</script>

<script>
// ── PUB TYPE CHOOSER (inline dans tab-publier) ──
function choosePubType(type){
  const plan = currentUser ? (currentUser.plan || 'free') : 'free';
  // All types are free now!
  // Hide chooser, show wizard
  const chooser = document.getElementById('pub-type-chooser');
  const wizard = document.getElementById('pub-wizard-content');
  const badge = document.getElementById('pub-type-badge');
  if(chooser) chooser.style.display = 'none';
  if(wizard) wizard.style.display = 'block';

  // Apply wizard config for this type
  applyWizardConfig(type);
  if(badge){
    const labels = {pub:'📢 PUB', annonce:'📣 ANNONCE', service:'🛍️ SERVICE', lancement:'🚀 LANCEMENT', collab:'🤝 COLLAB', promo:'🏷️ PROMO', sondage:'📊 SONDAGE', tutoriel:'🎓 TUTORIEL', recherche:'🔍 RECHERCHE', resultat:'🏆 RÉSULTAT', campagne:'🎯 CAMPAGNE', 'service-pro':'🔧 SERVICE PRO', emploi:'💼 OFFRE D\'EMPLOI'};
    badge.textContent = labels[type] || '';
  }
  window._currentPubType = type;
  if(type === 'campagne'){
    toast('🏆 Mode Campagne activé — maximum de visibilité !');
  } else if(type === 'annonce'){
    toast('📣 Mode Annonce activé !');
  }
}

function backToPubTypeChooser(){
  const chooser = document.getElementById('pub-type-chooser');
  const wizard = document.getElementById('pub-wizard-content');
  if(chooser) chooser.style.display = 'block';
  if(wizard) wizard.style.display = 'none';
  window._currentPubType = null;
  // Reset intro
  const intro = document.getElementById('pub-type-intro');
  if(intro) intro.style.display = 'none';
  document.querySelectorAll('.pub-type-card').forEach(c => c.classList.remove('ptc-selected'));
  _pendingPubType = null;
}

// Reset chooser when switching away and back to publier tab
const _origShowAppTab = showAppTab;
showAppTab = function(tab, el){
  if(tab === 'publier'){
    setTimeout(() => {
      const chooser = document.getElementById('pub-type-chooser');
      const wizard = document.getElementById('pub-wizard-content');
      if(chooser && wizard && !window._currentPubType){
        chooser.style.display = 'block';
        wizard.style.display = 'none';
        const intro = document.getElementById('pub-type-intro');
        if(intro) intro.style.display = 'none';
        document.querySelectorAll('.pub-type-card').forEach(c => c.classList.remove('ptc-selected'));
      }
    }, 50);
  }
  _origShowAppTab(tab, el);
};
</script>
</body>
</html>
