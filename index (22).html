<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ViralBoost — Publie ta publicité, touche ta cible</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#040a05;--bg2:#060e07;--s1:#0b1a0d;--s2:#0f2312;--s3:#142e17;
  --g1:#15803d;--g2:#16a34a;--g3:#22c55e;--g4:#4ade80;--g5:#86efac;--g6:#bbf7d0;
  --white:#f0fdf4;--muted:#4a7a58;--muted2:#2d5a3a;
  --border:rgba(34,197,94,0.15);--border2:rgba(34,197,94,0.08);--glow:rgba(34,197,94,0.08);
}
*{margin:0;padding:0;box-sizing:border-box;}
button,a,[onclick]{cursor:pointer !important;touch-action:manipulation;}
button{-webkit-appearance:none;}
html{scroll-behavior:smooth;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--white);overflow-x:hidden;}
#cursor{display:none;}
#cursor-ring{display:none;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(34,197,94,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(34,197,94,0.025) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}
.orb{position:fixed;border-radius:50%;filter:blur(120px);pointer-events:none;z-index:0;}
.o1{width:600px;height:600px;background:rgba(21,128,61,0.07);top:-200px;right:-100px;animation:drift 14s ease-in-out infinite alternate;}
.o2{width:400px;height:400px;background:rgba(74,222,128,0.04);bottom:-100px;left:-100px;animation:drift 18s ease-in-out infinite alternate-reverse;}
@keyframes drift{from{transform:translate(0,0)}to{transform:translate(40px,40px)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes bounce{0%,60%,100%{transform:translateY(0);opacity:.3}30%{transform:translateY(-6px);opacity:1}}
@keyframes toastIn{from{opacity:0;transform:translateX(50px)}to{opacity:1;transform:translateX(0)}}

#lang-switcher option{background:var(--s1);color:var(--white);}
#lang-switcher:hover{border-color:var(--g3);color:var(--g3);}
/* GOLD ELITE STYLES */
:root{--gold:#ffd700;--gold2:#ffb300;--gold3:#fff3b0;}
.elite-gold{color:var(--gold) !important;text-shadow:0 0 8px rgba(255,215,0,0.5);}
.btn-action.elite-action{border-color:var(--gold2)!important;color:var(--gold)!important;background:rgba(255,215,0,0.06)!important;box-shadow:0 0 8px rgba(255,215,0,0.15);}
.btn-action.elite-action:hover{box-shadow:0 0 16px rgba(255,215,0,0.3);}
.post-card.elite-post{border-color:rgba(255,215,0,0.25)!important;}
.plan-elite-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:2px;letter-spacing:1px;}

/* HERO AD BOX */
.hero-ad-box{background:rgba(22,163,74,0.06);border:2px solid rgba(22,163,74,0.25);border-radius:16px;padding:28px 32px;max-width:720px;width:100%;margin:0 auto 40px;animation:fadeUp 0.5s 0.1s ease both;}
.hero-ad-box h3{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:var(--g3);margin-bottom:12px;}
.hero-ad-form{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hero-ad-form input,.hero-ad-form select,.hero-ad-form textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.hero-ad-form input:focus,.hero-ad-form select:focus,.hero-ad-form textarea:focus{border-color:var(--g3);}
.hero-ad-form textarea{grid-column:1/-1;min-height:56px;resize:none;}
.hero-ad-form select option{background:var(--s1);}
.btn-hero-ad{grid-column:1/-1;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-hero-ad:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);}

/* PUBLIC FEED PREVIEW */
.public-feed-section{padding:60px 5% 80px;position:relative;z-index:1;}
.public-post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;margin-bottom:10px;transition:border-color 0.2s;}
.public-post-card:hover{border-color:rgba(34,197,94,0.2);}
.public-post-card.elite-pub{border-color:rgba(255,215,0,0.2);}
.public-feed-blur{position:relative;}
.public-feed-blur .feed-lock{position:absolute;bottom:0;left:0;right:0;height:180px;background:linear-gradient(transparent,var(--bg));display:flex;align-items:flex-end;justify-content:center;padding-bottom:20px;}
.btn-unlock-feed{padding:11px 28px;background:var(--g2);border:none;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);box-shadow:0 0 24px rgba(22,163,74,0.35);transition:all 0.2s;}
.btn-unlock-feed:hover{background:var(--g3);}

/* MEDIA UPLOAD */
.media-upload-area{border:2px dashed var(--border);border-radius:10px;padding:14px;margin:10px 0;cursor:pointer;transition:all 0.2s;text-align:center;}
.media-upload-area:hover{border-color:var(--g3);background:var(--glow);}
.media-upload-area input{display:none;}
.media-preview-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
.media-preview-item{position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;border:1.5px solid var(--border);}
.media-preview-item img,.media-preview-item video{width:100%;height:100%;object-fit:cover;}
.media-preview-item .rm-media{position:absolute;top:2px;right:2px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;color:#fff;font-size:9px;display:flex;align-items:center;justify-content:center;}
.file-chip{display:flex;align-items:center;gap:6px;background:var(--s2);border:1px solid var(--border);border-radius:5px;padding:4px 10px;font-size:11px;color:var(--g4);}

/* GROUP CHAT */
.group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;cursor:pointer;}
.group-card:hover{border-color:rgba(34,197,94,0.25);}
.group-card.elite-group{border-color:rgba(255,215,0,0.2);}
.group-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.group-icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.group-title{font-size:14px;font-weight:700;}
.group-desc{font-size:12px;color:var(--muted);margin-bottom:6px;}
.group-meta{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);display:flex;align-items:center;gap:10px;}

/* GROUP SETTINGS (ELITE) */
.group-settings-section{background:var(--s2);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:18px;margin-bottom:14px;}
.group-settings-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.toggle-row label{font-size:12px;color:var(--g5);}
.toggle{position:relative;width:38px;height:20px;cursor:pointer;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:var(--muted2);border-radius:20px;transition:0.3s;}
.toggle-slider::before{content:'';position:absolute;width:14px;height:14px;left:3px;top:3px;background:#fff;border-radius:50%;transition:0.3s;}
.toggle input:checked+.toggle-slider{background:var(--g2);}
.toggle input:checked+.toggle-slider::before{transform:translateX(18px);}

/* WALLPAPER */
#app.has-wallpaper{background-size:cover;background-position:center;background-attachment:fixed;}
#app.has-wallpaper .app-bar{background:rgba(4,10,5,0.85);}
#app.has-wallpaper .tpanel{background:rgba(4,10,5,0.5);border-radius:12px;}

/* REPORT MODAL */
.report-reason{display:flex;flex-direction:column;gap:8px;margin:12px 0;}
.report-reason label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--g5);cursor:pointer;}
.report-reason input[type=radio]{accent-color:var(--g3);}

/* ADMIN MSG BADGE */
.admin-msg-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:200;padding:0 5%;height:66px;display:flex;align-items:center;justify-content:space-between;background:rgba(4,10,5,0.92);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:3px;color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.35);position:relative;z-index:1;}
.logo span{color:var(--white);}
.nav-links{display:flex;gap:28px;}
.nav-links a{font-size:13px;font-weight:500;color:var(--muted);text-decoration:none;letter-spacing:0.5px;transition:color 0.2s;position:relative;z-index:1;}
.nav-links a:hover{color:var(--g3);}
.nav-right{display:flex;gap:10px;align-items:center;}
.btn-g{padding:9px 22px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;letter-spacing:0.3px;}
.btn-ghost-g{background:transparent;border:1.5px solid var(--border);color:var(--g3);}
.btn-ghost-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-solid-g:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);transform:translateY(-1px);}

/* HERO */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:100px 5% 80px;position:relative;z-index:1;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.25);border-radius:4px;padding:7px 16px;font-size:12px;font-weight:600;color:var(--g4);margin-bottom:32px;letter-spacing:1px;text-transform:uppercase;animation:fadeUp 0.6s ease both;}
.pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--g3);box-shadow:0 0 8px var(--g3);animation:blink 1.8s infinite;flex-shrink:0;}
.hero-concept{background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:12px;padding:18px 28px;margin-bottom:36px;max-width:660px;animation:fadeUp 0.6s 0.08s ease both;}
.hero-concept p{font-size:15px;color:var(--g5);line-height:1.8;font-weight:400;}
.hero-concept p strong{color:var(--g3);}
.hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(72px,12vw,148px);letter-spacing:2px;line-height:1;margin-bottom:20px;animation:fadeUp 0.6s 0.12s ease both;}
.hero h1 .line1{display:inline;color:var(--white);}
.hero h1 .line2{display:inline;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.35);}
.hero-sub{font-size:16px;color:var(--muted);max-width:500px;line-height:1.8;margin-bottom:44px;animation:fadeUp 0.6s 0.18s ease both;}
.hero-actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:18px;animation:fadeUp 0.6s 0.24s ease both;}
.btn-hero-big{padding:15px 38px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;transition:all 0.3s;letter-spacing:0.3px;}
.btn-hero-solid{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 36px rgba(22,163,74,0.35);}
.btn-hero-solid:hover{background:var(--g3);box-shadow:0 0 70px rgba(22,163,74,0.55);transform:translateY(-2px);}
.btn-hero-out{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-hero-out:hover{border-color:var(--g3);background:var(--glow);}
.hero-note{font-size:13px;color:var(--muted2);animation:fadeUp 0.6s 0.3s ease both;}
.hero-note span{color:var(--g4);}
.how-simple{display:flex;gap:0;justify-content:center;max-width:860px;width:100%;animation:fadeUp 0.6s 0.36s ease both;}
.how-step-simple{flex:1;text-align:center;padding:24px 18px;border:1px solid var(--border2);position:relative;}
.how-step-simple+.how-step-simple{border-left:none;}
.how-step-simple::before{content:attr(data-n);position:absolute;top:10px;left:12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);letter-spacing:1px;}
.step-icon{font-size:26px;margin-bottom:10px;}
.how-step-simple h4{font-size:13px;font-weight:700;color:var(--g3);margin-bottom:5px;}
.how-step-simple p{font-size:12px;color:var(--muted);line-height:1.6;}

/* SECTION HELPERS */
.sec-label{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;display:block;}
h2.section-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(36px,5vw,60px);letter-spacing:2px;color:var(--white);margin-bottom:8px;}
h2.section-title em{color:var(--g3);font-style:normal;}
.section-sub{color:var(--muted);font-size:15px;margin-bottom:48px;max-width:480px;}

/* VITRINE */
.vitrine-section{padding:100px 5%;position:relative;z-index:1;}
.filters-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px;}
.f-btn{padding:7px 18px;border-radius:4px;border:1.5px solid var(--border2);background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;}
.f-btn:hover,.f-btn.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.vitrine-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
.v-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer;}
.v-card:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-3px);box-shadow:0 16px 48px rgba(0,0,0,0.4);}
.v-banner{height:110px;display:flex;align-items:center;justify-content:center;font-size:42px;position:relative;}
.v-banner::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,transparent 40%,var(--s1));}
.v-body{padding:16px 18px;}
.v-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.v-name{font-size:15px;font-weight:700;margin-bottom:5px;}
.v-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:12px;}
.v-footer{display:flex;align-items:center;justify-content:space-between;}
.v-author{display:flex;align-items:center;gap:7px;font-size:12px;color:var(--muted);}
.v-ava{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--bg);background:var(--g2);}
.v-actions{display:flex;align-items:center;gap:5px;}
.btn-vote-g{display:flex;align-items:center;gap:4px;background:transparent;border:1.5px solid var(--border2);border-radius:4px;padding:4px 10px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'DM Mono',monospace;}
.btn-vote-g:hover,.btn-vote-g.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.btn-dm-small{background:transparent;border:1.5px solid var(--border2);border-radius:4px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;}
.btn-dm-small:hover{border-color:var(--g3);background:var(--glow);}
.v-badge{position:absolute;top:8px;left:8px;background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;letter-spacing:1px;z-index:2;border-radius:2px;}

/* PLANS */
.plans-section{padding:100px 5%;position:relative;z-index:1;background:linear-gradient(180deg,transparent,var(--bg2),transparent);}
.plans-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:16px;}
.plan-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:28px 20px;position:relative;transition:all 0.3s;}
.plan-card:hover{background:var(--s2);border-color:rgba(34,197,94,0.35);transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,0,0,0.4);}
.plan-card.recommended{background:var(--s2);border:1.5px solid var(--g3);border-top:3px solid var(--g3);}
.plan-badge{position:absolute;top:-1px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:9px;font-weight:700;padding:3px 10px;letter-spacing:1px;white-space:nowrap;}
.plan-name{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;}
.plan-card.recommended .plan-name{color:var(--g3);}
.plan-price{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--white);letter-spacing:-1px;line-height:1;}
.plan-card.recommended .plan-price{color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.3);}
.plan-period{font-size:12px;color:var(--muted);margin:3px 0 14px;}
.plan-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:16px;min-height:40px;}
.plan-features{list-style:none;margin-bottom:24px;}
.plan-features li{font-size:12px;color:#5a8a68;padding:6px 0;border-bottom:1px solid var(--border2);display:flex;align-items:flex-start;gap:7px;line-height:1.5;}
.plan-features li:last-child{border:none;}
.plan-features li::before{content:'✓';color:var(--g3);font-size:10px;font-weight:700;flex-shrink:0;margin-top:2px;}
.plan-features li.no::before{content:'✗';color:var(--muted2);}
.plan-features li.no{color:var(--muted2);}
.btn-plan-g{width:100%;padding:11px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;}
.btn-plan-outline-g{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-plan-outline-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-plan-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 16px rgba(22,163,74,0.3);}
.btn-plan-solid-g:hover{background:var(--g3);}

/* REVIEWS */
.reviews-section{padding:100px 5%;position:relative;z-index:1;}
.reviews-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.rev-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:22px;transition:all 0.2s;}
.rev-card:hover{border-color:rgba(34,197,94,0.25);}
.rev-stars{color:var(--g3);font-size:12px;margin-bottom:10px;letter-spacing:2px;}
.rev-text{font-size:13px;color:#6a9478;line-height:1.8;margin-bottom:16px;}
.rev-text strong{color:var(--g4);}
.rev-author{display:flex;align-items:center;gap:10px;}
.rev-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.rev-name{font-size:13px;font-weight:700;}
.rev-handle{font-size:11px;color:var(--muted);}
.rev-result{font-size:11px;color:var(--g3);font-weight:600;margin-top:1px;}

/* CTA / FOOTER */
.cta-section{padding:100px 5%;text-align:center;position:relative;z-index:1;border-top:1px solid var(--border2);}
.cta-section h2{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,8vw,96px);letter-spacing:2px;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.3);margin-bottom:14px;}
.cta-section p{color:var(--muted);font-size:15px;margin-bottom:36px;}
footer{background:var(--bg2);border-top:1px solid var(--border2);padding:28px 5%;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:14px;position:relative;z-index:1;}
.footer-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;}
footer p{color:var(--muted);font-size:11px;font-family:'DM Mono',monospace;}

/* MODALS */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(4,10,5,0.92);backdrop-filter:blur(16px);z-index:500;align-items:center;justify-content:center;padding:16px;overflow-y:auto;}
.modal-bg.open{display:flex;animation:fadeIn 0.2s ease;}
.modal{background:var(--s1);border:1.5px solid var(--border);border-radius:16px;padding:36px;width:100%;max-width:480px;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);max-height:90vh;overflow-y:auto;}
.modal.wide{max-width:900px;}
.modal::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:60%;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);border-radius:100px;}
.modal-close{position:absolute;top:12px;right:12px;background:rgba(22,163,74,0.08);border:1.5px solid var(--border);border-radius:50%;width:28px;height:28px;cursor:pointer;color:var(--muted);font-size:12px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.modal-close:hover{border-color:var(--g3);color:var(--g3);}
.modal h2{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;color:var(--g3);margin-bottom:3px;}
.modal-sub{color:var(--muted);font-size:11px;margin-bottom:22px;font-family:'DM Mono',monospace;letter-spacing:1px;}
.fg{margin-bottom:12px;}
label{display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:4px;letter-spacing:1.5px;text-transform:uppercase;}
input,select,textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
input:focus,select:focus,textarea:focus{border-color:var(--g3);box-shadow:0 0 10px rgba(34,197,94,0.08);}
select option{background:var(--s1);}
textarea{resize:vertical;min-height:68px;}
.btn-modal-g{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;margin-top:6px;box-shadow:0 0 18px rgba(22,163,74,0.28);}
.btn-modal-g:hover{background:var(--g3);}
.btn-modal-g:disabled{opacity:0.4;cursor:not-allowed;}
.modal-switch{text-align:center;margin-top:12px;font-size:13px;color:var(--muted);}
.modal-switch a{color:var(--g3);cursor:pointer;font-weight:600;}

/* SIGNUP PLANS */
.signup-plans{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:18px;}
.sp-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative;}
.sp-card:hover,.sp-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.sp-card.selected::after{content:'✓';position:absolute;top:5px;right:7px;color:var(--g3);font-size:10px;font-weight:700;}
.sp-plan{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px;}
.sp-price{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--g3);line-height:1;}
.sp-per{font-size:9px;color:var(--muted);}
.sp-feat{font-size:10px;color:#4a7a58;margin-top:5px;line-height:1.5;}

/* PAYMENT */
.pay-sum{background:rgba(22,163,74,0.07);border:1.5px solid rgba(22,163,74,0.18);border-radius:10px;padding:16px;text-align:center;margin-bottom:16px;}
.pay-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pay-price{font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--g3);}
.pay-period{font-size:11px;color:var(--muted);}
#card-element{background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:8px;padding:12px;margin-bottom:5px;}
#card-errors{color:#f87171;font-size:11px;min-height:14px;margin-bottom:7px;font-family:'DM Mono',monospace;}

/* APP BAR */
#app{display:none;min-height:100vh;}
.app-bar{background:rgba(4,10,5,0.96);border-bottom:1px solid var(--border2);padding:0 2%;height:60px;display:flex;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(24px);}
.app-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;text-shadow:0 0 12px rgba(74,222,128,0.35);margin-right:24px;white-space:nowrap;flex-shrink:0;}
.app-tabs{display:flex;flex:1;overflow-x:auto;gap:0;scrollbar-width:none;}
.app-tabs::-webkit-scrollbar{display:none;}
.app-tab{padding:0 14px;height:60px;display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.app-tab:hover{color:var(--white);}
.app-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.notif-dot{width:5px;height:5px;background:var(--g3);border-radius:50%;margin-top:-10px;margin-left:-3px;box-shadow:0 0 5px var(--g3);flex-shrink:0;}
.app-right{margin-left:auto;display:flex;align-items:center;gap:7px;flex-shrink:0;padding-left:12px;}
.plan-chip{background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:1px;}
.user-chip{display:flex;align-items:center;gap:7px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:4px 10px;cursor:pointer;transition:all 0.2s;}
.user-chip:hover{border-color:var(--g3);}
.user-chip-ava{width:24px;height:24px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.user-chip-name{font-size:12px;font-weight:600;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-out-g{background:transparent;border:1.5px solid var(--border2);border-radius:5px;padding:5px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-out-g:hover{border-color:#f87171;color:#f87171;}

/* APP PANELS */
.tpanel{display:none;}
.tpanel.active{display:block;animation:fadeUp 0.22s ease;}

/* PUBLISH BOX */
.publish-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;margin-bottom:18px;}
.publish-top{display:flex;gap:10px;align-items:flex-start;margin-bottom:12px;}
.pub-ava{width:34px;height:34px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;}
.pub-text{width:100%;background:transparent;border:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);resize:none;outline:none;min-height:60px;line-height:1.6;}
.pub-text::placeholder{color:var(--muted);}
.pub-meta{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;}
.pub-actions{display:flex;justify-content:space-between;align-items:center;border-top:1px solid var(--border2);padding-top:10px;}
.pub-limit{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);}
.btn-publish{background:var(--g2);border:none;border-radius:6px;padding:8px 20px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-publish:hover{background:var(--g3);box-shadow:0 0 16px rgba(22,163,74,0.3);}
.btn-publish:disabled{opacity:0.4;cursor:not-allowed;}

/* FEED */
.feed-tabs{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border2);}
.feed-tab{padding:9px 18px;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;}
.feed-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;margin-bottom:12px;transition:border-color 0.2s;}
.post-card:hover{border-color:rgba(34,197,94,0.2);}
.post-header{display:flex;align-items:center;gap:9px;margin-bottom:12px;}
.post-ava{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;cursor:pointer;}
.post-meta{flex:1;}
.post-author{font-size:14px;font-weight:700;cursor:pointer;transition:color 0.2s;}
.post-author:hover{color:var(--g3);}
.post-info{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-plan-badge{font-family:'DM Mono',monospace;font-size:8px;padding:1px 5px;border-radius:2px;letter-spacing:0.5px;}
.plan-free{background:rgba(107,114,128,0.2);color:#9ca3af;}
.plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.plan-elite{background:rgba(74,222,128,0.2);color:var(--g3);box-shadow:0 0 5px rgba(74,222,128,0.2);}
.post-content{font-size:14px;line-height:1.7;color:#c4d9cb;margin-bottom:12px;}
.post-project{background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:12px;margin-bottom:12px;display:flex;gap:10px;align-items:center;transition:all 0.2s;}
.post-project:hover{border-color:rgba(34,197,94,0.22);}
.post-proj-icon{font-size:26px;width:42px;height:42px;background:var(--s3);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.post-proj-name{font-size:13px;font-weight:700;margin-bottom:2px;}
.post-proj-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px;text-transform:uppercase;}
.post-proj-desc{font-size:11px;color:var(--muted);margin-top:3px;}
.post-timer{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.15);border-radius:3px;padding:2px 7px;display:inline-flex;align-items:center;gap:3px;}
.post-actions{display:flex;gap:5px;align-items:center;flex-wrap:wrap;}
.btn-action{background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);transition:all 0.2s;display:flex;align-items:center;gap:4px;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-action:hover{border-color:var(--g3);color:var(--g3);}
.btn-action.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}

/* WORLD CHAT PANEL */
.chat-panel-container{max-width:740px;margin:0 auto;padding:24px 0;}
.chat-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;display:flex;flex-direction:column;height:500px;}
.chat-msgs-area{flex:1;overflow-y:auto;padding:18px;display:flex;flex-direction:column;gap:9px;}
.chat-msgs-area::-webkit-scrollbar{width:3px;}
.chat-msgs-area::-webkit-scrollbar-thumb{background:var(--muted2);border-radius:2px;}
.chat-msg-item{background:var(--s2);border-radius:8px;padding:8px 11px;}
.chat-msg-name{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:2px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-text{font-size:13px;color:#7a9a82;line-height:1.5;}
.chat-input-row{padding:12px 14px;border-top:1px solid var(--border2);display:flex;gap:7px;}
.chat-input-field{flex:1;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.chat-input-field:focus{border-color:var(--g3);}
.btn-send{background:var(--g2);border:none;border-radius:7px;width:38px;height:38px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-send:hover{background:var(--g3);}

/* PROFILE */
.profile-banner{height:160px;background:linear-gradient(135deg,var(--s2),var(--s3));border-radius:12px;position:relative;margin-bottom:52px;}
.profile-avatar{position:absolute;bottom:-40px;left:22px;width:80px;height:80px;border-radius:50%;border:3px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.25);}
.profile-edit-btn{position:absolute;top:14px;right:14px;background:rgba(4,10,5,0.7);border:1.5px solid var(--border);border-radius:6px;padding:6px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.profile-edit-btn:hover{border-color:var(--g3);color:var(--g3);}
.profile-info{padding:0 22px;}
.profile-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1px;margin-bottom:2px;}
.profile-handle{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);margin-bottom:9px;display:flex;align-items:center;gap:8px;}
.profile-bio{font-size:13px;color:var(--muted);line-height:1.7;max-width:600px;margin-bottom:14px;}
.profile-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.profile-tag{background:rgba(22,163,74,0.08);border:1px solid rgba(22,163,74,0.18);border-radius:3px;padding:2px 9px;font-size:10px;color:var(--g4);font-family:'DM Mono',monospace;}
.profile-stats{display:flex;gap:20px;margin-bottom:16px;}
.pstat{text-align:center;}
.pstat-num{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3);}
.pstat-label{font-size:10px;color:var(--muted);}
.profile-links{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
.profile-link{display:flex;align-items:center;gap:5px;background:var(--s1);border:1.5px solid var(--border2);border-radius:5px;padding:5px 10px;font-size:11px;color:var(--muted);text-decoration:none;transition:all 0.2s;cursor:pointer;}
.profile-link:hover{border-color:var(--g3);color:var(--g3);}
.profile-fields{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0;padding:16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;}
.pfield{display:flex;flex-direction:column;gap:2px;}
.pfield-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);letter-spacing:1.5px;text-transform:uppercase;}
.pfield-value{font-size:12px;color:var(--white);}
.profile-actions{display:flex;gap:7px;margin-bottom:20px;}
.btn-follow{background:var(--g2);border:none;border-radius:6px;padding:8px 20px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-follow:hover{background:var(--g3);}
.btn-follow.following{background:transparent;border:1.5px solid var(--border);color:var(--muted);}
.btn-dm-profile{background:transparent;border:1.5px solid var(--border);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;}
.btn-dm-profile:hover{border-color:var(--g3);color:var(--g3);}

/* EDIT PROFILE */
.edit-section{background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:20px;margin-bottom:12px;}
.edit-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.edit-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.edit-avatar-row{display:flex;align-items:center;gap:14px;margin-bottom:14px;}
.edit-avatar-big{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;color:var(--bg);flex-shrink:0;}
.emoji-picker{display:flex;gap:6px;flex-wrap:wrap;}
.emoji-opt{width:32px;height:32px;border-radius:50%;border:2px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all 0.2s;}
.emoji-opt:hover,.emoji-opt.selected{border-color:var(--g3);background:rgba(22,163,74,0.1);}

/* DM */
.dm-thread{display:flex;flex-direction:column;height:380px;}
.dm-msgs{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:7px;padding-bottom:6px;}
.dm-msg{display:flex;flex-direction:column;max-width:75%;}
.dm-msg.mine{align-self:flex-end;align-items:flex-end;}
.dm-msg.theirs{align-self:flex-start;}
.dm-bubble-g{padding:9px 13px;border-radius:12px;font-size:13px;line-height:1.5;}
.dm-msg.mine .dm-bubble-g{background:var(--g2);color:var(--bg);border-bottom-right-radius:3px;}
.dm-msg.theirs .dm-bubble-g{background:var(--s2);border:1px solid var(--border2);border-bottom-left-radius:3px;}
.dm-time{font-size:9px;color:var(--muted);margin-top:2px;font-family:'DM Mono',monospace;}
.dm-input-row{display:flex;gap:7px;margin-top:10px;border-top:1px solid var(--border2);padding-top:10px;}

/* ELITE GOLD ACTIONS */
.elite-action { border-color: #d4af37 !important; color: #f5c842 !important; background: rgba(212,175,55,0.08) !important; }
.elite-action:hover { border-color: #f5c842 !important; box-shadow: 0 0 12px rgba(212,175,55,0.3) !important; }
.elite-action.active { background: rgba(212,175,55,0.15) !important; }
.plan-elite-action { border-color: #d4af37 !important; color: #f5c842 !important; }
.badge-elite-gold { color: #f5c842; text-shadow: 0 0 8px rgba(212,175,55,0.5); }

/* GROUP CARDS */
.group-card { background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer; }
.group-card:hover { border-color:rgba(34,197,94,0.35);transform:translateY(-2px);box-shadow:0 12px 36px rgba(0,0,0,0.4); }
.group-banner { height:90px;display:flex;align-items:center;justify-content:center;font-size:36px;position:relative;background:linear-gradient(135deg,var(--s2),var(--s3)); }
.group-body { padding:14px 16px; }
.group-name { font-size:15px;font-weight:700;margin-bottom:4px; }
.group-desc { font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:10px; }
.group-footer { display:flex;align-items:center;justify-content:space-between; }
.group-meta { font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2); }

/* MEDIA PREVIEW */
.media-preview-item { display:flex;align-items:center;gap:8px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:8px 12px;margin-top:6px;font-size:12px;color:var(--muted); }
.media-preview-item img, .media-preview-item video { max-width:100px;max-height:70px;border-radius:4px;object-fit:cover; }
.media-preview-item .remove-media { cursor:pointer;color:#f87171;margin-left:auto; }

/* POST MEDIA */
.post-media { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px;object-fit:cover; }
.post-media-video { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px; }

/* REPORT BTN */
.btn-report { background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 10px;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif; }
.btn-report:hover { border-color:#f87171;color:#f87171; }

/* CONTACT ADMIN BTN (ELITE in profile) */
.btn-contact-admin { background:linear-gradient(135deg,rgba(212,175,55,0.15),rgba(245,200,66,0.1));border:1.5px solid rgba(212,175,55,0.4);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:#f5c842;transition:all 0.2s; }
.btn-contact-admin:hover { border-color:#f5c842;box-shadow:0 0 12px rgba(212,175,55,0.25); }
.follow-list{display:flex;flex-direction:column;gap:7px;}
.follow-item{display:flex;align-items:center;gap:9px;padding:10px 12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;transition:all 0.2s;}
.follow-item:hover{border-color:rgba(34,197,94,0.2);}
.follow-item-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;}
.follow-item-name{font-size:13px;font-weight:700;flex:1;}
.follow-item-sub{font-size:11px;color:var(--muted);}
.btn-dm-list{background:transparent;border:1.5px solid var(--border2);border-radius:5px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;flex-shrink:0;}
.btn-dm-list:hover{border-color:var(--g3);}
.btn-follow-list{background:var(--g2);border:none;border-radius:5px;padding:5px 10px;font-size:11px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-follow-list:hover{background:var(--g3);}
.btn-follow-list.following{background:transparent;border:1px solid var(--border);color:var(--muted);}

/* IA BOOST */
.boost-type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:0;}
.boost-type-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:8px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;font-size:22px;}
.boost-type-card:hover,.boost-type-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.boost-type-card span{display:block;font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;}
.boost-type-card.selected span{color:var(--g3);}

/* UPGRADE */
.upgrade-strip{background:rgba(22,163,74,0.05);border:1.5px solid rgba(22,163,74,0.14);border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:14px;}
.upgrade-strip h4{font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px;}
.upgrade-strip p{font-size:11px;color:var(--muted);}

/* DOTS */
.dots{display:inline-flex;gap:3px;align-items:center;}
.dots span{width:5px;height:5px;border-radius:50%;background:var(--g3);animation:bounce 1.2s ease infinite;}
.dots span:nth-child(2){animation-delay:.2s;}
.dots span:nth-child(3){animation-delay:.4s;}

/* TOAST */
#toast-container{position:fixed;bottom:22px;right:22px;z-index:9999;display:flex;flex-direction:column;gap:7px;pointer-events:none;}
.toast-g{background:var(--s2);border:1.5px solid var(--border);border-radius:10px;padding:11px 16px;font-size:13px;font-weight:600;color:var(--white);display:flex;align-items:center;gap:7px;box-shadow:0 8px 30px rgba(0,0,0,0.5);pointer-events:auto;animation:toastIn 0.4s ease both;min-width:200px;}
.toast-g.success{border-color:rgba(22,163,74,0.4);}

/* RESPONSIVE */
@media(max-width:900px){.vitrine-grid,.reviews-grid,.plans-grid,.signup-plans{grid-template-columns:1fr 1fr;}.profile-fields{grid-template-columns:1fr 1fr;}.edit-grid{grid-template-columns:1fr;}.how-simple{flex-direction:column;}.nav-links{display:none;}}
@media(max-width:600px){.vitrine-grid,.reviews-grid,.plans-grid,.signup-plans,.boost-type-grid{grid-template-columns:1fr;}.profile-fields{grid-template-columns:1fr;}}
/* ── OFFRE 100 PREMIERS ── */
#offer-popup{position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);}
#offer-popup.hidden{display:none;}
.offer-box{background:linear-gradient(135deg,#061a08,#0a2a0d);border:2px solid rgba(34,197,94,0.45);border-radius:20px;padding:24px 26px;max-width:360px;width:92%;text-align:center;box-shadow:0 0 60px rgba(34,197,94,0.18);position:relative;}
.offer-crown{font-size:36px;margin-bottom:4px;}
.offer-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;background:linear-gradient(135deg,#4ade80,#86efac);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:3px;}
.offer-sub{font-size:11px;color:#4a7a58;margin-bottom:12px;font-family:'DM Mono',monospace;}
.offer-badge{display:inline-block;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;margin-bottom:12px;letter-spacing:1px;}
.offer-desc{font-size:12px;color:#e8fef0;line-height:1.6;margin-bottom:14px;}
.offer-desc strong{color:#4ade80;}
.offer-counter{background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:12px;padding:14px;margin-bottom:22px;}
.offer-counter-num{font-family:'Bebas Neue',sans-serif;font-size:34px;color:#4ade80;line-height:1;}
.offer-counter-lbl{font-size:11px;color:#4a7a58;font-family:'DM Mono',monospace;margin-top:3px;}
.offer-cta{width:100%;padding:11px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:800;cursor:pointer;letter-spacing:1px;margin-bottom:8px;transition:.2s;}
.offer-cta:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(34,197,94,0.3);}
.offer-skip{font-size:11px;color:#2d5a38;cursor:pointer;text-decoration:underline;}
.offer-close-btn{position:absolute;top:12px;right:14px;background:none;border:none;color:#2d5a38;font-size:20px;cursor:pointer;line-height:1;padding:4px;transition:.2s;}
.offer-close-btn:hover{color:#4ade80;}
.offer-timer{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:8px 12px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:12px;color:#f87171;}
.offer-timer span{font-weight:800;font-size:14px;}
.offer-full{background:rgba(234,179,8,0.08);border:1px solid rgba(234,179,8,0.25);border-radius:12px;padding:20px;text-align:center;max-width:460px;width:92%;}

/* ══ NOUVELLES AMÉLIORATIONS ══ */

/* COMPTEUR SOCIAL LIVE */
.social-proof-bar{display:flex;align-items:center;justify-content:center;gap:24px;padding:12px 20px;background:rgba(22,163,74,0.05);border:1px solid rgba(22,163,74,0.1);border-radius:12px;margin-bottom:28px;flex-wrap:wrap;animation:fadeUp 0.6s 0.3s ease both;}
.social-proof-item{display:flex;align-items:center;gap:7px;font-size:12px;font-weight:600;color:var(--g5);}
.social-proof-num{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3);line-height:1;}
.social-proof-divider{width:1px;height:28px;background:var(--border);}
@keyframes countUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.social-proof-num.animate{animation:countUp 0.5s ease both;}

/* HERO MOTS DÉFILANTS */
.hero-rotating-word{display:inline-block;color:var(--g3);text-shadow:0 0 30px rgba(74,222,128,0.3);position:relative;}
.hero-rotating-word::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);animation:lineSlide 3s ease infinite;}
@keyframes lineSlide{0%,100%{opacity:0;transform:scaleX(0)}30%,70%{opacity:1;transform:scaleX(1)}}
@keyframes wordFade{0%{opacity:0;transform:translateY(-12px)}10%,80%{opacity:1;transform:translateY(0)}90%,100%{opacity:0;transform:translateY(12px)}}
.word-loop{display:inline-block;overflow:hidden;height:1.1em;vertical-align:bottom;}
.word-loop span{display:block;animation:wordFade 3s ease infinite;}

/* TRENDING BAR */
.trending-bar{background:rgba(22,163,74,0.04);border-top:1px solid var(--border2);border-bottom:1px solid var(--border2);padding:10px 5%;display:flex;align-items:center;gap:12px;overflow:hidden;position:relative;z-index:1;}
.trending-label{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;white-space:nowrap;flex-shrink:0;}
.trending-scroll{display:flex;gap:20px;animation:trendingScroll 28s linear infinite;white-space:nowrap;}
.trending-scroll:hover{animation-play-state:paused;}
@keyframes trendingScroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.trending-item{font-size:12px;color:var(--muted);cursor:pointer;transition:color 0.2s;display:inline-flex;align-items:center;gap:5px;}
.trending-item:hover{color:var(--g3);}
.trend-rank{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);}

/* SKELETON LOADER */
@keyframes shimmer{0%{background-position:-400px 0}100%{background-position:400px 0}}
.skeleton{background:linear-gradient(90deg,var(--s1) 25%,var(--s2) 50%,var(--s1) 75%);background-size:800px 100%;animation:shimmer 1.6s infinite;}
.skeleton-card{border-radius:12px;padding:18px;border:1.5px solid var(--border2);margin-bottom:12px;}
.skeleton-line{height:12px;border-radius:6px;margin-bottom:8px;}
.skeleton-line.short{width:40%;}
.skeleton-line.medium{width:70%;}
.skeleton-circle{width:36px;height:36px;border-radius:50%;flex-shrink:0;}

/* SEARCH BAR IN APP */
.app-search-bar{display:flex;align-items:center;gap:8px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;transition:all 0.2s;max-width:220px;}
.app-search-bar:focus-within{border-color:var(--g3);max-width:280px;}
.app-search-bar input{background:none;border:none;outline:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;color:var(--white);width:100%;}
.app-search-bar input::placeholder{color:var(--muted);}
.search-results-dropdown{position:absolute;top:100%;left:0;right:0;background:var(--s1);border:1.5px solid var(--border);border-radius:10px;padding:8px;z-index:500;max-height:300px;overflow-y:auto;box-shadow:0 16px 40px rgba(0,0,0,0.5);display:none;margin-top:4px;}
.search-result-item{padding:8px 10px;border-radius:6px;cursor:pointer;transition:background 0.15s;display:flex;align-items:center;gap:8px;font-size:12px;}
.search-result-item:hover{background:var(--s2);}

/* ONBOARDING TOOLTIP */
.onboarding-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:8000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.onboarding-box{background:linear-gradient(135deg,#061a08,#0a2a0d);border:2px solid rgba(34,197,94,0.4);border-radius:20px;padding:28px 30px;max-width:420px;width:92%;animation:popIn 0.3s ease both;}
.onboarding-box h2{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--g3);margin-bottom:4px;}
.onboarding-step-list{display:flex;flex-direction:column;gap:12px;margin:18px 0;}
.onboarding-step{display:flex;align-items:center;gap:12px;background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.15);border-radius:10px;padding:12px 14px;cursor:pointer;transition:all 0.2s;}
.onboarding-step:hover{border-color:var(--g3);background:rgba(22,163,74,0.1);}
.onboarding-step-num{width:28px;height:28px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--bg);flex-shrink:0;}
.onboarding-step-text{font-size:13px;font-weight:600;color:var(--g5);}
.onboarding-step-sub{font-size:11px;color:var(--muted);margin-top:1px;}

/* PASSWORD STRENGTH */
.pass-strength-bar{display:flex;gap:3px;margin-top:5px;height:3px;}
.pass-strength-bar span{flex:1;border-radius:2px;background:var(--s2);transition:background 0.3s;}
.pass-strength-bar span.active.weak{background:#f87171;}
.pass-strength-bar span.active.medium{background:#fbbf24;}
.pass-strength-bar span.active.strong{background:var(--g3);}
.pass-strength-label{font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace;}

/* SIGNUP SOCIAL PROOF */
.signup-social-proof{display:flex;align-items:center;gap:-8px;margin-bottom:16px;}
.signup-ava-stack{display:flex;}
.signup-ava-stack span{width:28px;height:28px;border-radius:50%;border:2px solid var(--s1);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg);margin-left:-8px;}
.signup-ava-stack span:first-child{margin-left:0;}
.signup-proof-text{margin-left:10px;font-size:12px;color:var(--g5);font-weight:600;}
.signup-proof-text strong{color:var(--g3);}

/* STEPS HIGHLIGHT on scroll */
.how-step-simple{transition:all 0.4s;opacity:0.55;}
.how-step-simple.visible{opacity:1;}
.how-step-simple.visible .step-icon{transform:scale(1.1);filter:drop-shadow(0 0 12px var(--g3));}

/* TRENDING in FEED */
.trending-posts-section{background:rgba(22,163,74,0.04);border:1.5px solid rgba(22,163,74,0.12);border-radius:12px;padding:14px 16px;margin-bottom:18px;}
.trending-posts-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:1.5px;}
.trending-mini-post{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border2);cursor:pointer;transition:all 0.15s;}
.trending-mini-post:last-child{border-bottom:none;padding-bottom:0;}
.trending-mini-post:hover{padding-left:4px;}
.trending-mini-rank{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--muted2);width:20px;flex-shrink:0;}
.trending-mini-rank.top{color:var(--g3);}
.trending-mini-text{font-size:12px;color:var(--g5);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.trending-mini-likes{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;flex-shrink:0;}

/* NOTIF BADGE */
.notif-badge{position:absolute;top:-4px;right:-4px;width:16px;height:16px;border-radius:50%;background:#ef4444;font-size:9px;font-weight:800;color:#fff;display:flex;align-items:center;justify-content:center;font-family:'DM Mono',monospace;border:2px solid var(--bg);animation:popIn 0.2s ease;}
.app-right-notif{position:relative;}

/* REACTION EMOJIS */
.reactions-row{display:flex;gap:5px;margin-top:6px;flex-wrap:wrap;}
.reaction-btn{background:rgba(22,163,74,0.06);border:1.5px solid var(--border2);border-radius:20px;padding:3px 9px;font-size:12px;cursor:pointer;transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;color:var(--muted);}
.reaction-btn:hover{border-color:var(--g3);background:rgba(22,163,74,0.12);transform:scale(1.05);}
.reaction-btn.active{border-color:var(--g3);background:rgba(22,163,74,0.15);color:var(--g3);}
.reaction-btn span{font-size:11px;margin-left:3px;}

/* SHARE LINK BTN */
.btn-share-link{background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 10px;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-share-link:hover{border-color:var(--g4);color:var(--g4);}

/* PLAN PRO visually stronger */
.plan-card.recommended{transform:scale(1.03);box-shadow:0 0 40px rgba(22,163,74,0.18),0 0 0 2px rgba(34,197,94,0.25);}
.plan-card.recommended:hover{transform:scale(1.05);box-shadow:0 0 60px rgba(22,163,74,0.28);}

/* ANNUAL SAVINGS BADGE */
.plan-annual-save{display:inline-block;background:rgba(74,222,128,0.12);border:1px solid rgba(74,222,128,0.25);border-radius:4px;font-size:9px;font-weight:700;color:var(--g4);padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:0.5px;margin-bottom:8px;}

/* TAB mobile condensed */
@media(max-width:700px){
  .app-tabs{gap:0;overflow-x:auto;padding:0 4px;}
  .app-tab{padding:10px 10px;font-size:11px;white-space:nowrap;}
  .app-search-bar{display:none;}
}

/* HERO ORB extra */
.o3{width:350px;height:350px;background:rgba(22,163,74,0.035);top:40%;left:30%;animation:drift 22s ease-in-out infinite alternate;pointer-events:none;}

/* PROGRESS SIGNUP STEPS */
.signup-progress{display:flex;gap:6px;margin-bottom:18px;}
.signup-step-dot{flex:1;height:3px;border-radius:3px;background:var(--s2);transition:background 0.3s;}
.signup-step-dot.done{background:var(--g3);}

/* CONFETTI-LIKE after signup */
@keyframes confettiDrop{0%{transform:translateY(-20px) rotate(0deg);opacity:1}100%{transform:translateY(60px) rotate(360deg);opacity:0}}
.confetti-piece{position:absolute;width:6px;height:6px;border-radius:2px;animation:confettiDrop 0.8s ease forwards;pointer-events:none;}
</style>
</head>
<body>

<div id="cursor"></div>
<div id="cursor-ring"></div>
<div class="orb o1"></div>
<div class="orb o2"></div>
<div class="orb o3"></div>
<div id="toast-container"></div>

<!-- ══════════ LANDING ══════════ -->
<div id="landing">

<nav>
  <div class="logo">VIRAL<span>BOOST</span></div>
  <div class="nav-links">
    <a href="#vitrine" data-i18n="nav_vitrine">Vitrine</a>
    <a href="#plans" data-i18n="nav_plans">Abonnements</a>
    <a href="#reviews" data-i18n="nav_reviews">Avis</a>
  </div>
  <div class="nav-right">
    <select id="lang-switcher" onchange="setLang(this.value)" style="background:transparent;border:1.5px solid var(--border);border-radius:5px;color:var(--muted);font-size:12px;padding:5px 8px;cursor:pointer;font-family:'DM Mono',monospace;outline:none">
      <option value="fr">🇫🇷 FR</option>
      <option value="en">🇺🇸 EN</option>
      <option value="es">🇪🇸 ES</option>
    </select>
    <button class="btn-g btn-ghost-g" onclick="openModal('login-modal')" data-i18n="nav_login">Connexion</button>
    <button class="btn-g btn-solid-g" onclick="openModal('signup-modal')" data-i18n="nav_join">Rejoindre →</button>
  </div>
</nav>

<!-- TRENDING BAR -->
<div class="trending-bar" id="trending-bar">
  <span class="trending-label">🔥 TRENDING</span>
  <div class="trending-scroll" id="trending-scroll-content">
    <!-- duplicated for seamless loop -->
  </div>
</div>
  <div class="hero-badge"><span class="pulse-dot"></span><span data-i18n="hero_badge">📢 PLATEFORME N°1 DE PUBLICITÉ DIGITALE</span></div>

  <!-- COMPTEUR SOCIAL LIVE -->
  <div class="social-proof-bar" id="social-proof-bar">
    <div class="social-proof-item">
      <div>
        <div class="social-proof-num" id="sp-members">2 847</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">créateurs</div>
      </div>
    </div>
    <div class="social-proof-divider"></div>
    <div class="social-proof-item">
      <div>
        <div class="social-proof-num" id="sp-pubs">14 320</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">publicités publiées</div>
      </div>
    </div>
    <div class="social-proof-divider"></div>
    <div class="social-proof-item">
      <span style="width:7px;height:7px;border-radius:50%;background:var(--g3);box-shadow:0 0 8px var(--g3);animation:blink 1.2s infinite;flex-shrink:0"></span>
      <div>
        <div class="social-proof-num" id="sp-online">38</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">en ligne maintenant</div>
      </div>
    </div>
    <div class="social-proof-divider"></div>
    <div class="social-proof-item">
      <div>
        <div class="social-proof-num">★ 4.9</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">note moyenne</div>
      </div>
    </div>
  </div>

  <div class="hero-concept">
    <p data-i18n="hero_concept">Sur <strong>ViralBoost</strong>, tu <strong>publies ta publicité</strong> en 30 secondes et elle est visible par toute une communauté d'acheteurs, créateurs et entrepreneurs. SaaS, boutique, app, service — <strong>ta pub touche ta cible immédiatement.</strong></p>
  </div>
  <h1><span class="line1" id="hero-line1" data-i18n="hero_line1">PUBLIE TA</span> <span class="line2"><span class="hero-rotating-word" id="hero-rotating-word">PUBLICITÉ.</span></span></h1>
  <p class="hero-sub" data-i18n="hero_sub">La plateforme pub qui combine une audience qualifiée, l'IA et des outils de promotion tout-en-un. Publie d'abord, crée ton compte après.</p>

  <!-- FORMULAIRE PUB HERO -->
  <div class="hero-ad-box">
    <h3 data-i18n="hero_form_title">📢 PUBLIE TA PUBLICITÉ EN 30 SECONDES</h3>
    <div class="hero-ad-form">
      <input type="text" id="hero-ad-name" data-i18n-placeholder="hero_form_name" placeholder="Nom de ton produit / service *" maxlength="60"/>
      <select id="hero-ad-type">
        <option value="" data-i18n="hero_cat_select">Catégorie...</option>
        <option value="saas">🚀 SaaS / Logiciel</option>
        <option value="ecommerce">🛍️ E-commerce / Boutique</option>
        <option value="app">📱 Application mobile</option>
        <option value="tiktok">🎵 TikTok / Créateur</option>
        <option value="instagram">📸 Instagram / Influenceur</option>
        <option value="service">💼 Service / Freelance</option>
        <option value="site">🌐 Site web</option>
        <option value="autre">📦 Autre</option>
      </select>
      <textarea id="hero-ad-desc" data-i18n-placeholder="hero_form_desc" placeholder="Décris ta pub en 2 phrases : ce que tu proposes, à qui, pourquoi c'est top..."></textarea>
      <button class="btn-hero-ad" onclick="heroPublishAd()" data-i18n="hero_form_btn">📢 Publier ma publicité gratuitement →</button>
    </div>
    <div style="text-align:center;margin-top:8px;font-size:11px;color:var(--muted2)" data-i18n="hero_form_note">✓ Gratuit · Visible immédiatement · Pas de carte requise</div>
  </div>

  <div class="hero-actions">
    <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" data-i18n="hero_cta_create">Créer mon compte →</button>
    <button class="btn-hero-big btn-hero-out" onclick="openModal('login-modal')" data-i18n="hero_cta_login">Se connecter</button>
  </div>
  <p class="hero-note"><span>✓</span> <span data-i18n="hero_note">Gratuit pour commencer &nbsp;·&nbsp; <span>✓</span> Sans carte bancaire &nbsp;·&nbsp; <span>✓</span> Accès instantané</span></p>
  <div class="how-simple" style="margin-top:56px">
    <div class="how-step-simple" data-n="01"><div class="step-icon">📢</div><h4 data-i18n="step1_title">Publie ta pub</h4><p data-i18n="step1_desc">Décris ton produit ou service. En ligne en 30 secondes, visible par toute la communauté.</p></div>
    <div class="how-step-simple" data-n="02"><div class="step-icon">🎯</div><h4 data-i18n="step2_title">Touche ta cible</h4><p data-i18n="step2_desc">Notre audience de créateurs, entrepreneurs et acheteurs qualifiés voit ta pub.</p></div>
    <div class="how-step-simple" data-n="03"><div class="step-icon">🚀</div><h4 data-i18n="step3_title">Propulse avec l'IA</h4><p data-i18n="step3_desc">L'IA génère ta stratégie. Votes, partages, DMs — tu décoles vite.</p></div>
  </div>
</section>

<!-- FLUX PUBLIC (visible sans compte) -->
<section class="public-feed-section" id="public-feed">
  <div style="max-width:660px;margin:0 auto">
    <div style="text-align:center;margin-bottom:24px">
      <span class="sec-label">Fil public</span>
      <h2 class="section-title">Pubs <em>en direct</em></h2>
      <p class="section-sub" style="margin:0 auto">Les dernières publicités de la communauté — visibles par tous.</p>
    </div>
    <div id="public-feed-list" class="public-feed-blur">
      <!-- Les posts publics seront injectés ici -->
    </div>
    <div style="text-align:center;margin-top:28px">
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Rejoindre & publier ta pub →</button>
    </div>
  </div>
</section>

<section class="vitrine-section" id="vitrine">
  <div style="max-width:1100px;margin:0 auto 36px">
    <span class="sec-label">Vitrine communautaire</span>
    <h2 class="section-title">Projets <em>du moment</em></h2>
    <p class="section-sub">Votez pour vos favoris. Les plus votés gagnent en visibilité.</p>
    <div class="filters-row">
      <button class="f-btn active" onclick="filterLandingVitrine(this,'all')">Tous</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'site')">🌐 Sites</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'app')">📱 Apps</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'tiktok')">🎵 TikTok</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'saas')">🚀 SaaS</button>
    </div>
  </div>
  <div class="vitrine-grid" id="landing-vitrine-grid" style="max-width:1100px;margin:0 auto"></div>
</section>

<section class="plans-section" id="plans">
  <div style="text-align:center;margin-bottom:48px">
    <span class="sec-label">Abonnements</span>
    <h2 class="section-title">Choisis ton <em>niveau</em></h2>
    <p class="section-sub" style="margin:0 auto">Commence gratuitement. Evolue quand tu veux.</p>
  </div>
  <div class="plans-grid" id="landing-plans">

    <div class="plan-card">
      <div class="plan-name">FREE</div>
      <div class="plan-price">0<span style="font-size:22px;font-family:inherit">euro</span></div>
      <div class="plan-period">Gratuit pour toujours</div>
      <div class="plan-desc">Pour decouvrir ViralBoost</div>
      <ul class="plan-features">
        <li>1 publication / heure</li>
        <li>3 messages chat / jour</li>
        <li>Vitrine 1 heure</li>
        <li>Profil public complet</li>
        <li>Acces communaute</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="openModal('signup-modal')">Commencer gratuitement</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">STARTER</div>
      <div class="plan-price">3<span style="font-size:22px;font-family:inherit">euro</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour commencer a propulser</div>
      <ul class="plan-features">
        <li>3 publications / jour</li>
        <li>10 messages chat / jour</li>
        <li>Vitrine 7 jours</li>
        <li>Coach IA 20 req/mois</li>
        <li>DMs illimites</li>
        <li>Badge Starter</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('starter')">Choisir Starter &rarr;</button>
    </div>

    <div class="plan-card recommended">
      <div class="plan-badge">⭐ POPULAIRE</div>
      <div class="plan-annual-save">💰 Économise 35,9€/an</div>
      <div class="plan-name">PRO</div>
      <div class="plan-price">14,99<span style="font-size:22px;font-family:inherit">euro</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour les createurs serieux</div>
      <ul class="plan-features">
        <li>Publications illimitees</li>
        <li>Chat mondial illimite</li>
        <li>Vitrine 30j prioritaire</li>
        <li>IA Boost illimite</li>
        <li>Stats avancees</li>
        <li>Badge Pro verifie</li>
        <li>Affiliation 30%</li>
      </ul>
      <button class="btn-plan-g btn-plan-solid-g" onclick="startPayment('pro')">Choisir Pro &rarr;</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">ELITE</div>
      <div class="plan-price">39,99<span style="font-size:22px;font-family:inherit">euro</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour dominer ton marche</div>
      <ul class="plan-features">
      <li>Tout du plan Pro</li>
        <li>Vitrine permanente + épinglée</li>
        <li>🏆 Badge Elite doré</li>
        <li>Créateur de groupes de discussion</li>
        <li>Modération totale de tes groupes</li>
        <li>Fond d'écran personnalisé</li>
        <li>Signaler des membres → admin</li>
        <li>Messages privés à l'admin</li>
        <li>Likes/partages/commentaires dorés</li>
        <li>Sessions coaching live</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('elite')">Choisir Elite &rarr;</button>
    </div>

  </div>
</section>

<section class="reviews-section" id="reviews">
  <div style="text-align:center;margin-bottom:44px">
    <span class="sec-label">Témoignages</span>
    <h2 class="section-title">Ils ont <em>décollé</em></h2>
  </div>
  <div class="reviews-grid">
    <div class="rev-card"><div class="rev-stars">★★★★★</div><p class="rev-text">« La vitrine m'a apporté <strong>800 vues en 48h</strong> sur mon app. Du trafic que je n'aurais jamais eu seul. »</p><div class="rev-author"><div class="rev-ava" style="background:linear-gradient(135deg,#15803d,#22c55e)">K</div><div><div class="rev-name">Karim A.</div><div class="rev-handle">Fondateur SaaS</div><div class="rev-result">+800 vues en 48h</div></div></div></div>
    <div class="rev-card"><div class="rev-stars">★★★★★</div><p class="rev-text">« Le chat mondial et les DMs m'ont permis de trouver des <strong>partenaires business</strong> vraiment motivés. »</p><div class="rev-author"><div class="rev-ava" style="background:linear-gradient(135deg,#166534,#4ade80)">S</div><div><div class="rev-name">Sophie B.</div><div class="rev-handle">Créatrice de contenu</div><div class="rev-result">3 partenariats signés</div></div></div></div>
    <div class="rev-card"><div class="rev-stars">★★★★★</div><p class="rev-text">« La stratégie IA générée en 10s vaut <strong>mieux qu'une agence à 500€</strong>. Résultat visible en 2 semaines. »</p><div class="rev-author"><div class="rev-ava" style="background:linear-gradient(135deg,#14532d,#86efac)">T</div><div><div class="rev-name">Tom V.</div><div class="rev-handle">Entrepreneur indie</div><div class="rev-result">ROI x4 en 2 mois</div></div></div></div>
  </div>
</section>

<section class="cta-section">
  <h2 data-i18n="cta_title">REJOINS LA COMMUNAUTÉ</h2>
  <p data-i18n="cta_sub">Gratuit pour commencer. 1 247 créateurs déjà à bord.</p>
  <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" data-i18n="cta_btn">Créer mon compte →</button>
</section>

<footer>
  <div class="footer-logo">VIRALBOOST</div>
  <p data-i18n="footer_copy">© 2025 ViralBoost — Le réseau social des créateurs</p>
  <p>Stripe · Claude AI · WebSocket temps réel</p>
</footer>
</div><!-- /landing -->


<!-- ══════════ APP ══════════ -->
<div id="app">
  <div class="app-bar">
    <div class="app-logo">VB</div>
    <div class="app-tabs">
      <button class="app-tab active" onclick="showAppTab('feed',this)">🏠 Fil</button>
      <button class="app-tab" onclick="showAppTab('vitrine',this)">✨ Vitrine</button>
      <button class="app-tab" onclick="showAppTab('publier',this)">➕ Publier</button>
      <button class="app-tab" onclick="showAppTab('chat-global',this)" id="tab-btn-chat">💬 Chat <span class="notif-dot" id="chat-notif" style="display:none"></span></button>
      <button class="app-tab" onclick="showAppTab('groupes',this)" id="tab-btn-groups">👥 Groupes</button>
      <button class="app-tab" onclick="showAppTab('profil',this)">👤 Profil</button>
      <button class="app-tab" onclick="showAppTab('abonnes',this)">🔔 Abonnés</button>
      <button class="app-tab" onclick="showAppTab('ia-boost',this)">🤖 IA Boost</button>
    </div>
    <div class="app-right">
      <!-- BARRE DE RECHERCHE -->
      <div class="app-search-bar" style="position:relative" id="app-search-wrap">
        <span style="color:var(--muted);font-size:13px">🔍</span>
        <input type="text" id="app-search-input" placeholder="Chercher projets, créateurs..." oninput="handleAppSearch(this.value)" onfocus="document.getElementById('search-results-dropdown').style.display='block'" onblur="setTimeout(()=>document.getElementById('search-results-dropdown').style.display='none',200)"/>
        <div class="search-results-dropdown" id="search-results-dropdown"></div>
      </div>
      <!-- NOTIF BELL -->
      <div class="app-right-notif">
        <button onclick="toggleNotifPanel()" style="background:transparent;border:1.5px solid var(--border2);border-radius:8px;width:36px;height:36px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all 0.2s" title="Notifications">🔔</button>
        <span class="notif-badge" id="global-notif-badge" style="display:none">0</span>
      </div>
      <span class="plan-chip" id="app-plan-chip">FREE</span>
      <button id="btn-wallpaper" class="btn-out-g" onclick="openWallpaperModal()" style="display:none">🖼️</button>
      <button id="btn-admin-dm" class="btn-out-g" onclick="openAdminDM()" style="display:none;border-color:rgba(255,215,0,0.3);color:var(--gold)">📩 Admin</button>
      <div class="user-chip" onclick="showAppTab('profil',null)">
        <div class="user-chip-ava" id="app-user-ava">?</div>
        <span class="user-chip-name" id="app-user-name">...</span>
      </div>
      <button class="btn-out-g" onclick="logout()">Quitter</button>
    </div>
  </div>

  <div style="max-width:1160px;margin:0 auto;padding:0 16px">

    <!-- FIL -->
    <div class="tpanel active" id="tab-feed">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">

        <!-- TRENDING DU JOUR -->
        <div class="trending-posts-section" id="trending-posts-section">
          <div class="trending-posts-header">🔥 TRENDING AUJOURD'HUI <span style="color:var(--muted2);font-weight:400;margin-left:4px">· mis à jour il y a 2min</span></div>
          <div id="trending-posts-list">
            <!-- Injecté dynamiquement -->
          </div>
        </div>

        <div class="publish-box">
          <div class="publish-top">
            <div class="pub-ava" id="feed-pub-ava">?</div>
            <div style="flex:1"><textarea class="pub-text" id="feed-text" placeholder="Partage ton projet, une idée, une question à la communauté..." rows="3"></textarea></div>
          </div>
          <div class="pub-meta">
            <div class="fg" style="margin:0"><label>Projet associé</label><input type="text" id="feed-proj-name" placeholder="Nom du projet (optionnel)"/></div>
            <div class="fg" style="margin:0"><label>Type</label><select id="feed-proj-type"><option value="">Sans projet</option><option value="site">🌐 Site web</option><option value="app">📱 App</option><option value="saas">🚀 SaaS</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option><option value="ecommerce">🛍️ E-commerce</option></select></div>
          </div>
          <div class="pub-actions">
            <div style="display:flex;gap:7px;align-items:center;flex:1">
              <label style="cursor:pointer;font-size:18px;color:var(--g3);display:flex;align-items:center;gap:4px;font-size:12px;color:var(--muted);" title="Ajouter photo/vidéo">
                <input type="file" id="feed-media-input" accept="image/*,video/*,.pdf,.doc,.docx" multiple style="display:none" onchange="previewFeedMedia(this)"/>
                📎 <span>Photo / Vidéo / Fichier</span>
              </label>
            </div>
            <span class="pub-limit" id="feed-limit-info">FREE · 1 pub/heure</span>
            <button class="btn-publish" onclick="publishPost()">Publier</button>
          </div>
          <div id="feed-media-preview" class="media-preview-row"></div>
        </div>
        <div class="feed-tabs">
          <button class="feed-tab active" onclick="switchFeed('all',this)">Tout</button>
          <button class="feed-tab" onclick="switchFeed('following',this)">Abonnements</button>
          <button class="feed-tab" onclick="switchFeed('top',this)">Top du jour</button>
        </div>
        <div id="feed-list"></div>
      </div>
    </div>

    <!-- VITRINE APP -->
    <div class="tpanel" id="tab-vitrine">
      <div style="padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div><h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">VITRINE COMMUNAUTAIRE</h2><p style="font-size:12px;color:var(--muted)">Projets partagés par la communauté</p></div>
          <div class="filters-row" style="margin:0">
            <button class="f-btn active" onclick="filterAppVitrine(this,'all')">Tous</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'site')">🌐</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'app')">📱</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'tiktok')">🎵</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'saas')">🚀</button>
          </div>
        </div>
        <div class="vitrine-grid" id="app-vitrine-grid"></div>
      </div>
    </div>

    <!-- PUBLIER -->
    <div class="tpanel" id="tab-publier">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">PUBLIER UNE PUBLICITÉ</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Diffuse ta pub sur la vitrine communautaire</p>
        <div class="edit-section">
          <h3>Informations</h3>
          <div class="edit-grid">
            <div class="fg"><label>Nom *</label><input type="text" id="pub-name" placeholder="Ex: ContentPro — L'outil IA pour créateurs"/></div>
            <div class="fg"><label>Type *</label><select id="pub-type"><option value="saas">🚀 SaaS / App</option><option value="site">🌐 Site web</option><option value="ecommerce">🛍️ E-commerce</option><option value="service">💼 Service</option><option value="coaching">🎓 Coaching</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option></select></div>
            <div class="fg"><label>URL</label><input type="url" id="pub-url" placeholder="https://..."/></div>
            <div class="fg"><label>Emoji icône</label><input type="text" id="pub-emoji" placeholder="🚀" maxlength="2"/></div>
          </div>
          <div class="fg"><label>Description *</label><textarea id="pub-desc" rows="3" placeholder="Décris ta publicité, produit ou service en 2-3 phrases accrocheurs..."></textarea></div>
          <div class="fg"><label>Audience cible</label><input type="text" id="pub-target" placeholder="Ex: créateurs de contenu 18-30 ans"/></div>
          <div class="fg">
            <label>Image / Vidéo (optionnel)</label>
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
              📎 Ajouter une image ou vidéo
              <input type="file" id="pub-media-input" accept="image/*,video/*" style="display:none" onchange="handlePubMediaUpload(this)"/>
            </label>
            <div id="pub-media-preview" style="margin-top:6px"></div>
          </div>
        </div>
        <div style="background:rgba(22,163,74,0.05);border:1.5px solid rgba(22,163,74,0.13);border-radius:9px;padding:12px 16px;margin-bottom:14px;font-size:12px;color:var(--muted)">
          ⏱ Durée vitrine : <strong style="color:var(--g3)">FREE = 1h</strong> · Starter = 7j · Pro = 30j · Elite = Permanent
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn-publish" style="flex:1;padding:13px;font-size:13px" onclick="publishProject()">🚀 Publier sur la vitrine</button>
          <button onclick="generateBoostForProject()" style="flex:1;padding:13px;background:var(--s1);border:1.5px solid var(--border);border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s">🤖 Stratégie IA</button>
        </div>
        <div id="pub-strategy" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:10px;padding:16px;font-size:13px;line-height:1.8;color:#7a9a82;white-space:pre-wrap"></div>
      </div>
    </div>

    <!-- CHAT MONDIAL -->
    <div class="tpanel" id="tab-chat-global">
      <div class="chat-panel-container">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">CHAT MONDIAL</h2>
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);display:flex;align-items:center;gap:6px"><span style="width:6px;height:6px;border-radius:50%;background:var(--g3);box-shadow:0 0 5px var(--g3);display:inline-block"></span><span id="world-online-count">0 en ligne</span></div>
          </div>
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);background:var(--s1);border:1px solid var(--border2);border-radius:6px;padding:7px 12px">Messages restants : <span id="chat-msgs-left" style="color:var(--g3);font-weight:700">3</span></div>
        </div>
        <div class="chat-box">
          <div class="chat-msgs-area" id="world-chat-msgs"></div>
          <div class="chat-input-row">
            <input type="text" id="world-chat-in" class="chat-input-field" placeholder="Écris ton message à la communauté..." onkeydown="if(event.key==='Enter')sendWorldChat()"/>
            <button class="btn-send" onclick="sendWorldChat()">→</button>
          </div>
        </div>
        <div id="world-chat-upgrade" style="display:none" class="upgrade-strip">
          <div><h4>Messages du jour épuisés</h4><p>Starter (3€/mois) = 10 messages/jour</p></div>
          <button class="btn-g btn-solid-g" onclick="startPayment('starter')">Upgrade →</button>
        </div>
      </div>
    </div>

    <!-- PROFIL -->
    <div class="tpanel" id="tab-profil">
      <div style="max-width:760px;margin:0 auto;padding:22px 0" id="my-profile-view"></div>
    </div>

    <!-- ABONNÉS -->
    <div class="tpanel" id="tab-abonnes">
      <div style="max-width:640px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">ABONNÉS & ABONNEMENTS</h2>
        <div class="feed-tabs" style="margin-bottom:20px">
          <button class="feed-tab active" onclick="switchFollowTab('followers',this)">Abonnés (<span id="followers-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('following',this)">Abonnements (<span id="following-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('discover',this)">Découvrir</button>
        </div>
        <div id="follow-list-container" class="follow-list"></div>
      </div>
    </div>

    <!-- GROUPES -->
    <div class="tpanel" id="tab-groupes">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Rejoins ou crée des groupes thématiques</p>
          </div>
          <button class="btn-publish" onclick="openCreateGroup()" id="btn-create-group" style="display:none">+ Créer un groupe</button>
        </div>
        <div id="groups-list"></div>
      </div>
    </div>

    <!-- IA BOOST -->
    <div class="tpanel" id="tab-ia-boost">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">IA BOOST</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Stratégie de promotion complète générée en 10 secondes</p>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Type de stratégie</h3>
          <div class="boost-type-grid">
            <div class="boost-type-card selected" onclick="selectBoostType(this,'social')">📱<span>TikTok/Instagram</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'seo')">🔍<span>SEO Google</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'ads')">🎨<span>Publicités</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'email')">📧<span>Email marketing</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'strategy')">📊<span>Stratégie 90j</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'coach')">🤖<span>Coach IA</span></div>
          </div>
        </div>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Ton projet</h3>
          <div class="edit-grid">
            <div class="fg"><label>Nom</label><input type="text" id="boost-name" placeholder="Mon super projet"/></div>
            <div class="fg"><label>Type</label><select id="boost-proj-type"><option>Site web</option><option>Application</option><option>SaaS</option><option>TikTok</option><option>Instagram</option></select></div>
            <div class="fg"><label>Cible</label><input type="text" id="boost-target" placeholder="Créateurs 18-30 ans"/></div>
            <div class="fg"><label>Objectif</label><input type="text" id="boost-goal" placeholder="1000 abonnés en 30j"/></div>
          </div>
          <div class="fg"><label>Description</label><textarea id="boost-desc" rows="2" placeholder="Décris ton projet..."></textarea></div>
        </div>
        <button class="btn-publish" style="width:100%;padding:13px;font-size:14px" id="btn-ia-boost" onclick="runIABoost()">⚡ Générer ma stratégie</button>
        <div id="boost-output-box" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:12px;padding:18px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:1px">STRATÉGIE GÉNÉRÉE</span>
            <button onclick="navigator.clipboard.writeText(document.getElementById('boost-output-text').textContent).then(()=>toast('📋 Copié !'))" style="background:transparent;border:1px solid var(--border);border-radius:4px;padding:3px 10px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Copier</button>
          </div>
          <div id="boost-output-text" style="font-size:13px;line-height:1.9;color:#7a9a82;white-space:pre-wrap"></div>
        </div>
      </div>
    </div>

    <!-- GROUPES DISCUSSION -->
    <div class="tpanel" id="tab-groupes">
      <div style="max-width:900px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Rejoins ou crée des groupes thématiques (créer = plan ELITE)</p>
          </div>
          <button class="btn-publish" id="btn-create-group" onclick="openCreateGroup()" style="display:none">🏛️ Créer un groupe</button>
        </div>
        <div id="groups-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px"></div>
      </div>
    </div>

  </div><!-- /max-width container -->
</div><!-- /app -->

<!-- SIGNUP -->
<div class="modal-bg" id="signup-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('signup-modal')">✕</button>
    <h2>REJOINDRE VIRALBOOST</h2>
    <div class="modal-sub">CRÉE TON COMPTE · CHOISIS TON PLAN</div>

    <!-- SOCIAL PROOF AVATARS -->
    <div class="signup-social-proof">
      <div class="signup-ava-stack">
        <span style="background:linear-gradient(135deg,#15803d,#22c55e)">K</span>
        <span style="background:linear-gradient(135deg,#166534,#4ade80)">S</span>
        <span style="background:linear-gradient(135deg,#14532d,#86efac)">T</span>
        <span style="background:linear-gradient(135deg,#0f2312,#22c55e)">A</span>
        <span style="background:linear-gradient(135deg,#15803d,#4ade80)">M</span>
      </div>
      <div class="signup-proof-text"><strong>+2 847 créateurs</strong> déjà à bord 🔥</div>
    </div>

    <!-- PROGRESS BAR -->
    <div class="signup-progress" id="signup-progress">
      <div class="signup-step-dot done" id="sdot-1"></div>
      <div class="signup-step-dot" id="sdot-2"></div>
    </div>

    <!-- STEP 1: Plan -->
    <div id="signup-step-1">
      <div style="margin-bottom:14px">
        <label style="font-size:12px;color:var(--muted);margin-bottom:6px;display:block">Étape 1/2 · Choisis ton abonnement</label>
        <div class="signup-plans" id="signup-plans-grid"></div>
      </div>
      <button class="btn-modal-g" onclick="signupNextStep()">Continuer →</button>
    </div>

    <!-- STEP 2: Info -->
    <div id="signup-step-2" style="display:none">
      <div style="margin-bottom:10px;font-size:11px;color:var(--muted);font-family:'DM Mono',monospace">Étape 2/2 · Tes informations</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Prénom *</label><input type="text" id="s-name" placeholder="Marie"/></div>
        <div class="fg"><label>Pseudo *</label><input type="text" id="s-username" placeholder="@marie_creator"/></div>
        <div class="fg"><label>Email *</label><input type="email" id="s-email" placeholder="marie@exemple.fr"/></div>
        <div class="fg">
          <label>Mot de passe *</label>
          <input type="password" id="s-pass" placeholder="8 caractères min." oninput="checkPassStrength(this.value)"/>
          <div class="pass-strength-bar">
            <span id="ps-bar-1"></span><span id="ps-bar-2"></span><span id="ps-bar-3"></span><span id="ps-bar-4"></span>
          </div>
          <div class="pass-strength-label" id="ps-label">Saisis un mot de passe</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button onclick="signupBackStep()" style="background:transparent;border:1.5px solid var(--border);border-radius:8px;padding:12px 18px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:var(--muted)">← Retour</button>
        <button class="btn-modal-g" style="flex:1;margin:0" onclick="signup()">Créer mon compte →</button>
      </div>
    </div>

    <div class="modal-switch">Déjà inscrit ? <a onclick="switchModal('signup-modal','login-modal')">Se connecter</a></div>
  </div>
</div>

<!-- LOGIN -->
<div class="modal-bg" id="login-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('login-modal')">✕</button>
    <h2>CONNEXION</h2>
    <div class="modal-sub">CONTENT DE TE REVOIR 👋</div>
    <div class="fg"><label>Email</label><input type="email" id="l-email" placeholder="marie@exemple.fr"/></div>
    <div class="fg"><label>Mot de passe</label><input type="password" id="l-pass" placeholder="Ton mot de passe"/></div>
    <button class="btn-modal-g" onclick="login()">Se connecter →</button>
    <div class="modal-switch">Pas de compte ? <a onclick="switchModal('login-modal','signup-modal')">S'inscrire</a></div>
  </div>
</div>

<!-- PAYMENT -->
<div class="modal-bg" id="payment-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('payment-modal')">✕</button>
    <h2>ABONNEMENT</h2>
    <div class="modal-sub">SANS ENGAGEMENT · ANNULABLE ANYTIME</div>
    <div class="pay-sum">
      <div class="pay-plan" id="pay-plan-name">STARTER</div>
      <div class="pay-price" id="pay-plan-price">3€</div>
      <div class="pay-period">/mois</div>
    </div>
    <div id="card-element"></div>
    <div id="card-errors"></div>
    <button class="btn-modal-g" id="btn-pay" onclick="processPayment()">🔒 S'abonner maintenant</button>
    <div style="text-align:center;margin-top:7px;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">CRYPTÉ · STRIPE · SANS ENGAGEMENT</div>
  </div>
</div>

<!-- REPORT MODAL -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">SIGNALEMENT TRANSMIS À L'ADMIN</div>
    <div class="report-reason">
      <label><input type="radio" name="report-reason" value="spam"/> Spam / Publicité abusive</label>
      <label><input type="radio" name="report-reason" value="harcelement"/> Harcèlement</label>
      <label><input type="radio" name="report-reason" value="contenu_inapproprie"/> Contenu inapproprié</label>
      <label><input type="radio" name="report-reason" value="arnaque"/> Arnaque / Fraude</label>
      <label><input type="radio" name="report-reason" value="autre"/> Autre</label>
    </div>
    <div class="fg"><label>Détails (optionnel)</label><textarea id="report-details" rows="3" placeholder="Donne plus d'infos..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Envoyer le signalement</button>
  </div>
</div>

<!-- CREATE GROUP MODAL (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CRÉER UN GROUPE</h2>
    <div class="modal-sub">RÉSERVÉ AUX MEMBRES ELITE 🏆</div>
    <div class="group-settings-section">
      <h3>Informations du groupe</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Nom du groupe *</label><input type="text" id="cg-name" placeholder="Marketing Digital Pro"/></div>
        <div class="fg"><label>Emoji icône</label><input type="text" id="cg-emoji" placeholder="💼" maxlength="2"/></div>
        <div class="fg"><label>Thème / Catégorie</label><select id="cg-cat"><option value="marketing">📢 Marketing / Pub</option><option value="saas">🚀 SaaS / Tech</option><option value="ecommerce">🛍️ E-commerce</option><option value="tiktok">🎵 TikTok / Créateurs</option><option value="business">💼 Business</option><option value="freelance">💻 Freelance</option><option value="autre">📦 Autre</option></select></div>
        <div class="fg"><label>Membres max</label><select id="cg-max"><option value="50">50 membres</option><option value="100">100 membres</option><option value="500">500 membres</option><option value="0">Illimité</option></select></div>
      </div>
      <div class="fg"><label>Description</label><textarea id="cg-desc" rows="2" placeholder="À quoi sert ce groupe ? Qui peut rejoindre ?"></textarea></div>
    </div>
    <div class="group-settings-section">
      <h3>🔧 Paramètres de modération</h3>
      <div class="toggle-row"><label>Autoriser les photos dans le groupe</label><label class="toggle"><input type="checkbox" id="cg-allow-photos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Autoriser les vidéos</label><label class="toggle"><input type="checkbox" id="cg-allow-videos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Autoriser les fichiers</label><label class="toggle"><input type="checkbox" id="cg-allow-files"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Groupe privé (sur invitation)</label><label class="toggle"><input type="checkbox" id="cg-private"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Modération des messages avant publication</label><label class="toggle"><input type="checkbox" id="cg-premod"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Fond d'écran personnalisé pour le groupe</label><label class="toggle"><input type="checkbox" id="cg-wallpaper-enable"/><span class="toggle-slider"></span></label></div>
    </div>
    <button class="btn-modal-g" onclick="createGroup()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">🏆 Créer le groupe</button>
  </div>
</div>

<!-- WALLPAPER MODAL (ELITE) -->
<div class="modal-bg" id="wallpaper-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('wallpaper-modal')">✕</button>
    <h2>FOND D'ÉCRAN</h2>
    <div class="modal-sub">PERSONNALISE TON ESPACE — ELITE ONLY 🏆</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div onclick="setWallpaper('none')" style="height:70px;background:var(--bg);border:2px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--muted)">Aucun</div>
      <div onclick="setWallpaper('linear-gradient(135deg,#040a05,#0b2810)')" style="height:70px;background:linear-gradient(135deg,#040a05,#0b2810);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#0a0014,#1a0028)')" style="height:70px;background:linear-gradient(135deg,#0a0014,#1a0028);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#001a0a,#0a1f0a,#001210)')" style="height:70px;background:linear-gradient(135deg,#001a0a,#0a1f0a,#001210);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#1a0a00,#2a1000)')" style="height:70px;background:linear-gradient(135deg,#1a0a00,#2a1000);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#00101a,#001428)')" style="height:70px;background:linear-gradient(135deg,#00101a,#001428);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
    </div>
    <div class="fg"><label>Ou importe une image</label><input type="file" id="wallpaper-file" accept="image/*" onchange="setWallpaperFromFile(this)"/></div>
  </div>
</div>

<!-- DM ADMIN MODAL (ELITE) -->
<div class="modal-bg" id="dm-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-admin-modal')">✕</button>
    <h2>MESSAGE À L'ADMIN</h2>
    <div class="modal-sub">MESSAGE PRIVÉ — ELITE ONLY 🏆</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-admin-msgs"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-admin-input" placeholder="Ton message à l'admin..." onkeydown="if(event.key==='Enter')sendAdminDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendAdminDM()" style="padding:9px 18px">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- GROUP CHAT MODAL -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div class="modal-sub" id="group-chat-sub">DISCUSSION DE GROUPE</div>
    <div style="display:flex;gap:12px">
      <div style="flex:1">
        <div class="chat-box" style="height:400px">
          <div class="chat-msgs-area" id="group-chat-msgs"></div>
          <div class="chat-input-row" style="align-items:center">
            <label id="group-media-upload-label" style="cursor:pointer;color:var(--g3);font-size:18px;flex-shrink:0;display:none" title="Ajouter media">
              <input type="file" id="group-media-input" accept="image/*,video/*" style="display:none" onchange="sendGroupMedia(this)"/>📎
            </label>
            <input type="text" id="group-chat-in" class="chat-input-field" placeholder="Écris ton message..."/>
            <button class="btn-send" onclick="sendGroupMsg()">→</button>
          </div>
        </div>
      </div>
      <div id="group-members-sidebar" style="width:180px;background:var(--s1);border:1px solid var(--border2);border-radius:10px;padding:12px;max-height:430px;overflow-y:auto">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">MEMBRES</div>
        <div id="group-members-list" style="font-size:12px;color:var(--muted)"></div>
        <div id="group-admin-controls" style="display:none;margin-top:12px;border-top:1px solid var(--border2);padding-top:10px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:2px;margin-bottom:8px">MODÉRATION</div>
          <button onclick="openGroupSettings()" style="width:100%;padding:6px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:5px;font-size:11px;color:var(--gold);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;margin-bottom:5px">⚙️ Paramètres</button>
          <button onclick="openModal('wallpaper-modal')" style="width:100%;padding:6px;background:transparent;border:1px solid var(--border);border-radius:5px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">🖼️ Fond d'écran</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DM MODAL -->
<div class="modal-bg" id="dm-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-modal')">✕</button>
    <h2>MESSAGE PRIVÉ</h2>
    <div class="modal-sub" id="dm-modal-sub">À : ...</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-msgs-list"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-input" placeholder="Ton message..." onkeydown="if(event.key==='Enter')sendDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendDM()" style="padding:9px 18px">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT PROFILE -->
<div class="modal-bg" id="edit-profile-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('edit-profile-modal')">✕</button>
    <h2>MON PROFIL</h2>
    <div class="modal-sub">BIEN PLUS COMPLET QUE LES AUTRES RÉSEAUX</div>

    <div class="edit-section">
      <h3>Identité & Avatar</h3>
      <div class="edit-avatar-row">
        <div class="edit-avatar-big" id="edit-ava-preview" style="background:var(--g2)">🙂</div>
        <div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:7px">Choisis ton emoji avatar</div>
          <div class="emoji-picker">
            <div class="emoji-opt" onclick="selectEmoji(this,'🙂')">🙂</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😎')">😎</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🚀')">🚀</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'💡')">💡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🎯')">🎯</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🔥')">🔥</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'💎')">💎</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🌟')">🌟</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🦁')">🦁</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🐉')">🐉</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧠')">🧠</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'⚡')">⚡</div>
          </div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Prénom *</label><input type="text" id="ep-name" placeholder="Marie"/></div>
        <div class="fg"><label>Pseudo *</label><input type="text" id="ep-username" placeholder="marie_creator"/></div>
        <div class="fg"><label>Titre / Métier</label><input type="text" id="ep-title" placeholder="Créatrice de contenu · Dev indie"/></div>
        <div class="fg"><label>Localisation</label><input type="text" id="ep-location" placeholder="Paris, France 🇫🇷"/></div>
      </div>
      <div class="fg"><label>Bio</label><textarea id="ep-bio" rows="3" placeholder="Raconte qui tu es, ce que tu crées, ce qui te passionne..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>À propos (ultra-détaillé)</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Secteur / Niche</label><input type="text" id="ep-niche" placeholder="Marketing digital, Tech, Fitness..."/></div>
        <div class="fg"><label>Expérience</label><select id="ep-exp"><option>Débutant (0-1 an)</option><option>Intermédiaire (1-3 ans)</option><option>Confirmé (3-5 ans)</option><option>Expert (5+ ans)</option></select></div>
        <div class="fg"><label>Disponibilité</label><select id="ep-dispo"><option>Ouvert aux collaborations</option><option>Disponible pour missions</option><option>En recherche d'investisseur</option><option>Cherche associé</option><option>Simplement en réseau</option></select></div>
        <div class="fg"><label>Revenus/mois (optionnel)</label><select id="ep-revenue"><option value="">Non précisé</option><option>0–500€</option><option>500–2 000€</option><option>2 000–5 000€</option><option>5 000–10 000€</option><option>10 000€+</option></select></div>
        <div class="fg"><label>Objectif principal</label><input type="text" id="ep-goal" placeholder="Atteindre 100K abonnés en 2025"/></div>
        <div class="fg"><label>Compétences clés</label><input type="text" id="ep-skills" placeholder="Vidéo, Copywriting, SEO, Dev..."/></div>
        <div class="fg"><label>Outils utilisés</label><input type="text" id="ep-tools" placeholder="CapCut, Canva, Notion, Figma..."/></div>
        <div class="fg"><label>Langues parlées</label><input type="text" id="ep-langs" placeholder="Français, Anglais, Espagnol..."/></div>
      </div>
      <div class="fg"><label>Ce que je recherche</label><textarea id="ep-looking" rows="2" placeholder="Je cherche des collaborateurs, un associé, des clients, des conseils..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>Réseaux & Liens</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>🌐 Site web</label><input type="url" id="ep-website" placeholder="https://monsite.fr"/></div>
        <div class="fg"><label>🎵 TikTok</label><input type="text" id="ep-tiktok" placeholder="@moncompte"/></div>
        <div class="fg"><label>📸 Instagram</label><input type="text" id="ep-instagram" placeholder="@moncompte"/></div>
        <div class="fg"><label>🐦 Twitter/X</label><input type="text" id="ep-twitter" placeholder="@moncompte"/></div>
        <div class="fg"><label>💼 LinkedIn</label><input type="url" id="ep-linkedin" placeholder="linkedin.com/in/..."/></div>
        <div class="fg"><label>▶️ YouTube</label><input type="text" id="ep-youtube" placeholder="@moncompte"/></div>
      </div>
    </div>

    <div class="edit-section">
      <h3>Mes chiffres (optionnel)</h3>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px">
        <div class="fg"><label>Abonnés TikTok</label><input type="text" id="ep-tiktok-count" placeholder="45 000"/></div>
        <div class="fg"><label>Abonnés Instagram</label><input type="text" id="ep-ig-count" placeholder="12 000"/></div>
        <div class="fg"><label>Projets lancés</label><input type="text" id="ep-projects-count" placeholder="3"/></div>
        <div class="fg"><label>Ventes / Clients</label><input type="text" id="ep-sales" placeholder="150"/></div>
      </div>
    </div>

    <button class="btn-modal-g" onclick="saveProfile()">💾 Sauvegarder le profil</button>
  </div>
</div>

<!-- PUBLISH LANDING (avant inscription) -->
<div class="modal-bg" id="publish-landing-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('publish-landing-modal')">✕</button>
    <h2>PUBLIER UNE PUBLICITÉ</h2>
    <div class="modal-sub">DIFFUSION IMMÉDIATE SUR VIRALBOOST · SANS COMPTE REQUIS</div>
    <div class="fg"><label>Titre de ta publicité *</label><input type="text" id="pl-title" placeholder="Ex: ContentPro — L'outil IA pour créateurs"/></div>
    <div class="fg"><label>Message publicitaire *</label><textarea id="pl-text" rows="4" placeholder="Décris ton produit, service, projet... Sois accrocheur !"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Catégorie</label><select id="pl-type"><option value="saas">🚀 SaaS / App</option><option value="site">🌐 Site web</option><option value="ecommerce">🛍️ E-commerce</option><option value="service">💼 Service</option><option value="coaching">🎓 Coaching</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option></select></div>
      <div class="fg"><label>URL (optionnel)</label><input type="url" id="pl-url" placeholder="https://..."/></div>
    </div>
    <div class="fg">
      <label>Image / Vidéo (optionnel)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        📎 Ajouter un fichier
        <input type="file" id="pl-media" accept="image/*,video/*" style="display:none" onchange="handleLandingMediaUpload(this)"/>
      </label>
      <div id="pl-media-preview" style="margin-top:8px"></div>
    </div>
    <button class="btn-modal-g" onclick="publishLandingAd()">📢 Publier maintenant</button>
    <div class="modal-switch">Tu as un compte ? <a onclick="switchModal('publish-landing-modal','login-modal')">Se connecter</a> · <a onclick="switchModal('publish-landing-modal','signup-modal')">S'inscrire</a></div>
  </div>
</div>

<!-- CRÉER GROUPE (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CRÉER UN GROUPE</h2>
    <div class="modal-sub">FONCTIONNALITÉ ELITE — TU ES ADMIN DU GROUPE</div>
    <div class="edit-grid">
      <div class="fg"><label>Nom du groupe *</label><input type="text" id="grp-name" placeholder="Ex: SaaS Builders FR"/></div>
      <div class="fg"><label>Emoji / Icône</label><input type="text" id="grp-emoji" placeholder="🚀" maxlength="2"/></div>
    </div>
    <div class="fg"><label>Description *</label><textarea id="grp-desc" rows="2" placeholder="De quoi parle ce groupe ?"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Catégorie</label><select id="grp-cat"><option>SaaS / Tech</option><option>Marketing</option><option>TikTok / Instagram</option><option>E-commerce</option><option>Coaching</option><option>Crypto / Finance</option><option>Autre</option></select></div>
      <div class="fg"><label>Accès</label><select id="grp-access"><option value="public">🌍 Public</option><option value="private">🔒 Privé (sur invitation)</option></select></div>
    </div>
    <div class="fg"><label>Image de fond (URL ou upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Fond du groupe
        <input type="file" id="grp-bg-input" accept="image/*" style="display:none" onchange="handleGroupBgUpload(this)"/>
      </label>
      <div id="grp-bg-preview" style="margin-top:8px"></div>
    </div>
    <div class="fg"><label>Règles du groupe (optionnel)</label><textarea id="grp-rules" rows="2" placeholder="Ex: Pas de spam. Sujets liés au SaaS uniquement."></textarea></div>
    <div style="background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:8px;padding:12px;margin-bottom:14px;font-size:12px;color:var(--g5)">
      En tant qu'admin, tu pourras : modifier le fond, les règles, autoriser/interdire les photos, supprimer des membres, signaler des abus.
    </div>
    <button class="btn-modal-g" onclick="createGroup()">🏛️ Créer le groupe</button>
  </div>
</div>

<!-- SETTINGS GROUPE (ELITE admin) -->
<div class="modal-bg" id="group-settings-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-settings-modal')">✕</button>
    <h2>PARAMÈTRES DU GROUPE</h2>
    <div class="modal-sub">ADMINISTRATION — ELITE UNIQUEMENT</div>
    <div class="fg"><label>Autoriser les photos dans ce groupe</label>
      <select id="gs-allow-photos"><option value="1">✅ Oui, autorisées</option><option value="0">❌ Non, désactivées</option></select>
    </div>
    <div class="fg"><label>Nouveau fond (upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Modifier le fond
        <input type="file" id="gs-bg-input" accept="image/*" style="display:none" onchange="handleGroupSettingsBg(this)"/>
      </label>
    </div>
    <div class="fg"><label>Règles</label><textarea id="gs-rules" rows="2"></textarea></div>
    <div class="fg"><label>Mode privé</label>
      <select id="gs-access"><option value="public">🌍 Public</option><option value="private">🔒 Privé</option></select>
    </div>
    <button class="btn-modal-g" onclick="saveGroupSettings()">💾 Sauvegarder</button>
  </div>
</div>

<!-- CHAT GROUPE -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div style="display:flex;gap:8px;margin-bottom:8px" id="group-chat-actions"></div>
    <div class="chat-box" style="height:400px">
      <div class="chat-msgs-area" id="group-chat-msgs"></div>
      <div class="chat-input-row">
        <input type="text" id="group-chat-input" class="chat-input-field" placeholder="Message dans le groupe..." onkeydown="if(event.key==='Enter')sendGroupMessage()"/>
        <label id="group-media-btn" style="display:none;cursor:pointer;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0" title="Joindre un fichier">
          📎<input type="file" id="group-chat-file" accept="image/*,video/*" style="display:none" onchange="handleGroupChatFile(this)"/>
        </label>
        <button class="btn-send" onclick="sendGroupMessage()">→</button>
      </div>
    </div>
  </div>
</div>

<!-- SIGNALER UN UTILISATEUR -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">SIGNALEMENT TRANSMIS À L'ADMIN</div>
    <div class="fg"><label>Raison du signalement *</label>
      <select id="report-reason">
        <option value="spam">🚫 Spam / Publicité abusive</option>
        <option value="harcelement">⚠️ Harcèlement / Insultes</option>
        <option value="contenu">🔞 Contenu inapproprié</option>
        <option value="arnaque">💸 Arnaque / Fraude</option>
        <option value="autre">📝 Autre</option>
      </select>
    </div>
    <div class="fg"><label>Détails (optionnel)</label><textarea id="report-details" rows="3" placeholder="Explique ce qui s'est passé..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Envoyer le signalement</button>
  </div>
</div>

<!-- CONTACTER L'ADMIN (ELITE) -->
<div class="modal-bg" id="contact-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('contact-admin-modal')">✕</button>
    <h2>MESSAGE À L'ADMIN</h2>
    <div class="modal-sub">FONCTIONNALITÉ ELITE — RÉPONSE SOUS 24H</div>
    <div class="fg"><label>Objet</label><input type="text" id="ca-subject" placeholder="Ex: Demande de partenariat"/></div>
    <div class="fg"><label>Message *</label><textarea id="ca-message" rows="5" placeholder="Ton message à l'équipe ViralBoost..."></textarea></div>
    <button class="btn-modal-g" onclick="sendAdminMessage()">📩 Envoyer</button>
  </div>
</div>
<script>

const PLANS = [
  { id:'free', name:'FREE', price:0, period:'', desc:'Pour découvrir ViralBoost',
    features:['1 publication / heure','3 messages chat mondial / jour','Vitrine 1 heure','Profil public complet','Accès communauté'],
    limits:{pubsPerHour:1,chatMsgs:3,vitrineHours:1}
  },
  { id:'starter', name:'STARTER', price:3, period:'/mois', desc:'Pour commencer à propulser',
    features:['3 publications / jour','10 messages chat mondial / jour','Vitrine 7 jours','Coach IA (20 requêtes/mois)','DMs illimités','Badge Starter'],
    limits:{pubsPerDay:3,chatMsgs:10,vitrineHours:168}
  },
  { id:'pro', name:'PRO', price:14.99, period:'/mois', desc:'Pour les créateurs sérieux', recommended:true,
    features:['Publications illimitées','Chat mondial illimité','Vitrine 30j prioritaire','IA Boost illimité','Stats avancées','Badge Pro vérifié','Affiliation 30%'],
    limits:{pubsPerDay:999,chatMsgs:999,vitrineHours:720}
  },
  { id:'elite', name:'ELITE', price:39.99, period:'/mois', desc:'Pour dominer ton marché',
    features:['Tout du plan Pro','Vitrine permanente + épinglée','Badge Elite 🏆 doré sur actions','🏛️ Créer des groupes de discussion','Admin groupe complet','Signaler → transmis à admin','Message privé à l\'admin','Sessions coaching live','Commission 40%'],
    limits:{pubsPerDay:999,chatMsgs:999,vitrineHours:9999999}
  }
];

let currentUser=null,stripe,cardElement,pendingPlan='',selectedBoostType='social';
let worldChatMsgs=[],dmTarget=null,dmThreads={},ws=null;
let myVotes=new Set(JSON.parse(localStorage.getItem('vb_votes')||'[]'));
let posts=[],selectedSignupPlan='free';
let groupsData=[];
let currentGroupId=null;
let pendingMediaUrl=null, pendingLandingMediaUrl=null;
let reportTarget=null;
let currentGroupSettingsId=null;
let groupBgUrl=null, groupSettingsBgUrl=null;

// ── TOAST ──
function toast(msg,type='success'){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className='toast-g'+(type==='success'?' success':'');
  t.textContent=msg;
  c.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(50px)';t.style.transition='all 0.3s';setTimeout(()=>t.remove(),300);},3000);
}

// ── PLANS RENDER ──
function renderPlans(){
  // Landing plans grid
  const g=document.getElementById('landing-plans');
  if(g) g.innerHTML=PLANS.map(p=>`
    <div class="plan-card ${p.recommended?'recommended':''}">
      ${p.recommended?'<div class="plan-badge">⭐ POPULAIRE</div>':''}
      <div class="plan-name">${p.name}</div>
      <div class="plan-price">${p.price===0?'0':''+p.price+'€'}</div>
      <div class="plan-period">${p.price===0?'Gratuit':p.period}</div>
      <div class="plan-desc">${p.desc}</div>
      <ul class="plan-features">${p.features.map(f=>`<li>${f}</li>`).join('')}</ul>
      <button class="btn-plan-g ${p.recommended?'btn-plan-solid-g':'btn-plan-outline-g'}" onclick="${p.price===0?`openModal('signup-modal')`:`startPayment('${p.id}')`}">${p.price===0?'Commencer gratuitement':'Choisir '+p.name+' →'}</button>
    </div>`).join('');

  // Signup plans
  const sg=document.getElementById('signup-plans-grid');
  if(sg) sg.innerHTML=PLANS.map(p=>`
    <div class="sp-card ${p.id==='free'?'selected':''}" onclick="selectSignupPlan(this,'${p.id}')">
      <div class="sp-plan">${p.name}</div>
      <div class="sp-price">${p.price===0?'0€':p.price+'€'}</div>
      <div class="sp-per">${p.price===0?'Gratuit':p.period}</div>
      <div class="sp-feat">${p.features.slice(0,2).join('<br>')}</div>
    </div>`).join('');
}

function selectSignupPlan(el,planId){
  document.querySelectorAll('#signup-plans-grid .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedSignupPlan=planId;
}

// ── VITRINE DATA & RENDER ──
const sampleProjects=[
  {id:'p1',name:'ContentPro',cat:'saas',type:'SaaS',desc:'Outil IA tout-en-un pour créateurs TikTok et Instagram.',emoji:'🤖',color:'linear-gradient(135deg,#15803d,#22c55e)',author:'Alex M.',authorId:'demo1',votes:247,badge:'🔥 HOT'},
  {id:'p2',name:'NovaTrade',cat:'saas',type:'SaaS',desc:'Plateforme trading IA avec screener et coach temps réel.',emoji:'📈',color:'linear-gradient(135deg,#166534,#4ade80)',author:'Sarah K.',authorId:'demo2',votes:189,badge:'⭐ TOP'},
  {id:'p3',name:'@fitnessbyflo',cat:'tiktok',type:'TikTok',desc:'Coach fitness certifiée. 45K abonnés. Programmes minceur.',emoji:'💪',color:'linear-gradient(135deg,#14532d,#86efac)',author:'Flo R.',authorId:'demo3',votes:156},
  {id:'p4',name:'DevisPro',cat:'site',type:'Site web',desc:'Génération de devis professionnels PDF en 30 secondes.',emoji:'📄',color:'linear-gradient(135deg,#166534,#22c55e)',author:'Marc D.',authorId:'demo4',votes:134},
  {id:'p5',name:'MessageGenius',cat:'site',type:'Site web',desc:'Créez des messages parfaits grâce à l\'IA.',emoji:'💌',color:'linear-gradient(135deg,#15803d,#4ade80)',author:'Lisa T.',authorId:'demo5',votes:98},
  {id:'p6',name:'@techparis',cat:'tiktok',type:'TikTok',desc:'Tendances tech et IA pour les pros.',emoji:'🔬',color:'linear-gradient(135deg,#14532d,#22c55e)',author:'Tom V.',authorId:'demo6',votes:87},
];
let vitrineData=[...sampleProjects];

function buildVitrineGrid(containerId,filter='all'){
  const el=document.getElementById(containerId);
  if(!el)return;
  const data=filter==='all'?vitrineData:vitrineData.filter(p=>p.cat===filter);
  if(!data.length){el.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:48px;color:var(--muted)">🚀 Aucun projet pour ce filtre</div>';return;}
  el.innerHTML=data.map(p=>`
    <div class="v-card" data-pid="${p.id}">
      ${p.badge?`<div class="v-banner" style="background:${p.color}">${p.emoji}<div class="v-badge">${p.badge}</div></div>`:`<div class="v-banner" style="background:${p.color}">${p.emoji}</div>`}
      <div class="v-body">
        <div class="v-cat">${p.type}</div>
        <div class="v-name">${p.name}</div>
        <div class="v-desc">${p.desc}</div>
        <div class="v-footer">
          <div class="v-author"><div class="v-ava">${p.author[0]}</div>${p.author}</div>
          <div class="v-actions">
            <button class="btn-vote-g ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this)">▲ <span class="vote-count">${p.votes}</span></button>
            <button class="btn-dm-small" onclick="openDMToUser('${p.authorId}','${p.author}')" title="Envoyer un DM">💬</button>
          </div>
        </div>
      </div>
    </div>`).join('');
}

function filterLandingVitrine(el,filter){
  document.querySelectorAll('#vitrine .filters-row .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildVitrineGrid('landing-vitrine-grid',filter);
}
function filterAppVitrine(el,filter){
  document.querySelectorAll('#tab-vitrine .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildVitrineGrid('app-vitrine-grid',filter);
}

async function voteProject(e,id,btn){
  e.stopPropagation();
  if(!currentUser){openModal('login-modal');return;}
  if(myVotes.has(id)){toast('Tu as déjà voté !');return;}
  btn.classList.add('voted');
  const cnt=btn.querySelector('.vote-count');
  const proj=vitrineData.find(p=>p.id===id);
  if(proj)proj.votes++;
  if(cnt)cnt.textContent=(parseInt(cnt.textContent)||0)+1;
  myVotes.add(id);
  localStorage.setItem('vb_votes',JSON.stringify([...myVotes]));
  toast('👍 Vote comptabilisé !');
  // sync API
  try{await fetch('/api/projects/'+id+'/vote',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser.email})});}catch(e){}
}

// ── FEED ──
const samplePosts=[
  {id:'sp1',userId:'demo1',author:'Alex M.',emoji:'🤖',plan:'pro',text:'Viens de lancer ContentPro v2 ! Nouvelles features IA pour les créateurs TikTok. Dites-moi ce que vous en pensez 🚀',projName:'ContentPro',projType:'saas',projDesc:'Outil IA créateurs',projEmoji:'🤖',time:'2h',likes:24,comments:8,timerEnd:null},
  {id:'sp2',userId:'demo2',author:'Sarah K.',emoji:'📈',plan:'elite',text:'Stratégie TikTok qui m\'a permis de passer de 2K à 45K abonnés en 3 mois. Thread complet ici 👇',time:'5h',likes:87,comments:31,timerEnd:null},
  {id:'sp3',userId:'demo3',author:'Flo R.',emoji:'💪',plan:'starter',text:'Qui cherche un partenariat dans le fitness ? Je collabore avec 2 marques ce mois-ci.',time:'8h',likes:12,comments:5,timerEnd:null},
];
let feedPosts=[...samplePosts];

// Charge le feed depuis l'API au démarrage
async function loadPostsFromAPI(){
  const feedEl=document.getElementById('feed-list');
  if(feedEl&&!feedPosts.length){
    // Skeleton loader
    feedEl.innerHTML=Array(3).fill(`
      <div class="skeleton-card">
        <div style="display:flex;gap:10px;margin-bottom:12px">
          <div class="skeleton skeleton-circle"></div>
          <div style="flex:1"><div class="skeleton skeleton-line medium"></div><div class="skeleton skeleton-line short" style="margin-top:6px"></div></div>
        </div>
        <div class="skeleton skeleton-line" style="margin-bottom:6px"></div>
        <div class="skeleton skeleton-line medium"></div>
      </div>`).join('');
  }
  try{
    const r=await fetch('/api/posts');
    const apiPosts=await r.json();
    // Merge with sample posts (API first)
    const apiIds=new Set(apiPosts.map(p=>p.id));
    feedPosts=[...apiPosts,...samplePosts.filter(p=>!apiIds.has(p.id))];
  }catch(e){}
  buildFeed();
}

function buildFeed(filter='all'){
  const el=document.getElementById('feed-list');
  if(!el)return;
  let data=[...feedPosts];
  if(filter==='following')data=data.filter(p=>currentUser?.following?.includes(p.userId)||p.userId===currentUser?.id);
  if(filter==='top')data=data.sort((a,b)=>b.likes-a.likes);
  if(!data.length){el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted)">Aucune publication pour l\'instant.</div>';return;}
  el.innerHTML=data.map(p=>{
    const plan=PLANS.find(pl=>pl.id===p.plan)||PLANS[0];
    const isMe=p.userId===currentUser?.email;
    const isElite=(p.plan||'free')==='elite';
    const timerHtml=p.timerEnd?`<span class="post-timer">⏱ <span class="post-timer-val" data-end="${p.timerEnd}">--:--</span></span>`:'';
    const actionClass=isElite?'btn-action elite-action':'btn-action';
    const likedByMe=p.myLike;
    const mediaHtml=p.mediaUrl?`${p.mediaType&&p.mediaType.startsWith('video')?`<video class="post-media-video" controls src="${p.mediaUrl}"></video>`:`<img class="post-media" src="${p.mediaUrl}" alt="media" onclick="window.open('${p.mediaUrl}','_blank')" style="cursor:zoom-in"/>`}`:'';
    return `
    <div class="post-card" id="post-${p.id}" data-pid="${p.id}">
      <div class="post-header">
        <div class="post-ava" style="background:${getAvatarColor(p.userId)}" onclick="viewUserProfile('${p.userId}')">${p.emoji||p.author[0]}</div>
        <div class="post-meta">
          <div class="post-author" onclick="viewUserProfile('${p.userId}')">${isElite?'<span class="badge-elite-gold">🏆</span> ':''} ${p.author}</div>
          <div class="post-info"><span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span> · ${p.time} ${timerHtml}</div>
        </div>
        ${!isMe?`<button class="btn-dm-small" onclick="openDMToUser('${p.userId}','${p.author}')" title="DM">💬</button>`:''}
        <button class="btn-report" onclick="openReport('${p.userId}','${p.author}')" title="Signaler">⚑</button>
      </div>
      <div class="post-content">${escHtml(p.text)}</div>
      ${mediaHtml}
      ${p.projName?`<div class="post-project" onclick="void(0)">
        <div class="post-proj-icon">${p.projEmoji||'🚀'}</div>
        <div><div class="post-proj-name">${p.projName}</div><div class="post-proj-cat">${p.projType||'pub'}</div>${p.projDesc?`<div class="post-proj-desc">${p.projDesc}</div>`:''}</div>
      </div>`:''}
      <div class="post-actions">
        <button class="${actionClass} ${likedByMe?'active':''}" onclick="likePost('${p.id}',this)">❤️ <span class="like-count">${p.likes||0}</span></button>
        <button class="${actionClass}" onclick="openComments('${p.id}')">💬 <span class="comment-count">${p.comments||0}</span></button>
        <button class="btn-share-link" onclick="sharePost('${p.id}','${(p.author||'').replace(/'/g,'')}')">🔗 Partager</button>
        ${isMe?`<button class="${actionClass}" onclick="deletePost('${p.id}')" style="margin-left:auto;color:#f87171">🗑</button>`:''}
      </div>
      <div class="reactions-row" id="reactions-${p.id}">${buildReactionsHTML(p.id,p.reactions||{})}</div>
    </div>`;
  }).join('');
  updateTimers();
}

function switchFeed(filter,el){
  document.querySelectorAll('.feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFeed(filter);
}

async function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  btn.classList.toggle('active');
  const cnt=btn.querySelector('.like-count');
  if(cnt)cnt.textContent=p.likes;
  try{fetch('/api/posts/'+id+'/like',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser?.email||'anon'})});}catch(e){}
}

async function sharePost(id,btn){
  navigator.clipboard.writeText(window.location.origin+'#post-'+id).then(()=>toast('🔗 Lien copié !'));
  const p=feedPosts.find(p=>p.id===id);
  if(p){p.shares=(p.shares||0)+1;const cnt=btn?.querySelector('.share-count');if(cnt)cnt.textContent=p.shares;}
  try{fetch('/api/posts/'+id+'/share',{method:'POST'});}catch(e){}
}

function openComments(id){
  toast('💬 Commentaires — bientôt disponible !');
}

function deletePost(id){
  feedPosts=feedPosts.filter(p=>p.id!==id);
  document.getElementById('post-'+id)?.remove();
}

// ── MEDIA UPLOAD ──
async function handleMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('feed-media-preview');
  preview.style.display='block';
  preview.innerHTML='<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd=new FormData();
  fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingMediaUrl=d.url;
    const isVideo=file.type.startsWith('video');
    preview.innerHTML=`<div class="media-preview-item">${isVideo?`<video src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px"></video>`:`<img src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px;object-fit:cover"/>`} <span style="flex:1">${file.name}</span> <span class="remove-media" onclick="pendingMediaUrl=null;document.getElementById('feed-media-preview').innerHTML='';document.getElementById('feed-media-preview').style.display='none'">✕</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';pendingMediaUrl=null;}
}

async function handleLandingMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('pl-media-preview');
  preview.innerHTML='<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingLandingMediaUrl=d.url;
    preview.innerHTML=`<div class="media-preview-item"><img src="${d.url}" style="max-width:100px;max-height:60px;border-radius:4px;object-fit:cover"/> <span style="flex:1">${file.name}</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';}
}

async function handleGroupBgUpload(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupBgUrl=d.url;document.getElementById('grp-bg-preview').innerHTML=`<img src="${d.url}" style="width:100%;height:80px;object-fit:cover;border-radius:6px;margin-top:6px"/>`;}catch(e){}
}

async function handleGroupSettingsBg(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupSettingsBgUrl=d.url;}catch(e){}
}

async function handleGroupChatFile(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    // Send as message with media
    const msg={text:'',mediaUrl:d.url,mediaType:file.type,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
    await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});
    loadGroupMessages(currentGroupId);
  }catch(e){}
}

// ── PUBLISH LANDING AD (avant compte) ──
async function publishLandingAd(){
  const title=document.getElementById('pl-title').value.trim();
  const text=document.getElementById('pl-text').value.trim();
  if(!title||!text){toast('Remplis le titre et le message.');return;}
  const type=document.getElementById('pl-type').value;
  const url=document.getElementById('pl-url').value.trim();
  const post={
    id:'p'+Date.now(),userId:'landing_'+Date.now(),author:'Visiteur',
    emoji:'📢',plan:'free',text:title+'\n\n'+text,projName:title,projType:type,
    projEmoji:getTypeEmoji(type),projDesc:text.slice(0,80),projUrl:url,
    mediaUrl:pendingLandingMediaUrl,mediaType:pendingLandingMediaUrl?.match(/\.(mp4|webm|mov)/i)?'video/mp4':'image/jpeg',
    time:'À l\'instant',likes:0,comments:0,shares:0,timerEnd:Date.now()+3600000
  };
  feedPosts.unshift(post);
  pendingLandingMediaUrl=null;
  closeModal('publish-landing-modal');
  try{await fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  toast('📢 Publicité publiée ! Crée un compte pour gérer tes pubs.');
  setTimeout(()=>openModal('signup-modal'),2000);
}

function openPublishLanding(){
  document.getElementById('pl-title').value='';
  document.getElementById('pl-text').value='';
  document.getElementById('pl-media-preview').innerHTML='';
  pendingLandingMediaUrl=null;
  openModal('publish-landing-modal');
}

// ── PUBLISH POST ──
let pubHourCount=0, pubHourReset=0;
function publishPost(){
  if(!currentUser){openModal('login-modal');return;}
  const text=document.getElementById('feed-text').value.trim();
  if(!text){toast('Écris quelque chose !');return;}

  // Check limits
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const now=Date.now();
  if(currentUser.plan==='free'){
    if(now-pubHourReset>3600000){pubHourCount=0;pubHourReset=now;}
    if(pubHourCount>=1){toast('Plan FREE : 1 publication/heure. Upgrade pour plus !');return;}
  } else if(plan.limits.pubsPerDay){
    const today=new Date().toDateString();
    const key='vb_pubs_'+today;
    const count=parseInt(localStorage.getItem(key)||'0');
    if(count>=plan.limits.pubsPerDay){toast('Limite de publications atteinte pour aujourd\'hui.');return;}
    localStorage.setItem(key,count+1);
  }

  const projName=document.getElementById('feed-proj-name').value.trim();
  const projType=document.getElementById('feed-proj-type').value;
  const timerEnd=currentUser.plan==='free'?Date.now()+3600000:null;

  const post={
    id:'p'+Date.now(),userId:currentUser.email,author:currentUser.name,
    emoji:currentUser.avatar||'🙂',plan:currentUser.plan||'free',
    text,projName,projType,projEmoji:getTypeEmoji(projType),projDesc:'',
    mediaUrl:pendingMediaUrl,mediaType:pendingMediaUrl?'image':'',
    time:'À l\'instant',likes:0,comments:0,shares:0,myLike:false,timerEnd
  };
  feedPosts.unshift(post);
  pubHourCount++;
  pendingMediaUrl=null;
  document.getElementById('feed-text').value='';
  document.getElementById('feed-proj-name').value='';
  document.getElementById('feed-media-preview').innerHTML='';
  document.getElementById('feed-media-preview').style.display='none';
  buildFeed();
  toast('📢 Publication postée !');
  // Sync API
  try{fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  if(timerEnd)setTimeout(()=>{feedPosts=feedPosts.filter(p=>p.id!==post.id);buildFeed();},3600000);
}

let pendingPubMediaUrl=null;
async function handlePubMediaUpload(input){
  const file=input.files[0];if(!file)return;
  const preview=document.getElementById('pub-media-preview');
  preview.innerHTML='<div class="media-preview-item">⏳ Upload...</div>';
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();pendingPubMediaUrl=d.url;
    preview.innerHTML=`<div class="media-preview-item"><img src="${d.url}" style="max-width:80px;max-height:60px;border-radius:4px;object-fit:cover"/> <span style="flex:1">${file.name}</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';pendingPubMediaUrl=null;}
}

// ── PUBLISH PROJECT ──
function publishProject(){
  if(!currentUser){openModal('login-modal');return;}
  const name=document.getElementById('pub-name').value.trim();
  const desc=document.getElementById('pub-desc').value.trim();
  if(!name||!desc){toast('Remplis le nom et la description.');return;}
  const type=document.getElementById('pub-type').value;
  const emoji=document.getElementById('pub-emoji').value||getTypeEmoji(type);
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const colors=['linear-gradient(135deg,#15803d,#22c55e)','linear-gradient(135deg,#166534,#4ade80)','linear-gradient(135deg,#14532d,#86efac)'];
  const proj={
    id:'pub'+Date.now(),name,cat:type,type:typeName(type),
    desc:desc.slice(0,120),emoji,
    color:colors[Math.floor(Math.random()*colors.length)],
    author:currentUser.name,authorId:currentUser.email,votes:0,
    mediaUrl:pendingPubMediaUrl,
    timerEnd:plan.limits.vitrineHours<999999?Date.now()+plan.limits.vitrineHours*3600000:null
  };
  pendingPubMediaUrl=null;
  document.getElementById('pub-media-preview').innerHTML='';
  vitrineData.unshift(proj);
  buildVitrineGrid('app-vitrine-grid');
  buildVitrineGrid('landing-vitrine-grid');
  toast('🌐 Projet publié sur la vitrine !');
  document.getElementById('pub-name').value='';
  document.getElementById('pub-desc').value='';
  // Save & sync
  const saved=JSON.parse(localStorage.getItem('vb_my_projects')||'[]');
  saved.unshift(proj);
  localStorage.setItem('vb_my_projects',JSON.stringify(saved));
  try{fetch('/api/projects',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(proj)});}catch(e){}
}

async function generateBoostForProject(){
  const name=document.getElementById('pub-name').value.trim()||'Mon projet';
  const desc=document.getElementById('pub-desc').value.trim()||'Projet digital';
  const type=document.getElementById('pub-type').value;
  const target=document.getElementById('pub-target').value.trim()||'Grand public';
  const btn=document.getElementById('btn-pub-project');
  btn.disabled=true;
  const outBox=document.getElementById('pub-strategy');
  outBox.style.display='block';
  outBox.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:`Tu es expert en marketing digital. Génère une stratégie de promotion pour:\n- Projet: ${name} (${type})\n- Cible: ${target}\n- Description: ${desc}\n\nFournis: hashtags TikTok, calendrier contenu 2 semaines, 3 idées de posts viraux, 5 mots-clés SEO.`})});
    const data=await res.json();
    outBox.textContent=data.content;
  }catch(e){outBox.textContent='Connecte le backend Render pour générer des stratégies IA.';}
  btn.disabled=false;
}

// ── WORLD CHAT ──
let chatMsgsToday=parseInt(localStorage.getItem('vb_chat_today_'+new Date().toDateString())||'0');

function buildWorldChat(){
  const el=document.getElementById('world-chat-msgs');
  if(!el)return;
  const msgs=[
    {name:'Alex M.',plan:'pro',text:'Salut la communauté ! 🚀 Qui lance un projet ce mois-ci ?',time:'10:23'},
    {name:'Sarah K.',plan:'elite',text:'Je viens de dépasser les 50K abonnés TikTok grâce à ViralBoost 🎉',time:'10:45'},
    {name:'Flo R.',plan:'starter',text:'Quelqu\'un a des conseils pour le SEO en 2025 ?',time:'11:02'},
    {name:'Tom V.',plan:'free',text:'Nouveau projet lancé : @techparis sur TikTok, go check !',time:'11:18'},
    ...worldChatMsgs
  ];
  el.innerHTML=msgs.map(m=>`
    <div class="chat-msg-item">
      <div class="chat-msg-name">${m.name} <span class="chat-msg-plan-badge plan-${m.plan}">${m.plan.toUpperCase()}</span> <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.time||''}</span></div>
      <div class="chat-msg-text">${escHtml(m.text)}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
  // Update online count
  const onlineEl=document.getElementById('world-online-count');
  if(onlineEl)onlineEl.textContent=(12+Math.floor(Math.random()*8))+' en ligne';
}

function sendWorldChat(){
  if(!currentUser){openModal('login-modal');return;}
  const inp=document.getElementById('world-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const today=new Date().toDateString();
  if(chatMsgsToday>=plan.limits.chatMsgs){
    document.getElementById('world-chat-upgrade').style.display='flex';
    toast('Limite de messages atteinte ! Upgrade ton plan.');
    return;
  }
  chatMsgsToday++;
  localStorage.setItem('vb_chat_today_'+today,chatMsgsToday);
  document.getElementById('chat-msgs-left').textContent=Math.max(0,plan.limits.chatMsgs-chatMsgsToday);
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  worldChatMsgs.push({name:currentUser.name,plan:currentUser.plan||'free',text,time});
  inp.value='';
  buildWorldChat();
  // WS send
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'message',name:currentUser.name,plan:currentUser.plan||'free',text}));
  }
}

// ── PROFILE ──
function renderMyProfile(){
  const el=document.getElementById('my-profile-view');
  if(!el||!currentUser)return;
  const u=currentUser;
  const ava=u.avatar||'🙂';
  const followers=(u.followers||[]).length;
  const following=(u.following||[]).length;
  el.innerHTML=`
    <div class="profile-banner" style="background:linear-gradient(135deg,${getAvatarColor(u.email)},var(--s3))">
      <div class="profile-avatar" style="background:${getAvatarColor(u.email)}">${ava}</div>
      <button class="profile-edit-btn" onclick="openEditProfile()">✏️ Modifier</button>
      ${u.plan==='elite'?`<button class="btn-contact-admin" style="position:absolute;bottom:14px;right:14px" onclick="openContactAdmin()">📩 Admin</button>`:''}
    </div>
    <div class="profile-info">
      <div class="profile-name">${u.name||'Utilisateur'}</div>
      <div class="profile-handle">@${u.username||u.email.split('@')[0]} · <span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></div>
      <div class="profile-bio">${u.bio||'<span style="color:var(--muted2)">Ajoute une bio dans "Modifier mon profil"</span>'}</div>
      ${u.tags&&u.tags.length?`<div class="profile-tags">${u.tags.map(t=>`<span class="profile-tag">${t}</span>`).join('')}</div>`:''}
      <div class="profile-stats">
        <div class="pstat"><div class="pstat-num">${followers}</div><div class="pstat-label">Abonnés</div></div>
        <div class="pstat"><div class="pstat-num">${following}</div><div class="pstat-label">Abonnements</div></div>
        <div class="pstat"><div class="pstat-num">${(u.projects||[]).length}</div><div class="pstat-label">Projets</div></div>
        <div class="pstat"><div class="pstat-num">${u.totalVotes||0}</div><div class="pstat-label">Votes reçus</div></div>
      </div>
      ${renderProfileLinks(u)}
      ${renderProfileFields(u)}
    </div>
    <div style="margin-top:24px">
      <h3 style="font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:12px">MES PUBLICATIONS</h3>
      <div id="my-posts-feed">${feedPosts.filter(p=>p.userId===u.email).length===0?'<div style="color:var(--muted);font-size:13px">Aucune publication encore.</div>':''}</div>
    </div>`;
  // Render my posts
  const myPosts=feedPosts.filter(p=>p.userId===u.email);
  const mpEl=document.getElementById('my-posts-feed');
  if(mpEl&&myPosts.length){
    mpEl.innerHTML=myPosts.map(p=>`<div class="post-card" style="margin-bottom:10px"><div class="post-content">${escHtml(p.text)}</div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:8px">${p.time} · ❤️ ${p.likes}</div></div>`).join('');
  }
}

function renderProfileLinks(u){
  const links=[];
  if(u.website)links.push(`<a class="profile-link" href="${u.website}" target="_blank">🌐 Site web</a>`);
  if(u.tiktok)links.push(`<a class="profile-link" href="https://tiktok.com/@${u.tiktok.replace('@','')}" target="_blank">🎵 ${u.tiktok}</a>`);
  if(u.instagram)links.push(`<a class="profile-link" href="https://instagram.com/${u.instagram.replace('@','')}" target="_blank">📸 ${u.instagram}</a>`);
  if(u.twitter)links.push(`<a class="profile-link" href="https://twitter.com/${u.twitter.replace('@','')}" target="_blank">🐦 ${u.twitter}</a>`);
  if(u.linkedin)links.push(`<a class="profile-link" href="${u.linkedin}" target="_blank">💼 LinkedIn</a>`);
  if(u.youtube)links.push(`<a class="profile-link" href="https://youtube.com/@${u.youtube.replace('@','')}" target="_blank">▶️ ${u.youtube}</a>`);
  if(!links.length)return '';
  return `<div class="profile-links" style="margin-bottom:16px">${links.join('')}</div>`;
}

function renderProfileFields(u){
  const fields=[];
  if(u.title)fields.push({l:'Titre',v:u.title});
  if(u.location)fields.push({l:'Localisation',v:u.location});
  if(u.niche)fields.push({l:'Niche',v:u.niche});
  if(u.exp)fields.push({l:'Expérience',v:u.exp});
  if(u.dispo)fields.push({l:'Disponibilité',v:u.dispo});
  if(u.goal)fields.push({l:'Objectif',v:u.goal});
  if(u.skills)fields.push({l:'Compétences',v:u.skills});
  if(u.tools)fields.push({l:'Outils',v:u.tools});
  if(u.langs)fields.push({l:'Langues',v:u.langs});
  if(u.tiktokCount)fields.push({l:'Abonnés TikTok',v:u.tiktokCount});
  if(u.igCount)fields.push({l:'Abonnés Instagram',v:u.igCount});
  if(u.revenue)fields.push({l:'Revenus/mois',v:u.revenue});
  if(!fields.length)return '';
  return `<div class="profile-fields">${fields.map(f=>`<div class="pfield"><div class="pfield-label">${f.l}</div><div class="pfield-value">${f.v}</div></div>`).join('')}</div>`;
}

function openEditProfile(){
  if(!currentUser)return;
  const u=currentUser;
  const fields={name:'ep-name',username:'ep-username',title:'ep-title',location:'ep-location',bio:'ep-bio',niche:'ep-niche',goal:'ep-goal',skills:'ep-skills',tools:'ep-tools',langs:'ep-langs',website:'ep-website',tiktok:'ep-tiktok',instagram:'ep-instagram',twitter:'ep-twitter',linkedin:'ep-linkedin',youtube:'ep-youtube',tiktokCount:'ep-tiktok-count',igCount:'ep-ig-count',projectsCount:'ep-projects-count',sales:'ep-sales',looking:'ep-looking'};
  Object.entries(fields).forEach(([key,id])=>{const el=document.getElementById(id);if(el&&u[key])el.value=u[key];});
  if(u.exp){const sel=document.getElementById('ep-exp');if(sel)for(let o of sel.options)if(o.value===u.exp||o.text===u.exp)sel.value=o.value;}
  if(u.dispo){const sel=document.getElementById('ep-dispo');if(sel)for(let o of sel.options)if(o.text===u.dispo)sel.value=o.value;}
  if(u.revenue){const sel=document.getElementById('ep-revenue');if(sel)for(let o of sel.options)if(o.text===u.revenue)sel.value=o.value;}
  document.getElementById('edit-ava-preview').textContent=u.avatar||'🙂';
  openModal('edit-profile-modal');
}

function selectEmoji(el,emoji){
  document.querySelectorAll('.emoji-opt').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('edit-ava-preview').textContent=emoji;
}

function saveProfile(){
  if(!currentUser)return;
  const sel=document.getElementById('ep-exp');
  const selD=document.getElementById('ep-dispo');
  const selR=document.getElementById('ep-revenue');
  Object.assign(currentUser,{
    name:document.getElementById('ep-name').value.trim()||currentUser.name,
    username:document.getElementById('ep-username').value.trim().replace('@',''),
    title:document.getElementById('ep-title').value.trim(),
    location:document.getElementById('ep-location').value.trim(),
    bio:document.getElementById('ep-bio').value.trim(),
    niche:document.getElementById('ep-niche').value.trim(),
    exp:sel?sel.options[sel.selectedIndex].text:'',
    dispo:selD?selD.options[selD.selectedIndex].text:'',
    revenue:selR?selR.options[selR.selectedIndex].text:'',
    goal:document.getElementById('ep-goal').value.trim(),
    skills:document.getElementById('ep-skills').value.trim(),
    tools:document.getElementById('ep-tools').value.trim(),
    langs:document.getElementById('ep-langs').value.trim(),
    website:document.getElementById('ep-website').value.trim(),
    tiktok:document.getElementById('ep-tiktok').value.trim(),
    instagram:document.getElementById('ep-instagram').value.trim(),
    twitter:document.getElementById('ep-twitter').value.trim(),
    linkedin:document.getElementById('ep-linkedin').value.trim(),
    youtube:document.getElementById('ep-youtube').value.trim(),
    tiktokCount:document.getElementById('ep-tiktok-count').value.trim(),
    igCount:document.getElementById('ep-ig-count').value.trim(),
    looking:document.getElementById('ep-looking').value.trim(),
    avatar:document.getElementById('edit-ava-preview').textContent||'🙂',
    tags:[currentUser.niche,currentUser.dispo].filter(Boolean)
  });
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('edit-profile-modal');
  updateAppBar();
  renderMyProfile();
  toast('✅ Profil mis à jour !');
}

// ── FOLLOWERS ──
const sampleUsers=[
  {id:'demo1',name:'Alex M.',emoji:'🤖',plan:'pro',bio:'Créateur SaaS · 3 projets lancés',followers:142,following:89},
  {id:'demo2',name:'Sarah K.',emoji:'📈',plan:'elite',bio:'Trader & créatrice de contenu',followers:287,following:34},
  {id:'demo3',name:'Flo R.',emoji:'💪',plan:'starter',bio:'Coach fitness · 45K TikTok',followers:523,following:201},
  {id:'demo4',name:'Marc D.',emoji:'📄',plan:'free',bio:'Dev indie · outil devis',followers:67,following:45},
  {id:'demo5',name:'Tom V.',emoji:'🔬',plan:'pro',bio:'Tech & IA pour les pros',followers:198,following:112},
];

function buildFollowList(type='followers'){
  const el=document.getElementById('follow-list-container');
  if(!el)return;
  const myFollowers=currentUser?.followers||[];
  const myFollowing=currentUser?.following||[];
  let users=[];
  if(type==='followers')users=sampleUsers.filter(u=>myFollowers.includes(u.id)||Math.random()>0.5);
  if(type==='following')users=sampleUsers.filter(u=>myFollowing.includes(u.id));
  if(type==='discover')users=sampleUsers.filter(u=>u.id!==currentUser?.email);
  if(!users.length){el.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">Aucun utilisateur ${type==='following'?'suivi':type==='followers'?'abonné':'trouvé'}</div>`;return;}
  el.innerHTML=users.map(u=>`
    <div class="follow-item">
      <div class="follow-item-ava" style="background:${getAvatarColor(u.id)}">${u.emoji}</div>
      <div style="flex:1">
        <div class="follow-item-name">${u.name}</div>
        <div class="follow-item-sub">${u.bio}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px"><span class="chat-msg-plan-badge plan-${u.plan}">${u.plan.toUpperCase()}</span> · ${u.followers} abonnés</div>
      </div>
      <button class="btn-dm-list" onclick="openDMToUser('${u.id}','${u.name}')" title="DM">💬</button>
      <button class="btn-follow-list ${myFollowing.includes(u.id)?'following':''}" onclick="toggleFollow(this,'${u.id}')">${myFollowing.includes(u.id)?'Suivi ✓':'Suivre'}</button>
    </div>`).join('');
  document.getElementById('followers-count').textContent=myFollowers.length;
  document.getElementById('following-count').textContent=myFollowing.length;
}

function switchFollowTab(type,el){
  document.querySelectorAll('#tab-abonnes .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFollowList(type);
}

function toggleFollow(btn,userId){
  if(!currentUser)return;
  currentUser.following=currentUser.following||[];
  if(currentUser.following.includes(userId)){
    currentUser.following=currentUser.following.filter(id=>id!==userId);
    btn.textContent='Suivre';btn.classList.remove('following');
    toast('Désabonné');
  } else {
    currentUser.following.push(userId);
    btn.textContent='Suivi ✓';btn.classList.add('following');
    toast('✅ Abonné !');
  }
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  document.getElementById('following-count').textContent=currentUser.following.length;
}

// ── DM ──
function openDMToUser(userId,name){
  if(!currentUser){openModal('login-modal');return;}
  if(userId===currentUser.email){toast('Tu ne peux pas te DM toi-même 😄');return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='À : '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function openDMToUser(userId,name){
  if(!currentUser){openModal('login-modal');return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='À : '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function renderDMThread(userId){
  const el=document.getElementById('dm-msgs-list');
  const thread=dmThreads[userId]||[];
  if(!thread.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Début de la conversation 👋</div>';return;}
  el.innerHTML=thread.map(m=>`
    <div class="dm-msg ${m.fromMe?'mine':'theirs'}">
      <div class="dm-bubble-g">${escHtml(m.text)}</div>
      <div class="dm-time">${m.time}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
}

function sendDM(){
  if(!dmTarget||!currentUser)return;
  const inp=document.getElementById('dm-input');
  const text=inp.value.trim();
  if(!text)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  if(!dmThreads[dmTarget.id])dmThreads[dmTarget.id]=[];
  dmThreads[dmTarget.id].push({fromMe:true,text,time});
  inp.value='';
  renderDMThread(dmTarget.id);
  // WS
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'dm',toId:dmTarget.id,fromName:currentUser.name,fromPlan:currentUser.plan||'free',text}));
  }
}

// ── IA BOOST ──
function selectBoostType(el,type){
  document.querySelectorAll('#tab-ia-boost .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostType=type;
}

const boostPrompts={
  social:(n,t,d,g)=>`Expert growth hacking TikTok/Instagram. Stratégie pour:\n- Projet: ${n}\n- Cible: ${t}\n- Description: ${d}\n- Objectif: ${g}\n\nFournis: 5 scripts vidéo viraux, 20 hashtags, calendrier 30 jours, meilleurs horaires.`,
  seo:(n,t,d,g)=>`Expert SEO. Plan pour:\n- Projet: ${n}\n- Cible: ${t}\n- Description: ${d}\n\nFournis: 20 mots-clés, 5 sujets d'articles, stratégie backlinks, checklist on-page.`,
  ads:(n,t,d,g)=>`Expert copywriting pub. Crée pour:\n- Projet: ${n}\n- Cible: ${t}\n\nFournis: 3 pubs Facebook Ads, 3 scripts TikTok Ads (30s), 3 annonces Google, 5 accroches Instagram.`,
  email:(n,t,d,g)=>`Expert email marketing. Séquence pour:\n- Projet: ${n}\n- Cible: ${t}\n\nFournis: 5 emails complets (bienvenue J0, valeur J3, preuve J7, promo J14, relance J30).`,
  strategy:(n,t,d,g)=>`Consultant stratégie digitale. Plan 90j pour:\n- Projet: ${n}\n- Cible: ${t}\n- Objectif: ${g}\n\nFournis: analyse SWOT, objectifs SMART, actions mois 1/2/3, budget estimé.`,
  coach:(n,t,d,g)=>`Tu es coach marketing expert. Donne des conseils personnalisés pour:\n- Projet: ${n}\n- Description: ${d}\n- Objectif: ${g}\n\nConseils concrets, actionnables, priorisés.`
};

async function runIABoost(){
  if(!currentUser){openModal('login-modal');return;}
  const name=document.getElementById('boost-name').value.trim()||'Mon projet';
  const target=document.getElementById('boost-target').value.trim()||'Grand public';
  const desc=document.getElementById('boost-desc').value.trim()||'Projet digital';
  const goal=document.getElementById('boost-goal').value.trim()||'Croître';
  const btn=document.getElementById('btn-ia-boost');
  btn.disabled=true;btn.textContent='⚡ Génération...';
  const out=document.getElementById('boost-output-box');
  const txt=document.getElementById('boost-output-text');
  out.style.display='block';
  txt.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:boostPrompts[selectedBoostType](name,target,desc,goal)})});
    const data=await res.json();
    txt.textContent=data.content;
    toast('✅ Stratégie générée !');
  }catch(e){txt.textContent='Connecte le backend Render pour générer des stratégies IA complètes.';}
  btn.disabled=false;btn.textContent='⚡ Générer ma stratégie';
}

// ── AUTH ──
function signup(){
  const name=document.getElementById('s-name').value.trim();
  const username=document.getElementById('s-username').value.trim().replace('@','');
  const email=document.getElementById('s-email').value.trim();
  const pass=document.getElementById('s-pass').value;
  if(!name||!email||!pass){toast('Remplis tous les champs obligatoires.');return;}
  if(pass.length<8){toast('Mot de passe trop court (8 car. min).');return;}
  if(selectedSignupPlan!=='free'){
    closeModal('signup-modal');
    pendingSignup={name,username,email,pass};
    startPayment(selectedSignupPlan);
    return;
  }
  createUser({name,username,email,plan:'free'});
  closeModal('signup-modal');
  showApp();
}

let pendingSignup=null;

function createUser({name,username,email,plan}){
  currentUser={id:email,name,username:username||email.split('@')[0],email,plan:plan||'free',avatar:'🙂',bio:'',followers:[],following:[],projects:[],totalVotes:0,createdAt:new Date().toISOString()};
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  try{fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)});}catch(e){}
  // Onboarding après 1 seconde
  setTimeout(showOnboarding, 1000);
}

// ── SUPER ADMIN ──
const SUPER_ADMIN_EMAIL='soug759@gmail.com';
const SUPER_ADMIN_PASS='Carla123';

function isSuperAdmin(email,pass){
  return email===SUPER_ADMIN_EMAIL&&pass===SUPER_ADMIN_PASS;
}

function loginAsSuperAdmin(){
  currentUser={
    id:SUPER_ADMIN_EMAIL,
    name:'Admin',
    username:'admin_viralboost',
    email:SUPER_ADMIN_EMAIL,
    plan:'elite',
    avatar:'👑',
    bio:'Super Administrateur de ViralBoost',
    isSuperAdmin:true,
    followers:[],following:[],projects:[],totalVotes:0,
    createdAt:new Date().toISOString()
  };
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('login-modal');
  showApp();
  // Charger toutes les données admin
  loadAdminData();
}

async function loadAdminData(){
  // Charger tous les utilisateurs, signalements, DMs, projets
  try{
    const [usersRes,reportsRes,dmsRes,projectsRes]=await Promise.all([
      fetch('/api/admin/all-users?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/reports?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/dms?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/projects').catch(()=>({ok:false}))
    ]);
    window._adminData={
      users: usersRes.ok ? await usersRes.json() : [],
      reports: reportsRes.ok ? await reportsRes.json() : [],
      dms: dmsRes.ok ? await dmsRes.json() : [],
      projects: projectsRes.ok ? await projectsRes.json() : []
    };
    toast('👑 Accès Admin total activé !');
    showAdminPanel();
  }catch(e){
    toast('👑 Mode Admin activé (données locales)');
    window._adminData={users:[],reports:[],dms:[],projects:[]};
    showAdminPanel();
  }
}

function showAdminPanel(){
  // Ajouter onglet Admin dans la barre si pas déjà là
  const tabs=document.querySelector('.app-tabs');
  if(tabs&&!document.getElementById('tab-btn-admin')){
    const btn=document.createElement('button');
    btn.className='app-tab';
    btn.id='tab-btn-admin';
    btn.style.color='#ffd700';
    btn.style.borderBottomColor='#ffd700';
    btn.innerHTML='👑 Admin';
    btn.onclick=()=>showAppTab('admin',btn);
    tabs.appendChild(btn);
    // Créer le panel admin
    const panel=document.createElement('div');
    panel.className='tpanel';
    panel.id='tab-admin';
    panel.innerHTML=buildAdminPanelHTML();
    document.querySelector('#app > div[style]').appendChild(panel);
  }
}

function buildAdminPanelHTML(){
  const d=window._adminData||{};
  const users=d.users||[];
  const reports=d.reports||[];
  const dms=d.dms||[];
  const projects=d.projects||[];

  // Compute stats
  const planCount={free:0,starter:0,pro:0,elite:0};
  users.forEach(u=>{ if(planCount[u.plan]!==undefined) planCount[u.plan]++; else planCount.free++; });
  const revenue=(planCount.starter*3)+(planCount.pro*14.99)+(planCount.elite*39.99);
  const todayStr=new Date().toLocaleDateString('fr-FR');
  const todayUsers=users.filter(u=>u.createdAt&&new Date(u.createdAt).toLocaleDateString('fr-FR')===todayStr).length;
  const bannedUsers=users.filter(u=>u.banned).length;

  // Local users from localStorage (toujours visibles même sans MongoDB)
  const localUser=JSON.parse(localStorage.getItem('viralboost_user')||'null');
  const allLocalKeys=Object.keys(localStorage).filter(k=>k.startsWith('viralboost_user'));
  const localUsers=localUser?[localUser]:[];

  const mergedUsers=users.length>0?users:localUsers;

  return `
  <div style="max-width:1200px;margin:0 auto;padding:22px 0">

    <!-- HEADER ADMIN -->
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px">
      <div>
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:38px;letter-spacing:3px;color:#ffd700;margin-bottom:2px">👑 SUPER ADMIN DASHBOARD</h2>
        <p style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace">soug759@gmail.com · Accès total · Mis à jour : ${new Date().toLocaleString('fr-FR')}</p>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button onclick="loadAdminData()" style="background:rgba(255,215,0,0.1);border:1.5px solid rgba(255,215,0,0.3);border-radius:6px;padding:7px 14px;font-size:11px;color:#ffd700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-weight:700">🔄 Rafraîchir</button>
        <button onclick="adminExportCSV()" style="background:rgba(34,197,94,0.1);border:1.5px solid rgba(34,197,94,0.3);border-radius:6px;padding:7px 14px;font-size:11px;color:var(--g3);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-weight:700">📥 Export CSV</button>
        <a href="/admin?key=viralboost-admin" target="_blank" style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:6px;padding:7px 14px;font-size:11px;color:#ffd700;text-decoration:none;font-family:'Plus Jakarta Sans',sans-serif;font-weight:700">🖥️ Serveur →</a>
      </div>
    </div>

    <!-- KPI CARDS -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:28px">
      <div style="background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:12px;padding:18px;position:relative;overflow:hidden">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:rgba(255,215,0,0.6);letter-spacing:2px;margin-bottom:8px">TOTAL INSCRITS</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:44px;color:#ffd700;line-height:1">${mergedUsers.length||0}</div>
        <div style="font-size:10px;color:rgba(255,215,0,0.5);margin-top:4px">+${todayUsers} aujourd'hui</div>
        <div style="position:absolute;right:12px;top:12px;font-size:28px;opacity:0.15">👥</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(34,197,94,0.08),rgba(22,163,74,0.04));border:1.5px solid rgba(34,197,94,0.25);border-radius:12px;padding:18px;position:relative;overflow:hidden">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:rgba(34,197,94,0.6);letter-spacing:2px;margin-bottom:8px">REVENU MENSUEL</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--g3);line-height:1">${revenue.toFixed(0)}€</div>
        <div style="font-size:10px;color:rgba(34,197,94,0.5);margin-top:4px">${planCount.pro} Pro · ${planCount.elite} Elite · ${planCount.starter} Starter</div>
        <div style="position:absolute;right:12px;top:12px;font-size:28px;opacity:0.15">💰</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(248,113,113,0.08),rgba(220,38,38,0.04));border:1.5px solid rgba(248,113,113,0.25);border-radius:12px;padding:18px;position:relative;overflow:hidden">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:rgba(248,113,113,0.6);letter-spacing:2px;margin-bottom:8px">SIGNALEMENTS</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:44px;color:#f87171;line-height:1">${reports.length}</div>
        <div style="font-size:10px;color:rgba(248,113,113,0.5);margin-top:4px">${bannedUsers} bannis</div>
        <div style="position:absolute;right:12px;top:12px;font-size:28px;opacity:0.15">🚨</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(139,92,246,0.08),rgba(109,40,217,0.04));border:1.5px solid rgba(139,92,246,0.25);border-radius:12px;padding:18px;position:relative;overflow:hidden">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:rgba(139,92,246,0.6);letter-spacing:2px;margin-bottom:8px">PUBLICATIONS</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:44px;color:#a78bfa;line-height:1">${projects.length||vitrineData.length}</div>
        <div style="font-size:10px;color:rgba(139,92,246,0.5);margin-top:4px">${dms.length} DMs admin</div>
        <div style="position:absolute;right:12px;top:12px;font-size:28px;opacity:0.15">📢</div>
      </div>
    </div>

    <!-- PLAN BREAKDOWN -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:28px">
      ${['free','starter','pro','elite'].map((p,i)=>{
        const colors=['#4a7a58','#22c55e','#4ade80','#ffd700'];
        const pct=mergedUsers.length?Math.round((planCount[p]/mergedUsers.length)*100):0;
        return `<div style="background:var(--s1);border:1px solid var(--border2);border-radius:8px;padding:12px 14px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span class="chat-msg-plan-badge plan-${p}" style="font-size:9px">${p.toUpperCase()}</span>
            <span style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:${colors[i]}">${planCount[p]}</span>
          </div>
          <div style="height:4px;background:var(--s2);border-radius:2px">
            <div style="height:4px;background:${colors[i]};border-radius:2px;width:${pct}%;transition:width 0.5s"></div>
          </div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px;font-family:'DM Mono',monospace">${pct}% des membres</div>
        </div>`;
      }).join('')}
    </div>

    <!-- TABS NAVIGATION -->
    <div class="feed-tabs" style="margin-bottom:20px">
      <button class="feed-tab active" onclick="switchAdminTab('users',this)">👥 Membres (${mergedUsers.length})</button>
      <button class="feed-tab" onclick="switchAdminTab('projects',this)">📢 Pubs (${projects.length||vitrineData.length})</button>
      <button class="feed-tab" onclick="switchAdminTab('reports',this)">🚨 Signalements (${reports.length})</button>
      <button class="feed-tab" onclick="switchAdminTab('dms',this)">📩 DMs Admin (${dms.length})</button>
      <button class="feed-tab" onclick="switchAdminTab('chat',this)">💬 Chat Live</button>
    </div>

    <!-- TAB: USERS -->
    <div id="admin-tab-users">
      <!-- Barre de recherche -->
      <div style="display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap">
        <input type="text" id="admin-search" placeholder="🔍 Rechercher par nom, email..." oninput="adminFilterUsers(this.value)" style="flex:1;min-width:200px;padding:9px 14px;background:var(--s1);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none"/>
        <select id="admin-plan-filter" onchange="adminFilterUsers(document.getElementById('admin-search').value)" style="padding:9px 12px;background:var(--s1);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none">
          <option value="">Tous les plans</option>
          <option value="free">FREE</option>
          <option value="starter">STARTER</option>
          <option value="pro">PRO</option>
          <option value="elite">ELITE</option>
        </select>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden">
        <table style="width:100%;border-collapse:collapse" id="admin-users-table">
          <thead><tr style="background:var(--s2)">
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">#</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">MEMBRE</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">EMAIL</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">PLAN</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">INSCRIT LE</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">PSEUDO</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">STATUT</th>
            <th style="padding:12px 14px;text-align:left;font-size:9px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">ACTIONS</th>
          </tr></thead>
          <tbody id="admin-users-tbody">
            ${mergedUsers.length?mergedUsers.map((u,i)=>`<tr class="admin-user-row" data-name="${(u.name||'').toLowerCase()}" data-email="${(u.email||'').toLowerCase()}" data-plan="${u.plan||'free'}" style="border-top:1px solid var(--border2);transition:background 0.15s" onmouseover="this.style.background='rgba(255,215,0,0.03)'" onmouseout="this.style.background=''">
              <td style="padding:10px 14px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2)">${i+1}</td>
              <td style="padding:10px 14px">
                <div style="display:flex;align-items:center;gap:8px">
                  <div style="width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,#15803d,#22c55e);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0">${u.avatar||u.name?.[0]||'?'}</div>
                  <div>
                    <div style="font-size:13px;font-weight:700">${u.name||'Inconnu'}</div>
                    <div style="font-size:10px;color:var(--muted)">${u.bio?u.bio.slice(0,35):'—'}</div>
                  </div>
                </div>
              </td>
              <td style="padding:10px 14px;font-size:11px;color:var(--muted);font-family:'DM Mono',monospace">${u.email||'—'}</td>
              <td style="padding:10px 14px">
                <span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span>
                ${u.banned?'<span style="background:rgba(248,113,113,0.2);color:#f87171;font-size:8px;padding:2px 5px;border-radius:3px;margin-left:4px;font-family:DM Mono,monospace">BANNI</span>':''}
              </td>
              <td style="padding:10px 14px;font-size:11px;color:var(--muted)">${u.createdAt?new Date(u.createdAt).toLocaleDateString('fr-FR'):'—'}</td>
              <td style="padding:10px 14px;font-size:12px;color:var(--muted2);font-family:'DM Mono',monospace">@${u.username||'—'}</td>
              <td style="padding:10px 14px">
                <span style="width:7px;height:7px;border-radius:50%;background:${u.banned?'#f87171':'var(--g3)'};display:inline-block;margin-right:5px;box-shadow:0 0 5px ${u.banned?'#f87171':'var(--g3)'}"></span>
                <span style="font-size:10px;color:var(--muted)">${u.banned?'Banni':'Actif'}</span>
              </td>
              <td style="padding:10px 14px">
                <div style="display:flex;gap:5px;flex-wrap:wrap">
                  <select onchange="adminChangePlan('${u.email}',this.value)" style="background:var(--s2);border:1px solid var(--border);border-radius:4px;padding:3px 6px;font-size:10px;color:var(--g4);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">
                    <option value="">Plan...</option>
                    <option value="free" ${u.plan==='free'?'selected':''}>FREE</option>
                    <option value="starter" ${u.plan==='starter'?'selected':''}>STARTER</option>
                    <option value="pro" ${u.plan==='pro'?'selected':''}>PRO</option>
                    <option value="elite" ${u.plan==='elite'?'selected':''}>ELITE</option>
                  </select>
                  <button onclick="adminBanUser('${u.email}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:3px 8px;font-size:10px;color:#f87171;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif" title="${u.banned?'Débannir':'Bannir'}">${u.banned?'✓':'🚫'}</button>
                  <button onclick="adminSendDM('${u.email}','${u.name}')" style="background:transparent;border:1px solid rgba(34,197,94,0.3);border-radius:4px;padding:3px 8px;font-size:10px;color:var(--g3);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif" title="DM">💬</button>
                </div>
              </td>
            </tr>`).join(''):`<tr><td colspan="8" style="padding:36px;text-align:center;color:var(--muted)">
              <div style="font-size:32px;margin-bottom:12px">👥</div>
              <div style="font-size:14px;font-weight:700;margin-bottom:6px">Aucun utilisateur enregistré</div>
              <div style="font-size:12px">Connecte MongoDB pour voir tous les inscrits en temps réel</div>
            </td></tr>`}
          </tbody>
        </table>
      </div>
      ${mergedUsers.length?`<div style="margin-top:10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);text-align:right">${mergedUsers.length} membre${mergedUsers.length>1?'s':''} au total</div>`:''}
    </div>

    <!-- TAB: PROJECTS -->
    <div id="admin-tab-projects" style="display:none">
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px">
        ${(projects.length?projects:vitrineData).map(p=>`
        <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden">
          <div style="height:80px;background:${p.color||'var(--s2)'};display:flex;align-items:center;justify-content:center;font-size:36px;position:relative">
            ${p.emoji||'🚀'}
            <div style="position:absolute;top:6px;left:6px;background:#ffd700;color:#1a0a00;font-family:DM Mono,monospace;font-size:8px;font-weight:700;padding:2px 6px;border-radius:2px;letter-spacing:1px">${(p.cat||p.type||'pub').toUpperCase()}</div>
            <div style="position:absolute;top:6px;right:6px">
              <button onclick="adminDeleteProject('${p.id}')" style="background:rgba(248,113,113,0.2);border:1px solid rgba(248,113,113,0.4);border-radius:4px;padding:2px 7px;font-size:10px;color:#f87171;cursor:pointer">🗑</button>
            </div>
          </div>
          <div style="padding:12px 14px">
            <div style="font-size:14px;font-weight:700;margin-bottom:3px">${p.name}</div>
            <div style="font-size:11px;color:var(--muted);margin-bottom:8px;line-height:1.5">${(p.desc||'').slice(0,70)}</div>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-size:11px;color:var(--muted2)">par ${p.author||'?'}</div>
              <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3)">▲ ${p.votes||0}</div>
            </div>
          </div>
        </div>`).join('')||'<div style="grid-column:1/-1;text-align:center;padding:48px;color:var(--muted)">Aucune publication</div>'}
      </div>
    </div>

    <!-- TAB: REPORTS -->
    <div id="admin-tab-reports" style="display:none">
      ${reports.length?`<div style="display:flex;flex-direction:column;gap:10px">
        ${reports.map(r=>`<div style="background:rgba(248,113,113,0.06);border:1.5px solid rgba(248,113,113,0.2);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap">
            <span style="font-size:13px;font-weight:700;color:#f87171">🚨 ${r.reportedName||r.reportedId||'?'}</span>
            <span style="font-size:11px;color:var(--muted)">signalé par <strong>${r.reporterName||r.reporterEmail||'?'}</strong></span>
            <span style="background:rgba(248,113,113,0.15);color:#f87171;font-size:9px;padding:2px 7px;border-radius:3px;font-family:'DM Mono',monospace;margin-left:auto">${r.reason||'?'}</span>
          </div>
          ${r.details?`<div style="font-size:12px;color:var(--muted);background:rgba(0,0,0,0.2);border-radius:6px;padding:8px 12px;margin-bottom:8px">${r.details}</div>`:''}
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace">${r.createdAt?new Date(r.createdAt).toLocaleString('fr-FR'):''}</div>
            <button onclick="adminBanUser('${r.reportedId||r.reportedName}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:4px 10px;font-size:10px;color:#f87171;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Bannir le signalé</button>
          </div>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:60px;color:var(--muted)"><div style="font-size:40px;margin-bottom:12px">🎉</div><div style="font-size:15px;font-weight:700">Aucun signalement !</div></div>'}
    </div>

    <!-- TAB: DMs -->
    <div id="admin-tab-dms" style="display:none">
      ${dms.length?`<div style="display:flex;flex-direction:column;gap:10px">
        ${dms.map(d=>`<div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap">
            <span style="font-size:18px">👑</span>
            <span style="font-size:13px;font-weight:700;color:#ffd700">${d.fromName||d.fromEmail||'?'}</span>
            <span class="chat-msg-plan-badge plan-${d.fromPlan||'elite'}">${(d.fromPlan||'ELITE').toUpperCase()}</span>
            <span style="font-size:10px;color:var(--muted);margin-left:auto;font-family:'DM Mono',monospace">${d.createdAt?new Date(d.createdAt).toLocaleString('fr-FR'):''}</span>
          </div>
          <div style="font-size:13px;color:var(--g5);background:rgba(255,215,0,0.04);border-radius:6px;padding:10px 12px;margin-bottom:8px">${d.text||'—'}</div>
          <div style="display:flex;gap:8px">
            <button onclick="replyToAdminDM('${d.fromEmail}')" style="background:transparent;border:1px solid rgba(255,215,0,0.25);border-radius:4px;padding:5px 12px;font-size:11px;color:#ffd700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">💬 Répondre</button>
            <span style="font-size:11px;color:var(--muted);align-self:center">De : ${d.fromEmail||'?'}</span>
          </div>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:60px;color:var(--muted)"><div style="font-size:40px;margin-bottom:12px">📩</div><div>Aucun DM admin pour le moment</div></div>'}
    </div>

    <!-- TAB: CHAT LIVE -->
    <div id="admin-tab-chat" style="display:none">
      <div class="chat-box" style="height:500px">
        <div class="chat-msgs-area" id="admin-chat-msgs">
          <div style="text-align:center;padding:32px;color:var(--muted)">Chat en temps réel visible ici après connexion WebSocket</div>
        </div>
        <div class="chat-input-row">
          <input type="text" id="admin-chat-in" class="chat-input-field" placeholder="Envoyer un message en tant qu'Admin 👑..." onkeydown="if(event.key==='Enter')sendAdminChatMsg()"/>
          <button class="btn-send" onclick="sendAdminChatMsg()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">→</button>
        </div>
      </div>
    </div>

  </div>`;
}

// ── ADMIN: Filtrer les utilisateurs ──
function adminFilterUsers(q){
  const plan=document.getElementById('admin-plan-filter')?.value||'';
  const qLow=(q||'').toLowerCase();
  document.querySelectorAll('#admin-users-tbody .admin-user-row').forEach(row=>{
    const matchQ=!qLow||row.dataset.name?.includes(qLow)||row.dataset.email?.includes(qLow);
    const matchP=!plan||row.dataset.plan===plan;
    row.style.display=(matchQ&&matchP)?'':'none';
  });
}

// ── ADMIN: Changer le plan d'un utilisateur ──
async function adminChangePlan(email,plan){
  if(!plan||!email)return;
  try{
    await fetch('/api/admin/set-plan',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,plan,key:'viralboost-admin'})}).catch(()=>{});
    toast(`✅ Plan de ${email} → ${plan.toUpperCase()}`);
    // Refresh
    setTimeout(()=>loadAdminData(),800);
  }catch(e){toast('Erreur changement plan');}
}

// ── ADMIN: DM à un user depuis admin ──
function adminSendDM(email,name){
  openDMToUser(email,name||email);
}

// ── ADMIN: Export CSV ──
function adminExportCSV(){
  const d=window._adminData||{};
  const users=d.users||[];
  const localUser=JSON.parse(localStorage.getItem('viralboost_user')||'null');
  const allUsers=users.length>0?users:(localUser?[localUser]:[]);
  if(!allUsers.length){toast('Aucun utilisateur à exporter');return;}
  const headers=['Nom','Email','Pseudo','Plan','Inscrit','Bio'];
  const rows=allUsers.map(u=>[
    `"${(u.name||'').replace(/"/g,'""')}"`,
    `"${u.email||''}"`,
    `"@${u.username||''}"`,
    `"${u.plan||'free'}"`,
    `"${u.createdAt?new Date(u.createdAt).toLocaleDateString('fr-FR'):''}"`,
    `"${(u.bio||'').replace(/"/g,'""').slice(0,100)}"`
  ].join(','));
  const csv=[headers.join(','),...rows].join('\n');
  const blob=new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='viralboost_membres_'+new Date().toISOString().split('T')[0]+'.csv';
  document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
  toast('📥 CSV exporté !');
}

function switchAdminTab(tab,el){
  document.querySelectorAll('#tab-admin .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  ['users','reports','dms','projects','chat'].forEach(t=>{
    const el2=document.getElementById('admin-tab-'+t);
    if(el2)el2.style.display=t===tab?'block':'none';
  });
}

function adminBanUser(email){
  if(confirm('Bannir '+email+' ?')){
    fetch('/api/admin/ban',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,key:'viralboost-admin'})}).catch(()=>{});
    toast('🚫 Utilisateur banni : '+email);
  }
}

function adminDeleteProject(id){
  if(confirm('Supprimer ce projet ?')){
    vitrineData=vitrineData.filter(p=>p.id!==id);
    fetch('/api/projects/'+id,{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({key:'viralboost-admin'})}).catch(()=>{});
    toast('🗑 Projet supprimé');
    document.getElementById('tab-admin').innerHTML=buildAdminPanelHTML();
  }
}

function replyToAdminDM(email){
  openDMToUser(email, email.split('@')[0]);
}

function sendAdminChatMsg(){
  const inp=document.getElementById('admin-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  inp.value='';
  const el=document.getElementById('admin-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.style.background='rgba(255,215,0,0.06)';
  div.style.border='1px solid rgba(255,215,0,0.15)';
  div.innerHTML=`<div class="chat-msg-name"><span style="color:#ffd700">👑 Admin</span> <span class="admin-msg-badge">ADMIN</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({type:'message',name:'👑 Admin',plan:'elite',text,isAdmin:true}));
  }
}

function login(){
  const email=document.getElementById('l-email').value.trim();
  const pass=document.getElementById('l-pass').value;
  if(!email||!pass){toast('Remplis tous les champs.');return;}

  // ── SUPER ADMIN ──
  if(isSuperAdmin(email,pass)){
    loginAsSuperAdmin();
    return;
  }

  const saved=localStorage.getItem('viralboost_user');
  if(saved){
    const u=JSON.parse(saved);
    if(u.email===email){currentUser=u;closeModal('login-modal');showApp();return;}
  }
  createUser({name:email.split('@')[0],email,plan:'free'});
  closeModal('login-modal');
  showApp();
}

function logout(){
  currentUser=null;
  document.getElementById('app').style.display='none';
  document.getElementById('landing').style.display='block';
  window.scrollTo(0,0);
}

async function loadVitrineFromAPI(){
  try{
    const r=await fetch('/api/projects');
    const apiProjects=await r.json();
    if(Array.isArray(apiProjects)&&apiProjects.length>0){
      const apiIds=new Set(apiProjects.map(p=>p.id));
      vitrineData=[...apiProjects,...(vitrineData||[]).filter(p=>!apiIds.has(p.id))];
    }
  }catch(e){}
  buildVitrineGrid('app-vitrine-grid');
}

function showApp(){
  document.getElementById('landing').style.display='none';
  document.getElementById('app').style.display='block';
  updateAppBar();
  loadPostsFromAPI();
  loadVitrineFromAPI();
  window.scrollTo(0,0);
  connectWS();
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  document.getElementById('feed-limit-info').innerHTML=`Plan ${(currentUser.plan||'FREE').toUpperCase()} · <span id="pubs-left">${plan.limits.pubsPerHour||plan.limits.pubsPerDay||'∞'}</span> pub${currentUser.plan==='free'?'/h':'/jour'}`;
  const chatLeft=Math.max(0,(PLANS.find(p=>p.id===currentUser.plan)||PLANS[0]).limits.chatMsgs-chatMsgsToday);
  document.getElementById('chat-msgs-left').textContent=chatLeft;
}

function updateAppBar(){
  if(!currentUser)return;
  document.getElementById('app-user-name').textContent=currentUser.name;
  document.getElementById('app-user-ava').textContent=currentUser.avatar||currentUser.name[0];
  document.getElementById('app-plan-chip').textContent=(currentUser.plan||'FREE').toUpperCase();
}

// ── PAYMENT ──
function startPayment(planId){
  const plan=PLANS.find(p=>p.id===planId);
  if(!plan||plan.price===0)return;
  pendingPlan=planId;
  document.getElementById('pay-plan-name').textContent=plan.name;
  document.getElementById('pay-plan-price').textContent=plan.price+'€';
  openModal('payment-modal');
  if(stripe){
    const el=stripe.elements({appearance:{theme:'night',variables:{colorPrimary:'#22c55e',colorBackground:'#0b1a0d',colorText:'#f0fdf4',borderRadius:'8px'}}});
    cardElement=el.create('card');
    setTimeout(()=>cardElement.mount('#card-element'),100);
  }
}

async function processPayment(){
  const btn=document.getElementById('btn-pay');
  btn.disabled=true;btn.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  const amounts={starter:300,pro:1499,elite:3999};
  try{
    const r=await fetch('/api/create-payment-intent',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan:pendingPlan,amount:amounts[pendingPlan]||300})});
    const{clientSecret,error:ie}=await r.json();
    if(ie)throw new Error(ie);
    const{error,paymentIntent}=await stripe.confirmCardPayment(clientSecret,{payment_method:{card:cardElement}});
    if(error)throw new Error(error.message);
    if(paymentIntent.status==='succeeded'){
      if(pendingSignup){createUser({...pendingSignup,plan:pendingPlan});pendingSignup=null;}
      else if(currentUser){currentUser.plan=pendingPlan;localStorage.setItem('viralboost_user',JSON.stringify(currentUser));}
      closeModal('payment-modal');
      updateAppBar();
      showApp();
      toast('🎉 Plan '+pendingPlan.toUpperCase()+' activé !');
    }
  }catch(err){
    document.getElementById('card-errors').textContent=err.message;
    btn.disabled=false;btn.textContent='🔒 S\'abonner';
  }
}

// ── WEBSOCKET ──
function connectWS(){
  if(!currentUser)return;
  try{
    const proto=location.protocol==='https:'?'wss':'ws';
    ws=new WebSocket(`${proto}://${location.host}`);
    ws.onopen=()=>{
      ws.send(JSON.stringify({type:'join',userId:currentUser.email,name:currentUser.name,plan:currentUser.plan||'free'}));
    };
    ws.onmessage=(e)=>{
      try{
        const data=JSON.parse(e.data);
        // Historique du chat au chargement (messages précédents)
        if(data.type==='history'&&Array.isArray(data.messages)){
          worldChatMsgs=data.messages.map(m=>({name:m.name,plan:m.plan||'free',text:m.text,time:new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})}));
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
        }
        // Publications vitrine précédentes envoyées au login
        if(data.type==='projects_history'&&Array.isArray(data.projects)){
          const apiIds=new Set(data.projects.map(p=>p.id));
          vitrineData=[...data.projects,...(vitrineData||[]).filter(p=>!apiIds.has(p.id))];
          if(document.getElementById('tab-vitrine')?.classList.contains('active'))buildVitrineGrid('app-vitrine-grid');
        }
        if(data.type==='message'&&data.message){
          worldChatMsgs.push({name:data.message.name,plan:data.message.plan||'free',text:data.message.text,time:new Date(data.message.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
          else{const nd=document.getElementById('chat-notif');if(nd)nd.style.display='inline-block';}
        }
        if(data.type==='online_users'){
          const cnt=document.getElementById('world-online-count');
          if(cnt)cnt.textContent=data.users.length+' en ligne';
        }
        if(data.type==='dm'&&data.message?.fromId){
          const fromId=data.message.fromId;
          if(!dmThreads[fromId])dmThreads[fromId]=[];
          dmThreads[fromId].push({fromMe:false,text:data.message.text,time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(dmTarget&&dmTarget.id===fromId)renderDMThread(fromId);
          toast('💬 Nouveau DM de '+data.message.fromName);
          addNotif('DM de '+data.message.fromName,'💬');
        }
        if(data.type==='vote_update'){
          document.querySelectorAll('[data-pid="'+data.projectId+'"] .vote-count').forEach(el=>el.textContent=data.votes);
        }
        if(data.type==='new_project'&&data.project?.authorId!==currentUser?.email){
          vitrineData.unshift(data.project);
          toast('🚀 Nouveau projet : '+data.project.name);
          addNotif('Nouveau projet : '+data.project.name,'🚀');
        }
        if(data.type==='new_post'&&data.post?.userId!==currentUser?.email){
          // Ajouter le post en temps réel
          if(!feedPosts.find(p=>p.id===data.post.id)){
            const p=data.post;
            p.time='À l\'instant';
            feedPosts.unshift(p);
            if(document.getElementById('tab-feed')?.classList.contains('active'))buildFeed();
          }
        }
        if(data.type==='like_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p){p.likes=data.likes;}
          const cnt=document.querySelector(`#post-${data.postId} .like-count`);
          if(cnt)cnt.textContent=data.likes;
        }
        if(data.type==='comment_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p)p.comments=data.comments;
          const cnt=document.querySelector(`#post-${data.postId} .comment-count`);
          if(cnt)cnt.textContent=data.comments;
        }
        if(data.type==='share_update'){
          const cnt=document.querySelector(`#post-${data.postId} .share-count`);
          if(cnt)cnt.textContent=data.shares;
        }
        if(data.type==='group_message'&&data.groupId===currentGroupId){
          if(document.getElementById('group-chat-modal')?.classList.contains('open')){
            loadGroupMessages(currentGroupId);
          }
        }
      }catch(e){}
    };
    ws.onclose=()=>setTimeout(connectWS,5000);
  }catch(e){}
}

// ── TIMERS (posts) ──
function updateTimers(){
  document.querySelectorAll('.post-timer-val').forEach(el=>{
    const end=parseInt(el.dataset.end);
    if(!end)return;
    const left=end-Date.now();
    if(left<=0){el.closest('.post-card')?.remove();return;}
    const m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);
    el.textContent=m+'m'+String(s).padStart(2,'0')+'s';
  });
}
setInterval(updateTimers,1000);

// ── TABS update to include groupes ──
function showAppTab(tab,el){
  document.querySelectorAll('.app-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tpanel').forEach(p=>p.classList.remove('active'));
  if(el)el.classList.add('active');
  const panel=document.getElementById('tab-'+tab);
  if(panel)panel.classList.add('active');
  if(tab==='vitrine')buildVitrineGrid('app-vitrine-grid');
  if(tab==='profil')renderMyProfile();
  if(tab==='abonnes')buildFollowList('discover');
  if(tab==='chat-global'){buildWorldChat();const nd=document.getElementById('chat-notif');if(nd)nd.style.display='none';}
  if(tab==='feed'){buildFeed();buildTrendingPosts();}
  if(tab==='groupes')loadGroups();
}

// ── GROUPES ──
async function loadGroups(){
  try{
    const r=await fetch('/api/groups');
    groupsData=await r.json();
  }catch(e){groupsData=sampleGroups;}
  buildGroupsList();
  // Show create button for ELITE only
  const btn=document.getElementById('btn-create-group');
  if(btn)btn.style.display=(currentUser?.plan==='elite')?'block':'none';
}

const sampleGroups=[
  {id:'sg1',name:'SaaS Builders FR',emoji:'🚀',desc:'Créateurs SaaS et indie hackers francophones',cat:'SaaS / Tech',membersCount:342,creatorId:'demo1',bgUrl:'',access:'public'},
  {id:'sg2',name:'TikTok Créateurs',emoji:'🎵',desc:'Stratégies, trends et croissance TikTok',cat:'TikTok',membersCount:891,creatorId:'demo2',bgUrl:'',access:'public'},
  {id:'sg3',name:'Growth Marketing',emoji:'📈',desc:'Hacks de croissance, funnel et acquisition',cat:'Marketing',membersCount:567,creatorId:'demo5',bgUrl:'',access:'public'},
];

function buildGroupsList(){
  const el=document.getElementById('groups-list');
  if(!el)return;
  const data=groupsData.length?groupsData:sampleGroups;
  el.innerHTML=data.map(g=>`
    <div class="group-card" onclick="openGroupChat('${g.id}','${escHtml(g.name)}','${g.creatorId}','${g.access}','${g.allowPhotos||1}')">
      <div class="group-banner" style="${g.bgUrl?`background:url('${g.bgUrl}') center/cover`:'background:linear-gradient(135deg,var(--s2),var(--s3))'}">
        <span style="font-size:36px">${g.emoji||'💬'}</span>
        ${g.access==='private'?'<span style="position:absolute;top:8px;right:8px;font-size:10px;background:rgba(0,0,0,0.6);padding:2px 7px;border-radius:4px;color:#fff">🔒 Privé</span>':''}
      </div>
      <div class="group-body">
        <div class="group-name">${g.name}</div>
        <div class="group-desc">${g.desc||''}</div>
        <div class="group-footer">
          <div class="group-meta">👥 ${g.membersCount||0} membres · ${g.cat||''}</div>
          ${currentUser?.plan==='elite'&&currentUser?.email===g.creatorId?`<button class="btn-report" onclick="event.stopPropagation();openGroupSettings('${g.id}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Admin</button>`:''}
        </div>
      </div>
    </div>`).join('');
}

async function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser){openModal('login-modal');return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  // Show admin btn if elite creator
  const acts=document.getElementById('group-chat-actions');
  acts.innerHTML='';
  if(currentUser.plan==='elite'&&currentUser.email===creatorId){
    acts.innerHTML=`<button class="btn-report" onclick="openGroupSettings('${groupId}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Paramètres groupe</button>`;
  }
  // Show media upload if allowed
  const mediaBtnLabel=document.getElementById('group-media-btn');
  if(mediaBtnLabel)mediaBtnLabel.style.display=(allowPhotos==='1'||allowPhotos===1)?'flex':'none';
  await loadGroupMessages(groupId);
  openModal('group-chat-modal');
}

async function loadGroupMessages(groupId){
  const el=document.getElementById('group-chat-msgs');
  try{
    const r=await fetch('/api/groups/'+groupId+'/messages');
    const msgs=await r.json();
    if(!msgs.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Premier à écrire dans ce groupe 👋</div>';return;}
    el.innerHTML=msgs.map(m=>`
      <div class="chat-msg-item">
        <div class="chat-msg-name">${escHtml(m.author||'Anonyme')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>
        ${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}
        ${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px;object-fit:cover"/>`}</div>`:''}
      </div>`).join('');
    el.scrollTop=el.scrollHeight;
  }catch(e){el.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px">Impossible de charger les messages</div>';}
}

async function sendGroupMessage(){
  if(!currentUser){openModal('login-modal');return;}
  const inp=document.getElementById('group-chat-input');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const msg={text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
  inp.value='';
  try{await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});}catch(e){}
  await loadGroupMessages(currentGroupId);
}

function openCreateGroup(){
  if(currentUser?.plan!=='elite'){toast('⭐ Créer un groupe est réservé au plan ELITE.');startPayment('elite');return;}
  openModal('create-group-modal');
}

async function createGroup(){
  if(!currentUser){return;}
  const name=document.getElementById('grp-name').value.trim();
  const desc=document.getElementById('grp-desc').value.trim();
  if(!name||!desc){toast('Remplis le nom et la description.');return;}
  const group={
    name,desc,emoji:document.getElementById('grp-emoji').value||'💬',
    cat:document.getElementById('grp-cat').value,
    access:document.getElementById('grp-access').value,
    rules:document.getElementById('grp-rules').value.trim(),
    bgUrl:groupBgUrl||'',allowPhotos:1,
    creatorId:currentUser.email,membersCount:1
  };
  try{
    const r=await fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)});
    const d=await r.json();
    toast('🏛️ Groupe créé !');
    closeModal('create-group-modal');
    groupBgUrl=null;
    await loadGroups();
  }catch(e){toast('Erreur création groupe.');}
}

function openGroupSettings(groupId){
  currentGroupSettingsId=groupId;
  const grp=groupsData.find(g=>g.id===groupId)||sampleGroups.find(g=>g.id===groupId);
  if(grp){
    document.getElementById('gs-rules').value=grp.rules||'';
    document.getElementById('gs-allow-photos').value=grp.allowPhotos||1;
    document.getElementById('gs-access').value=grp.access||'public';
  }
  openModal('group-settings-modal');
}

async function saveGroupSettings(){
  if(!currentGroupSettingsId)return;
  const settings={
    allowPhotos:parseInt(document.getElementById('gs-allow-photos').value),
    rules:document.getElementById('gs-rules').value.trim(),
    access:document.getElementById('gs-access').value
  };
  if(groupSettingsBgUrl)settings.bgUrl=groupSettingsBgUrl;
  try{
    await fetch('/api/groups/'+currentGroupSettingsId+'/settings',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({settings,requesterId:currentUser.email})});
    toast('✅ Paramètres du groupe mis à jour !');
    closeModal('group-settings-modal');
    groupSettingsBgUrl=null;
    await loadGroups();
  }catch(e){toast('Erreur paramètres.');}
}

// ── SIGNALEMENT ──
function openReport(userId,userName){
  if(!currentUser){openModal('login-modal');return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Signaler : '+userName+' → transmis à l\'admin';
  openModal('report-modal');
}

async function submitReport(){
  if(!reportTarget||!currentUser)return;
  const reason=document.getElementById('report-reason').value;
  const details=document.getElementById('report-details').value.trim();
  try{
    await fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      reporterId:currentUser.email,reporterEmail:currentUser.email,reporterName:currentUser.name,
      reportedId:reportTarget.id,reportedName:reportTarget.name,reason,details
    })});
    toast('🚨 Signalement envoyé à l\'admin !');
    closeModal('report-modal');
  }catch(e){toast('Erreur envoi signalement.');}
}

// ── CONTACT ADMIN (ELITE) ──
function openContactAdmin(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacter l\'admin est réservé au plan ELITE.');return;}
  openModal('contact-admin-modal');
}

async function sendAdminMessage(){
  if(!currentUser)return;
  const subject=document.getElementById('ca-subject').value.trim();
  const message=document.getElementById('ca-message').value.trim();
  if(!message){toast('Écris ton message.');return;}
  try{
    await fetch('/api/contact-admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      fromName:currentUser.name,fromEmail:currentUser.email,fromPlan:currentUser.plan,
      subject,message
    })});
    toast('📩 Message envoyé à l\'admin !');
    closeModal('contact-admin-modal');
  }catch(e){toast('Erreur envoi.');}
}

// ── HERO PUBLISH AD ──
function heroPublishAd(){
  const name=document.getElementById('hero-ad-name').value.trim();
  const type=document.getElementById('hero-ad-type').value;
  const desc=document.getElementById('hero-ad-desc').value.trim();
  if(!name){document.getElementById('hero-ad-name').focus();toast('Indique le nom de ton produit !','error');return;}
  if(!desc){document.getElementById('hero-ad-desc').focus();toast('Décris brièvement ta pub !','error');return;}
  // Pré-remplir le signup modal et lancer la pub après inscription
  window._pendingHeroAd={name,type,desc};
  openModal('signup-modal');
  toast('✅ Crée ton compte pour publier ta pub !');
}

// ── PUBLIC FEED ──
function buildPublicFeed(){
  const el=document.getElementById('public-feed-list');
  if(!el)return;
  const publicPosts=[...feedPosts,...samplePosts].slice(0,5);
  if(!publicPosts.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted)">Aucune pub encore</div>';return;}
  el.innerHTML=`<div>${publicPosts.slice(0,3).map(p=>{
    const isElite=p.plan==='elite';
    return `<div class="public-post-card ${isElite?'elite-pub':''}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <div style="width:32px;height:32px;border-radius:50%;background:${getAvatarColor(p.userId)};display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg)">${p.emoji||p.author?.[0]||'?'}</div>
        <div>
          <div style="font-size:13px;font-weight:700;${isElite?'color:var(--gold)':''}">${p.author||'Anonyme'}</div>
          <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">${p.time||''}</div>
        </div>
        <span class="chat-msg-plan-badge plan-${p.plan||'free'}" style="margin-left:auto">${(p.plan||'FREE').toUpperCase()}</span>
      </div>
      <div style="font-size:13px;line-height:1.7;color:#c4d9cb">${p.text?p.text.slice(0,160)+(p.text.length>160?'...':''):''}</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">❤️ ${p.likes||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">💬 ${p.comments||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">🔗 Partager</span>
      </div>
    </div>`;
  }).join('')}</div><div class="feed-lock"><button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Voir tout le fil & publier ta pub →</button></div>`;
}

// ── MEDIA PREVIEW ──
function previewFeedMedia(input){
  const preview=document.getElementById('feed-media-preview');
  if(!preview)return;
  preview.innerHTML='';
  const files=Array.from(input.files).slice(0,4);
  files.forEach(f=>{
    const div=document.createElement('div');
    div.className='media-preview-item';
    if(f.type.startsWith('image/')){
      const img=document.createElement('img');
      img.src=URL.createObjectURL(f);
      div.appendChild(img);
    } else if(f.type.startsWith('video/')){
      const vid=document.createElement('video');
      vid.src=URL.createObjectURL(f);
      vid.muted=true;
      div.appendChild(vid);
    } else {
      div.innerHTML=`<div style="padding:8px;font-size:11px;color:var(--g4);text-align:center">📄<br>${f.name.slice(0,12)}</div>`;
    }
    const rm=document.createElement('button');
    rm.className='rm-media';rm.textContent='✕';
    rm.onclick=()=>{div.remove();};
    div.appendChild(rm);
    preview.appendChild(div);
  });
}

// ── SIGNALEMENT (avec radio) ──
function submitReport(){
  if(!currentUser)return;
  const radios=document.querySelectorAll('input[name="report-reason"]');
  let reason='';
  radios.forEach(r=>{if(r.checked)reason=r.value;});
  if(!reason){toast('Choisis une raison de signalement.');return;}
  const details=document.getElementById('report-details').value.trim();
  fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
    reporterId:currentUser?.email||'anonymous',reporterName:currentUser?.name||'?',
    reportedId:reportTarget?.id||'?',reportedName:reportTarget?.name||'?',reason,details,timestamp:new Date().toISOString()
  })}).catch(()=>{});
  toast('🚨 Signalement envoyé à l\'admin !');
  closeModal('report-modal');
  reportTarget=null;
}

// ── SEND GROUP MSG ──
function sendGroupMsg(){
  if(!currentUser){openModal('login-modal');return;}
  const inp=document.getElementById('group-chat-in');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${time}</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  inp.value='';
  fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free'})}).catch(()=>{});
}

function sendGroupMedia(input){
  const f=input.files[0];
  if(!f||!currentGroupId)return;
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  const url=URL.createObjectURL(f);
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span></div><div style="margin-top:4px">${f.type.startsWith('video')?`<video src="${url}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${url}" style="max-width:200px;border-radius:6px"/>`}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  input.value='';
}

// ── CREATE GROUP (new modal IDs) ──
function createGroup(){
  if(!currentUser){return;}
  if(currentUser.plan!=='elite'){toast('⭐ Créer un groupe est réservé au plan ELITE.');return;}
  const name=document.getElementById('cg-name')?.value.trim();
  if(!name){toast('Donne un nom au groupe.');return;}
  const group={
    id:'grp'+Date.now(),name,emoji:document.getElementById('cg-emoji')?.value||'💬',
    desc:document.getElementById('cg-desc')?.value.trim()||'',
    cat:document.getElementById('cg-cat')?.value||'Autre',
    access:document.getElementById('cg-private')?.checked?'private':'public',
    allowPhotos:document.getElementById('cg-allow-photos')?.checked?1:0,
    allowVideos:document.getElementById('cg-allow-videos')?.checked?1:0,
    premod:document.getElementById('cg-premod')?.checked?1:0,
    creatorId:currentUser.email,membersCount:1
  };
  sampleGroups.unshift(group);
  groupsData=sampleGroups;
  toast('🏆 Groupe créé !');
  closeModal('create-group-modal');
  if(document.getElementById('tab-groupes')?.classList.contains('active'))buildGroupsList();
  fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)}).catch(()=>{});
}

// ── WALLPAPER (ELITE) ──
function setWallpaper(bg){
  if(currentUser?.plan!=='elite'){toast('⭐ Le fond d\'écran est réservé au plan ELITE.');return;}
  const app=document.getElementById('app');
  if(bg==='none'){app.style.background='';app.classList.remove('has-wallpaper');}
  else{app.style.background=bg;app.classList.add('has-wallpaper');}
  currentUser.wallpaper=bg;
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('wallpaper-modal');
  toast('🖼️ Fond d\'écran appliqué !');
}

function setWallpaperFromFile(input){
  if(!input.files[0])return;
  if(currentUser?.plan!=='elite'){toast('⭐ Le fond d\'écran est réservé au plan ELITE.');return;}
  const url=URL.createObjectURL(input.files[0]);
  const app=document.getElementById('app');
  app.style.background=`url('${url}') center/cover fixed`;
  app.classList.add('has-wallpaper');
  toast('🖼️ Fond d\'écran appliqué !');
  closeModal('wallpaper-modal');
}

// ── DM ADMIN (ELITE) ──
let adminDMMessages=[];
function openAdminDM(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacter l\'admin directement est réservé au plan ELITE.');return;}
  renderAdminDMThread();
  openModal('dm-admin-modal');
}
function renderAdminDMThread(){
  const el=document.getElementById('dm-admin-msgs');
  if(!el)return;
  if(!adminDMMessages.length){el.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">📩 Premier message à l\'admin — répond sous 24h</div>';return;}
  el.innerHTML=adminDMMessages.map(m=>`<div class="dm-msg ${m.fromMe?'mine':'theirs'}"><div class="dm-bubble-g">${escHtml(m.text)}</div><div class="dm-time">${m.time}</div></div>`).join('');
  el.scrollTop=el.scrollHeight;
}
function sendAdminDM(){
  const inp=document.getElementById('dm-admin-input');
  const text=inp.value.trim();
  if(!text||!currentUser)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  adminDMMessages.push({fromMe:true,text,time});
  inp.value='';
  renderAdminDMThread();
  fetch('/api/admin-dm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fromEmail:currentUser.email,fromName:currentUser.name,fromPlan:currentUser.plan,text,timestamp:new Date().toISOString()})}).catch(()=>{});
  toast('📩 Message envoyé à l\'admin !');
}

// ── OPEN REPORT ──
function openReport(userId,userName){
  if(!currentUser){openModal('login-modal');return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Signaler : '+userName+' → transmis à l\'admin';
  document.querySelectorAll('input[name="report-reason"]').forEach(r=>r.checked=false);
  document.getElementById('report-details').value='';
  openModal('report-modal');
}

// ── OPEN GROUP CHAT ──
function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser){openModal('login-modal');return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  document.getElementById('group-chat-sub').textContent='Groupe de discussion · '+(access==='private'?'🔒 Privé':'🌍 Public');
  // Admin controls
  const adminCtrl=document.getElementById('group-admin-controls');
  if(adminCtrl)adminCtrl.style.display=(currentUser.plan==='elite'&&currentUser.email===creatorId)?'block':'none';
  // Media upload
  const mediLabel=document.getElementById('group-media-upload-label');
  if(mediLabel)mediLabel.style.display=(allowPhotos==='1'||allowPhotos===1||allowPhotos===true)?'inline-flex':'none';
  // Load members
  const ml=document.getElementById('group-members-list');
  if(ml)ml.innerHTML='<div style="color:var(--muted2);font-size:11px">👥 En ligne...</div>';
  // Load messages
  const msgEl=document.getElementById('group-chat-msgs');
  msgEl.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)">Premier à écrire dans ce groupe 👋</div>';
  fetch('/api/groups/'+groupId+'/messages').then(r=>r.json()).then(msgs=>{
    if(!msgs.length)return;
    msgEl.innerHTML=msgs.map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${escHtml(m.author||'?')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px"/>`}</div>`:''}</div>`).join('');
    msgEl.scrollTop=msgEl.scrollHeight;
  }).catch(()=>{});
  openModal('group-chat-modal');
}

function openGroupSettings(groupId){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('create-group-modal');
}

// ── LIKE/PARTAGE/COMMENTAIRE DORÉS ELITE ──
function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  const isElite=currentUser?.plan==='elite';
  if(isElite){btn.style.borderColor='var(--gold)';btn.style.color='var(--gold)';btn.style.boxShadow='0 0 8px rgba(255,215,0,0.3)';}
  else btn.classList.toggle('active');
  btn.textContent='❤️ '+p.likes;
  // WS broadcast
  if(ws&&ws.readyState===1){ws.send(JSON.stringify({type:'like',postId:id,likes:p.likes,userId:currentUser?.email,userPlan:currentUser?.plan}));}
}

// ── SHOW APP update for wallpaper ──
const _originalShowApp=showApp;
function showApp(){
  document.getElementById('landing').style.display='none';
  document.getElementById('app').style.display='block';
  updateAppBar();
  loadPostsFromAPI();
  loadVitrineFromAPI();
  window.scrollTo(0,0);
  connectWS();
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  document.getElementById('feed-limit-info').innerHTML=`Plan ${(currentUser.plan||'FREE').toUpperCase()} · <span id="pubs-left">${plan.limits.pubsPerHour||plan.limits.pubsPerDay||'∞'}</span> pub${currentUser.plan==='free'?'/h':'/jour'}`;
  const chatLeft=Math.max(0,(PLANS.find(p=>p.id===currentUser.plan)||PLANS[0]).limits.chatMsgs-chatMsgsToday);
  const chatEl=document.getElementById('chat-msgs-left');
  if(chatEl)chatEl.textContent=chatLeft;
  // Restore wallpaper
  if(currentUser.wallpaper&&currentUser.wallpaper!=='none'){
    const app=document.getElementById('app');
    app.style.background=currentUser.wallpaper;
    app.classList.add('has-wallpaper');
  }
  // Show wallpaper & admin-dm buttons if ELITE
  const profileView=document.getElementById('my-profile-view');
  // Pub hero après inscription
  if(window._pendingHeroAd&&currentUser){
    const ad=window._pendingHeroAd;
    document.getElementById('feed-text').value=ad.desc;
    document.getElementById('feed-proj-name').value=ad.name;
    const sel=document.getElementById('feed-proj-type');
    if(sel&&ad.type)sel.value=ad.type;
    showAppTab('feed',document.querySelector('.app-tab'));
    toast('📢 Ta pub est prête ! Clique sur Publier.');
    window._pendingHeroAd=null;
  }
  setTimeout(buildTrendingPosts,500);
}

// ── UPDATE APP BAR avec ELITE options ──
const _origUpdateAppBar=updateAppBar;
function updateAppBar(){
  if(!currentUser)return;
  document.getElementById('app-user-name').textContent=currentUser.name;
  document.getElementById('app-user-ava').textContent=currentUser.avatar||currentUser.name[0];
  const chip=document.getElementById('app-plan-chip');
  chip.textContent=(currentUser.plan||'FREE').toUpperCase();
  const isElite=currentUser.plan==='elite';
  if(isElite){
    chip.style.background='linear-gradient(135deg,#ffd700,#ff8c00)';
    chip.style.color='#1a0a00';
  }
  // Boutons ELITE exclusifs
  const btnWp=document.getElementById('btn-wallpaper');
  const btnAdm=document.getElementById('btn-admin-dm');
  if(btnWp)btnWp.style.display=isElite?'flex':'none';
  if(btnAdm)btnAdm.style.display=isElite?'flex':'none';
}

// ── WEBSOCKET — update for likes broadcast ──
const _origWsMessage=null;
function _patchWS(){
  if(ws){
    const origOnMessage=ws.onmessage;
    ws.onmessage=(e)=>{
      if(origOnMessage)origOnMessage(e);
      try{
        const data=JSON.parse(e.data);
        if(data.type==='like'){
          const btn=document.querySelector(`[data-post-id="${data.postId}"] .btn-like`);
          if(btn)btn.textContent='❤️ '+data.likes;
        }
      }catch(err){}
    };
  }
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('wallpaper-modal');
}

// ── WEBSOCKET — update for group messages ──

function escHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function getAvatarColor(id){const colors=['linear-gradient(135deg,#15803d,#4ade80)','linear-gradient(135deg,#166534,#22c55e)','linear-gradient(135deg,#14532d,#86efac)','linear-gradient(135deg,#065f46,#34d399)'];return colors[(id||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0)%colors.length];}
function getTypeEmoji(t){return{site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️'}[t]||'🚀';}
function typeName(t){return{site:'Site web',app:'Application',saas:'SaaS',tiktok:'TikTok',instagram:'Instagram',ecommerce:'E-commerce'}[t]||t;}

// ── MODALS ──
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function switchModal(a,b){closeModal(a);setTimeout(()=>openModal(b),200);}
document.querySelectorAll('.modal-bg').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

// ── STRIPE ──
try{stripe=Stripe('pk_test_VOTRE_CLE_STRIPE_ICI');}catch(e){}

// ══════════════════════════════════════════════
// ── SYSTÈME I18N — DÉTECTION AUTOMATIQUE ──
// ══════════════════════════════════════════════

const I18N = {
  fr: {
    nav_vitrine: 'Vitrine',
    nav_plans: 'Abonnements',
    nav_reviews: 'Avis',
    nav_login: 'Connexion',
    nav_join: 'Rejoindre →',
    hero_badge: '📢 PLATEFORME N°1 DE PUBLICITÉ DIGITALE',
    hero_concept: 'Sur <strong>ViralBoost</strong>, tu <strong>publies ta publicité</strong> en 30 secondes et elle est visible par toute une communauté d\'acheteurs, créateurs et entrepreneurs. SaaS, boutique, app, service — <strong>ta pub touche ta cible immédiatement.</strong>',
    hero_line1: 'PUBLIE TA',
    hero_line2: 'PUBLICITÉ.',
    hero_sub: 'La plateforme pub qui combine une audience qualifiée, l\'IA et des outils de promotion tout-en-un. Publie d\'abord, crée ton compte après.',
    hero_form_title: '📢 PUBLIE TA PUBLICITÉ EN 30 SECONDES',
    hero_form_name: 'Nom de ton produit / service *',
    hero_cat_select: 'Catégorie...',
    hero_form_desc: 'Décris ta pub en 2 phrases : ce que tu proposes, à qui, pourquoi c\'est top...',
    hero_form_btn: '📢 Publier ma publicité gratuitement →',
    hero_form_note: '✓ Gratuit · Visible immédiatement · Pas de carte requise',
    hero_cta_create: 'Créer mon compte →',
    hero_cta_login: 'Se connecter',
    hero_note: 'Gratuit pour commencer · ✓ Sans carte bancaire · ✓ Accès instantané',
    step1_title: 'Publie ta pub',
    step1_desc: 'Décris ton produit ou service. En ligne en 30 secondes, visible par toute la communauté.',
    step2_title: 'Touche ta cible',
    step2_desc: 'Notre audience de créateurs, entrepreneurs et acheteurs qualifiés voit ta pub.',
    step3_title: 'Propulse avec l\'IA',
    step3_desc: 'L\'IA génère ta stratégie. Votes, partages, DMs — tu décoles vite.',
    cta_title: 'REJOINS LA COMMUNAUTÉ',
    cta_sub: 'Gratuit pour commencer. 1 247 créateurs déjà à bord.',
    cta_btn: 'Créer mon compte →',
    footer_copy: '© 2025 ViralBoost — Le réseau social des créateurs',
  },
  en: {
    nav_vitrine: 'Showcase',
    nav_plans: 'Plans',
    nav_reviews: 'Reviews',
    nav_login: 'Log in',
    nav_join: 'Join →',
    hero_badge: '📢 #1 DIGITAL ADVERTISING PLATFORM',
    hero_concept: 'On <strong>ViralBoost</strong>, you <strong>publish your ad</strong> in 30 seconds and it\'s instantly visible to an entire community of buyers, creators and entrepreneurs. SaaS, shop, app, service — <strong>your ad reaches your target immediately.</strong>',
    hero_line1: 'PUBLISH YOUR',
    hero_line2: 'AD.',
    hero_sub: 'The ad platform that combines a qualified audience, AI and all-in-one promotion tools. Publish first, create your account after.',
    hero_form_title: '📢 PUBLISH YOUR AD IN 30 SECONDS',
    hero_form_name: 'Your product / service name *',
    hero_cat_select: 'Category...',
    hero_form_desc: 'Describe your ad in 2 sentences: what you offer, who it\'s for, why it\'s great...',
    hero_form_btn: '📢 Publish my ad for free →',
    hero_form_note: '✓ Free · Instantly visible · No card required',
    hero_cta_create: 'Create my account →',
    hero_cta_login: 'Log in',
    hero_note: 'Free to start · ✓ No credit card · ✓ Instant access',
    step1_title: 'Publish your ad',
    step1_desc: 'Describe your product or service. Live in 30 seconds, visible to the whole community.',
    step2_title: 'Reach your target',
    step2_desc: 'Our audience of qualified creators, entrepreneurs and buyers sees your ad.',
    step3_title: 'Boost with AI',
    step3_desc: 'AI generates your strategy. Votes, shares, DMs — you take off fast.',
    cta_title: 'JOIN THE COMMUNITY',
    cta_sub: 'Free to start. 1,247 creators already on board.',
    cta_btn: 'Create my account →',
    footer_copy: '© 2025 ViralBoost — The creators\' social network',
  },
  es: {
    nav_vitrine: 'Escaparate',
    nav_plans: 'Planes',
    nav_reviews: 'Opiniones',
    nav_login: 'Entrar',
    nav_join: 'Unirme →',
    hero_badge: '📢 PLATAFORMA N°1 DE PUBLICIDAD DIGITAL',
    hero_concept: 'En <strong>ViralBoost</strong>, <strong>publicas tu anuncio</strong> en 30 segundos y es visible para toda una comunidad de compradores, creadores y emprendedores. SaaS, tienda, app, servicio — <strong>tu anuncio llega a tu audiencia al instante.</strong>',
    hero_line1: 'PUBLICA TU',
    hero_line2: 'ANUNCIO.',
    hero_sub: 'La plataforma publicitaria que combina una audiencia cualificada, IA y herramientas de promoción todo en uno. Publica primero, crea tu cuenta después.',
    hero_form_title: '📢 PUBLICA TU ANUNCIO EN 30 SEGUNDOS',
    hero_form_name: 'Nombre de tu producto / servicio *',
    hero_cat_select: 'Categoría...',
    hero_form_desc: 'Describe tu anuncio en 2 frases: qué ofreces, a quién, por qué es genial...',
    hero_form_btn: '📢 Publicar mi anuncio gratis →',
    hero_form_note: '✓ Gratis · Visible inmediatamente · Sin tarjeta requerida',
    hero_cta_create: 'Crear mi cuenta →',
    hero_cta_login: 'Iniciar sesión',
    hero_note: 'Gratis para empezar · ✓ Sin tarjeta · ✓ Acceso instantáneo',
    step1_title: 'Publica tu anuncio',
    step1_desc: 'Describe tu producto o servicio. En línea en 30 segundos, visible para toda la comunidad.',
    step2_title: 'Llega a tu audiencia',
    step2_desc: 'Nuestra audiencia de creadores, emprendedores y compradores calificados ve tu anuncio.',
    step3_title: 'Impulsa con IA',
    step3_desc: 'La IA genera tu estrategia. Votos, compartidos, DMs — despega rápido.',
    cta_title: 'ÚNETE A LA COMUNIDAD',
    cta_sub: 'Gratis para empezar. 1.247 creadores ya a bordo.',
    cta_btn: 'Crear mi cuenta →',
    footer_copy: '© 2025 ViralBoost — La red social de los creadores',
  }
};

// Détecte la langue selon le navigateur / pays
function detectLang(){
  const saved=localStorage.getItem('vb_lang');
  if(saved&&I18N[saved])return saved;
  const bl=navigator.language||navigator.userLanguage||'fr';
  const code=bl.toLowerCase();
  if(code.startsWith('es'))return'es';
  if(code.startsWith('en'))return'en';
  return'fr';
}

let currentLang='fr';

function setLang(lang){
  if(!I18N[lang])return;
  currentLang=lang;
  localStorage.setItem('vb_lang',lang);
  applyLang();
  // Update switcher
  const sw=document.getElementById('lang-switcher');
  if(sw)sw.value=lang;
}

function applyLang(){
  const t=I18N[currentLang];
  if(!t)return;
  // Textes simples (data-i18n)
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n');
    if(t[key]!==undefined)el.innerHTML=t[key];
  });
  // Placeholders (data-i18n-placeholder)
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
    const key=el.getAttribute('data-i18n-placeholder');
    if(t[key]!==undefined)el.placeholder=t[key];
  });
  // HTML lang attribute
  document.documentElement.lang=currentLang;
}

// ── INIT ──
window.addEventListener('load',()=>{
  // Langue automatique
  currentLang=detectLang();
  const sw=document.getElementById('lang-switcher');
  if(sw)sw.value=currentLang;
  applyLang();

  renderPlans();
  buildVitrineGrid('landing-vitrine-grid');
  buildPublicFeed();
  initTrendingBar();
  animateSocialProof();
  initRotatingWords();
  const saved=localStorage.getItem('viralboost_user');
  if(saved){
    currentUser=JSON.parse(saved);
    showApp();
  }
});

// ── MOTS ROTATIFS HERO ──
function initRotatingWords(){
  // [article, mot] — accord correct français
  const pairs=[
    ['PUBLIE TA',      'PUBLICITÉ.'],
    ['LANCE TON',      'PROJET.'],
    ['PROPULSE TA',    'MARQUE.'],
    ['DÉPLOIE TON',    'SAAS.'],
    ['LANCE TON',      'APP.'],
    ['BOOSTE TA',      'BOUTIQUE.'],
    ['PUBLIE TON',     'SERVICE.'],
  ];
  let idx=0;
  const elWord=document.getElementById('hero-rotating-word');
  const elLine=document.getElementById('hero-line1');
  if(!elWord||!elLine)return;
  setInterval(()=>{
    elWord.style.opacity='0';
    elWord.style.transform='translateY(-10px)';
    elWord.style.transition='all 0.3s ease';
    elLine.style.opacity='0';
    elLine.style.transition='all 0.3s ease';
    setTimeout(()=>{
      idx=(idx+1)%pairs.length;
      elLine.textContent=pairs[idx][0];
      elWord.textContent=pairs[idx][1];
      elWord.style.opacity='1';
      elWord.style.transform='translateY(0)';
      elLine.style.opacity='1';
    },300);
  },2800);
}

// ── COMPTEUR SOCIAL ANIMÉ ──
function animateSocialProof(){
  // Récupérer le vrai nombre d'inscrits si possible
  fetch('/api/admin/all-users?key=viralboost-admin')
    .then(r=>r.ok?r.json():[])
    .then(users=>{
      const base=Math.max(users.length,0);
      animateCount('sp-members', 2847+base, 1200);
    }).catch(()=>animateCount('sp-members',2847,1200));

  animateCount('sp-pubs',14320,1800);
  // Online count fluctuant
  const online=18+Math.floor(Math.random()*30);
  animateCount('sp-online',online,800);
  setInterval(()=>{
    const el=document.getElementById('sp-online');
    if(el){
      const current=parseInt(el.textContent.replace(/\s/g,''))||18;
      const delta=Math.floor(Math.random()*5)-2;
      el.textContent=Math.max(5,current+delta);
    }
  },12000);
}

function animateCount(id,target,duration){
  const el=document.getElementById(id);
  if(!el)return;
  const start=0;
  const startTime=performance.now();
  const tick=(now)=>{
    const elapsed=now-startTime;
    const progress=Math.min(elapsed/duration,1);
    const eased=1-Math.pow(1-progress,3);
    const value=Math.round(start+(target-start)*eased);
    el.textContent=value.toLocaleString('fr-FR');
    if(progress<1)requestAnimationFrame(tick);
  };
  requestAnimationFrame(tick);
}

// ── TRENDING BAR ──
function initTrendingBar(){
  const trendingProjects=[...sampleProjects].sort((a,b)=>b.votes-a.votes);
  const items=trendingProjects.map((p,i)=>`
    <span class="trending-item" onclick="document.getElementById('landing').scrollIntoView({behavior:'smooth'})">
      <span class="trend-rank">#${i+1}</span>${p.emoji} <strong>${p.name}</strong> · ${p.votes} votes
    </span>`).join(' &nbsp;·&nbsp; ');
  const doubled=items+' &nbsp;&nbsp;&nbsp; '+items; // duplicate for seamless loop
  const el=document.getElementById('trending-scroll-content');
  if(el)el.innerHTML=doubled;
}

// ── TRENDING DANS LE FIL ──
function buildTrendingPosts(){
  const el=document.getElementById('trending-posts-list');
  if(!el)return;
  const top=feedPosts.length
    ?[...feedPosts].sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,3)
    :samplePosts.slice(0,3);
  if(!top.length){document.getElementById('trending-posts-section')?.style && (document.getElementById('trending-posts-section').style.display='none');return;}
  el.innerHTML=top.map((p,i)=>`
    <div class="trending-mini-post" onclick="scrollToPost('${p.id}')">
      <div class="trending-mini-rank ${i===0?'top':''}">${i+1}</div>
      <div style="width:26px;height:26px;border-radius:50%;background:${getAvatarColor(p.userId)};display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--bg);flex-shrink:0">${p.emoji||p.author?.[0]||'?'}</div>
      <div class="trending-mini-text">${p.author||'?'} — ${(p.text||'').slice(0,60)}${(p.text||'').length>60?'...':''}</div>
      <div class="trending-mini-likes">❤️ ${p.likes||0}</div>
    </div>`).join('');
}

function scrollToPost(postId){
  const el=document.getElementById('post-'+postId);
  if(el)el.scrollIntoView({behavior:'smooth',block:'center'});
}

// ── RECHERCHE APP ──
function handleAppSearch(val){
  const dropdown=document.getElementById('search-results-dropdown');
  if(!dropdown)return;
  if(!val.trim()){dropdown.innerHTML='';dropdown.style.display='none';return;}
  dropdown.style.display='block';
  const q=val.toLowerCase();
  const projectResults=vitrineData.filter(p=>
    (p.name||'').toLowerCase().includes(q)||(p.desc||'').toLowerCase().includes(q)
  ).slice(0,4);
  const postResults=feedPosts.filter(p=>
    (p.text||'').toLowerCase().includes(q)||(p.author||'').toLowerCase().includes(q)
  ).slice(0,3);
  let html='';
  if(projectResults.length){
    html+=`<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1.5px;padding:4px 8px;margin-bottom:2px">PROJETS</div>`;
    html+=projectResults.map(p=>`<div class="search-result-item" onclick="document.getElementById('tab-vitrine').querySelector('.tpanel')">
      <span>${p.emoji||'🚀'}</span><div><div style="font-weight:700">${p.name}</div><div style="font-size:10px;color:var(--muted)">${p.type||''} · ❤️ ${p.votes||0} votes</div></div>
    </div>`).join('');
  }
  if(postResults.length){
    html+=`<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1.5px;padding:4px 8px;margin-top:4px">PUBLICATIONS</div>`;
    html+=postResults.map(p=>`<div class="search-result-item" onclick="showAppTab('feed',document.querySelector('[onclick*=feed]'));scrollToPost('${p.id}')">
      <div style="width:24px;height:24px;border-radius:50%;background:${getAvatarColor(p.userId||'')};display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--bg)">${p.emoji||p.author?.[0]||'?'}</div>
      <div><div style="font-weight:700">${p.author||'?'}</div><div style="font-size:10px;color:var(--muted)">${(p.text||'').slice(0,45)}...</div></div>
    </div>`).join('');
  }
  if(!html)html=`<div style="padding:12px;text-align:center;font-size:12px;color:var(--muted)">Aucun résultat pour "${val}"</div>`;
  dropdown.innerHTML=html;
}

// ── FORCE MOT DE PASSE ──
function checkPassStrength(pass){
  const bars=[1,2,3,4].map(i=>document.getElementById('ps-bar-'+i));
  const label=document.getElementById('ps-label');
  bars.forEach(b=>{if(b)b.className='';});
  if(!pass){if(label)label.textContent='Saisis un mot de passe';return;}
  let score=0;
  if(pass.length>=8)score++;
  if(/[A-Z]/.test(pass))score++;
  if(/[0-9]/.test(pass))score++;
  if(/[^A-Za-z0-9]/.test(pass))score++;
  const levels=['weak','weak','medium','strong'];
  const texts=['Trop court','Faible','Moyen','Fort 💪'];
  for(let i=0;i<score;i++){
    if(bars[i])bars[i].className='active '+(levels[score-1]||'weak');
  }
  if(label)label.textContent=texts[score-1]||'';
}

// ── SIGNUP EN 2 ÉTAPES ──
function signupNextStep(){
  document.getElementById('signup-step-1').style.display='none';
  document.getElementById('signup-step-2').style.display='block';
  document.getElementById('sdot-2').classList.add('done');
}
function signupBackStep(){
  document.getElementById('signup-step-2').style.display='none';
  document.getElementById('signup-step-1').style.display='block';
}

// ── ONBOARDING APRÈS INSCRIPTION ──
function showOnboarding(){
  if(localStorage.getItem('vb_onboarded'))return;
  const overlay=document.createElement('div');
  overlay.className='onboarding-overlay';
  overlay.id='onboarding-overlay';
  overlay.innerHTML=`
    <div class="onboarding-box">
      <div style="font-size:36px;margin-bottom:6px">🎉</div>
      <h2>BIENVENUE !</h2>
      <p style="font-size:13px;color:var(--muted);margin-bottom:4px">3 choses à faire pour décoller :</p>
      <div class="onboarding-step-list">
        <div class="onboarding-step" onclick="closeOnboarding();showAppTab('feed',document.querySelector('.app-tab'))">
          <div class="onboarding-step-num">1</div>
          <div><div class="onboarding-step-text">📢 Publie ta première pub</div><div class="onboarding-step-sub">Partage ton projet à toute la communauté</div></div>
        </div>
        <div class="onboarding-step" onclick="closeOnboarding();showAppTab('profil',document.querySelectorAll('.app-tab')[5])">
          <div class="onboarding-step-num">2</div>
          <div><div class="onboarding-step-text">👤 Complète ton profil</div><div class="onboarding-step-sub">Bio, réseaux sociaux, tes chiffres</div></div>
        </div>
        <div class="onboarding-step" onclick="closeOnboarding();showAppTab('ia-boost',document.querySelectorAll('.app-tab')[7])">
          <div class="onboarding-step-num">3</div>
          <div><div class="onboarding-step-text">🤖 Génère ta stratégie IA</div><div class="onboarding-step-sub">Plan de croissance personnalisé en 10s</div></div>
        </div>
      </div>
      <button class="btn-modal-g" onclick="closeOnboarding()" style="margin-top:0">C'est parti 🚀</button>
    </div>`;
  document.body.appendChild(overlay);
  localStorage.setItem('vb_onboarded','1');
}

function closeOnboarding(){
  document.getElementById('onboarding-overlay')?.remove();
}

// ── RÉACTIONS SUR LES POSTS ──
const REACTIONS=['🔥','💡','👏','🚀','❤️'];
function addReaction(postId,reaction){
  if(!currentUser){openModal('login-modal');return;}
  const post=feedPosts.find(p=>p.id===postId);
  if(!post)return;
  if(!post.reactions)post.reactions={};
  if(post.reactions[reaction]&&post.reactions[reaction].includes(currentUser.email)){
    post.reactions[reaction]=post.reactions[reaction].filter(e=>e!==currentUser.email);
  } else {
    if(!post.reactions[reaction])post.reactions[reaction]=[];
    post.reactions[reaction].push(currentUser.email);
  }
  // Update just the reactions row
  const row=document.querySelector(`#post-${postId} .reactions-row`);
  if(row)row.innerHTML=buildReactionsHTML(postId,post.reactions);
}

function buildReactionsHTML(postId,reactions={}){
  return REACTIONS.map(r=>{
    const count=(reactions[r]||[]).length;
    const active=currentUser&&(reactions[r]||[]).includes(currentUser.email);
    return `<button class="reaction-btn ${active?'active':''}" onclick="addReaction('${postId}','${r}')">${r}${count>0?`<span>${count}</span>`:''}</button>`;
  }).join('');
}

// ── PARTAGE PAR LIEN ──
function sharePost(postId,title){
  const shareUrl=`${location.origin}/?post=${postId}`;
  if(navigator.share){
    navigator.share({title:title||'ViralBoost',url:shareUrl}).catch(()=>{});
  } else {
    navigator.clipboard.writeText(shareUrl).then(()=>toast('🔗 Lien copié !'));
  }
  // Increment share count
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({type:'share',postId,userId:currentUser?.email}));
  }
}

// ── NOTIF PANEL ──
let notifPanelOpen=false;
function toggleNotifPanel(){
  notifPanelOpen=!notifPanelOpen;
  let panel=document.getElementById('notif-panel');
  if(!panel){
    panel=document.createElement('div');
    panel.id='notif-panel';
    panel.style.cssText='position:fixed;top:66px;right:16px;width:300px;background:var(--s1);border:1.5px solid var(--border);border-radius:12px;z-index:600;box-shadow:0 16px 40px rgba(0,0,0,0.5);animation:popIn 0.2s ease both;overflow:hidden;';
    panel.innerHTML=`
      <div style="padding:14px 16px;border-bottom:1px solid var(--border2);font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:1.5px">NOTIFICATIONS</div>
      <div id="notif-list" style="max-height:340px;overflow-y:auto;padding:8px"></div>`;
    document.body.appendChild(panel);
    document.addEventListener('click',function closePanel(e){
      if(!panel.contains(e.target)&&!e.target.closest('[onclick="toggleNotifPanel()"]')){
        panel.remove();notifPanelOpen=false;
        document.removeEventListener('click',closePanel);
      }
    });
  } else {
    panel.remove();return;
  }
  renderNotifList();
}

const notifList=[];
function addNotif(msg,icon='🔔'){
  notifList.unshift({msg,icon,time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
  if(notifList.length>20)notifList.pop();
  const badge=document.getElementById('global-notif-badge');
  const count=parseInt(badge?.textContent||'0')+1;
  if(badge){badge.textContent=count;badge.style.display='flex';}
  renderNotifList();
}

function renderNotifList(){
  const el=document.getElementById('notif-list');
  if(!el)return;
  if(!notifList.length){el.innerHTML='<div style="padding:16px;text-align:center;font-size:12px;color:var(--muted)">Aucune notification</div>';return;}
  el.innerHTML=notifList.map(n=>`
    <div style="display:flex;align-items:center;gap:9px;padding:9px 10px;border-radius:7px;margin-bottom:3px;background:rgba(22,163,74,0.04)">
      <span style="font-size:16px">${n.icon}</span>
      <div style="flex:1"><div style="font-size:12px;font-weight:600;color:var(--g5)">${n.msg}</div><div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">${n.time}</div></div>
    </div>`).join('');
}

// ── SCROLL REVEAL STEPS ──
function initStepReveal(){
  const steps=document.querySelectorAll('.how-step-simple');
  if(!steps.length)return;
  const obs=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{if(e.isIntersecting)e.target.classList.add('visible');});
  },{threshold:0.3});
  steps.forEach(s=>obs.observe(s));
}
window.addEventListener('load',()=>setTimeout(initStepReveal,500));


</script>
<!-- ── POPUP OFFRE 100 PREMIERS — s'affiche après 8s ── -->
<div id="offer-popup" class="hidden">
  <div id="offer-box-wrap">
    <!-- Contenu par défaut visible instantanément -->
    <div class="offer-box">
      <button class="offer-close-btn" onclick="closeOffer()">✕</button>
      <div class="offer-crown">🎁</div>
      <div class="offer-title">OFFRE LANCEMENT</div>
      <div class="offer-sub">Limité aux 100 premiers inscrits uniquement</div>
      <div class="offer-badge">💎 PLAN PRO — 1 AN 100% GRATUIT</div>
      <div class="offer-desc">
        Valeur réelle : <strong>179,88€</strong><br>
        ✅ 999 publications/jour<br>
        ✅ Coach IA illimité<br>
        ✅ Vitrine 30 jours<br>
        ✅ Chat illimité
      </div>
      <div class="offer-timer">⏰ Offre expire dans : <span id="offer-countdown">--:--:--</span></div>
      <div class="offer-counter">
        <div class="offer-counter-num" id="offer-remaining">—</div>
        <div class="offer-counter-lbl">places restantes sur 100</div>
      </div>
      <button class="offer-cta" onclick="claimOffer()">🚀 CRÉER MON COMPTE GRATUIT</button>
      <div class="offer-skip" onclick="closeOffer()">Non merci, je préfère payer</div>
    </div>
  </div>
</div>

<script>
// ── OFFRE 100 PREMIERS — PRO 1 AN GRATUIT ──
const OFFER_LIMIT = 100;

async function checkAndShowOffer() {
  if (sessionStorage.getItem('vb_offer_closed')) return;
  if (localStorage.getItem('vb_offer_seen')) return;
  if (currentUser && (currentUser.plan === 'pro' || currentUser.plan === 'elite')) return;

  // Mettre à jour le compteur en temps réel
  try {
    const r = await fetch('/api/admin/all-users?key=viralboost-admin');
    const users = r.ok ? await r.json() : [];
    const remaining = Math.max(0, OFFER_LIMIT - users.length);
    const el = document.getElementById('offer-remaining');
    if (el) el.textContent = remaining;

    if (remaining <= 0) {
      // Offre terminée — changer le contenu
      const wrap = document.getElementById('offer-box-wrap');
      wrap.innerHTML = `<div class="offer-full">
        <div style="font-size:40px;margin-bottom:10px">😔</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;color:#fbbf24;letter-spacing:2px">OFFRE TERMINÉE</div>
        <div style="font-size:13px;color:#4a7a58;margin-top:8px">Les 100 places gratuites ont été prises.<br>Découvre nos plans à partir de 3€/mois.</div>
        <button class="offer-cta" style="margin-top:18px;width:auto;padding:12px 28px" onclick="closeOffer()">Voir les plans →</button>
      </div>`;
    }
  } catch(e) {
    // API indisponible — laisser le "—" ou mettre une valeur approx
    const el = document.getElementById('offer-remaining');
    if (el && el.textContent === '—') el.textContent = '< 100';
  }
}

// showOfferFallback supprimé — le popup est toujours visible par défaut

function claimOffer() {
  localStorage.setItem('vb_offer_seen', '1');
  localStorage.setItem('vb_offer_claimed', '1');
  localStorage.setItem('vb_offer_pending', '1');
  document.getElementById('offer-popup').classList.add('hidden');
  if (currentUser) {
    // Déjà connecté → upgrade direct
    currentUser.plan = 'pro';
    currentUser.offerClaimed = true;
    currentUser.offerExpiry = new Date(Date.now() + 365*24*60*60*1000).toISOString();
    localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
    fetch('/api/register-user', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(currentUser)}).catch(()=>{});
    toast('🎉 Plan PRO activé gratuitement pour 1 an !');
    updateAppBar();
  } else {
    // Ouvrir directement le formulaire d'inscription
    openModal('signup-modal');
  }
}

function closeOffer() {
  // Marquer comme refusé définitivement — ne plus jamais afficher
  localStorage.setItem('vb_offer_seen', '1');
  document.getElementById('offer-popup').classList.add('hidden');
}



// Activer le plan PRO offert lors de la création de compte
const _origCreateUser = createUser;
function createUser({name, username, email, plan}) {
  const offeredPlan = localStorage.getItem('vb_offer_pending') ? 'pro' : (plan || 'free');
  _origCreateUser({name, username, email, plan: offeredPlan});
  if (offeredPlan === 'pro') {
    currentUser.offerClaimed = true;
    currentUser.offerExpiry = new Date(Date.now() + 365*24*60*60*1000).toISOString();
    localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
    localStorage.removeItem('vb_offer_pending');
    setTimeout(()=>toast('🎉 Plan PRO activé gratuitement pour 1 an !'), 800);
  }
}

// ── COUNTDOWN OFFRE — expire le 01/03/2026 à 10h00 ──
const OFFER_EXPIRY = new Date('2026-03-01T10:00:00');

function updateCountdown() {
  const el = document.getElementById('offer-countdown');
  if (!el) return;
  const diff = OFFER_EXPIRY - Date.now();
  if (diff <= 0) {
    el.textContent = 'EXPIRÉE';
    el.style.color = '#f87171';
    return;
  }
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  el.textContent = (d > 0 ? d + 'j ' : '') + String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}
setInterval(updateCountdown, 1000);

// Masquer le popup si déjà vu/refusé ou offre expirée
window.addEventListener('load', () => {
  const popup = document.getElementById('offer-popup');
  const expired = Date.now() > OFFER_EXPIRY;
  if (localStorage.getItem('vb_offer_seen') || expired) {
    popup.classList.add('hidden');
  } else {
    // Délai de 8 secondes + scroll trigger pour moins d'agressivité
    let offerShown = false;
    const showOffer = () => {
      if (offerShown) return;
      offerShown = true;
      popup.classList.remove('hidden');
      updateCountdown();
      checkAndShowOffer();
    };
    // Déclencher après 8s OU après scroll 40%
    setTimeout(showOffer, 8000);
    window.addEventListener('scroll', () => {
      const scrollPct = window.scrollY / (document.body.scrollHeight - window.innerHeight);
      if (scrollPct > 0.4) showOffer();
    }, { passive: true });
  }
});
</script>
</body>
</html>