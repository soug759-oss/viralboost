<!DOCTYPE html>
<html lang="en">
<script defer src="https://cloud.umami.is/script.js" data-website-id="2fb2c139-5a87-4082-b9f3-0aad697c9317"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8GRTQLRM9C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8GRTQLRM9C');
</script>
  <head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ViralBoost — Publish your ad, reach your target</title>
<meta name="description" content="Free platform for creators and entrepreneurs. Publish your ad in 30 seconds, find collabs, grow your audience."/>
<meta name="theme-color" content="#22c55e"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="ViralBoost"/>
<link rel="manifest" href="data:application/json,%7B%22name%22%3A%22ViralBoost%22%2C%22short_name%22%3A%22ViralBoost%22%2C%22description%22%3A%22Post%20your%20ad%20in%20ub%20en%2030%20secondes%22%2C%22start_url%22%3A%22%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23040a05%22%2C%22theme_color%22%3A%22%2322c55e%22%2C%22orientation%22%3A%22portrait%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22https%3A%2F%2Fplacehold.co%2F192x192%2F22c55e%2Fffffff%3Ftext%3DVB%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fpng%22%7D%2C%7B%22src%22%3A%22https%3A%2F%2Fplacehold.co%2F512x512%2F22c55e%2Fffffff%3Ftext%3DVB%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fpng%22%7D%5D%7D"/>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#040a05;--bg2:#060e07;--s1:#0b1a0d;--s2:#0f2312;--s3:#142e17;
  --g1:#15803d;--g2:#16a34a;--g3:#22c55e;--g4:#4ade80;--g5:#86efac;--g6:#bbf7d0;
  --white:#f0fdf4;--muted:#4a7a58;--muted2:#2d5a3a;
  --border:rgba(34,197,94,0.15);--border2:rgba(34,197,94,0.08);--glow:rgba(34,197,94,0.08);
}
*{margin:0;padding:0;box-sizing:border-box;}
button,a,[onclick]{cursor:pointer !important;touch-action:manipulation;}
button{-webkit-appearance:none;}
html{scroll-behavior:smooth;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--white);overflow-x:hidden;}
#cursor{display:none;}
#cursor-ring{display:none;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(34,197,94,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(34,197,94,0.025) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}
.orb{position:fixed;border-radius:50%;filter:blur(120px);pointer-events:none;z-index:0;}
.o1{width:600px;height:600px;background:rgba(21,128,61,0.07);top:-200px;right:-100px;animation:drift 14s ease-in-out infinite alternate;}
.o2{width:400px;height:400px;background:rgba(74,222,128,0.04);bottom:-100px;left:-100px;animation:drift 18s ease-in-out infinite alternate-reverse;}
@keyframes drift{from{transform:translate(0,0)}to{transform:translate(40px,40px)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes bounce{0%,60%,100%{transform:translateY(0);opacity:.3}30%{transform:translateY(-6px);opacity:1}}
@keyframes toastIn{from{opacity:0;transform:translateX(50px)}to{opacity:1;transform:translateX(0)}}

/* GOLD ELITE STYLES */
:root{--gold:#ffd700;--gold2:#ffb300;--gold3:#fff3b0;}
.elite-gold{color:var(--gold) !important;text-shadow:0 0 8px rgba(255,215,0,0.5);}
.btn-action.elite-action{border-color:var(--gold2)!important;color:var(--gold)!important;background:rgba(255,215,0,0.06)!important;box-shadow:0 0 8px rgba(255,215,0,0.15);}
.btn-action.elite-action:hover{box-shadow:0 0 16px rgba(255,215,0,0.3);}
.post-card.elite-post{border-color:rgba(255,215,0,0.25)!important;}
/* ── HERO SOCIAL PROOF ── */
.hero-social-proof{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--g5);margin-bottom:28px;animation:fadeUp 0.6s 0.05s ease both;}
.hsp-avatars{display:flex;}
.hsp-avatars span{width:28px;height:28px;border-radius:50%;background:var(--s2);border:2px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:13px;margin-left:-8px;}
.hsp-avatars span:first-child{margin-left:0;}
.hero-social-proof strong{color:var(--g3);}

/* ── SIGNUP MODAL REFAIT ── */
.signup-header{text-align:center;margin-bottom:20px;}
.signup-logo{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:3px;color:var(--g3);margin-bottom:8px;}
.signup-title{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--white);margin-bottom:6px;}
.signup-subtitle{font-size:12px;color:var(--muted);}
.signup-benefits{display:flex;flex-direction:column;gap:7px;margin-bottom:20px;background:rgba(22,163,74,0.05);border:1px solid var(--border2);border-radius:10px;padding:14px 16px;}
.signup-benefit{font-size:12px;color:var(--g5);line-height:1.5;}
.signup-form{display:flex;flex-direction:column;gap:10px;margin-bottom:16px;}
.signup-input{width:100%;padding:12px 14px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;transition:border-color 0.2s;}
.signup-input:focus{border-color:rgba(34,197,94,0.5);}
.signup-input::placeholder{color:var(--muted);}
.btn-signup-big{width:100%;padding:14px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 28px rgba(34,197,94,0.35);transition:all 0.2s;margin-bottom:10px;}
.btn-signup-big:hover{transform:translateY(-2px);box-shadow:0 0 44px rgba(34,197,94,0.55);}
.signup-footer-note{text-align:center;font-size:11px;color:var(--muted2);margin-bottom:10px;}

.plan-elite-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:2px;letter-spacing:1px;}

/* HERO AD BOX */
.hero-ad-box{background:rgba(22,163,74,0.06);border:2px solid rgba(22,163,74,0.25);border-radius:16px;padding:28px 32px;max-width:720px;width:100%;margin:0 auto 40px;animation:fadeUp 0.5s 0.1s ease both;}
.hero-ad-box h3{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:var(--g3);margin-bottom:12px;}
.hero-ad-form{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hero-ad-form input,.hero-ad-form select,.hero-ad-form textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.hero-ad-form input:focus,.hero-ad-form select:focus,.hero-ad-form textarea:focus{border-color:var(--g3);}
.hero-ad-form textarea{grid-column:1/-1;min-height:56px;resize:none;}
.hero-ad-form select option{background:var(--s1);}
.btn-hero-ad{grid-column:1/-1;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-hero-ad:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);}

/* ═══════════════════════════════════════════
   STEP-BY-STEP WIZARD — PUBLISH TAB
═══════════════════════════════════════════ */
/* Stepper header */
.wiz-stepper{display:flex;align-items:center;gap:0;margin-bottom:28px;padding:20px 24px;background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;}
.wiz-step-dot{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;cursor:pointer;}
.wiz-step-circle{width:34px;height:34px;border-radius:50%;border:2px solid var(--border);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;font-family:'DM Mono',monospace;color:var(--muted);transition:all 0.3s;position:relative;}
.wiz-step-circle.active{border-color:var(--g3);background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);box-shadow:0 0 16px rgba(34,197,94,0.4);}
.wiz-step-circle.done{border-color:var(--g2);background:rgba(22,163,74,0.15);color:var(--g3);}
.wiz-step-circle.done::after{content:'✓';position:absolute;font-size:12px;}
.wiz-step-circle.done span{display:none;}
.wiz-step-lbl{font-size:9px;font-weight:700;font-family:'DM Mono',monospace;letter-spacing:0.5px;color:var(--muted);text-align:center;text-transform:uppercase;transition:color 0.3s;}
.wiz-step-dot.active .wiz-step-lbl{color:var(--g3);}
.wiz-step-dot.done .wiz-step-lbl{color:var(--g4);}
.wiz-connector{flex:1;height:2px;background:var(--border2);margin:0 4px;margin-bottom:18px;transition:background 0.4s;}
.wiz-connector.done{background:linear-gradient(90deg,var(--g2),var(--g3));}

/* Step panels */
.wiz-panel{display:none;animation:fadeUp 0.3s ease;}
.wiz-panel.active{display:block;}

/* Step card group */
.wiz-group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 22px;margin-bottom:0;transition:border-color 0.3s;}
.wiz-group-card:focus-within{border-color:rgba(34,197,94,0.3);}
.wiz-group-title{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
.wiz-group-icon{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.wiz-group-head{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:var(--white);}
.wiz-group-sub{font-size:12px;color:var(--muted);margin-top:1px;}

/* Nav boutons */
.wiz-nav{display:flex;gap:12px;margin-top:22px;}
.btn-wiz-back{flex:1;padding:13px;background:transparent;border:1.5px solid var(--border);border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-wiz-back:hover{border-color:var(--g3);color:var(--g3);}
.btn-wiz-next{flex:3;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.25);display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-wiz-next:hover{background:linear-gradient(135deg,var(--g2),var(--g3));box-shadow:0 0 32px rgba(34,197,94,0.45);transform:translateY(-1px);}
.btn-wiz-publish{flex:3;padding:14px;background:linear-gradient(135deg,#15803d,#22c55e);border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 24px rgba(34,197,94,0.35);display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-wiz-publish:hover{box-shadow:0 0 40px rgba(34,197,94,0.55);transform:translateY(-1px);}

/* Progress bar sous le stepper */
.wiz-progress-bar{height:3px;background:var(--s3);border-radius:2px;overflow:hidden;margin-bottom:22px;}
.wiz-progress-fill{height:100%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:2px;transition:width 0.5s cubic-bezier(0.4,0,0.2,1);}

/* Ad preview in step 5 */
.wiz-preview-card{background:linear-gradient(135deg,var(--s1),var(--s2));border:2px solid rgba(34,197,94,0.3);border-radius:14px;overflow:hidden;margin-bottom:14px;box-shadow:0 8px 32px rgba(0,0,0,0.4);}
.wiz-preview-banner{height:110px;background:linear-gradient(135deg,var(--s2),var(--s3));display:flex;align-items:center;justify-content:center;font-size:52px;position:relative;}
.wiz-preview-banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.wiz-preview-body{padding:16px 18px;}
.wiz-preview-name{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:1.5px;color:var(--white);margin-bottom:3px;}
.wiz-preview-hook{font-size:12px;color:var(--g3);font-weight:700;margin-bottom:8px;}
.wiz-preview-desc{font-size:13px;color:#c4d9cb;line-height:1.7;margin-bottom:10px;}
.wiz-preview-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px;}
.wiz-preview-footer{display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--muted);}
.wiz-preview-label{display:inline-block;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;padding:2px 8px;border-radius:3px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);color:var(--g4);}

/* ═══════════════════════════════════════════
   MODAL GUIDE — 1st opening
═══════════════════════════════════════════ */
.guide-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.3s ease;}
.guide-overlay.hidden{display:none !important;}
.guide-box{background:var(--s1);border:2px solid rgba(34,197,94,0.4);border-radius:16px;max-width:340px;width:100%;padding:24px 22px;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);}
.guide-box-close{position:absolute;top:16px;right:16px;background:var(--s2);border:1px solid var(--border);border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--muted);transition:all 0.2s;}
.guide-box-close:hover{border-color:var(--g3);color:var(--g3);}
.guide-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--g4);font-family:'DM Mono',monospace;letter-spacing:1px;margin-bottom:16px;}
.guide-title{font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:2px;color:var(--white);line-height:1;margin-bottom:6px;}
.guide-subtitle{font-size:13px;color:var(--muted);margin-bottom:22px;line-height:1.7;}
.guide-steps-list{display:flex;flex-direction:column;gap:10px;margin-bottom:24px;}
.guide-step-row{display:flex;align-items:flex-start;gap:14px;background:rgba(22,163,74,0.04);border:1.5px solid var(--border2);border-radius:12px;padding:14px 16px;transition:border-color 0.2s;}
.guide-step-row:hover{border-color:rgba(34,197,94,0.2);}
.guide-step-num{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);font-size:11px;font-weight:800;font-family:'DM Mono',monospace;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.guide-step-content{}
.guide-step-title{font-size:13px;font-weight:800;color:var(--white);margin-bottom:2px;}
.guide-step-desc{font-size:11px;color:var(--muted);line-height:1.6;}
.guide-tip-box{background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:10px;padding:12px 14px;margin-bottom:22px;font-size:12px;color:var(--g5);line-height:1.7;}
.guide-tip-box strong{color:var(--gold);}
.btn-guide-start{width:100%;padding:15px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 28px rgba(34,197,94,0.35);transition:all 0.2s;}
.btn-guide-start:hover{background:linear-gradient(135deg,var(--g2),var(--g3));box-shadow:0 0 44px rgba(34,197,94,0.55);transform:translateY(-2px);}

/* PUBLIC FEED PREVIEW */
.public-feed-section{padding:60px 5% 80px;position:relative;z-index:1;}
.public-post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;margin-bottom:10px;transition:border-color 0.2s;}
.public-post-card:hover{border-color:rgba(34,197,94,0.2);}
.public-post-card.elite-pub{border-color:rgba(255,215,0,0.2);}
.public-feed-blur{position:relative;}
.public-feed-blur .feed-lock{position:absolute;bottom:0;left:0;right:0;height:180px;background:linear-gradient(transparent,var(--bg));display:flex;align-items:flex-end;justify-content:center;padding-bottom:20px;}
.btn-unlock-feed{padding:11px 28px;background:var(--g2);border:none;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);box-shadow:0 0 24px rgba(22,163,74,0.35);transition:all 0.2s;}
.btn-unlock-feed:hover{background:var(--g3);}

/* MEDIA UPLOAD */
.media-upload-area{border:2px dashed var(--border);border-radius:10px;padding:14px;margin:10px 0;cursor:pointer;transition:all 0.2s;text-align:center;}
.media-upload-area:hover{border-color:var(--g3);background:var(--glow);}
.media-upload-area input{display:none;}
.media-preview-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
.media-preview-item{position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;border:1.5px solid var(--border);}
.media-preview-item img,.media-preview-item video{width:100%;height:100%;object-fit:cover;}
.media-preview-item .rm-media{position:absolute;top:2px;right:2px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;color:#fff;font-size:9px;display:flex;align-items:center;justify-content:center;}
.file-chip{display:flex;align-items:center;gap:6px;background:var(--s2);border:1px solid var(--border);border-radius:5px;padding:4px 10px;font-size:11px;color:var(--g4);}

/* GROUP CHAT */
.group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;cursor:pointer;}
.group-card:hover{border-color:rgba(34,197,94,0.25);}
.group-card.elite-group{border-color:rgba(255,215,0,0.2);}
.group-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.group-icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.group-title{font-size:14px;font-weight:700;}
.group-desc{font-size:12px;color:var(--muted);margin-bottom:6px;}
.group-meta{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);display:flex;align-items:center;gap:10px;}

/* GROUP SETTINGS (ELITE) */
.group-settings-section{background:var(--s2);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:18px;margin-bottom:14px;}
.group-settings-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.toggle-row label{font-size:12px;color:var(--g5);}
.toggle{position:relative;width:38px;height:20px;cursor:pointer;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:var(--muted2);border-radius:20px;transition:0.3s;}
.toggle-slider::before{content:'';position:absolute;width:14px;height:14px;left:3px;top:3px;background:#fff;border-radius:50%;transition:0.3s;}
.toggle input:checked+.toggle-slider{background:var(--g2);}
.toggle input:checked+.toggle-slider::before{transform:translateX(18px);}

/* WALLPAPER */
#app.has-wallpaper{background-size:cover;background-position:center;background-attachment:fixed;}
#app.has-wallpaper .app-bar{background:rgba(4,10,5,0.85);}
#app.has-wallpaper .tpanel{background:rgba(4,10,5,0.5);border-radius:12px;}

/* REPORT MODAL */
.report-reason{display:flex;flex-direction:column;gap:8px;margin:12px 0;}
.report-reason label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--g5);cursor:pointer;}
.report-reason input[type=radio]{accent-color:var(--g3);}

/* ADMIN MSG BADGE */
.admin-msg-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}

/* ── BADGES SYSTÈME ── */
.badges-section{margin-top:24px;}
.badges-section h3{font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:14px;text-transform:uppercase;}
.badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px;}
.badge-item{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;transition:all 0.2s;position:relative;}
.badge-item.unlocked{border-color:rgba(34,197,94,0.35);background:rgba(22,163,74,0.06);}
.badge-item.unlocked:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.badge-item.locked{opacity:0.4;filter:grayscale(1);}
.badge-item.special{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.05);}
.badge-item.special.unlocked{box-shadow:0 0 12px rgba(255,215,0,0.15);}
.badge-emoji{font-size:26px;line-height:1;margin-bottom:6px;}
.badge-name{font-size:9px;font-weight:700;color:var(--g5);font-family:'DM Mono',monospace;letter-spacing:0.5px;line-height:1.3;}
.badge-item.locked .badge-name{color:var(--muted2);}
.badge-lock-icon{position:absolute;top:5px;right:6px;font-size:8px;color:var(--muted2);}
.badge-plan-tag{display:inline-block;font-family:'DM Mono',monospace;font-size:7px;padding:1px 5px;border-radius:2px;margin-top:3px;letter-spacing:0.5px;}
.badge-plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.badge-plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.badge-plan-elite{background:linear-gradient(135deg,rgba(255,215,0,0.25),rgba(255,140,0,0.2));color:#ffd700;}
.badge-tooltip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--s3);border:1px solid var(--border);border-radius:6px;padding:6px 10px;font-size:10px;color:var(--g5);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:10;font-family:'Plus Jakarta Sans',sans-serif;}
.badge-item:hover .badge-tooltip{opacity:1;}
.badge-progress-bar{height:3px;background:var(--s3);border-radius:2px;margin-top:5px;overflow:hidden;}
.badge-progress-fill{height:100%;background:var(--g3);border-radius:2px;transition:width 0.4s;}

/* ── MISSIONS & SHOP CREDITS ── */
.credits-tabs{display:flex;gap:0;margin-bottom:20px;border-bottom:1px solid var(--border2);}
.credits-tab{padding:9px 16px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.credits-tab.active{color:var(--gold);border-bottom-color:var(--gold);}
.credits-tab:hover{color:var(--white);}
.cpanel{display:none;}
.cpanel.active{display:block;animation:fadeUp 0.2s ease;}

/* Barre credits améliorée */
.credits-bar-v2{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;}
.credits-big{font-family:'Bebas Neue',sans-serif;font-size:42px;color:var(--gold);line-height:1;letter-spacing:1px;}
.credits-sub{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.credits-actions{display:flex;gap:8px;flex-wrap:wrap;}

/* Missions */
.mission-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:14px;transition:all 0.2s;}
.mission-card.done{border-color:rgba(34,197,94,0.3);background:rgba(22,163,74,0.04);opacity:0.7;}
.mission-icon{font-size:26px;flex-shrink:0;width:44px;height:44px;background:var(--s2);border-radius:10px;display:flex;align-items:center;justify-content:center;}
.mission-info{flex:1;}
.mission-title{font-size:13px;font-weight:700;color:var(--white);margin-bottom:2px;}
.mission-desc{font-size:11px;color:var(--muted);margin-bottom:6px;}
.mission-prog-bar{height:4px;background:var(--s3);border-radius:2px;overflow:hidden;margin-bottom:4px;}
.mission-prog-fill{height:100%;background:var(--g3);border-radius:2px;transition:width 0.5s;}
.mission-prog-txt{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);}
.mission-reward{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;}
.mission-reward-val{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);line-height:1;}
.mission-reward-label{font-size:8px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.btn-claim{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.15));border:1.5px solid rgba(255,215,0,0.4);border-radius:5px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer;color:var(--gold);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-claim:hover{box-shadow:0 0 10px rgba(255,215,0,0.3);}
.btn-claim:disabled{opacity:0.4;cursor:not-allowed;}
.mission-done-tag{font-size:10px;color:var(--g3);font-weight:700;}
.missions-reset{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);text-align:right;margin-bottom:12px;}

/* Shop */
.shop-section-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin:20px 0 10px;}
.shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-bottom:20px;}
.shop-item{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 12px;text-align:center;transition:all 0.2s;cursor:pointer;position:relative;}
.shop-item:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-2px);}
.shop-item.premium{border-color:rgba(255,215,0,0.25);background:rgba(255,215,0,0.03);}
.shop-item.premium:hover{border-color:rgba(255,215,0,0.5);box-shadow:0 0 16px rgba(255,215,0,0.1);}
.shop-item-emoji{font-size:30px;margin-bottom:8px;}
.shop-item-name{font-size:12px;font-weight:700;color:var(--white);margin-bottom:3px;}
.shop-item-desc{font-size:10px;color:var(--muted);margin-bottom:8px;line-height:1.4;}
.shop-item-price{display:inline-flex;align-items:center;gap:4px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:4px;padding:3px 9px;font-family:'DM Mono',monospace;font-size:11px;font-weight:700;color:var(--gold);}
.shop-item-badge{position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:3px;font-family:'DM Mono',monospace;}

/* Badge rewards in BADGES */
.badge-reward{font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);margin-top:3px;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:200;padding:0 5%;height:66px;display:flex;align-items:center;justify-content:space-between;background:rgba(4,10,5,0.92);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:3px;color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.35);position:relative;z-index:1;}
.logo span{color:var(--white);}
.nav-links{display:flex;gap:28px;}
.nav-links a{font-size:13px;font-weight:500;color:var(--muted);text-decoration:none;letter-spacing:0.5px;transition:color 0.2s;position:relative;z-index:1;}
.nav-links a:hover{color:var(--g3);}
.lang-btn{background:rgba(34,197,94,0.08);border:1.5px solid var(--border);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:700;color:var(--g4);cursor:pointer;transition:all 0.2s;font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.lang-btn:hover{border-color:var(--g3);background:rgba(34,197,94,0.15);}
.nav-right{display:flex;gap:10px;align-items:center;}
.btn-g{padding:9px 22px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;letter-spacing:0.3px;}
.btn-ghost-g{background:transparent;border:1.5px solid var(--border);color:var(--g3);}
.btn-ghost-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-solid-g:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);transform:translateY(-1px);}

/* HAMBURGER MOBILE */
.hamburger{display:none;flex-direction:column;justify-content:center;gap:5px;width:36px;height:36px;background:transparent;border:1.5px solid var(--border);border-radius:6px;cursor:pointer;padding:7px;flex-shrink:0;transition:border-color 0.2s;}
.hamburger span{display:block;height:2px;background:var(--g3);border-radius:2px;transition:all 0.3s;}
.hamburger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
.hamburger.open span:nth-child(2){opacity:0;transform:scaleX(0);}
.hamburger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}
.hamburger:hover{border-color:var(--g3);}

/* MOBILE DROPDOWN MENU */
.mobile-menu{display:none;position:fixed;top:66px;left:0;right:0;z-index:199;background:rgba(4,10,5,0.97);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);padding:0;max-height:0;overflow:hidden;transition:max-height 0.35s cubic-bezier(0.4,0,0.2,1),padding 0.35s ease;}
.mobile-menu.open{max-height:400px;padding:16px 5% 20px;}
.mobile-menu a{display:block;padding:13px 0;font-size:15px;font-weight:600;color:var(--muted);text-decoration:none;border-bottom:1px solid var(--border2);transition:color 0.2s;}
.mobile-menu a:last-of-type{border-bottom:none;}
.mobile-menu a:hover,.mobile-menu a:active{color:var(--g3);}
.mobile-menu .mobile-btns{display:flex;gap:10px;margin-top:16px;}
.mobile-menu .mobile-btns button{flex:1;}

/* BOTTOM NAV BAR */
.bottom-nav{
  display:none;
  position:fixed;bottom:0;left:0;right:0;z-index:300;
  background:rgba(4,10,5,0.96);backdrop-filter:blur(28px);
  border-top:1px solid rgba(34,197,94,0.1);
  padding:8px 4px max(10px,env(safe-area-inset-bottom));
  gap:0;
}
body:not(.app-active) .bottom-nav{display:none !important;}
.bn-item{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:4px;padding:6px 0;background:none;border:none;cursor:pointer;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:9px;font-weight:600;
  color:var(--muted);transition:color 0.2s, transform 0.15s;position:relative;
  touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.bn-item:active{transform:scale(0.88);}
.bn-item.active{color:var(--g3);}
.bn-item.active .bn-icon{filter:drop-shadow(0 0 8px rgba(34,197,94,0.7));transform:translateY(-3px) scale(1.2);}
.bn-item.bn-publish.active{color:var(--bg) !important;}

/* Colors label par onglet */
#bn-feed.active{color:#fb923c;}
#bn-showcase.active{color:#c4b5fd;}
#bn-profile.active{color:#38bdf8;}
#bn-more.active{color:#94a3b8;}
/* Individual colors — removed, icons auto-colored */
#bn-feed.active,#bn-showcase.active,#bn-profile.active,#bn-more.active{color:var(--g3);}
.bn-item .bn-icon{line-height:1;display:flex;align-items:center;justify-content:center;transition:transform 0.25s cubic-bezier(0.34,1.56,0.64,1);}
.bn-item .bn-icon svg{width:36px;height:36px;border-radius:10px;}
.bn-item.active .bn-icon{transform:translateY(-3px) scale(1.18);}
.bn-item.bn-publish .bn-icon{transform:none !important;filter:none !important;}
.bn-item.bn-publish .bn-icon svg{width:28px;height:28px;border-radius:0;}
@keyframes bnPop{0%{transform:scale(1)}40%{transform:scale(1.3)}100%{transform:scale(1)}}
.bn-item.bn-just-activated .bn-icon{animation:bnPop 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.bn-item .bn-dot{
  position:absolute;top:4px;right:calc(50% - 14px);
  width:6px;height:6px;background:var(--g3);border-radius:50%;
  box-shadow:0 0 5px var(--g3);display:none;
}
.bn-item .bn-dot.show{display:block;}
.bn-item.bn-publish{
  background:linear-gradient(135deg,var(--g1),var(--g2));
  border-radius:16px;
  width:50px;max-width:50px;height:50px;padding:0;margin:0 auto;margin-top:-8px;
  box-shadow:0 0 20px rgba(34,197,94,0.4), 0 4px 12px rgba(0,0,0,0.3);
  color:var(--bg) !important;
  flex:0 0 50px;
  transition:transform 0.15s, box-shadow 0.2s;
}
.bn-item.bn-publish svg{stroke:var(--bg) !important;}
.bn-item.bn-publish:active{transform:scale(0.9);box-shadow:0 0 10px rgba(34,197,94,0.3);}
.bn-item#bn-credits{position:relative;}
/* ── MENU PLUS MOBILE ── */
.bn-more-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:8000;display:flex;align-items:flex-end;justify-content:center;}
.bn-more-overlay.hidden{display:none!important;}
.bn-more-sheet{background:var(--s1);border:1.5px solid var(--border);border-radius:20px 20px 0 0;width:100%;max-width:480px;padding:12px 20px 32px;animation:slideUp 0.3s cubic-bezier(0.34,1.2,0.64,1);}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.bn-more-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px;}
.bn-more-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:16px;text-align:center;}
.bn-more-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.bn-more-item{display:flex;flex-direction:column;align-items:center;gap:6px;background:var(--s2);border:1.5px solid var(--border2);border-radius:14px;padding:14px 8px;cursor:pointer;transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);}
.bn-more-item:hover,.bn-more-item:active{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.bn-more-item.bn-more-logout{border-color:rgba(248,113,113,0.2);color:#f87171;}
.bn-more-item.bn-more-logout:hover,.bn-more-item.bn-more-logout:active{border-color:#f87171;background:rgba(248,113,113,0.08);color:#f87171;}
.bn-more-icon{font-size:22px;line-height:1;display:flex;align-items:center;justify-content:center;}
.bn-more-icon svg{width:38px;height:38px;border-radius:10px;}
.bn-item#bn-credits .bn-icon{font-size:18px;}
.bn-credits-val{font-family:'Bebas Neue',sans-serif;font-size:12px;color:var(--gold);line-height:1;margin-top:-1px;}

@media(max-width:768px){
  /* On home (landing): logo + auth buttons, hide links and hamburger */
  #landing .nav-links{display:none;}
  #landing .nav-right{display:flex;gap:8px;}
  #landing .nav-right .lang-btn{display:flex;}
  #landing .nav-right .btn-ghost-g,
  #landing .nav-right .btn-solid-g{display:flex;padding:8px 14px;font-size:12px;}
  #landing .hamburger{display:none !important;}
  /* Hide mobile-menu dropdown on home */
  #mobile-menu{display:none !important;}
  /* For app (app-active): normal behavior */
  body.app-active nav .nav-links{display:none;}
  body.app-active nav .nav-right{display:none;}
  body.app-active nav .hamburger{display:flex !important;}
  body.app-active #mobile-menu{display:block !important;}
  body.app-active .bottom-nav{display:flex;}
  body.app-active #app{padding-bottom:72px;}
  .app-bar{padding:0 3%;gap:0;}
  .app-logo{font-size:15px;letter-spacing:2px;margin-right:8px;}
}

/* HERO */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:100px 5% 80px;position:relative;z-index:1;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.25);border-radius:4px;padding:7px 16px;font-size:12px;font-weight:600;color:var(--g4);margin-bottom:32px;letter-spacing:1px;text-transform:uppercase;animation:fadeUp 0.6s ease both;}
.pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--g3);box-shadow:0 0 8px var(--g3);animation:blink 1.8s infinite;flex-shrink:0;}
.hero-concept{background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:12px;padding:18px 28px;margin-bottom:36px;max-width:660px;animation:fadeUp 0.6s 0.08s ease both;}
.hero-concept p{font-size:15px;color:var(--g5);line-height:1.8;font-weight:400;}
.hero-concept p strong{color:var(--g3);}
.hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(72px,12vw,148px);letter-spacing:2px;line-height:0.88;margin-bottom:20px;animation:fadeUp 0.6s 0.12s ease both;}
.hero h1 .line1{display:block;color:var(--white);}
.hero h1 .line2{display:block;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.35);}
.hero-sub{font-size:16px;color:var(--muted);max-width:500px;line-height:1.8;margin-bottom:44px;animation:fadeUp 0.6s 0.18s ease both;}
.hero-actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:18px;animation:fadeUp 0.6s 0.24s ease both;}
.btn-hero-big{padding:15px 38px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;transition:all 0.3s;letter-spacing:0.3px;}
.btn-hero-solid{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 36px rgba(22,163,74,0.35);}
.btn-hero-solid:hover{background:var(--g3);box-shadow:0 0 70px rgba(22,163,74,0.55);transform:translateY(-2px);}
.btn-hero-out{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-hero-out:hover{border-color:var(--g3);background:var(--glow);}
.hero-note{font-size:13px;color:var(--muted2);animation:fadeUp 0.6s 0.3s ease both;}
.hero-note span{color:var(--g4);}
.how-simple{display:flex;gap:0;justify-content:center;max-width:860px;width:100%;animation:fadeUp 0.6s 0.36s ease both;}
.how-step-simple{flex:1;text-align:center;padding:24px 18px;border:1px solid var(--border2);position:relative;}
.how-step-simple+.how-step-simple{border-left:none;}
.how-step-simple::before{content:attr(data-n);position:absolute;top:10px;left:12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);letter-spacing:1px;}
.step-icon{font-size:26px;margin-bottom:10px;}
.how-step-simple h4{font-size:13px;font-weight:700;color:var(--g3);margin-bottom:5px;}
.how-step-simple p{font-size:12px;color:var(--muted);line-height:1.6;}

/* SECTION HELPERS */
.sec-label{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;display:block;}
h2.section-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(36px,5vw,60px);letter-spacing:2px;color:var(--white);margin-bottom:8px;}
h2.section-title em{color:var(--g3);font-style:normal;}
.section-sub{color:var(--muted);font-size:15px;margin-bottom:48px;max-width:480px;}

/* SHOWCASE */
.showcase-section{padding:100px 5%;position:relative;z-index:1;}
.filters-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px;}
.f-btn{padding:7px 18px;border-radius:4px;border:1.5px solid var(--border2);background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;}
.f-btn:hover,.f-btn.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.showcase-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
.v-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer;}
.v-card:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-3px);box-shadow:0 16px 48px rgba(0,0,0,0.4);}
.v-banner{height:110px;display:flex;align-items:center;justify-content:center;font-size:42px;position:relative;}
.v-banner::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,transparent 40%,var(--s1));}
.v-body{padding:16px 18px;}
.v-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.v-name{font-size:15px;font-weight:700;margin-bottom:5px;}
.v-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:8px;}
/* ── EXIT INTENT POPUP ── */
.exit-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);z-index:9500;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.3s ease;}
.exit-overlay.hidden{display:none!important;}
.exit-box{background:linear-gradient(145deg,var(--s1),var(--s2));border:2px solid rgba(34,197,94,0.3);border-radius:20px;max-width:360px;width:100%;padding:32px 28px;text-align:center;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);}
.exit-close{position:absolute;top:14px;right:14px;background:var(--s2);border:1px solid var(--border);border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;color:var(--muted);}
.exit-emoji{font-size:48px;margin-bottom:12px;}
.exit-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--white);margin-bottom:8px;}
.exit-sub{font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:16px;}
.exit-sub strong{color:var(--g4);}
.exit-perks{display:flex;flex-direction:column;gap:6px;margin-bottom:20px;text-align:left;}
.exit-perks span{font-size:12px;color:var(--g5);padding:6px 12px;background:rgba(34,197,94,0.05);border:1px solid var(--border2);border-radius:6px;}
.btn-exit-cta{width:100%;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 24px rgba(34,197,94,0.3);transition:all 0.2s;margin-bottom:12px;}
.btn-exit-cta:hover{transform:translateY(-1px);box-shadow:0 0 40px rgba(34,197,94,0.5);}
.exit-skip{font-size:11px;color:var(--muted2);cursor:pointer;text-decoration:underline;}
.exit-skip:hover{color:var(--muted);}

/* ── MODAL PROJET ── */
.project-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:9000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.2s ease;}
.project-modal-overlay.hidden{display:none!important;}
.project-modal{background:var(--s1);border:1.5px solid rgba(34,197,94,0.25);border-radius:18px;max-width:480px;width:100%;max-height:85vh;overflow-y:auto;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.pmo-banner{height:130px;display:flex;align-items:center;justify-content:center;font-size:60px;position:relative;flex-shrink:0;}
.pmo-banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.pmo-close{position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.5);border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:#fff;z-index:2;}
.pmo-body{padding:20px 22px 24px;}
.pmo-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pmo-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1.5px;color:var(--white);margin-bottom:8px;line-height:1.1;}
.pmo-hook{font-size:13px;color:var(--g4);font-weight:700;margin-bottom:10px;}
.pmo-desc{font-size:13px;color:#c4d9cb;line-height:1.75;margin-bottom:14px;}
.pmo-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.pmo-tag{font-family:'DM Mono',monospace;font-size:10px;padding:3px 9px;border-radius:3px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);color:var(--g4);}
.pmo-url{display:flex;align-items:center;gap:8px;padding:11px 14px;background:rgba(22,163,74,0.07);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;text-decoration:none;margin-bottom:14px;transition:all 0.2s;}
.pmo-url:hover{border-color:var(--g3);background:rgba(22,163,74,0.14);}
.pmo-url span{font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.pmo-footer{display:flex;align-items:center;justify-content:space-between;padding-top:14px;border-top:1px solid var(--border2);}
.pmo-author{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);}
.pmo-ava{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg);}
.pmo-actions{display:flex;gap:8px;}
.pmo-btn{display:flex;align-items:center;gap:5px;background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:6px 14px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.pmo-btn:hover,.pmo-btn.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.pmo-btn-dm{border-color:rgba(34,197,94,0.2);color:var(--g4);}
.pmo-btn-dm:hover{border-color:var(--g3);background:var(--glow);}

.v-url-link{display:flex;align-items:center;gap:6px;padding:7px 10px;margin-bottom:10px;background:rgba(22,163,74,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:8px;text-decoration:none;transition:all 0.2s;font-size:11px;color:var(--g4);}
.v-url-link:hover{border-color:rgba(34,197,94,0.4);background:rgba(22,163,74,0.12);color:var(--g3);}
.v-url-text{font-family:'DM Mono',monospace;font-size:11px;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.v-footer{display:flex;align-items:center;justify-content:space-between;}
.v-author{display:flex;align-items:center;gap:7px;font-size:12px;color:var(--muted);}
.v-ava{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--bg);background:var(--g2);}
.v-actions{display:flex;align-items:center;gap:5px;}
.btn-vote-g{display:flex;align-items:center;gap:4px;background:transparent;border:1.5px solid var(--border2);border-radius:4px;padding:4px 10px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'DM Mono',monospace;}
.btn-vote-g:hover,.btn-vote-g.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.btn-dm-small{background:transparent;border:1.5px solid var(--border2);border-radius:4px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;}
.btn-dm-small:hover{border-color:var(--g3);background:var(--glow);}
.v-badge{position:absolute;top:8px;left:8px;background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;letter-spacing:1px;z-index:2;border-radius:2px;}

/* PLANS */
.plans-section{padding:100px 5%;position:relative;z-index:1;background:linear-gradient(180deg,transparent,var(--bg2),transparent);}
.plans-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:16px;}
.plan-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:28px 20px;position:relative;transition:all 0.3s;}
.plan-card:hover{background:var(--s2);border-color:rgba(34,197,94,0.35);transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,0,0,0.4);}
.plan-card.recommended{background:var(--s2);border:1.5px solid var(--g3);border-top:3px solid var(--g3);}
.plan-badge{position:absolute;top:-1px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:9px;font-weight:700;padding:3px 10px;letter-spacing:1px;white-space:nowrap;}
.plan-name{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;}
.plan-card.recommended .plan-name{color:var(--g3);}
.plan-price{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--white);letter-spacing:-1px;line-height:1;}
.plan-card.recommended .plan-price{color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.3);}
.plan-period{font-size:12px;color:var(--muted);margin:3px 0 14px;}
.plan-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:16px;min-height:40px;}
.plan-features{list-style:none;margin-bottom:24px;}
.plan-features li{font-size:12px;color:#5a8a68;padding:6px 0;border-bottom:1px solid var(--border2);display:flex;align-items:flex-start;gap:7px;line-height:1.5;}
.plan-features li:last-child{border:none;}
.plan-features li::before{content:'✓';color:var(--g3);font-size:10px;font-weight:700;flex-shrink:0;margin-top:2px;}
.plan-features li.no::before{content:'✗';color:var(--muted2);}
.plan-features li.no{color:var(--muted2);}
.btn-plan-g{width:100%;padding:11px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;}
.btn-plan-outline-g{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-plan-outline-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-plan-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 16px rgba(22,163,74,0.3);}
.btn-plan-solid-g:hover{background:var(--g3);}

/* REVIEWS */
.reviews-section{padding:100px 5%;position:relative;z-index:1;}
.reviews-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.rev-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:22px;transition:all 0.2s;}
.rev-card:hover{border-color:rgba(34,197,94,0.25);}
.rev-stars{color:var(--g3);font-size:12px;margin-bottom:10px;letter-spacing:2px;}
.rev-text{font-size:13px;color:#6a9478;line-height:1.8;margin-bottom:16px;}
.rev-text strong{color:var(--g4);}
.rev-author{display:flex;align-items:center;gap:10px;}
.rev-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.rev-name{font-size:13px;font-weight:700;}
.rev-handle{font-size:11px;color:var(--muted);}
.rev-result{font-size:11px;color:var(--g3);font-weight:600;margin-top:1px;}

/* CTA / FOOTER */
.cta-section{padding:100px 5%;text-align:center;position:relative;z-index:1;border-top:1px solid var(--border2);}
.cta-section h2{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,8vw,96px);letter-spacing:2px;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.3);margin-bottom:14px;}
.cta-section p{color:var(--muted);font-size:15px;margin-bottom:36px;}
footer{background:var(--bg2);border-top:1px solid var(--border2);padding:28px 5%;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:14px;position:relative;z-index:1;}
.footer-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;}
footer p{color:var(--muted);font-size:11px;font-family:'DM Mono',monospace;}

/* MODALS */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(4,10,5,0.92);backdrop-filter:blur(16px);z-index:500;align-items:center;justify-content:center;padding:16px;overflow-y:auto;}
.modal-bg.open{display:flex;animation:fadeIn 0.2s ease;}
.modal{background:var(--s1);border:1.5px solid var(--border);border-radius:16px;padding:36px;width:100%;max-width:480px;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);max-height:90vh;overflow-y:auto;}
.modal.wide{max-width:900px;}
.modal::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:60%;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);border-radius:100px;}
.modal-close{position:absolute;top:12px;right:12px;background:rgba(22,163,74,0.08);border:1.5px solid var(--border);border-radius:50%;width:28px;height:28px;cursor:pointer;color:var(--muted);font-size:12px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.modal-close:hover{border-color:var(--g3);color:var(--g3);}
.modal h2{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;color:var(--g3);margin-bottom:3px;}
.modal-sub{color:var(--muted);font-size:11px;margin-bottom:22px;font-family:'DM Mono',monospace;letter-spacing:1px;}
.fg{margin-bottom:12px;}
label{display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:4px;letter-spacing:1.5px;text-transform:uppercase;}
input,select,textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
input:focus,select:focus,textarea:focus{border-color:var(--g3);box-shadow:0 0 10px rgba(34,197,94,0.08);}
select option{background:var(--s1);}
textarea{resize:vertical;min-height:68px;}
.btn-modal-g{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;margin-top:6px;box-shadow:0 0 18px rgba(22,163,74,0.28);}
.btn-modal-g:hover{background:var(--g3);}
.btn-modal-g:disabled{opacity:0.4;cursor:not-allowed;}
.modal-switch{text-align:center;margin-top:12px;font-size:13px;color:var(--muted);}
.modal-switch a{color:var(--g3);cursor:pointer;font-weight:600;}

/* SIGNUP PLANS */
.signup-plans{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:18px;}
.sp-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative;}
.sp-card:hover,.sp-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.sp-card.selected::after{content:'✓';position:absolute;top:5px;right:7px;color:var(--g3);font-size:10px;font-weight:700;}
.sp-plan{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px;}
.sp-price{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--g3);line-height:1;}
.sp-per{font-size:9px;color:var(--muted);}
.sp-feat{font-size:10px;color:#4a7a58;margin-top:5px;line-height:1.5;}

/* PAYMENT */
.pay-sum{background:rgba(22,163,74,0.07);border:1.5px solid rgba(22,163,74,0.18);border-radius:10px;padding:16px;text-align:center;margin-bottom:16px;}
.pay-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pay-price{font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--g3);}
.pay-period{font-size:11px;color:var(--muted);}
#card-element{background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:8px;padding:12px;margin-bottom:5px;}
#card-errors{color:#f87171;font-size:11px;min-height:14px;margin-bottom:7px;font-family:'DM Mono',monospace;}

/* APP BAR */
#app{display:none;min-height:100vh;}
.app-bar{background:rgba(4,10,5,0.96);border-bottom:1px solid var(--border2);padding:0 2%;height:60px;display:flex;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(24px);}
.app-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;text-shadow:0 0 12px rgba(74,222,128,0.35);margin-right:24px;white-space:nowrap;flex-shrink:0;}
.app-tabs{display:flex;flex:1;overflow-x:auto;gap:0;scrollbar-width:none;}
.app-tabs::-webkit-scrollbar{display:none;}
.app-tab{padding:0 14px;height:60px;display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.app-tab:hover{color:var(--white);}
.app-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.notif-dot{width:5px;height:5px;background:var(--g3);border-radius:50%;margin-top:-10px;margin-left:-3px;box-shadow:0 0 5px var(--g3);flex-shrink:0;}
.app-right{margin-left:auto;display:flex;align-items:center;gap:7px;flex-shrink:0;padding-left:12px;}
.plan-chip{background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:1px;}
.user-chip{display:flex;align-items:center;gap:7px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:4px 10px;cursor:pointer;transition:all 0.2s;}
.user-chip:hover{border-color:var(--g3);}
.user-chip-ava{width:24px;height:24px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.user-chip-name{font-size:12px;font-weight:600;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-out-g{background:transparent;border:1.5px solid var(--border2);border-radius:5px;padding:5px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-out-g:hover{border-color:#f87171;color:#f87171;}

/* APP PANELS */
.tpanel{display:none;}
.tpanel.active{display:block;animation:fadeUp 0.22s ease;}

/* PUBLISH BOX */
/* ── COMPOSER TWEET-STYLE ── */
.composer-intro{margin-bottom:20px;padding:0 2px;}
.composer-intro-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--g3);text-transform:uppercase;margin-bottom:6px;opacity:0.7;}
.composer-intro-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--white);line-height:1;margin-bottom:5px;}
.composer-intro-sub{font-size:12px;color:var(--muted);line-height:1.6;}

.publish-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:16px;padding:0;margin-bottom:22px;overflow:hidden;transition:border-color 0.25s,box-shadow 0.25s;}
.publish-box:focus-within{border-color:rgba(34,197,94,0.35);box-shadow:0 4px 40px rgba(34,197,94,0.06);}
.publish-top{display:flex;gap:12px;align-items:flex-start;padding:16px 16px 0;}
.pub-ava{width:36px;height:36px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;margin-top:2px;}
.pub-input-wrap{flex:1;display:flex;flex-direction:column;gap:10px;}
.pub-text{width:100%;background:transparent;border:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;color:var(--white);resize:none;outline:none;min-height:52px;max-height:200px;line-height:1.65;overflow:hidden;}
.pub-text::placeholder{color:var(--muted);}

.pub-type-card{background:var(--s1);border:2px solid rgba(34,197,94,0.15);border-radius:14px;padding:14px 16px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.22s;}
.pub-type-card:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,0.3);}
.pub-type-card.ptc-selected{transform:translateY(-2px);box-shadow:0 6px 28px rgba(0,0,0,0.4);outline:2px solid rgba(255,255,255,0.12);}
.ptc-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.ptc-body{flex:1;}
.ptc-name{font-size:14px;font-weight:800;color:var(--white);margin-bottom:2px;}
.ptc-desc{font-size:11px;color:var(--muted);margin-bottom:4px;}
.ptc-fields{font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace;}
.pub-type-row{display:flex;gap:5px;flex-wrap:wrap;max-height:0;overflow:hidden;opacity:0;transition:max-height 0.3s ease,opacity 0.25s ease;}
.pub-type-row.visible{max-height:80px;opacity:1;}
.pub-type-pill{display:flex;align-items:center;gap:4px;padding:4px 11px;border-radius:20px;border:1.5px solid var(--border2);background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.18s;white-space:nowrap;}
.pub-type-pill:hover{border-color:var(--g3);color:var(--g3);}
.pub-type-pill.active{border-color:var(--g2);color:var(--bg);background:var(--g2);}

.pub-proj-wrap{padding-bottom:2px;}
.pub-proj-wrap input{width:100%;padding:7px 11px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border2);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;color:var(--white);outline:none;transition:border-color 0.2s;}
.pub-proj-wrap input:focus{border-color:rgba(34,197,94,0.4);}
.pub-proj-wrap input::placeholder{color:var(--muted2);}
.pub-url-trigger{display:inline-flex;align-items:center;gap:5px;background:transparent;border:1.5px solid var(--border2);border-radius:20px;padding:4px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.18s;}
.pub-url-trigger:hover{border-color:var(--g3);color:var(--g3);}
.pub-url-wrap{padding-top:0;}
.pub-url-inner{display:flex;align-items:center;gap:8px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;transition:border-color 0.2s;}
.pub-url-inner:focus-within{border-color:rgba(34,197,94,0.4);}
.pub-url-icon{font-size:13px;flex-shrink:0;}
.pub-url-wrap input{flex:1;background:transparent;border:none;outline:none;font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);letter-spacing:0.3px;}
.pub-url-wrap input::placeholder{color:var(--muted2);}
.pub-url-close{background:transparent;border:none;color:var(--muted);font-size:11px;cursor:pointer;padding:0 2px;line-height:1;transition:color 0.15s;}
.pub-url-close:hover{color:#f87171;}

.pub-divider{height:1px;background:var(--border2);margin:14px 0 0;}
.pub-actions{display:flex;justify-content:flex-end;align-items:center;padding:10px 16px;gap:12px;}
.pub-meta{display:none;}
.pub-right{display:flex;align-items:center;gap:12px;}
.pub-char-count{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);transition:color 0.2s,opacity 0.2s;}
.pub-limit{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);letter-spacing:0.4px;}
.btn-publish{background:var(--g2);border:none;border-radius:20px;padding:8px 22px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;letter-spacing:0.2px;}
.btn-publish:hover{background:var(--g3);box-shadow:0 0 20px rgba(34,197,94,0.35);transform:translateY(-1px);}
.btn-publish:disabled{opacity:0.3;cursor:not-allowed;transform:none;box-shadow:none;}

/* FEED */
.feed-tabs{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border2);}
.feed-tab{padding:9px 18px;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;}
.feed-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;margin-bottom:12px;transition:border-color 0.2s;}
.post-card:hover{border-color:rgba(34,197,94,0.2);}
.post-url-card{display:flex;align-items:center;gap:8px;margin:10px 0 4px;padding:10px 14px;background:rgba(22,163,74,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:10px;text-decoration:none;transition:all 0.2s;cursor:pointer;}
.post-url-card:hover{border-color:rgba(34,197,94,0.4);background:rgba(22,163,74,0.1);}
.post-url-icon{font-size:14px;flex-shrink:0;}
.post-url-text{font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.post-url-arrow{font-size:14px;color:var(--g3);flex-shrink:0;}
.post-header{display:flex;align-items:center;gap:9px;margin-bottom:12px;}
.post-ava{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;cursor:pointer;}
.post-meta{flex:1;}
.post-author{font-size:14px;font-weight:700;cursor:pointer;transition:color 0.2s;}
.post-author:hover{color:var(--g3);}
.post-info{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-plan-badge{font-family:'DM Mono',monospace;font-size:8px;padding:1px 5px;border-radius:2px;letter-spacing:0.5px;}
.plan-free{background:rgba(107,114,128,0.2);color:#9ca3af;}
.plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.plan-elite{background:rgba(74,222,128,0.2);color:var(--g3);box-shadow:0 0 5px rgba(74,222,128,0.2);}
.post-content{font-size:14px;line-height:1.7;color:#c4d9cb;margin-bottom:12px;}
.post-project{background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:12px;margin-bottom:12px;display:flex;gap:10px;align-items:center;transition:all 0.2s;}
.post-project:hover{border-color:rgba(34,197,94,0.22);}
.post-proj-icon{font-size:26px;width:42px;height:42px;background:var(--s3);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.post-proj-name{font-size:13px;font-weight:700;margin-bottom:2px;}
.post-proj-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px;text-transform:uppercase;}
.post-proj-desc{font-size:11px;color:var(--muted);margin-top:3px;}
.post-timer{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.15);border-radius:3px;padding:2px 7px;display:inline-flex;align-items:center;gap:3px;}
.post-actions{display:flex;gap:5px;align-items:center;flex-wrap:wrap;}
.btn-action{background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);transition:all 0.2s;display:flex;align-items:center;gap:4px;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-action:hover{border-color:var(--g3);color:var(--g3);}
.btn-action.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}

/* WORLD CHAT PANEL */
.chat-panel-container{max-width:740px;margin:0 auto;padding:24px 0;}
.chat-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;display:flex;flex-direction:column;height:500px;}
.chat-msgs-area{flex:1;overflow-y:auto;padding:18px;display:flex;flex-direction:column;gap:9px;}
.chat-msgs-area::-webkit-scrollbar{width:3px;}
.chat-msgs-area::-webkit-scrollbar-thumb{background:var(--muted2);border-radius:2px;}
.chat-msg-item{background:var(--s2);border-radius:8px;padding:8px 11px;}
.chat-msg-name{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:2px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-text{font-size:13px;color:#7a9a82;line-height:1.5;}
.chat-input-row{padding:12px 14px;border-top:1px solid var(--border2);display:flex;gap:7px;}
.chat-input-field{flex:1;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.chat-input-field:focus{border-color:var(--g3);}
.btn-send{background:var(--g2);border:none;border-radius:7px;width:38px;height:38px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-send:hover{background:var(--g3);}

/* PROFILE */
.profile-banner{height:160px;background:linear-gradient(135deg,var(--s2),var(--s3));border-radius:12px;position:relative;margin-bottom:52px;}
.profile-avatar{position:absolute;bottom:-40px;left:22px;width:80px;height:80px;border-radius:50%;border:3px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.25);line-height:1;overflow:hidden;}
.profile-edit-btn{position:absolute;top:14px;right:14px;background:rgba(4,10,5,0.7);border:1.5px solid var(--border);border-radius:6px;padding:6px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.profile-edit-btn:hover{border-color:var(--g3);color:var(--g3);}
.profile-info{padding:0 22px;}
.profile-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1px;margin-bottom:2px;}
.profile-handle{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);margin-bottom:9px;display:flex;align-items:center;gap:8px;}
.profile-bio{font-size:13px;color:var(--muted);line-height:1.7;max-width:600px;margin-bottom:14px;}
.profile-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.profile-tag{background:rgba(22,163,74,0.08);border:1px solid rgba(22,163,74,0.18);border-radius:3px;padding:2px 9px;font-size:10px;color:var(--g4);font-family:'DM Mono',monospace;}
.profile-stats{display:flex;gap:20px;margin-bottom:16px;}
.pstat{text-align:center;}
.pstat-num{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3);}
.pstat-label{font-size:10px;color:var(--muted);}
.profile-links{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
.profile-link{display:flex;align-items:center;gap:5px;background:var(--s1);border:1.5px solid var(--border2);border-radius:5px;padding:5px 10px;font-size:11px;color:var(--muted);text-decoration:none;transition:all 0.2s;cursor:pointer;}
.profile-link:hover{border-color:var(--g3);color:var(--g3);}
.profile-fields{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0;padding:16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;}
.pfield{display:flex;flex-direction:column;gap:2px;}
.pfield-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);letter-spacing:1.5px;text-transform:uppercase;}
.pfield-value{font-size:12px;color:var(--white);}
.profile-actions{display:flex;gap:7px;margin-bottom:20px;}
.btn-follow{background:var(--g2);border:none;border-radius:6px;padding:8px 20px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-follow:hover{background:var(--g3);}
.btn-follow.following{background:transparent;border:1.5px solid var(--border);color:var(--muted);}
.btn-dm-profile{background:transparent;border:1.5px solid var(--border);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;}
.btn-dm-profile:hover{border-color:var(--g3);color:var(--g3);}

/* EDIT PROFILE */
.edit-section{background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:20px;margin-bottom:12px;}
.edit-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.edit-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.edit-avatar-row{display:flex;align-items:flex-start;gap:14px;margin-bottom:14px;}
.edit-avatar-big{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;color:var(--bg);flex-shrink:0;position:relative;cursor:pointer;overflow:hidden;border:2.5px solid rgba(34,197,94,0.3);transition:border-color 0.2s;}
.edit-avatar-big:hover{border-color:var(--g3);}
.edit-avatar-big img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:50%;}
.edit-avatar-big .ava-upload-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;border-radius:50%;font-size:20px;pointer-events:none;}
.edit-avatar-big:hover .ava-upload-overlay{opacity:0;}
.edit-avatar-big.has-photo .ava-upload-overlay{display:none!important;}
#edit-ava-emoji{position:relative;z-index:1;line-height:1;pointer-events:none;}
.emoji-picker{display:flex;gap:5px;flex-wrap:wrap;}
.emoji-opt{width:32px;height:32px;border-radius:8px;border:2px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all 0.2s;background:var(--s2);}
.emoji-opt:hover,.emoji-opt.selected{border-color:var(--g3);background:rgba(22,163,74,0.12);}
.emoji-opt.premium-emoji{position:relative;}
.emoji-opt.premium-emoji::after{content:'⭐';position:absolute;top:-4px;right:-4px;font-size:8px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;width:12px;height:12px;display:flex;align-items:center;justify-content:center;padding:0;}
/* Media upload improved */
.media-upload-bar{display:flex;gap:8px;align-items:center;padding:8px 0;}
.media-btn{display:flex;align-items:center;gap:5px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.media-btn:hover{border-color:var(--g3);color:var(--g3);}
.media-btn input{display:none;}
.media-btn .media-btn-icon{font-size:16px;}

/* DM */
.dm-thread{display:flex;flex-direction:column;height:380px;}
.dm-msgs{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:7px;padding-bottom:6px;}
.dm-msg{display:flex;flex-direction:column;max-width:75%;}
.dm-msg.mine{align-self:flex-end;align-items:flex-end;}
.dm-msg.theirs{align-self:flex-start;}
.dm-bubble-g{padding:9px 13px;border-radius:12px;font-size:13px;line-height:1.5;}
.dm-msg.mine .dm-bubble-g{background:var(--g2);color:var(--bg);border-bottom-right-radius:3px;}
.dm-msg.theirs .dm-bubble-g{background:var(--s2);border:1px solid var(--border2);border-bottom-left-radius:3px;}
.dm-time{font-size:9px;color:var(--muted);margin-top:2px;font-family:'DM Mono',monospace;}
.dm-input-row{display:flex;gap:7px;margin-top:10px;border-top:1px solid var(--border2);padding-top:10px;}

/* ELITE GOLD ACTIONS */
.elite-action { border-color: #d4af37 !important; color: #f5c842 !important; background: rgba(212,175,55,0.08) !important; }
.elite-action:hover { border-color: #f5c842 !important; box-shadow: 0 0 12px rgba(212,175,55,0.3) !important; }
.elite-action.active { background: rgba(212,175,55,0.15) !important; }
.plan-elite-action { border-color: #d4af37 !important; color: #f5c842 !important; }
.badge-elite-gold { color: #f5c842; text-shadow: 0 0 8px rgba(212,175,55,0.5); }

/* GROUP CARDS */
.group-card { background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer; }
.group-card:hover { border-color:rgba(34,197,94,0.35);transform:translateY(-2px);box-shadow:0 12px 36px rgba(0,0,0,0.4); }
.group-banner { height:90px;display:flex;align-items:center;justify-content:center;font-size:36px;position:relative;background:linear-gradient(135deg,var(--s2),var(--s3)); }
.group-body { padding:14px 16px; }
.group-name { font-size:15px;font-weight:700;margin-bottom:4px; }
.group-desc { font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:10px; }
.group-footer { display:flex;align-items:center;justify-content:space-between; }
.group-meta { font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2); }

/* MEDIA PREVIEW */
.media-preview-item { display:flex;align-items:center;gap:8px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:8px 12px;margin-top:6px;font-size:12px;color:var(--muted); }
.media-preview-item img, .media-preview-item video { max-width:100px;max-height:70px;border-radius:4px;object-fit:cover; }
.media-preview-item .remove-media { cursor:pointer;color:#f87171;margin-left:auto; }

/* POST MEDIA */
.post-media { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px;object-fit:cover; }
.post-media-video { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px; }

/* REPORT BTN */
.btn-report { background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 10px;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif; }
.btn-report:hover { border-color:#f87171;color:#f87171; }

/* CONTACT ADMIN BTN (ELITE in profile) */
.btn-contact-admin { background:linear-gradient(135deg,rgba(212,175,55,0.15),rgba(245,200,66,0.1));border:1.5px solid rgba(212,175,55,0.4);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:#f5c842;transition:all 0.2s; }
.btn-contact-admin:hover { border-color:#f5c842;box-shadow:0 0 12px rgba(212,175,55,0.25); }
.follow-list{display:flex;flex-direction:column;gap:7px;}
.follow-item{display:flex;align-items:center;gap:9px;padding:10px 12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;transition:all 0.2s;}
.follow-item:hover{border-color:rgba(34,197,94,0.2);}
.follow-item-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;}
.follow-item-name{font-size:13px;font-weight:700;flex:1;}
.follow-item-sub{font-size:11px;color:var(--muted);}
.btn-dm-list{background:transparent;border:1.5px solid var(--border2);border-radius:5px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;flex-shrink:0;}
.btn-dm-list:hover{border-color:var(--g3);}
.btn-follow-list{background:var(--g2);border:none;border-radius:5px;padding:5px 10px;font-size:11px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-follow-list:hover{background:var(--g3);}
.btn-follow-list.following{background:transparent;border:1px solid var(--border);color:var(--muted);}

/* IA BOOST */
.boost-type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:0;}
.boost-type-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:8px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;font-size:22px;}
.boost-type-card:hover,.boost-type-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.boost-type-card span{display:block;font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;}
.boost-type-card.selected span{color:var(--g3);}

/* UPGRADE */
.upgrade-strip{background:rgba(22,163,74,0.05);border:1.5px solid rgba(22,163,74,0.14);border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:14px;}
.upgrade-strip h4{font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px;}
.upgrade-strip p{font-size:11px;color:var(--muted);}

/* DOTS */
.dots{display:inline-flex;gap:3px;align-items:center;}
.dots span{width:5px;height:5px;border-radius:50%;background:var(--g3);animation:bounce 1.2s ease infinite;}
.dots span:nth-child(2){animation-delay:.2s;}
.dots span:nth-child(3){animation-delay:.4s;}

/* TOAST */
#toast-container{position:fixed;bottom:22px;right:22px;z-index:9999;display:flex;flex-direction:column;gap:7px;pointer-events:none;}
.toast-g{background:var(--s2);border:1.5px solid var(--border);border-radius:10px;padding:11px 16px;font-size:13px;font-weight:600;color:var(--white);display:flex;align-items:center;gap:7px;box-shadow:0 8px 30px rgba(0,0,0,0.5);pointer-events:auto;animation:toastIn 0.4s ease both;min-width:200px;}
.toast-g.success{border-color:rgba(22,163,74,0.4);}

/* ── NEW FEATURES ── */

/* ANALYTICS DASHBOARD */
.analytics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;transition:all 0.2s;}
.stat-card:hover{border-color:rgba(34,197,94,0.25);}
.stat-card-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.stat-card-value{font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3);line-height:1;}
.stat-card-sub{font-size:11px;color:var(--muted);margin-top:3px;}
.stat-card-trend{font-size:11px;font-weight:700;margin-top:5px;}
.stat-card-trend.up{color:#4ade80;}
.stat-card-trend.down{color:#f87171;}
.chart-wrap{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:18px;margin-bottom:16px;}
.chart-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.mini-chart{display:flex;align-items:flex-end;gap:4px;height:60px;}
.mini-bar{flex:1;background:var(--g2);border-radius:3px 3px 0 0;opacity:0.7;transition:opacity 0.2s;cursor:pointer;}
.mini-bar:hover{opacity:1;}
.mini-chart-labels{display:flex;gap:4px;margin-top:5px;}
.mini-chart-labels span{flex:1;font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);text-align:center;}

/* BOOST TOKENS / CREDITS */
.credits-bar{background:var(--s1);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
.credits-info{display:flex;align-items:center;gap:8px;}
.credits-icon{font-size:20px;}
.credits-count{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--gold);line-height:1;}
.credits-label{font-size:11px;color:var(--muted);}
.btn-buy-credits{background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,179,0,0.1));border:1.5px solid rgba(255,215,0,0.4);border-radius:6px;padding:7px 16px;font-size:12px;font-weight:700;cursor:pointer;color:var(--gold);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-buy-credits:hover{box-shadow:0 0 12px rgba(255,215,0,0.3);}
.boost-options{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;}
.boost-opt{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s;}
.boost-opt:hover,.boost-opt.selected{border-color:var(--gold);background:rgba(255,215,0,0.04);}
.boost-opt-icon{font-size:24px;margin-bottom:5px;}
.boost-opt-name{font-size:12px;font-weight:700;color:var(--g5);margin-bottom:3px;}
.boost-opt-cost{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);}
.boost-opt-desc{font-size:10px;color:var(--muted);margin-top:4px;}

/* A/B TEST IA */
.ab-compare{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.ab-side{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;}
.ab-side-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;margin-bottom:7px;}
.ab-side-label.a{color:#4ade80;}
.ab-side-label.b{color:#60a5fa;}
.ab-result{background:var(--s2);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px;margin-top:12px;}
.ab-winner{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);margin-bottom:6px;}
.ab-analysis{font-size:12px;color:#7a9a82;line-height:1.8;white-space:pre-wrap;}

/* LEADERBOARD */
.leaderboard-list{display:flex;flex-direction:column;gap:8px;}
.lb-item{display:flex;align-items:center;gap:12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:12px 16px;transition:all 0.2s;}
.lb-item:hover{border-color:rgba(34,197,94,0.2);}
.lb-item.top1{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.03);}
.lb-item.top2{border-color:rgba(192,192,192,0.35);}
.lb-item.top3{border-color:rgba(205,127,50,0.35);}
.lb-rank{font-family:'Bebas Neue',sans-serif;font-size:22px;width:30px;text-align:center;flex-shrink:0;}
.lb-item.top1 .lb-rank{color:var(--gold);}
.lb-item.top2 .lb-rank{color:#c0c0c0;}
.lb-item.top3 .lb-rank{color:#cd7f32;}
.lb-info{flex:1;}
.lb-name{font-size:14px;font-weight:700;margin-bottom:2px;}
.lb-sub{font-size:11px;color:var(--muted);}
.lb-score{font-family:'DM Mono',monospace;font-size:13px;color:var(--g3);font-weight:700;text-align:right;}
.lb-medal{font-size:18px;}

/* RÉACTIONS ENRICHIES */
.reactions-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px;padding-top:8px;border-top:1px solid var(--border2);}
.react-btn{display:flex;align-items:center;gap:3px;background:transparent;border:1.5px solid var(--border2);border-radius:20px;padding:4px 10px;font-size:13px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;position:relative;}
.react-btn:hover{transform:scale(1.08);}
.react-btn.active-fire{border-color:#f97316;color:#f97316;background:rgba(249,115,22,0.1);}
.react-btn.active-money{border-color:#4ade80;color:#4ade80;background:rgba(74,222,128,0.1);}
.react-btn.active-bulb{border-color:#facc15;color:#facc15;background:rgba(250,204,21,0.1);}
.react-btn.active-rocket{border-color:#818cf8;color:#818cf8;background:rgba(129,140,248,0.1);}
.react-btn.active-crown{border-color:#ffd700;color:#ffd700;background:rgba(255,215,0,0.1);}
.react-btn.active-gem{border-color:#22d3ee;color:#22d3ee;background:rgba(34,211,238,0.1);}
.react-btn.active-clap{border-color:#fb923c;color:#fb923c;background:rgba(251,146,60,0.1);}
.react-btn.active-eyes{border-color:#a78bfa;color:#a78bfa;background:rgba(167,139,250,0.1);}
.react-btn.active-star{border-color:#ffd700;color:#ffd700;background:rgba(255,215,0,0.1);}
.react-btn.active-zap{border-color:#86efac;color:#86efac;background:rgba(134,239,172,0.1);}
/* Reactions premium lockées */
.react-btn.premium-lock{opacity:0.5;}
.react-btn.premium-lock::after{content:'🔒';position:absolute;top:-5px;right:-5px;font-size:9px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;width:14px;height:14px;display:flex;align-items:center;justify-content:center;padding:0;}
.react-premium-tip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a0f00,#2a1800);border:1px solid rgba(255,215,0,0.4);border-radius:7px;padding:6px 10px;font-size:10px;color:var(--gold);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:10;font-family:'DM Mono',monospace;}
.react-btn.premium-lock:hover .react-premium-tip{opacity:1;}
.react-count{font-family:'DM Mono',monospace;font-size:10px;}

/* EDITORIAL CALENDAR */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:14px;}
.cal-day{min-height:64px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:6px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);cursor:pointer;transition:all 0.2s;}
.cal-day:hover{border-color:rgba(34,197,94,0.25);}
.cal-day.has-post{border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.04);}
.cal-day.today{border-color:var(--g3);background:rgba(34,197,94,0.08);}
.cal-day .cal-num{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:4px;}
.cal-day .cal-post-dot{width:6px;height:6px;border-radius:50%;background:var(--g3);display:inline-block;margin:1px;}
.cal-header-days{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:6px;}
.cal-header-days span{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);text-align:center;letter-spacing:1px;}
.slot-chip{display:inline-flex;align-items:center;gap:5px;background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:3px 8px;font-size:11px;color:var(--g4);margin:2px;cursor:pointer;font-family:'DM Mono',monospace;transition:all 0.2s;}
.slot-chip:hover,.slot-chip.selected{background:rgba(34,197,94,0.15);border-color:var(--g3);color:var(--g3);}

/* COLLABORATIONS MATCHING */
.collab-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;}
.collab-card:hover{border-color:rgba(34,197,94,0.25);}
.collab-match-score{display:inline-flex;align-items:center;gap:5px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:3px 9px;font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);}
.collab-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.collab-ava{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--bg);flex-shrink:0;}
.collab-why{font-size:12px;color:#7a9a82;line-height:1.6;margin-bottom:10px;font-style:italic;}
.btn-collab{background:var(--g2);border:none;border-radius:6px;padding:7px 16px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-collab:hover{background:var(--g3);}

/* MOBILE PREVIEW */
.mobile-preview{background:#111;border-radius:24px;width:200px;min-height:340px;padding:12px;border:3px solid var(--border);flex-shrink:0;position:relative;overflow:hidden;}
.mobile-preview::before{content:'';position:absolute;top:8px;left:50%;transform:translateX(-50%);width:60px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;}
.mobile-screen{background:var(--s1);border-radius:16px;width:100%;height:100%;min-height:310px;padding:10px;overflow:hidden;margin-top:10px;}
.mobile-post-preview{background:var(--bg);border-radius:8px;padding:10px;font-size:10px;}
.mobile-post-preview .mob-title{font-weight:700;font-size:11px;margin-bottom:4px;color:var(--white);}
.mobile-post-preview .mob-text{color:var(--muted);font-size:10px;line-height:1.5;}
.mobile-post-preview .mob-cta{margin-top:8px;background:var(--g2);border-radius:4px;padding:5px 8px;font-size:10px;font-weight:700;color:var(--bg);display:inline-block;}
.preview-tabs{display:flex;gap:5px;margin-bottom:10px;}
.prev-tab{flex:1;background:transparent;border:1px solid var(--border2);border-radius:4px;padding:4px;font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);cursor:pointer;text-align:center;transition:all 0.2s;}
.prev-tab.active,.prev-tab:hover{border-color:var(--g3);color:var(--g3);}

/* ── PUBLICATION STEPS ── */
.pub-step-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:20px;margin-bottom:14px;transition:border-color 0.3s;}
.pub-step-card:focus-within{border-color:rgba(34,197,94,0.3);}
.pub-step-header{display:flex;align-items:flex-start;gap:14px;}
.pub-step-num{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:'DM Mono',monospace;}
.pub-step-title{font-size:14px;font-weight:700;color:var(--white);margin-bottom:2px;}
.pub-step-sub{font-size:11px;color:var(--muted);}
.pub-hint{font-size:10px;font-family:'DM Mono',monospace;padding:3px 9px;border-radius:20px;border:1px solid;transition:all 0.3s;}
.pub-hint.pending{color:var(--muted2);border-color:var(--border2);}
.pub-hint.done{color:var(--g3);border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.06);}
.pub-hint.done::before{content:'✓ ';}
.pub-tip-item{background:var(--s2);border:1px solid var(--border2);border-radius:6px;padding:7px 10px;font-size:11px;color:var(--muted);cursor:pointer;transition:all 0.2s;user-select:none;}
.pub-tip-item:hover{border-color:rgba(34,197,94,0.3);color:var(--g4);background:rgba(34,197,94,0.05);}
.pub-tag-chip{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:20px;padding:3px 10px;font-size:11px;color:var(--g4);font-family:'DM Mono',monospace;}

/* ── ONBOARDING TOOLTIP (mini help) ── */
.ob-tooltip{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9990;width:min(520px,94vw);background:linear-gradient(135deg,#061a08,#0c2610);border:1.5px solid rgba(34,197,94,0.35);border-radius:16px;box-shadow:0 12px 48px rgba(0,0,0,0.7),0 0 40px rgba(34,197,94,0.08);animation:slideUpTooltip 0.5s cubic-bezier(.34,1.56,.64,1) both;}
.ob-tooltip.hiding{animation:slideDownTooltip 0.35s ease forwards;}
@keyframes slideUpTooltip{from{opacity:0;transform:translateX(-50%) translateY(30px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes slideDownTooltip{from{opacity:1;transform:translateX(-50%) translateY(0)}to{opacity:0;transform:translateX(-50%) translateY(20px)}}
.ob-tooltip-inner{padding:18px 20px 14px;}
.ob-tooltip-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.ob-tooltip-close{background:none;border:none;color:var(--muted2);font-size:18px;cursor:pointer;line-height:1;padding:2px 6px;border-radius:4px;transition:color 0.2s;}
.ob-tooltip-close:hover{color:var(--g3);}
.ob-steps-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;}
.ob-steps-row::-webkit-scrollbar{display:none;}
.ob-step-card{flex-shrink:0;width:130px;background:rgba(22,163,74,0.04);border:1.5px solid var(--border2);border-radius:10px;padding:12px 10px;text-align:center;cursor:pointer;transition:all 0.25s;}
.ob-step-card:hover,.ob-step-card.active{border-color:rgba(34,197,94,0.4);background:rgba(34,197,94,0.08);}
.ob-step-card.active{border-color:var(--g3);}
.ob-step-icon{font-size:24px;margin-bottom:6px;}
.ob-step-label{font-size:10px;font-weight:700;color:var(--g5);margin-bottom:4px;font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.ob-step-desc{font-size:10px;color:var(--muted);line-height:1.5;}
.ob-tooltip-footer{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:10px;border-top:1px solid var(--border2);}
.ob-progress{display:flex;gap:5px;align-items:center;}
.ob-dot{width:6px;height:6px;border-radius:50%;background:var(--muted2);transition:all 0.3s;}
.ob-dot.active{background:var(--g3);box-shadow:0 0 5px var(--g3);width:18px;border-radius:3px;}
.ob-btn-next{padding:7px 18px;background:var(--g2);border:none;border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;color:var(--bg);cursor:pointer;transition:all 0.2s;}
.ob-btn-next:hover{background:var(--g3);}

/* ── ONBOARDING MODAL (oldne) ── */
.onboarding-overlay{position:fixed;inset:0;background:rgba(4,10,5,0.96);z-index:9998;display:flex;align-items:center;justify-content:center;}
.onboarding-overlay.hidden{display:none;}
.onboarding-box{background:var(--s1);border:1.5px solid var(--border);border-radius:20px;padding:36px;max-width:460px;width:92%;text-align:center;animation:popIn 0.4s ease;}
.onboarding-step{display:none;}
.onboarding-step.active{display:block;animation:fadeUp 0.3s ease;}
.onboarding-progress{display:flex;justify-content:center;gap:6px;margin-bottom:24px;}
.onboarding-progress-dot{width:8px;height:8px;border-radius:50%;background:var(--muted2);transition:all 0.3s;}
.onboarding-progress-dot.active{background:var(--g3);box-shadow:0 0 6px var(--g3);}
.onboarding-icon{font-size:48px;margin-bottom:10px;}
.onboarding-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--g3);margin-bottom:8px;}
.onboarding-sub{font-size:13px;color:var(--muted);margin-bottom:24px;line-height:1.7;}
.btn-onboard-next{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-onboard-next:hover{background:var(--g3);}
.btn-onboard-skip{font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;display:block;text-decoration:underline;}

/* AGENCE */
.agency-client-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;transition:all 0.2s;}
.agency-client-card:hover{border-color:rgba(34,197,94,0.2);}
.agency-client-ava{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g3));display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.agency-client-info{flex:1;}
.agency-client-name{font-size:13px;font-weight:700;margin-bottom:1px;}
.agency-client-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.agency-client-stats{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);}

@media(max-width:860px){#tab-publish .tpanel>div>div[style*="grid-template-columns:1fr 340px"]{display:block !important;}
#tab-publish [style*="position:sticky"]{position:static !important;margin-top:20px;}}
@media(max-width:600px){.analytics-grid{grid-template-columns:1fr;}.cal-day{min-height:44px;}}

/* RESPONSIVE */
@media(max-width:900px){.showcase-grid,.reviews-grid,.plans-grid,.signup-plans{grid-template-columns:1fr 1fr;}.profile-fields{grid-template-columns:1fr 1fr;}.edit-grid{grid-template-columns:1fr;}.how-simple{flex-direction:column;}}
@media(max-width:600px){.showcase-grid,.reviews-grid,.plans-grid,.signup-plans,.boost-type-grid{grid-template-columns:1fr;}.profile-fields{grid-template-columns:1fr;}}

#offer-popup{position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);}
#offer-popup.hidden{display:none;}
.offer-box{background:linear-gradient(135deg,#061a08,#0a2a0d);border:2px solid rgba(34,197,94,0.45);border-radius:20px;padding:24px 26px;max-width:360px;width:92%;text-align:center;box-shadow:0 0 60px rgba(34,197,94,0.18);position:relative;}
.offer-crown{font-size:36px;margin-bottom:4px;}
.offer-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;background:linear-gradient(135deg,#4ade80,#86efac);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:3px;}
.offer-sub{font-size:11px;color:#4a7a58;margin-bottom:12px;font-family:'DM Mono',monospace;}
.offer-badge{display:inline-block;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;margin-bottom:12px;letter-spacing:1px;}
.offer-desc{font-size:12px;color:#e8fef0;line-height:1.6;margin-bottom:14px;}
.offer-desc strong{color:#4ade80;}
.offer-counter{background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:12px;padding:14px;margin-bottom:22px;}
.offer-counter-num{font-family:'Bebas Neue',sans-serif;font-size:34px;color:#4ade80;line-height:1;}
.offer-counter-lbl{font-size:11px;color:#4a7a58;font-family:'DM Mono',monospace;margin-top:3px;}
.offer-cta{width:100%;padding:11px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:800;cursor:pointer;letter-spacing:1px;margin-bottom:8px;transition:.2s;}
.offer-cta:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(34,197,94,0.3);}
.offer-skip{font-size:11px;color:#2d5a38;cursor:pointer;text-decoration:underline;}
.offer-close-btn{position:absolute;top:12px;right:14px;background:none;border:none;color:#2d5a38;font-size:20px;cursor:pointer;line-height:1;padding:4px;transition:.2s;}
.offer-close-btn:hover{color:#4ade80;}
.offer-timer{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:8px 12px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:12px;color:#f87171;}
.offer-timer span{font-weight:800;font-size:14px;}
.offer-full{background:rgba(234,179,8,0.08);border:1px solid rgba(234,179,8,0.25);border-radius:12px;padding:20px;text-align:center;max-width:460px;width:92%;}
</style>
<style>
.ob-input{width:100%;padding:11px 13px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;transition:border-color 0.2s;}
.ob-input:focus{border-color:var(--g3);}
.ob-btn-next{flex:1;padding:13px;background:var(--g2);border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:var(--bg);cursor:pointer;width:100%;}
.ob-btn-back{flex:1;padding:13px;background:var(--s2);border:1.5px solid var(--border);border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--muted);cursor:pointer;}
.ob-btn-skip{width:100%;margin-top:8px;background:none;border:none;font-size:11px;color:var(--muted2);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;padding:6px;}
.av-opt{font-size:26px;cursor:pointer;padding:7px;border-radius:10px;border:2px solid var(--border2);transition:all 0.15s;display:inline-flex;}
.av-opt:hover{border-color:var(--g3);background:rgba(34,197,94,0.08);}
.av-premium{position:relative;}
.ob-goal-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:13px 16px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.2s;}
.ob-goal-card:hover{border-color:var(--g3);background:rgba(34,197,94,0.04);}

/* ── PROFILE COMPLETION BAR ── */
.profile-completion-bar{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:16px 20px;margin-bottom:16px;}
.pcb-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.pcb-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;}
.pcb-pct{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3);}
.pcb-bar{height:8px;background:var(--s3);border-radius:4px;overflow:hidden;margin-bottom:10px;}
.pcb-fill{height:100%;border-radius:4px;transition:width 0.6s cubic-bezier(0.4,0,0.2,1);}
.pcb-items{display:flex;flex-wrap:wrap;gap:6px;}
.pcb-item{font-size:11px;padding:3px 10px;border-radius:20px;display:flex;align-items:center;gap:4px;}
.pcb-item.done{background:rgba(34,197,94,0.1);color:var(--g4);border:1px solid rgba(34,197,94,0.2);}
.pcb-item.todo{background:rgba(255,255,255,0.03);color:var(--muted);border:1px solid var(--border2);}

/* ── REFERRAL / PARRAINAGE ── */
.referral-box{background:linear-gradient(135deg,rgba(34,197,94,0.08),rgba(74,222,128,0.04));border:1.5px solid rgba(34,197,94,0.25);border-radius:14px;padding:18px 20px;margin-bottom:16px;}
.referral-link{display:flex;align-items:center;gap:8px;background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:8px;padding:10px 14px;margin:12px 0;}
.referral-link span{flex:1;font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.referral-copy-btn{background:var(--g2);border:none;border-radius:6px;padding:6px 12px;font-size:11px;font-weight:700;color:var(--bg);cursor:pointer;white-space:nowrap;transition:all 0.2s;}
.referral-copy-btn:hover{background:var(--g3);}
.referral-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:10px;}
.referral-stat{text-align:center;background:rgba(255,255,255,0.02);border:1px solid var(--border2);border-radius:8px;padding:10px 6px;}
.referral-stat-num{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--g3);}
.referral-stat-lbl{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;}

/* ── BADGE VERIFIE ── */
.badge-verified{display:inline-flex;align-items:center;gap:3px;background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(74,222,128,0.08));border:1px solid rgba(34,197,94,0.35);border-radius:4px;padding:2px 7px;font-size:10px;font-weight:700;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.badge-verified::before{content:'✓';font-size:11px;}

/* ── TRENDING TOPICS ── */
.trending-widget{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:16px 18px;margin-bottom:16px;}
.trending-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;display:flex;align-items:center;gap:6px;}
.trending-item{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border2);cursor:pointer;transition:all 0.2s;}
.trending-item:last-child{border-bottom:none;}
.trending-item:hover .trending-tag{color:var(--g3);}
.trending-rank{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2);width:18px;}
.trending-tag{font-size:13px;font-weight:700;flex:1;padding:0 8px;}
.trending-count{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.trending-fire{font-size:12px;}

/* ── STORIES ── */
.stories-bar{display:flex;gap:10px;padding:14px 0 10px;overflow-x:auto;scrollbar-width:none;margin-bottom:4px;}
.stories-bar::-webkit-scrollbar{display:none;}
.story-item{flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;}
.story-ring{width:56px;height:56px;border-radius:50%;padding:2.5px;background:linear-gradient(135deg,var(--g2),var(--g4));position:relative;}
.story-ring.seen{background:var(--muted2);}
.story-ring.add-story{background:var(--s2);border:2px dashed var(--border);}
.story-ava{width:100%;height:100%;border-radius:50%;background:var(--s1);display:flex;align-items:center;justify-content:center;font-size:22px;border:2px solid var(--bg);}
.story-label{font-size:10px;color:var(--muted);max-width:60px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.story-add-icon{position:absolute;bottom:0;right:0;width:18px;height:18px;background:var(--g2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;border:2px solid var(--bg);}

/* ── STORY VIEWER ── */
.story-viewer-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10002;display:flex;align-items:center;justify-content:center;}
.story-viewer-overlay.hidden{display:none;}
.story-viewer-box{max-width:400px;width:100%;position:relative;}
.story-viewer-progress{display:flex;gap:3px;padding:10px 12px 6px;position:absolute;top:0;left:0;right:0;z-index:10;}
.story-progress-bar{flex:1;height:3px;background:rgba(255,255,255,0.3);border-radius:2px;overflow:hidden;}
.story-progress-fill{height:100%;background:#fff;border-radius:2px;animation:storyProgress 5s linear forwards;}
@keyframes storyProgress{from{width:0}to{width:100%}}
.story-viewer-header{position:absolute;top:24px;left:12px;right:12px;display:flex;align-items:center;justify-content:space-between;z-index:10;}
.story-viewer-close{background:none;border:none;color:#fff;font-size:22px;cursor:pointer;padding:4px;}
.story-content{width:100%;aspect-ratio:9/16;max-height:80vh;background:var(--s1);border-radius:16px;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;}

/* ── BOOST PAYANT ── */
.boost-promo-card{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:18px 20px;margin-bottom:12px;cursor:pointer;transition:all 0.2s;}
.boost-promo-card:hover{border-color:rgba(255,215,0,0.5);box-shadow:0 4px 20px rgba(255,215,0,0.1);}
.boost-promo-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:var(--gold);margin-bottom:4px;}
.boost-promo-desc{font-size:12px;color:var(--muted);line-height:1.6;}
.boost-promo-price{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--gold);}

/* ── GLOBAL SEARCH ── */
.search-overlay{position:fixed;inset:0;background:rgba(4,10,5,0.97);backdrop-filter:blur(20px);z-index:9998;display:flex;flex-direction:column;padding:20px;}
.search-overlay.hidden{display:none;}
.search-input-row{display:flex;align-items:center;gap:12px;margin-bottom:20px;}
.search-big-input{flex:1;padding:14px 18px;background:var(--s1);border:2px solid rgba(34,197,94,0.4);border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;color:var(--white);outline:none;}
.search-big-input::placeholder{color:var(--muted);}
.search-close-btn{background:var(--s2);border:1.5px solid var(--border);border-radius:8px;padding:10px 14px;font-size:18px;cursor:pointer;color:var(--muted);}
.search-results{flex:1;overflow-y:auto;}
.search-section-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin:16px 0 10px;}
.search-result-item{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;margin-bottom:8px;cursor:pointer;transition:all 0.2s;}
.search-result-item:hover{border-color:rgba(34,197,94,0.3);}
.search-result-ava{width:36px;height:36px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.search-result-name{font-size:14px;font-weight:700;}
.search-result-sub{font-size:11px;color:var(--muted);}

/* ── MODE CLAIR ── */
body.light-mode{
  --bg:#f0fdf4;--bg2:#e8f5e9;--s1:#ffffff;--s2:#f1f8f2;--s3:#e8f5e9;
  --white:#1a2e1c;--muted:#4a7a58;--muted2:#6b9b76;
  --border:rgba(34,197,94,0.2);--border2:rgba(34,197,94,0.12);--glow:rgba(34,197,94,0.08);
}
body.light-mode .app-bar{background:rgba(240,253,244,0.97);}
body.light-mode input,body.light-mode select,body.light-mode textarea{background:#f8fdf9;color:#1a2e1c;}
.theme-toggle{display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;color:var(--muted);}
.theme-toggle-track{width:36px;height:20px;border-radius:10px;background:var(--s3);border:1.5px solid var(--border);position:relative;transition:background 0.3s;}
.theme-toggle-thumb{width:14px;height:14px;border-radius:50%;background:var(--g3);position:absolute;top:2px;left:2px;transition:transform 0.3s;}
body.light-mode .theme-toggle-track{background:rgba(34,197,94,0.2);}
body.light-mode .theme-toggle-thumb{transform:translateX(16px);}

/* ── SHAREABLE PUBLIC PROFILE ── */
.share-profile-btn{display:flex;align-items:center;gap:6px;background:rgba(34,197,94,0.08);border:1.5px solid var(--border);border-radius:8px;padding:8px 14px;font-size:12px;font-weight:600;color:var(--g3);cursor:pointer;transition:all 0.2s;}
.share-profile-btn:hover{border-color:var(--g3);background:rgba(34,197,94,0.15);}
</style></head>
<body>

<div id="cursor"></div>
<div id="cursor-ring"></div>
<div class="orb o1"></div>
<div class="orb o2"></div>
<div id="toast-container"></div>

<!-- ══════════ LANDING ══════════ -->
<div id="landing">

<nav>
  <div class="logo">VIRAL<span>BOOST</span></div>
  <div class="nav-links">
    <a href="#showcase" data-i18n="nav_showcase">Showcase</a>
    <a href="#plans" data-i18n="nav_plans">Plans</a>
    <a href="#reviews" data-i18n="nav_reviews">Reviews</a>
  </div>
  <div class="nav-right">
    <button class="lang-btn" id="lang-btn" onclick="toggleLang()" title="Switch language">🇺🇸 EN</button>
    <button class="btn-g btn-ghost-g" onclick="openModal('login-modal')" data-i18n="nav_login">Log in</button>
    <button class="btn-g btn-solid-g" onclick="openModal('signup-modal')" data-i18n="nav_join">Join →</button>
  </div>
  <button class="hamburger" id="hamburger-btn" onclick="toggleMobileMenu()" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
</nav>
<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobile-menu">
  <a href="#showcase" onclick="closeMobileMenu()" data-i18n="mob_showcase">📊 Showcase</a>
  <a href="#plans" onclick="closeMobileMenu()" data-i18n="mob_plans">💎 Plans</a>
  <a href="#reviews" onclick="closeMobileMenu()" data-i18n="mob_reviews">⭐ Reviews</a>
  <div class="mobile-btns" id="mob-btns-guest">
    <button class="btn-g btn-ghost-g" onclick="closeMobileMenu();openModal('login-modal')">Log in</button>
    <button class="btn-g btn-solid-g" onclick="closeMobileMenu();openModal('signup-modal')">Join →</button>
  </div>
  <div class="mobile-btns" id="mob-btns-user" style="display:none">
    <button class="btn-g btn-ghost-g" onclick="closeMobileMenu();logout()" style="color:#f87171;border-color:rgba(248,113,113,0.3)">🚪 Log out</button>
  </div>
</div>

<section class="hero">

  <!-- BADGE PLATEFORME -->
  <div style="display:inline-block;background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(74,222,128,0.08));border:1px solid rgba(34,197,94,0.3);border-radius:20px;padding:8px 20px;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;color:var(--g3);margin-bottom:24px;animation:fadeUp 0.4s ease both;" data-i18n="hero_badge">
    📢 THE #1 DIGITAL ADVERTISING PLATFORM
  </div>

  <!-- GROS CTA -->
  <div style="display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:20px;">
    <button class="btn-hero-big btn-hero-solid" onclick="startDemoPublish()" style="font-size:18px;padding:18px 52px;box-shadow:0 0 60px rgba(34,197,94,0.5);letter-spacing:0.5px" data-i18n="hero_cta1">
      ⚡ Get Started — Publish your ad →
    </button>
    <button onclick="openModal('login-modal')" style="background:rgba(34,197,94,0.08);border:1.5px solid rgba(34,197,94,0.25);border-radius:12px;padding:12px 32px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:700;color:var(--g3);cursor:pointer">
      🔑 I already have an account
    </button>
    <span style="font-size:12px;color:var(--muted)" data-i18n="hero_nocard">Free · No credit card · 30 seconds</span>
  </div>

  <!-- 3 SHORT PROOF POINTS -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:640px;margin:0 auto 16px;">
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">📢</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat1_title">Publish your ad</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat1_sub">Instantly visible to everyone</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🤝</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat2_title">Find collabs</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat2_sub">AI matching with creators</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🚀</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat3_title">Grow your audience</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat3_sub">Votes, shares, visibility</div>
      </div>
    </div>
  </div>

  <!-- 3 ADDITIONAL CARDS -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:640px;margin:0 auto 48px;">
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">💬</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat4_title">Community chat</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat4_sub">Connect with other creators</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🏆</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat5_title">Project leaderboard</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat5_sub">Top projects rise to the top</div>
      </div>
    </div>
    <div style="background:rgba(11,26,13,0.9);border:1px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px 12px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center">
      <span style="font-size:18px">🎯</span>
      <div style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--white)" data-i18n="feat6_title">Targeted audience</div>
        <div style="font-size:10px;color:var(--muted)" data-i18n="feat6_sub">Creators, entrepreneurs, founders</div>
      </div>
    </div>
  </div>

  <!-- CARTE MONETISATION -->
  <div style="max-width:640px;margin:0 auto 48px;background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:18px 22px;display:flex;align-items:center;gap:14px">
    <span style="font-size:32px;flex-shrink:0">💰</span>
    <div>
      <div style="font-size:13px;font-weight:800;color:#ffd700;margin-bottom:4px" data-i18n="mono_title">From 1,000 followers — generate revenue</div>
      <div style="font-size:11px;color:var(--muted);line-height:1.6" data-i18n="mono_sub">Enable sales on your profile and monetize your community directly from the platform.</div>
    </div>
  </div>

  <!-- FORMULAIRE PUB HERO -->
  <div class="hero-ad-box">
    <h3 data-i18n="hero_form_title">📢 PUBLISH YOUR AD IN 30 SECONDS</h3>
    <div class="hero-ad-form">
      <input type="text" id="hero-ad-name" placeholder="Your product / service name *" maxlength="60"/>
      <select id="hero-ad-type">
        <option value="">Category...</option>
        <option value="saas">🚀 SaaS / Logiciel</option>
        <option value="ecommerce">🛍️ E-commerce / Store</option>
        <option value="app">📱 Application mobile</option>
        <option value="tiktok">🎵 TikTok / Creator</option>
        <option value="instagram">📸 Instagram / Influencer</option>
        <option value="service">💼 Service / Freelance</option>
        <option value="site">🌐 Website</option>
        <option value="autre">📦 Other</option>
      </select>
      <textarea id="hero-ad-desc" placeholder="Describe your ad in 2 sentences: what you offer, who it's for, why it's great..."></textarea>
      <button class="btn-hero-ad" onclick="heroPublishAd()" data-i18n="hero_form_btn">📢 Post my ad for free →</button>
    </div>
    <div style="text-align:center;margin-top:8px;font-size:11px;color:var(--muted2)" data-i18n="hero_form_note">✓ Free · Instantly visible · No card required</div>
  </div>

  <!-- DISCREET LOGIN LINK -->
  <p style="text-align:center;margin-top:20px;font-size:12px;color:var(--muted)" data-i18n="hero_login_link">Already signed up? <a onclick="openModal('login-modal')" style="color:var(--g3);cursor:pointer;text-decoration:underline">Log in</a></p>

</section>

<!-- PUBLIC FEED (visible without account) -->
<section class="public-feed-section" id="public-feed">
  <div style="max-width:660px;margin:0 auto">
    <div style="text-align:center;margin-bottom:24px">
      <span class="sec-label" data-i18n="sec_feed">Public feed</span>
      <h2 class="section-title">Ads <em>live</em></h2>
      <p class="section-sub" style="margin:0 auto">The latest community ads — visible to everyone.</p>
    </div>
    <div id="public-feed-list" class="public-feed-blur">
      <!-- Public posts will be injected here -->
    </div>
    <div style="text-align:center;margin-top:28px">
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Join & post your ad →</button>
    </div>
  </div>
</section>

<section class="showcase-section" id="showcase">
  <div style="max-width:1100px;margin:0 auto 36px">
    <span class="sec-label" data-i18n="sec_showcase">Community Showcase</span>
    <h2 class="section-title"><em>Trending</em> projects</h2>
    <p class="section-sub">Vote for your favorites. The most voted gain visibility.</p>
    <div class="filters-row">
      <button class="f-btn active" onclick="filterLandingShowcase(this,'all')">All</button>
      <button class="f-btn" onclick="filterLandingShowcase(this,'site')">🌐 Sites</button>
      <button class="f-btn" onclick="filterLandingShowcase(this,'app')">📱 Apps</button>
      <button class="f-btn" onclick="filterLandingShowcase(this,'tiktok')">🎵 TikTok</button>
      <button class="f-btn" onclick="filterLandingShowcase(this,'saas')">🚀 SaaS</button>
    </div>
  </div>
  <div class="showcase-grid" id="landing-showcase-grid" style="max-width:1100px;margin:0 auto"></div>
</section>

<section class="plans-section" id="plans">
  <div style="text-align:center;margin-bottom:48px">
    <span class="sec-label" data-i18n="sec_plans">Plans</span>
    <h2 class="section-title">Choose your <em>plan</em></h2>
    <p class="section-sub" style="margin:0 auto">Start for free. Upgrade whenever you want.</p>
  </div>
  <div class="plans-grid" id="landing-plans">

    <div class="plan-card">
      <div class="plan-name">FREE</div>
      <div class="plan-price">0<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">Free forever</div>
      <div class="plan-desc">To discover ViralBoost</div>
      <ul class="plan-features">
        <li>5 publications / jour</li>
        <li>3 messages chat / jour</li>
        <li>Showcase 24h</li>
        <li>Full public profile</li>
        <li>Community & collab access</li>
        <li>50 ViralCredits on signup</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="openModal('signup-modal')">Get started for free</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">STARTER</div>
      <div class="plan-price">3<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois no commitment</div>
      <div class="plan-desc">To start boosting</div>
      <ul class="plan-features">
        <li>10 publications / jour</li>
        <li>10 messages chat / jour</li>
        <li>Showcase 7 days</li>
        <li>Coach IA 20 req/mois</li>
        <li>Unlimitd DMs</li>
        <li>Badge Starter</li>
        <li>+200 ViralCredits/month</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('starter')">Choose Starter &rarr;</button>
    </div>

    <div class="plan-card recommended">
      <div class="plan-badge">&#11088; POPULAIRE</div>
      <div class="plan-name">PRO</div>
      <div class="plan-price">14,99<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois no commitment</div>
      <div class="plan-desc">For serious creators</div>
      <ul class="plan-features">
        <li>Unlimitd posts</li>
        <li>Unlimitd global chat</li>
        <li>Priority showcase 30d</li>
        <li>Unlimitd AI Boost</li>
        <li>Advanced stats</li>
        <li>Verified Pro badge</li>
        <li>Affiliation 30%</li>
        <li>+500 ViralCredits/month</li>
      </ul>
      <button class="btn-plan-g btn-plan-solid-g" onclick="startPayment('pro')">Choose Pro &rarr;</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">ELITE</div>
      <div class="plan-price">39,99<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois no commitment</div>
      <div class="plan-desc">To dominate your market</div>
      <ul class="plan-features">
        <li>Everything in Pro</li>
        <li>Permanent + pinned showcase</li>
        <li>🏆 Golden Elite badge</li>
        <li>Priority #1 in AI matching</li>
        <li>Discussion group creator</li>
        <li>Monthly performance report</li>
        <li>1 strategy call/month</li>
        <li>Private messages to admin</li>
        <li>Golden likes/shares</li>
        <li>+1500 ViralCredits/month</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('elite')">Choose Elite &rarr;</button>
    </div>

  </div>
</section>

<section style="padding:80px 5%;position:relative;z-index:1;" id="reviews">
  <div style="max-width:700px;margin:0 auto;text-align:center">
    <span class="sec-label">The community</span>
    <h2 class="section-title">Join the <em>first creators</em></h2>
    <p class="section-sub" style="margin:0 auto 40px">ViralBoost is launching. No fake reviews — join the community, post your project, and if you're satisfied, we'd be thrilled to feature your testimonial.</p>

    <!-- 3 raisons de rejoindre -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:40px;text-align:left">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px 16px">
        <div style="font-size:24px;margin-bottom:8px">🎯</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:4px">Dedicated platform</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6">Unlike traditional networks, here everyone is looking to promote their project.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px 16px">
        <div style="font-size:24px;margin-bottom:8px">⚡</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:4px">Free to get started</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6">Create your account, post your ad and access AI matching without a credit card.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px 16px">
        <div style="font-size:24px;margin-bottom:8px">🛠️</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:4px">You shape the platform</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.6">In the launch phase, every piece of feedback is taken into account directly by the founder.</div>
      </div>
    </div>

    <!-- CTA final -->
    <div style="background:linear-gradient(135deg,rgba(21,128,61,0.15),rgba(74,222,128,0.05));border:1.5px solid rgba(34,197,94,0.3);border-radius:16px;padding:36px 32px">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--g3);margin-bottom:8px">READY TO GET STARTED?</div>
      <div style="font-size:13px;color:var(--muted);line-height:1.8;margin-bottom:24px">Sign up free · No credit card · Immediate access to all tools</div>
      <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" style="font-size:16px;padding:15px 44px;box-shadow:0 0 40px rgba(34,197,94,0.4)">🚀 Create my free account →</button>
    </div>
  </div>
</section>

<!-- SECTION COLLABORATION MISE EN AVANT -->
<section style="padding:80px 5%;position:relative;z-index:1;background:rgba(11,26,13,0.6);">
  <div style="max-width:900px;margin:0 auto;text-align:center">
    <span class="sec-label">Matching IA</span>
    <h2 class="section-title">Find your <em>prochain partner</em></h2>
    <p class="section-sub" style="margin:0 auto 40px">The algorithm analyzes your profiles, projects and goals to automatically connect you with the most compatible creators.</p>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:32px">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">🧠</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Compatibility score</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">AI analyzes your profile and suggests the most compatible partners with a matching score.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">💬</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Contact direct</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">Send a DM directly from the matching profile. No middleman, immediate contact.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">🎯</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Niche-targeted</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">Feedter by sector, objective and availability for truly relevant collaborations.</div>
      </div>
    </div>
    <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')">🤝 Discover my matches →</button>
  </div>
</section>

<section class="cta-section">
  <h2>JOIN THE COMMUNITY</h2>
  <p style="font-size:15px;color:var(--muted);margin:8px 0 28px">Plateforme en launch — be among the first creators on board.</p>
  <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" data-i18n="hero_cta1">Create my account →</button>
</section>

<footer>
  <div class="footer-logo">VIRALBOOST</div>
  <p>© 2025 ViralBoost — The creator social network</p>
  <p>Stripe · Claude AI · Real-time WebSocket</p>
</footer>
</div><!-- /landing -->


<!-- ══════════ APP ══════════ -->
<div id="app">
  <div class="app-bar">
    <div class="app-logo">VB</div>
    <div class="app-tabs">
      <button class="app-tab" onclick="showAppTab('feed',this)">🏠 Feed</button>
      <button class="app-tab" onclick="showAppTab('showcase',this)">✨ Showcase</button>
      <button class="app-tab active" onclick="showAppTab('publish',this)">➕ Publish</button>
      <button class="app-tab" onclick="showAppTab('chat-global',this)" id="tab-btn-chat">💬 Chat <span class="notif-dot" id="chat-notif" style="display:none"></span></button>
      <button class="app-tab" onclick="showAppTab('groups',this)" id="tab-btn-groups">👥 Groups</button>
      <button class="app-tab" onclick="showAppTab('stats',this)">📊 Stats</button>
      <button class="app-tab" onclick="showAppTab('boost-credits',this)">⚡ Boost</button>
      <button class="app-tab" onclick="showAppTab('leaderboard',this)">🏆 Top</button>
      <button class="app-tab" onclick="showAppTab('collab',this)">🤝 Collabs</button>
      <button class="app-tab" onclick="showAppTab('calendrier',this)">📅 Calendar</button>
      <button class="app-tab" onclick="showAppTab('ab-test',this)">🔬 A/B Test</button>
      <button class="app-tab" onclick="showAppTab('profile',this)">👤 Profile</button>
      <button class="app-tab" onclick="showAppTab('followers',this)">🔔 Followers</button>
      <button class="app-tab" onclick="showAppTab('ia-boost',this)">🤖 IA Boost</button>
    </div>
    <div class="app-right">
      <span class="plan-chip" id="app-plan-chip">FREE</span>
      <button class="btn-out-g" onclick="showAppTab('boost-credits',null);switchCreditsTab('shop',document.getElementById('ctab-shop'))" style="border-color:rgba(255,215,0,0.3);color:var(--gold);display:flex;align-items:center;gap:5px">🛒 <span style="font-family:'DM Mono',monospace;font-size:11px;font-weight:700" id="header-credits">0</span><span style="font-size:9px;opacity:0.7">⚡</span></button>
      <button id="btn-wallpaper" class="btn-out-g" onclick="openWallpaperModal()" style="display:none">🖼️</button>
      <button id="btn-admin-dm" class="btn-out-g" onclick="openAdminDM()" style="display:none;border-color:rgba(255,215,0,0.3);color:var(--gold)">📩 Admin</button>
      <div class="user-chip" onclick="showAppTab('profile',null)">
        <div class="user-chip-ava" id="app-user-ava">?</div>
        <span class="user-chip-name" id="app-user-name">...</span>
      </div>
      <button class="btn-out-g" onclick="logout()">Leave</button>
    </div>
  </div>

  <div style="max-width:1160px;margin:0 auto;padding:0 16px">

    <!-- FEED -->
    <div class="tpanel active" id="tab-feed">
      <div id="stories-bar-container"></div>
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <!-- INTRO COMPOSER -->
        <div class="composer-intro">
          <div class="composer-intro-label" data-i18n="comp_label">✦ COMMUNITY FEED</div>
          <h2 class="composer-intro-title" data-i18n="comp_title">Share with the community</h2>
          <p class="composer-intro-sub" data-i18n="comp_sub">Projects, ideas, questions — your voice matters here.</p>
        </div>

        <!-- TWEET-STYLE COMPOSER -->
        <div class="publish-box" id="publish-box">
          <div class="publish-top">
            <div class="pub-ava" id="feed-pub-ava">?</div>
            <div class="pub-input-wrap">
              <textarea class="pub-text" id="feed-text" placeholder="Share your project with the community…" rows="2" oninput="updateCharCount(this);autoGrowTA(this)"></textarea>
              <!-- Type pills (hidden by default, visible on focus) -->
              <div class="pub-type-row" id="pub-type-row">
                <button class="pub-type-pill active" onclick="selectPubType(this,'')" data-type="">💬 Post</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'site')" data-type="site">🌐 Site</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'app')" data-type="app">📱 App</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'saas')" data-type="saas">🚀 SaaS</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'tiktok')" data-type="tiktok">🎵 TikTok</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'instagram')" data-type="instagram">📸 Insta</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'ecommerce')" data-type="ecommerce">🛍️ Shop</button>
              </div>
              <!-- Project field (visible if type selected) -->
              <div class="pub-proj-wrap" id="pub-proj-wrap" style="display:none">
                <input type="text" id="feed-proj-name" placeholder="Project name (optional)"/>
              </div>
              <!-- URL trigger button -->
              <button class="pub-url-trigger" id="pub-url-trigger" onclick="toggleUrlField()" type="button" data-i18n="btn_addlink">🔗 Add a link</button>
              <!-- URL field hidden by default -->
              <div class="pub-url-wrap" id="pub-url-wrap" style="display:none">
                <div class="pub-url-inner">
                  <span class="pub-url-icon">🔗</span>
                  <input type="url" id="feed-url" placeholder="https://your-site.com" autocomplete="off" spellcheck="false"/>
                  <button class="pub-url-close" onclick="closeUrlField()" type="button">✕</button>
                </div>
              </div>
            </div>
          </div>
          <select id="feed-proj-type" style="display:none"><option value="">No project</option><option value="site">🌐 Website</option><option value="app">📱 App</option><option value="saas">🚀 SaaS</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option><option value="ecommerce">🛍️ E-commerce</option></select>
          <div id="feed-media-preview" class="media-preview-row" style="display:none;padding:0 16px;margin-left:50px"></div>
          <div class="pub-divider"></div>
          <div class="pub-actions">
            <div class="pub-right">
              <span class="pub-char-count" id="pub-char-count" style="opacity:0">0/500</span>
              <span class="pub-limit" id="feed-limit-info">FREE · 1/h</span>
              <button class="btn-publish" onclick="publishPost()" data-i18n="btn_publish">Publish</button>
            </div>
          </div>
        </div>
        <div class="feed-tabs">
          <button class="feed-tab active" onclick="switchFeed('all',this)" data-i18n="tab_all">All</button>
          <button class="feed-tab" onclick="switchFeed('following',this)" data-i18n="tab_following">Following</button>
          <button class="feed-tab" onclick="switchFeed('top',this)" data-i18n="tab_top">Top of the day</button>
        </div>
        <div id="trending-widget-container"></div>
      <div id="feed-list"></div>
      </div>
    </div>

    <!-- SHOWCASE APP -->
    <div class="tpanel" id="tab-showcase">
      <div style="padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div><h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">COMMUNITY SHOWCASE</h2><p style="font-size:12px;color:var(--muted)">Projects shared by the community</p></div>
          <div class="filters-row" style="margin:0">
            <button class="f-btn active" onclick="filterAppShowcase(this,'all')">All</button>
            <button class="f-btn" onclick="filterAppShowcase(this,'site')">🌐</button>
            <button class="f-btn" onclick="filterAppShowcase(this,'app')">📱</button>
            <button class="f-btn" onclick="filterAppShowcase(this,'tiktok')">🎵</button>
            <button class="f-btn" onclick="filterAppShowcase(this,'saas')">🚀</button>
          </div>
        </div>
        <div class="showcase-grid" id="app-showcase-grid"></div>
      </div>
    </div>

    <!-- PUBLISH -->
    <div class="tpanel" id="tab-publish">
      <div style="max-width:800px;margin:0 auto;padding:28px 0">

        <!-- TYPE CHOICE -->
        <div id="pub-type-chooser" style="margin-bottom:28px">
          <p style="font-size:13px;color:var(--muted);margin-bottom:16px;letter-spacing:0.5px">What do you want to publish?</p>

          <!-- INTRO CARD -->
          <div id="pub-page-intro" style="display:flex;align-items:flex-start;gap:14px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.12);border-radius:14px;padding:16px 18px;margin-bottom:20px;animation:fadeUp 0.4s ease both">
            <div style="font-size:26px;line-height:1;flex-shrink:0">✨</div>
            <div>
              <div style="font-size:13px;font-weight:700;color:var(--g4);margin-bottom:4px">Post in 30 seconds</div>
              <div style="font-size:12px;color:var(--muted);line-height:1.6">Choose a format below, fill in the fields, and your post is visible to the entire community. <span style="color:var(--g3)">100% free.</span></div>
            </div>
            <button onclick="document.getElementById('pub-page-intro').style.display='none'" style="background:none;border:none;color:var(--muted2);font-size:18px;cursor:pointer;flex-shrink:0;padding:0;line-height:1;margin-left:4px">×</button>
          </div>

          <!-- MINI INTRO TOOLTIP -->
          <div id="pub-type-intro" style="display:none;margin-bottom:18px;padding:16px 18px;border-radius:14px;animation:fadeUp 0.25s ease both;transition:all 0.2s;position:relative">
            <div id="pub-intro-emoji" style="font-size:28px;margin-bottom:6px"></div>
            <div id="pub-intro-title" style="font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;margin-bottom:4px"></div>
            <div id="pub-intro-text" style="font-size:12px;line-height:1.7;color:var(--g5);margin-bottom:12px"></div>
            <div id="pub-intro-tags" style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px"></div>
            <button id="pub-intro-confirm" style="width:100%;padding:11px;border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:#0a0a0a;transition:all 0.2s" onclick="confirmPubTypeChoice()">
              Let's go →
            </button>
          </div>

          <div id="pub-type-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">

            <!-- PUB — style simple vert -->
            <div onclick="previewPubType('pub')" class="pub-type-card ptc-pub" id="ptc-pub" style="border-color:rgba(34,197,94,0.25);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(34,197,94,0.2),rgba(34,197,94,0.05));font-size:22px">📢</div>
                <div class="ptc-name" style="font-size:15px">Ad</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(34,197,94,0.1);color:var(--g4);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">SIMPLE</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Introduce your project to the community</div>
              <div class="ptc-fields">Nom · Description · Link</div>
            </div>

            <!-- AD — flash/alert style -->
            <div onclick="previewPubType('ad')" class="pub-type-card ptc-ad" id="ptc-ad" style="border-color:rgba(74,222,128,0.3);background:linear-gradient(135deg,rgba(74,222,128,0.04),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(74,222,128,0.25),rgba(74,222,128,0.05));font-size:22px;animation:blink 2s infinite">📣</div>
                <div class="ptc-name" style="font-size:15px;color:#4ade80">Ad</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(74,222,128,0.12);color:#4ade80;border:1px solid rgba(74,222,128,0.25);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">NEWS</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Inform the community about something new</div>
              <div class="ptc-fields">Title · Message · Link · Date</div>
            </div>

            <!-- SERVICE — shop/blue style -->
            <div onclick="previewPubType('service')" class="pub-type-card" id="ptc-service" style="border-color:rgba(59,130,246,0.3);background:linear-gradient(135deg,rgba(59,130,246,0.04),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(59,130,246,0.2),rgba(59,130,246,0.05));font-size:22px">🛍️</div>
                <div class="ptc-name" style="font-size:15px;color:#60a5fa">Service</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(59,130,246,0.12);color:#93c5fd;border:1px solid rgba(59,130,246,0.25);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">VENTE</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Offer your skills or services</div>
              <div class="ptc-fields">Service · Rate · Deadline · Contact</div>
            </div>

            <!-- LAUNCH — style rocket/rouge -->
            <div onclick="previewPubType('launch')" class="pub-type-card" id="ptc-launch" style="border-color:rgba(239,68,68,0.35);background:linear-gradient(135deg,rgba(239,68,68,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(239,68,68,0.25),rgba(239,68,68,0.05));font-size:22px">🚀</div>
                <div class="ptc-name" style="font-size:15px;color:#f87171">Launch</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(239,68,68,0.12);color:#fca5a5;border:1px solid rgba(239,68,68,0.3);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">🔥 HYPE</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Officially launch your product</div>
              <div class="ptc-fields">Product · Problem · Solution · Price</div>
            </div>

            <!-- COLLAB — network/purple style -->
            <div onclick="previewPubType('collab')" class="pub-type-card" id="ptc-collab" style="border-color:rgba(168,85,247,0.35);background:linear-gradient(135deg,rgba(168,85,247,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;">
              <div style="position:absolute;top:-10px;right:-10px;font-size:40px;opacity:0.06;pointer-events:none">🤝</div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(168,85,247,0.25),rgba(168,85,247,0.05));font-size:22px">🤝</div>
                <div class="ptc-name" style="font-size:15px;color:#c084fc">Collab</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(168,85,247,0.12);color:#d8b4fe;border:1px solid rgba(168,85,247,0.3);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">NETWORK</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Looking for a partner or co-founder</div>
              <div class="ptc-fields">Desired profile · Niche · Terms</div>
            </div>

            <!-- PROMO — style deal/orange + countdown feel -->
            <div onclick="previewPubType('promo')" class="pub-type-card" id="ptc-promo" style="border-color:rgba(245,158,11,0.4);background:linear-gradient(135deg,rgba(245,158,11,0.06),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;">
              <div style="position:absolute;top:0;right:0;background:rgba(245,158,11,0.12);border-bottom-left-radius:10px;padding:3px 10px;font-size:9px;font-family:'DM Mono',monospace;color:#fbbf24;letter-spacing:1px">LIMITED</div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(245,158,11,0.25),rgba(245,158,11,0.05));font-size:22px">🏷️</div>
                <div class="ptc-name" style="font-size:15px;color:#fbbf24">Promo</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Promotion or limitd-time deal</div>
              <div class="ptc-fields">Offer · Crossed price · Code · Expiration</div>
            </div>

            <!-- SONDAGE — style vote/teal -->
            <div onclick="previewPubType('sondage')" class="pub-type-card" id="ptc-sondage" style="border-color:rgba(20,184,166,0.35);background:linear-gradient(135deg,rgba(20,184,166,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(20,184,166,0.25),rgba(20,184,166,0.05));font-size:22px">📊</div>
                <div class="ptc-name" style="font-size:15px;color:#2dd4bf">Poll</div>
                <div style="margin-left:auto;display:flex;gap:2px;align-items:flex-end;height:16px">
                  <div style="width:4px;height:6px;background:rgba(45,212,191,0.4);border-radius:2px"></div>
                  <div style="width:4px;height:10px;background:rgba(45,212,191,0.6);border-radius:2px"></div>
                  <div style="width:4px;height:16px;background:#2dd4bf;border-radius:2px"></div>
                  <div style="width:4px;height:8px;background:rgba(45,212,191,0.5);border-radius:2px"></div>
                </div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Ask the community a question</div>
              <div class="ptc-fields">Question · 4 options · Vote duration</div>
            </div>

            <!-- TUTORIAL — academic/light green style -->
            <div onclick="previewPubType('tutoriel')" class="pub-type-card" id="ptc-tutoriel" style="border-color:rgba(34,197,94,0.2);background:linear-gradient(160deg,rgba(11,26,13,0.8),rgba(15,35,18,0.4));flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(34,197,94,0.03));font-size:22px">🎓</div>
                <div class="ptc-name" style="font-size:15px">Tutorial</div>
              </div>
              <div style="display:flex;gap:4px;margin-top:2px">
                <div style="flex:1;height:3px;background:var(--g3);border-radius:2px"></div>
                <div style="flex:1;height:3px;background:rgba(34,197,94,0.3);border-radius:2px"></div>
                <div style="flex:1;height:3px;background:rgba(34,197,94,0.15);border-radius:2px"></div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Share a method or step-by-step guide</div>
              <div class="ptc-fields">Topic · Steps · Level · Duration</div>
            </div>

            <!-- SEARCH — magnify/indigo style -->
            <div onclick="previewPubType('search')" class="pub-type-card" id="ptc-search" style="border-color:rgba(99,102,241,0.35);background:linear-gradient(135deg,rgba(99,102,241,0.05),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(99,102,241,0.25),rgba(99,102,241,0.05));font-size:22px">🔍</div>
                <div class="ptc-name" style="font-size:15px;color:#a5b4fc">Search</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(99,102,241,0.12);color:#c7d2fe;border:1px solid rgba(99,102,241,0.3);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">BESOIN</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Search for a freelaunch, tool or resource</div>
              <div class="ptc-fields">Need · Budget · Deadline · Contact</div>
            </div>

            <!-- RESULT — trophy/subtle gold style -->
            <div onclick="previewPubType('resultat')" class="pub-type-card" id="ptc-resultat" style="border-color:rgba(255,215,0,0.2);background:linear-gradient(135deg,rgba(255,215,0,0.03),transparent);flex-direction:column;align-items:flex-start;gap:8px;padding:16px;">
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,215,0,0.03));font-size:22px">🏆</div>
                <div class="ptc-name" style="font-size:15px;color:#fde68a">Result</div>
                <div style="margin-left:auto;font-size:18px;opacity:0.4">📈</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Share your stats and wins</div>
              <div class="ptc-fields">Figures · Period · Learnings</div>
            </div>

            <!-- CAMPAGNE — style premium or -->
            <div onclick="previewPubType('campagne')" class="pub-type-card" id="ptc-campagne" style="border-color:rgba(255,215,0,0.4);background:linear-gradient(135deg,rgba(255,215,0,0.07),rgba(255,140,0,0.03));flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;box-shadow:0 0 20px rgba(255,215,0,0.06)">
              <div style="position:absolute;inset:0;background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,215,0,0.015) 10px,rgba(255,215,0,0.015) 11px);pointer-events:none"></div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(255,215,0,0.3),rgba(255,140,0,0.1));font-size:22px">🎯</div>
                <div class="ptc-name" style="font-size:15px;color:#ffd700">Campaign</div>
                <span class="plan-elite-badge" style="margin-left:auto">MAX</span>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5;color:#fef3c7">Maximum visibility with a measurable goal</div>
              <div class="ptc-fields" style="color:rgba(255,215,0,0.5)">Goal · Video · FAQ · Top boost</div>
            </div>

            <!-- SERVICE PRO — style violet premium -->
            <div onclick="previewPubType('service-pro')" class="pub-type-card" id="ptc-service-pro" style="border-color:rgba(168,85,247,0.4);background:linear-gradient(135deg,rgba(168,85,247,0.07),rgba(109,40,217,0.03));flex-direction:column;align-items:flex-start;gap:8px;padding:16px;position:relative;overflow:hidden;">
              <div style="position:absolute;top:-20px;right:-20px;width:80px;height:80px;border-radius:50%;background:radial-gradient(circle,rgba(168,85,247,0.1),transparent);pointer-events:none"></div>
              <div style="display:flex;align-items:center;gap:10px;width:100%">
                <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(168,85,247,0.3),rgba(168,85,247,0.05));font-size:22px">🔧</div>
                <div class="ptc-name" style="font-size:15px;color:#a855f7">Pro Service</div>
                <div style="margin-left:auto;font-size:9px;background:rgba(168,85,247,0.15);color:#d8b4fe;border:1px solid rgba(168,85,247,0.35);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">PRO</div>
              </div>
              <div class="ptc-desc" style="font-size:11px;line-height:1.5">Premium service with full portfolio</div>
              <div class="ptc-fields" style="color:rgba(168,85,247,0.5)">Portfolio · Rates · Testimonials · Booking</div>
            </div>

            <!-- EMPLOI — style large/bleu entreprise -->
            <div onclick="previewPubType('emploi')" class="pub-type-card" id="ptc-emploi" style="grid-column:span 2;border-color:rgba(59,130,246,0.35);background:linear-gradient(90deg,rgba(59,130,246,0.06),transparent);flex-direction:row;align-items:center;gap:14px;padding:16px 20px;position:relative;overflow:hidden;">
              <div style="position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:48px;opacity:0.05;pointer-events:none">💼</div>
              <div class="ptc-icon" style="background:linear-gradient(135deg,rgba(59,130,246,0.25),rgba(59,130,246,0.05));font-size:26px;width:50px;height:50px;border-radius:12px;flex-shrink:0">💼</div>
              <div style="flex:1">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                  <div class="ptc-name" style="font-size:15px;color:#60a5fa">Job Offer</div>
                  <div style="font-size:9px;background:rgba(59,130,246,0.12);color:#93c5fd;border:1px solid rgba(59,130,246,0.25);border-radius:4px;padding:2px 7px;font-family:'DM Mono',monospace;letter-spacing:1px">RECRUITMENT</div>
                </div>
                <div class="ptc-desc" style="font-size:11px;line-height:1.5;margin-bottom:4px">Recruit for your team or project</div>
                <div class="ptc-fields">Position · Skills · Remote/On-site · Compensation · Application</div>
              </div>
            </div>

          </div>
        </div>

        <!-- WIZARD (hidden until type selected) -->
        <div id="pub-wizard-content" style="display:none">

        <!-- HEADER -->
        <div style="margin-bottom:22px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
          <div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
              <h2 id="wiz-main-title" style="font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:3px;color:var(--g3)">CREATE MY POST</h2>
              <span id="pub-type-badge" style="font-size:11px;background:rgba(34,197,94,0.1);color:var(--g3);border:1px solid rgba(34,197,94,0.3);border-radius:6px;padding:3px 10px;font-weight:700"></span>
            </div>
            <p id="wiz-main-sub" style="font-size:13px;color:var(--muted)">Follow the steps to create a post that converts.</p>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button onclick="backToPubTypeChooser()" style="background:rgba(255,255,255,0.04);border:1.5px solid var(--border);border-radius:8px;padding:8px 14px;font-size:12px;font-weight:700;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">← Change</button>
            <button onclick="showPubGuide()" style="background:rgba(34,197,94,0.08);border:1.5px solid rgba(34,197,94,0.2);border-radius:8px;padding:8px 14px;font-size:12px;font-weight:700;color:var(--g4);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">💡 Guide</button>
          </div>
        </div>

        <!-- STEPPER -->
        <div class="wiz-stepper" id="wiz-stepper">
          <div class="wiz-step-dot active" id="wdot-1" onclick="wizGoTo(1)">
            <div class="wiz-step-circle active" id="wcirc-1"><span>1</span></div>
            <div class="wiz-step-lbl" id="wlbl-1">Identity</div>
          </div>
          <div class="wiz-connector" id="wconn-1"></div>
          <div class="wiz-step-dot" id="wdot-2" onclick="wizGoTo(2)">
            <div class="wiz-step-circle" id="wcirc-2"><span>2</span></div>
            <div class="wiz-step-lbl" id="wlbl-2">Description</div>
          </div>
          <div class="wiz-connector" id="wconn-2"></div>
          <div class="wiz-step-dot" id="wdot-3" onclick="wizGoTo(3)">
            <div class="wiz-step-circle" id="wcirc-3"><span>3</span></div>
            <div class="wiz-step-lbl" id="wlbl-3">Details</div>
          </div>
          <div class="wiz-connector" id="wconn-3"></div>
          <div class="wiz-step-dot" id="wdot-4" onclick="wizGoTo(4)">
            <div class="wiz-step-circle" id="wcirc-4"><span>4</span></div>
            <div class="wiz-step-lbl" id="wlbl-4">Visual</div>
          </div>
          <div class="wiz-connector" id="wconn-4"></div>
          <div class="wiz-step-dot" id="wdot-5" onclick="wizGoTo(5)">
            <div class="wiz-step-circle" id="wcirc-5"><span>5</span></div>
            <div class="wiz-step-lbl" id="wlbl-5">Preview</div>
          </div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="wiz-progress-bar">
          <div class="wiz-progress-fill" id="wiz-prog-fill" style="width:20%"></div>
        </div>

        <!-- ────────────────────────────────────
             STEP 1 — PROJECT IDENTITY
        ──────────────────────────────────── -->
        <!-- ────────────────────────────────────
             STEP 1 — IDENTITY (DYNAMIC)
        ──────────────────────────────────── -->
        <div class="wiz-panel active" id="wpanel-1">
          <div class="wiz-group-card" id="wpanel-1-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon" id="wiz-step1-icon">🚀</div>
              <div>
                <div class="wiz-group-head" id="wiz-step1-head">IDENTITY</div>
                <div class="wiz-group-sub" id="wiz-step1-sub">Main information</div>
              </div>
            </div>
            <div id="wiz-step1-fields" class="edit-grid" style="gap:14px"></div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-next" id="wiz-step1-next" onclick="wizNext(1)">Next <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             STEP 2 — CONTENT (DYNAMIC)
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-2">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon" id="wiz-step2-icon">✍️</div>
              <div>
                <div class="wiz-group-head" id="wiz-step2-head">CONTENT</div>
                <div class="wiz-group-sub" id="wiz-step2-sub">Describe your post</div>
              </div>
            </div>
            <div id="wiz-step2-fields" style="display:flex;flex-direction:column;gap:14px"></div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(2)">← Back</button>
            <button class="btn-wiz-next" id="wiz-step2-next" onclick="wizNext(2)">Next <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             STEP 3 — DETAILS (DYNAMIC)
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-3">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon" id="wiz-step3-icon">🎯</div>
              <div>
                <div class="wiz-group-head" id="wiz-step3-head">DETAILS</div>
                <div class="wiz-group-sub" id="wiz-step3-sub">Additional information</div>
              </div>
            </div>
            <div id="wiz-step3-fields" class="edit-grid" style="gap:14px"></div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(3)">← Back</button>
            <button class="btn-wiz-next" id="wiz-step3-next" onclick="wizNext(3)">Next — Visual <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             STEP 4 — VISUAL
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-4">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">🖼️</div>
              <div>
                <div class="wiz-group-head">YOUR AD VISUAL</div>
                <div class="wiz-group-sub">Listings with images get <strong style="color:var(--g3)">3× more votes</strong> — highly recommended</div>
              </div>
            </div>
            <label style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;background:var(--s2);border:2px dashed var(--border);border-radius:14px;padding:40px 20px;font-size:13px;color:var(--muted);transition:all 0.2s;text-align:center" id="pub-media-drop" onmouseover="this.style.borderColor='var(--g3)';this.style.background='rgba(34,197,94,0.04)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--s2)'">
              <span style="font-size:44px">🖼️</span>
              <div>
                <div style="font-weight:700;color:var(--g4);margin-bottom:4px">Click to add your image or video</div>
                <div style="font-size:11px;color:var(--muted2)">PNG, JPG, GIF, MP4 · Max 10MB</div>
              </div>
              <input type="file" id="pub-media-input" accept="image/*,video/*" style="display:none" onchange="handlePubMediaUpload(this);updatePubCompletion()"/>
            </label>
            <div id="pub-media-preview" style="margin-top:12px"></div>
            <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.15);border-radius:10px;padding:12px 14px;margin-top:14px;font-size:11px;color:var(--muted);line-height:1.9">
              ✅ Cover image → <strong style="color:var(--g4)">3× more votes</strong><br>
              ✅ Description 100+ chars. → <strong style="color:var(--g4)">+60% clicks</strong><br>
              ✅ Precise tags → <strong style="color:var(--g4)">AI matching activated</strong>
            </div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(4)">← Back</button>
            <button class="btn-wiz-next" onclick="wizNext(4)">Next — Final preview <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             STEP 5 — PREVIEW & PUBLISH
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-5">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">👁️</div>
              <div>
                <div class="wiz-group-head">PREVIEW & PUBLISH</div>
                <div class="wiz-group-sub">Here is exactly how your ad will be seen by the community</div>
              </div>
            </div>

            <!-- SHOWCASE PREVIEW -->
            <div id="wiz-showcase-preview" class="wiz-preview-card">
              <div class="wiz-preview-banner" id="wiz-prev-banner">
                <span id="wiz-prev-emoji">🚀</span>
                <img id="wiz-prev-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover"/>
              </div>
              <div class="wiz-preview-body">
                <div class="wiz-preview-name" id="wiz-prev-name">Project name</div>
                <div class="wiz-preview-hook" id="wiz-prev-hook" style="display:none"></div>
                <div class="wiz-preview-desc" id="wiz-prev-desc">Your description will appear here...</div>
                <div class="wiz-preview-tags" id="wiz-prev-tags"></div>
                <div class="wiz-preview-footer">
                  <div style="display:flex;gap:10px">
                    <span>❤️ 0</span>
                    <span>💬 0</span>
                    <span id="wiz-prev-collab" style="display:none;font-size:10px;background:rgba(22,163,74,0.15);border:1px solid rgba(22,163,74,0.3);border-radius:4px;padding:1px 6px;color:var(--g4)"></span>
                  </div>
                  <div id="wiz-prev-author" style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2)"></div>
                </div>
              </div>
            </div>

            <!-- SUMMARY CHECKLIST -->
            <div id="wiz-checklist" style="background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:4px">
              <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">LISTING STRENGTH</div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2)">Completion</span>
                <span style="font-family:'DM Mono',monospace;font-size:14px;color:var(--gold);font-weight:700" id="wiz-completion-pct">0%</span>
              </div>
              <div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden;margin-bottom:12px">
                <div id="wiz-completion-bar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:3px;transition:width 0.4s"></div>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap" id="wiz-hints"></div>
            </div>

            <!-- SHOWCASE DURATION -->
            <div style="background:rgba(22,163,74,0.04);border:1px solid rgba(22,163,74,0.1);border-radius:8px;padding:10px 14px;font-size:11px;color:var(--muted);margin-top:10px">
              ⏱ Showcase duration: <strong style="color:var(--g3)">FREE = 24h</strong> · Starter = 7d · Pro = 30d · Elite = Permanent
              <span id="pub-plan-label" style="float:right;color:var(--g4);font-weight:600"></span>
            </div>
          </div>

          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(5)">← Edit</button>
            <button class="btn-wiz-publish" onclick="publishProject()">🚀 Publish to showcase!</button>
          </div>

          <div style="display:none" id="pub-strategy" style="margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:10px;padding:16px;font-size:13px;line-height:1.8;color:#7a9a82;white-space:pre-wrap"></div>
        </div>

      </div>
    </div>

        </div><!-- /pub-wizard-content -->
    <!-- CHAT MONDIAL -->
    <div class="tpanel" id="tab-chat-global">
      <div class="chat-panel-container">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">CHAT MONDIAL</h2>
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);display:flex;align-items:center;gap:6px"><span style="width:6px;height:6px;border-radius:50%;background:var(--g3);box-shadow:0 0 5px var(--g3);display:inline-block"></span><span id="world-online-count">0 online</span></div>
          </div>
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);background:var(--s1);border:1px solid var(--border2);border-radius:6px;padding:7px 12px">Messages restants : <span id="chat-msgs-left" style="color:var(--g3);font-weight:700">3</span></div>
        </div>
        <div class="chat-box">
          <div class="chat-msgs-area" id="world-chat-msgs"></div>
          <div class="chat-input-row">
            <input type="text" id="world-chat-in" class="chat-input-field" placeholder="Write your message to the community..." onkeydown="if(event.key==='Enter')sendWorldChat()"/>
            <button class="btn-send" onclick="sendWorldChat()">→</button>
          </div>
        </div>
        <div id="world-chat-upgrade" style="display:none" class="upgrade-strip">
          <div><h4>Daily messages exhausted</h4><p>Starter (3€/mois) = 10 messages/jour</p></div>
          <button class="btn-g btn-solid-g" onclick="startPayment('starter')">Upgrade →</button>
        </div>
      </div>
    </div>

    <!-- PROFILE -->
    <div class="tpanel" id="tab-profile">
      <div style="max-width:760px;margin:0 auto;padding:22px 0" id="my-profile-view"></div>
    </div>

    <!-- FOLLOWERS -->
    <div class="tpanel" id="tab-abonnes">
      <div style="max-width:640px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">FOLLOWERS & SUBSCRIPTIONS</h2>
        <div class="feed-tabs" style="margin-bottom:20px">
          <button class="feed-tab active" onclick="switchFollowTab('followers',this)">Followers (<span id="followers-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('following',this)">Following (<span id="following-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('discover',this)">Discover</button>
        </div>
        <div id="follow-list-container" class="follow-list"></div>
      </div>
    </div>

    <!-- GROUPES -->
    <div class="tpanel" id="tab-groups">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Join or create themed groups</p>
          </div>
          <button class="btn-publish" onclick="openCreateGroup()" id="btn-create-group" style="display:none">+ Create a group</button>
        </div>
        <div id="groups-list"></div>
      </div>
    </div>

    <!-- IA BOOST -->
    <div class="tpanel" id="tab-ia-boost">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">IA BOOST</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Complete promotion strategy generated in 10 seconds</p>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Strategy type</h3>
          <div class="boost-type-grid">
            <div class="boost-type-card selected" onclick="selectBoostType(this,'social')">📱<span>TikTok/Instagram</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'seo')">🔍<span>SEO Google</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'ads')">🎨<span>Ads</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'email')">📧<span>Email marketing</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'strategy')">📊<span>90-day strategy</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'coach')">🤖<span>Coach IA</span></div>
          </div>
        </div>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>My project</h3>
          <div class="edit-grid">
            <div class="fg"><label>Name</label><input type="text" id="boost-name" placeholder="My awesome project"/></div>
            <div class="fg"><label>Type</label><select id="boost-proj-type"><option>Website</option><option>Application</option><option>SaaS</option><option>TikTok</option><option>Instagram</option></select></div>
            <div class="fg"><label>Target</label><input type="text" id="boost-target" placeholder="Creators 18-30"/></div>
            <div class="fg"><label>Goal</label><input type="text" id="boost-goal" placeholder="1000 followers en 30j"/></div>
          </div>
          <div class="fg"><label>Description</label><textarea id="boost-desc" rows="2" placeholder="Describe your project..."></textarea></div>
        </div>
        <button class="btn-publish" style="width:100%;padding:13px;font-size:14px" id="btn-ia-boost" onclick="runIABoost()">⚡ Generate my strategy</button>
        <div id="boost-output-box" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:12px;padding:18px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:1px">STRATEGY GENERATED</span>
            <button onclick="navigator.clipboard.writeText(document.getElementById('boost-output-text').textContent).then(()=>toast('📋 Copied!'))" style="background:transparent;border:1px solid var(--border);border-radius:4px;padding:3px 10px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Copy</button>
          </div>
          <div id="boost-output-text" style="font-size:13px;line-height:1.9;color:#7a9a82;white-space:pre-wrap"></div>
        </div>
      </div>
    </div>

    <!-- GROUPES DISCUSSION -->
    <div class="tpanel" id="tab-groups">
      <div style="max-width:900px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Join or create themed groups (create = ELITE plan)</p>
          </div>
          <button class="btn-publish" id="btn-create-group" onclick="openCreateGroup()" style="display:none">🏛️ Create a group</button>
        </div>
        <div id="groups-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px"></div>
      </div>
    </div>

    <!-- ══ STATS & ANALYTICS ══ -->
    <div class="tpanel" id="tab-stats">
      <div style="max-width:960px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">TABLEAU DE BORD</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:22px">Your post performance over 30 days</p>
        <div class="analytics-grid" id="stats-kpi-grid">
          <div class="stat-card"><div class="stat-card-label">Total views</div><div class="stat-card-value" id="stat-views">0</div><div class="stat-card-trend up" id="stat-views-trend">↑ +0%</div></div>
          <div class="stat-card"><div class="stat-card-label">Clicks</div><div class="stat-card-value" id="stat-clicks">0</div><div class="stat-card-trend up" id="stat-clicks-trend">↑ +0%</div></div>
          <div class="stat-card"><div class="stat-card-label">Posts</div><div class="stat-card-value" id="stat-posts">0</div><div class="stat-card-sub">this month</div></div>
          <div class="stat-card"><div class="stat-card-label">Followers</div><div class="stat-card-value" id="stat-followers">0</div><div class="stat-card-trend up" id="stat-followers-trend">↑ +0</div></div>
        </div>
        <div class="chart-wrap">
          <div class="chart-title">VUES PAR JOUR — 7 DERNIERS JOURS</div>
          <div class="mini-chart" id="views-chart"></div>
          <div class="mini-chart-labels" id="views-chart-labels"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
          <div class="chart-wrap">
            <div class="chart-title">TOP ADS</div>
            <div id="top-posts-list" style="font-size:12px;color:var(--muted)">No data</div>
          </div>
          <div class="chart-wrap">
            <div class="chart-title">DISTRIBUTION BY CATEGORY</div>
            <div id="cat-chart" style="font-size:12px;color:var(--muted)">No data</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ BOOST CREDITS ══ -->
    <div class="tpanel" id="tab-boost-credits">
      <div style="max-width:700px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--gold);margin-bottom:3px">⚡ VIRAL CREDITS</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:16px">Earn credits via missions and badges — spend them to boost your content</p>

        <!-- CREDITS BAR -->
        <div class="credits-bar-v2">
          <div>
            <div class="credits-big" id="user-credits">0</div>
            <div class="credits-sub">⚡ VIRALCREDITS AVAILABLE</div>
          </div>
          <div class="credits-actions">
            <button class="btn-buy-credits" onclick="switchCreditsTab('missions',this)">🎯 Missions</button>
            <button class="btn-buy-credits" onclick="switchCreditsTab('shop',this)" style="background:rgba(22,163,74,0.1);border-color:rgba(22,163,74,0.4);color:var(--g3)">🛒 Shop</button>
            <button class="btn-buy-credits" onclick="switchCreditsTab('packs',this)">💳 Buy</button>
          </div>
        </div>

        <!-- TABS -->
        <div class="credits-tabs">
          <button class="credits-tab active" id="ctab-missions" onclick="switchCreditsTab('missions',this)">🎯 Missions</button>
          <button class="credits-tab" id="ctab-shop" onclick="switchCreditsTab('shop',this)">🛒 Shop</button>
          <button class="credits-tab" id="ctab-plans" onclick="switchCreditsTab('plans',this)">🎁 Plans</button>
          <button class="credits-tab" id="ctab-boost" onclick="switchCreditsTab('boost',this)">🚀 Booster</button>
          <button class="credits-tab" id="ctab-packs" onclick="switchCreditsTab('packs',this)">💳 Buy</button>
        </div>

        <!-- MISSIONS -->
        <div class="cpanel active" id="cpanel-missions">
          <div class="missions-reset" id="missions-reset-timer">Reset in <span id="missions-countdown">--:--:--</span></div>
          <div id="missions-list"></div>
          <div style="margin-top:20px;background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 16px;">
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;margin-bottom:10px">🏅 BADGES → CREDITS</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.8">
              Each unlocked badge automatically gives credits.<br>
              <span style="color:var(--g4)">📝 Premiers badges</span> → <b style="color:var(--gold)">+5 to +15⚡</b> &nbsp;|&nbsp;
              <span style="color:var(--g4)">🟢 Starter/Pro</span> → <b style="color:var(--gold)">+20 to +50⚡</b> &nbsp;|&nbsp;
              <span style="color:var(--gold)">👑 Special badges</span> → <b style="color:var(--gold)">+100 to +200⚡</b>
            </div>
          </div>
        </div>

        <!-- SHOP -->
        <div class="cpanel" id="cpanel-shop">
          <!-- ── BUY A PLAN WITH CREDITS ── -->
          <div style="background:linear-gradient(135deg,rgba(22,163,74,0.08),rgba(74,222,128,0.04));border:2px solid rgba(22,163,74,0.3);border-radius:14px;padding:18px 20px;margin-bottom:20px">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
              <span style="font-size:28px">🎁</span>
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:2px;color:var(--g3)">PAY YOUR PLAN WITH CREDITS</div>
                <div style="font-size:11px;color:var(--muted)">Earn credits and upgrade without a credit card</div>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
              <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s" onclick="buyPlanWithCredits('starter')" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.08)'">
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:1px">STARTER</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">800<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 3€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:var(--g2);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Buy</button>
              </div>
              <div style="background:var(--s1);border:2px solid rgba(22,163,74,0.3);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onclick="buyPlanWithCredits('pro')" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(22,163,74,0.3)'">
                <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-size:8px;font-weight:800;padding:2px 8px;border-radius:3px;letter-spacing:1px;white-space:nowrap">⭐ POPULAR</div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:1px">PRO</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">3500<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 14,99€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:var(--g2);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Buy</button>
              </div>
              <div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.25);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s" onclick="buyPlanWithCredits('elite')" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--gold);letter-spacing:1px">ELITE</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">9000<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 39,99€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:#1a0a00">Buy</button>
              </div>
            </div>
            <div style="text-align:center;margin-top:10px;font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace">✓ No credit card · ✓ Instant activation · ✓ 1 month free</div>
          </div>
          <div class="shop-section-title">🚀 BOOST DE PUBLICATION</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('top-feed',10)">
              <div class="shop-item-emoji">🔝</div>
              <div class="shop-item-name">Top of Feed</div>
              <div class="shop-item-desc">Your ad at the top of the feed for 2h</div>
              <div class="shop-item-price">⚡ 10</div>
            </div>
            <div class="shop-item" onclick="shopBuy('showcase-24h',25)">
              <div class="shop-item-emoji">✨</div>
              <div class="shop-item-name">Showcase 24h</div>
              <div class="shop-item-desc">Pinned in showcase for one day</div>
              <div class="shop-item-price">⚡ 25</div>
            </div>
            <div class="shop-item" onclick="shopBuy('notif-push',50)">
              <div class="shop-item-emoji">🔔</div>
              <div class="shop-item-name">Notif Push</div>
              <div class="shop-item-desc">Notification to entire community</div>
              <div class="shop-item-price">⚡ 50</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('boost-7j',80)">
              <div class="shop-item-badge">PREMIUM</div>
              <div class="shop-item-emoji">🏆</div>
              <div class="shop-item-name">Boost 7 Jours</div>
              <div class="shop-item-desc">Featured for one week</div>
              <div class="shop-item-price">⚡ 80</div>
            </div>
          </div>
          <div class="shop-section-title">🎨 PROFILE CUSTOMIZATION</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('cadre-or',30)">
              <div class="shop-item-emoji">🖼️</div>
              <div class="shop-item-name">Golden Frame</div>
              <div class="shop-item-desc">Avatar with animated golden border</div>
              <div class="shop-item-price">⚡ 30</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('badge-feu',45)">
              <div class="shop-item-badge">RARE</div>
              <div class="shop-item-emoji">🔥</div>
              <div class="shop-item-name">Badge Feu</div>
              <div class="shop-item-desc">Animated flame on your profile</div>
              <div class="shop-item-price">⚡ 45</div>
            </div>
            <div class="shop-item" onclick="shopBuy('emoji-pack',20)">
              <div class="shop-item-emoji">🎭</div>
              <div class="shop-item-name">Pack Emojis+</div>
              <div class="shop-item-desc">15 exclusive emojis for your posts</div>
              <div class="shop-item-price">⚡ 20</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('title-vip',60)">
              <div class="shop-item-badge">VIP</div>
              <div class="shop-item-emoji">💎</div>
              <div class="shop-item-name">Title VIP</div>
              <div class="shop-item-desc">"VIP" golden badge under your name</div>
              <div class="shop-item-price">⚡ 60</div>
            </div>
          </div>
          <div class="shop-section-title">🤖 IA & OUTILS</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('ia-analysis',15)">
              <div class="shop-item-emoji">🔬</div>
              <div class="shop-item-name">AI Analysis</div>
              <div class="shop-item-desc">Detailed analysis of your ad</div>
              <div class="shop-item-price">⚡ 15</div>
            </div>
            <div class="shop-item" onclick="shopBuy('ia-hashtags',10)">
              <div class="shop-item-emoji">📌</div>
              <div class="shop-item-name">Hashtags IA</div>
              <div class="shop-item-desc">30 viral hashtags generated by AI</div>
              <div class="shop-item-price">⚡ 10</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('ia-strategie',35)">
              <div class="shop-item-emoji">🗺️</div>
              <div class="shop-item-name">AI Strategy</div>
              <div class="shop-item-desc">Plan marketing complet 30 jours</div>
              <div class="shop-item-price">⚡ 35</div>
            </div>
          </div>
          <div id="shop-boost-select-wrap" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;">
            <div style="font-size:12px;font-weight:700;margin-bottom:8px">Choose the post to boost:</div>
            <select id="boost-post-select" style="margin-bottom:10px"><option value="">Choose...</option></select>
            <button class="btn-modal-g" onclick="confirmShopBoost()" style="margin-top:0;padding:9px">⚡ Confirmer le boost</button>
          </div>
        </div>

        <!-- PLANS WITH CREDITS -->
        <div class="cpanel" id="cpanel-plans">
          <div style="text-align:center;margin-bottom:20px">
            <div style="font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px;color:var(--g3)">UPGRADE WITH YOUR CREDITS</div>
            <div style="font-size:12px;color:var(--muted);margin-top:4px">Earn credits via missions & badges → upgrade your plan without a credit card</div>
          </div>
          <div style="background:rgba(255,215,0,0.05);border:1.5px solid rgba(255,215,0,0.2);border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
            <div><div style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px">YOUR CURRENT CREDITS</div><div style="font-family:'Bebas Neue',sans-serif;font-size:42px;color:var(--gold);line-height:1" id="plans-credits-display">0</div></div>
            <div style="text-align:right"><div style="font-size:11px;color:var(--muted)">Your current plan</div><div style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3)" id="plans-current-plan">FREE</div></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr;gap:14px">
            <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);letter-spacing:1px;margin-bottom:4px">🟢 STARTER — 800⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">10 posts/day · Showcase 7d · AI Coach · +200 credits/month</div>
                <div id="starter-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="starter-progress-bar" style="height:100%;background:var(--g3);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="starter-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('starter')" style="padding:10px 22px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);white-space:nowrap;flex-shrink:0">Buy →</button>
            </div>
            <div style="background:var(--s1);border:2px solid rgba(22,163,74,0.25);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;position:relative">
              <div style="position:absolute;top:-10px;left:18px;background:var(--g2);color:var(--bg);font-size:9px;font-weight:800;padding:3px 10px;border-radius:3px;letter-spacing:1px">⭐ POPULAIRE</div>
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);letter-spacing:1px;margin-bottom:4px">✅ PRO — 3 500⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Unlimitd posts · IA Boost · Advanced stats · +500 credits/mois</div>
                <div id="pro-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="pro-progress-bar" style="height:100%;background:var(--g3);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="pro-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('pro')" style="padding:10px 22px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);white-space:nowrap;flex-shrink:0">Buy →</button>
            </div>
            <div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.25);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);letter-spacing:1px;margin-bottom:4px">🏆 ELITE — 9 000⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Permanent showcase · Monthly call · Priority matching · +1500 credits/month</div>
                <div id="elite-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="elite-progress-bar" style="height:100%;background:linear-gradient(90deg,#ffd700,#ff8c00);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="elite-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('elite')" style="padding:10px 22px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:#1a0a00;white-space:nowrap;flex-shrink:0">Buy →</button>
            </div>
          </div>
          <div style="margin-top:16px;text-align:center;font-size:11px;color:var(--muted2);font-family:'DM Mono',monospace">
            💡 Earn credits via daily missions and badges to upgrade for free!
          </div>
        </div>

        <!-- BOOST MY AD (shortcut) -->
        <div class="cpanel" id="cpanel-boost">
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px">Que veux-tu faire ?</div>
          <div class="boost-options">
            <div class="boost-opt selected" onclick="selectBoostOpt(this,'top-feed')">
              <div class="boost-opt-icon">🔝</div>
              <div class="boost-opt-name">Top of feed</div>
              <div class="boost-opt-cost">⚡ 10 credits</div>
              <div class="boost-opt-desc">Your ad at the top for 2h</div>
            </div>
            <div class="boost-opt" onclick="selectBoostOpt(this,'showcase-24h')">
              <div class="boost-opt-icon">✨</div>
              <div class="boost-opt-name">Showcase 24h</div>
              <div class="boost-opt-cost">⚡ 25 credits</div>
              <div class="boost-opt-desc">Pinned in showcase for one day</div>
            </div>
            <div class="boost-opt" onclick="selectBoostOpt(this,'notif-push')">
              <div class="boost-opt-icon">🔔</div>
              <div class="boost-opt-name">Notification push</div>
              <div class="boost-opt-cost">⚡ 50 credits</div>
              <div class="boost-opt-desc">Notify entire community</div>
            </div>
          </div>
          <div style="margin-bottom:12px">
            <label>Post to boost</label>
            <select id="boost-post-select2" style="margin-top:4px"><option value="">Choose a post...</option></select>
          </div>
          <button class="btn-publish" onclick="applyBoost()" style="width:100%;padding:13px">⚡ Activer le boost</button>
        </div>

        <!-- BUY CREDITS -->
        <div class="cpanel" id="cpanel-packs">
          <div class="shop-section-title">💳 CREDIT PACKS</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
            <div onclick="buyCredits(50,4.99)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(34,197,94,0.3)'" onmouseout="this.style.borderColor='var(--border2)'">
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)">50</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">credits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">4,99€</div>
              <div style="font-size:10px;color:var(--muted);margin-top:3px">€0.10/credit</div>
            </div>
            <div onclick="buyCredits(150,12.99)" style="background:var(--s2);border:1.5px solid rgba(34,197,94,0.3);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.3)'">
              <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-size:8px;font-weight:700;padding:2px 8px;border-radius:3px;white-space:nowrap">⭐ POPULAIRE</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)">150</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">credits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">12,99€</div>
              <div style="font-size:10px;color:var(--g4);margin-top:3px">-13% moins cher</div>
            </div>
            <div onclick="buyCredits(400,29.99)" style="background:var(--s1);border:1.5px solid rgba(255,215,0,0.25);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onmouseover="this.style.borderColor='rgba(255,215,0,0.5)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
              <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:8px;font-weight:700;padding:2px 8px;border-radius:3px;white-space:nowrap">👑 BEST VALUE</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--gold)">400</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">credits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">29,99€</div>
              <div style="font-size:10px;color:var(--gold);margin-top:3px">-25% moins cher</div>
            </div>
          </div>
          <div style="margin-top:14px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.15);border-radius:8px;padding:12px 14px;font-size:11px;color:var(--muted);line-height:1.7">
            💡 <b style="color:var(--g4)">Astuce :</b> You can also earn free credits by completing <span style="color:var(--g3);cursor:pointer" onclick="switchCreditsTab('missions',document.getElementById('ctab-missions'))">missions quotidiennes</span> and unlocking badges!
          </div>
        </div>

      </div>
    </div>

    <!-- ══ LEADERBOARD ══ -->
    <div class="tpanel" id="tab-leaderboard">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">CLASSEMENT</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Top viral posts this week</p>
        <div class="feed-tabs" style="margin-bottom:18px">
          <button class="feed-tab active" onclick="switchLeaderboard('pubs',this)">📢 Viral ads</button>
          <button class="feed-tab" onclick="switchLeaderboard('creators',this)">👤 Creators</button>
          <button class="feed-tab" onclick="switchLeaderboard('showcase',this)">✨ Showcase</button>
        </div>
        <div class="leaderboard-list" id="leaderboard-list"></div>
      </div>
    </div>

    <!-- ══ COLLABS ══ -->
    <div class="tpanel" id="tab-collab">
      <div style="max-width:760px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">COLLABORATIONS</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Creators compatible with your profile — AI matched</p>
        <div style="background:rgba(34,197,94,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:10px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px">
          <div style="font-size:24px">🤖</div>
          <div>
            <div style="font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px">AI Matching enabled</div>
            <div style="font-size:11px;color:var(--muted)">Based on your niche, goals and skills</div>
          </div>
          <button onclick="loadCollabs()" style="margin-left:auto;background:var(--g2);border:none;border-radius:6px;padding:7px 14px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Refresh</button>
        </div>
        <div id="collab-list">
          <div style="text-align:center;padding:32px;color:var(--muted)">Loading suggestions...</div>
        </div>
      </div>
    </div>

    <!-- ══ EDITORIAL CALENDAR ══ -->
    <div class="tpanel" id="tab-calendrier">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">EDITORIAL CALENDAR</h2>
            <p style="font-size:12px;color:var(--muted)">Plan and visualize your posts</p>
          </div>
          <div style="display:flex;gap:8px">
            <button onclick="calNav(-1)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted)">←</button>
            <span id="cal-month-label" style="font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);padding:7px 14px;background:var(--s1);border:1.5px solid var(--border2);border-radius:6px"></span>
            <button onclick="calNav(1)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted)">→</button>
          </div>
        </div>
        <div class="cal-header-days">
          <span>MON</span><span>TUE</span><span>WED</span><span>THU</span><span>FRI</span><span>SAT</span><span>SUN</span>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
        <div style="margin-top:20px">
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px">🤖 AI-SUGGESTED OPTIMAL TIME SLOTS</div>
          <div id="optimal-slots" style="display:flex;flex-wrap:wrap;gap:6px"></div>
        </div>
      </div>
    </div>

    <!-- ══ A/B TEST IA ══ -->
    <div class="tpanel" id="tab-ab-test">
      <div style="max-width:760px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">AI A/B TEST</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">AI analyzes your 2 versions and predicts which will convert better</p>
        <div class="ab-compare">
          <div class="ab-side">
            <div class="ab-side-label a">VERSION A</div>
            <textarea id="ab-text-a" rows="4" placeholder="First version of your ad..." style="width:100%;resize:none"></textarea>
          </div>
          <div class="ab-side">
            <div class="ab-side-label b">VERSION B</div>
            <textarea id="ab-text-b" rows="4" placeholder="Second version of your ad..." style="width:100%;resize:none"></textarea>
          </div>
        </div>
        <div class="fg"><label>Ad objective</label><select id="ab-goal"><option value="clicks">Generate clicks</option><option value="followers">Gain followers</option><option value="ventes">Convert to sales</option><option value="notoriete">Brand awareness / Views</option></select></div>
        <button class="btn-publish" onclick="runABTest()" id="btn-ab" style="width:100%;padding:13px;font-size:14px;margin-top:4px">🔬 Analyze with AI</button>
        <div id="ab-result" style="display:none;margin-top:16px" class="ab-result">
          <div class="ab-winner" id="ab-winner-text">Version A wins</div>
          <div class="ab-analysis" id="ab-analysis-text"></div>
        </div>
      </div>
    </div>

  </div><!-- /max-width container -->
</div><!-- /app -->

<!-- SIGNUP -->
<div class="modal-bg" id="signup-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('signup-modal')">✕</button>
    <!-- Header with value -->
    <div class="signup-header">
      <div class="signup-logo">⚡ VIRALBOOST</div>
      <h2 class="signup-title">Join the community</h2>
      <p class="signup-subtitle">Free · No card · Online in 30 seconds</p>
    </div>
    <!-- Quick benefits -->
    <div class="signup-benefits">
      <div class="signup-benefit">✅ Publish your ad in front of thousands of creators</div>
      <div class="signup-benefit">✅ Find collaborators via AI matching</div>
      <div class="signup-benefit">✅ Access community chat & groups</div>
    </div>
    <!-- Simplified form -->
    <div class="signup-form">
      <input type="email" id="s-email" placeholder="📧 Your email *" class="signup-input"/>
      <input type="password" id="s-pass" placeholder="🔒 Password (8 chars min.) *" class="signup-input"/>
    </div>
    <!-- Plan hidden (FREE by default) -->
    <div style="display:none"><div class="signup-plans" id="signup-plans-grid"></div></div>
    <button class="btn-signup-big" onclick="signup()">🚀 Create my free account →</button>
    <div class="signup-footer-note">✓ Free forever · Upgrade anytime</div>
    <div class="modal-switch">Already have an account? <a onclick="switchModal('signup-modal','login-modal')">Log in</a></div>
  </div>
</div>

<!-- LOGIN -->
<div class="modal-bg" id="login-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('login-modal')">✕</button>
    <h2>LOG IN</h2>
    <div class="modal-sub">WELCOME BACK 👋</div>
    <div class="fg"><label>Email</label><input type="email" id="l-email" placeholder="hello@example.com"/></div>
    <div class="fg"><label>Password</label><input type="password" id="l-pass" placeholder="Your password"/></div>
    <button class="btn-modal-g" onclick="login()">Log in →</button>
    <div class="modal-switch">No account? <a onclick="switchModal('login-modal','signup-modal')">Sign up</a></div>
  </div>
</div>

<!-- PAYMENT -->
<div class="modal-bg" id="payment-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('payment-modal')">✕</button>
    <h2>SUBSCRIPTION</h2>
    <div class="modal-sub">NO COMMITMENT · CANCEL ANYTIME</div>
    <div class="pay-sum">
      <div class="pay-plan" id="pay-plan-name">STARTER</div>
      <div class="pay-price" id="pay-plan-price">3€</div>
      <div class="pay-period">/mois</div>
    </div>
    <div id="card-element"></div>
    <div id="card-errors"></div>
    <button class="btn-modal-g" id="btn-pay" onclick="processPayment()">🔒 Subscribe now</button>
    <div style="text-align:center;margin-top:7px;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">ENCRYPTED · STRIPE · NO COMMITMENT</div>
  </div>
</div>

<!-- REPORT MODAL -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>REPORT</h2>
    <div class="modal-sub" id="report-modal-sub">REPORT SENT TO ADMIN</div>
    <div class="report-reason">
      <label><input type="radio" name="report-reason" value="spam"/> Spam / Abusive advertising</label>
      <label><input type="radio" name="report-reason" value="harcelement"/> Harassment</label>
      <label><input type="radio" name="report-reason" value="contenu_inapproprie"/> Inappropriate content</label>
      <label><input type="radio" name="report-reason" value="arnaque"/> Scam / Fraud</label>
      <label><input type="radio" name="report-reason" value="autre"/> Other</label>
    </div>
    <div class="fg"><label>Details (optional)</label><textarea id="report-details" rows="3" placeholder="Give more info..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Send report</button>
  </div>
</div>

<!-- CREATE GROUP MODAL (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CREATE A GROUP</h2>
    <div class="modal-sub">ELITE MEMBERS ONLY 🏆</div>
    <div class="group-settings-section">
      <h3>Group information</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Group name *</label><input type="text" id="cg-name" placeholder="Digital Marketing Pro"/></div>
        <div class="fg"><label>Icon emoji</label><input type="text" id="cg-emoji" placeholder="💼" maxlength="2"/></div>
        <div class="fg"><label>Theme / Category</label><select id="cg-cat"><option value="marketing">📢 Marketing / Ads</option><option value="saas">🚀 SaaS / Tech</option><option value="ecommerce">🛍️ E-commerce</option><option value="tiktok">🎵 TikTok / Creators</option><option value="business">💼 Business</option><option value="freelance">💻 Freelance</option><option value="autre">📦 Autre</option></select></div>
        <div class="fg"><label>Max members</label><select id="cg-max"><option value="50">50 members</option><option value="100">100 members</option><option value="500">500 members</option><option value="0">Unlimitd</option></select></div>
      </div>
      <div class="fg"><label>Description</label><textarea id="cg-desc" rows="2" placeholder="What is this group about? Who can join?"></textarea></div>
    </div>
    <div class="group-settings-section">
      <h3>🔧 Moderation settings</h3>
      <div class="toggle-row"><label>Allow photos in group</label><label class="toggle"><input type="checkbox" id="cg-allow-photos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Allow videos</label><label class="toggle"><input type="checkbox" id="cg-allow-videos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Allow files</label><label class="toggle"><input type="checkbox" id="cg-allow-files"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Private group (invite only)</label><label class="toggle"><input type="checkbox" id="cg-private"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Pre-moderate messages</label><label class="toggle"><input type="checkbox" id="cg-premod"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Custom background for group</label><label class="toggle"><input type="checkbox" id="cg-wallpaper-enable"/><span class="toggle-slider"></span></label></div>
    </div>
    <button class="btn-modal-g" onclick="createGroup()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">🏆 Create group</button>
  </div>
</div>

<!-- WALLPAPER MODAL (ELITE) -->
<div class="modal-bg" id="wallpaper-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('wallpaper-modal')">✕</button>
    <h2>WALLPAPER</h2>
    <div class="modal-sub">CUSTOMIZE YOUR SPACE — ELITE ONLY 🏆</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div onclick="setWallpaper('none')" style="height:70px;background:var(--bg);border:2px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--muted)">None</div>
      <div onclick="setWallpaper('linear-gradient(135deg,#040a05,#0b2810)')" style="height:70px;background:linear-gradient(135deg,#040a05,#0b2810);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#0a0014,#1a0028)')" style="height:70px;background:linear-gradient(135deg,#0a0014,#1a0028);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#001a0a,#0a1f0a,#001210)')" style="height:70px;background:linear-gradient(135deg,#001a0a,#0a1f0a,#001210);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#1a0a00,#2a1000)')" style="height:70px;background:linear-gradient(135deg,#1a0a00,#2a1000);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#00101a,#001428)')" style="height:70px;background:linear-gradient(135deg,#00101a,#001428);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
    </div>
    <div class="fg"><label>Or import an image</label><input type="file" id="wallpaper-file" accept="image/*" onchange="setWallpaperFromFeede(this)"/></div>
  </div>
</div>

<!-- DM ADMIN MODAL (ELITE) -->
<div class="modal-bg" id="dm-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-admin-modal')">✕</button>
    <h2>MESSAGE TO ADMIN</h2>
    <div class="modal-sub">PRIVATE MESSAGE — ELITE ONLY 🏆</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-admin-msgs"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-admin-input" placeholder="Your message to admin..." onkeydown="if(event.key==='Enter')sendAdminDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendAdminDM()" style="padding:9px 18px">Send</button>
      </div>
    </div>
  </div>
</div>

<!-- GROUP CHAT MODAL -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div class="modal-sub" id="group-chat-sub">GROUP DISCUSSION</div>
    <div style="display:flex;gap:12px">
      <div style="flex:1">
        <div class="chat-box" style="height:400px">
          <div class="chat-msgs-area" id="group-chat-msgs"></div>
          <div class="chat-input-row" style="align-items:center">
            <label id="group-media-upload-label" style="cursor:pointer;color:var(--g3);font-size:18px;flex-shrink:0;display:none" title="Add media">
              <input type="file" id="group-media-input" accept="image/*,video/*" style="display:none" onchange="sendGroupMedia(this)"/>📎
            </label>
            <input type="text" id="group-chat-in" class="chat-input-field" placeholder="Write your message..."/>
            <button class="btn-send" onclick="sendGroupMsg()">→</button>
          </div>
        </div>
      </div>
      <div id="group-members-sidebar" style="width:180px;background:var(--s1);border:1px solid var(--border2);border-radius:10px;padding:12px;max-height:430px;overflow-y:auto">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">MEMBERS</div>
        <div id="group-members-list" style="font-size:12px;color:var(--muted)"></div>
        <div id="group-admin-controls" style="display:none;margin-top:12px;border-top:1px solid var(--border2);padding-top:10px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:2px;margin-bottom:8px">MODERATION</div>
          <button onclick="openGroupSettings()" style="width:100%;padding:6px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:5px;font-size:11px;color:var(--gold);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;margin-bottom:5px">⚙️ Settings</button>
          <button onclick="openModal('wallpaper-modal')" style="width:100%;padding:6px;background:transparent;border:1px solid var(--border);border-radius:5px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">🖼️ Wallpaper</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DM MODAL -->
<div class="modal-bg" id="dm-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-modal')">✕</button>
    <h2>PRIVATE MESSAGE</h2>
    <div class="modal-sub" id="dm-modal-sub">To: ...</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-msgs-list"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-input" placeholder="Your message..." onkeydown="if(event.key==='Enter')sendDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendDM()" style="padding:9px 18px">Send</button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT PROFILE -->
<div class="modal-bg" id="edit-profile-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('edit-profile-modal')">✕</button>
    <h2>MY PROFILE</h2>
    <div class="modal-sub">MORE COMPLETE THAN ANY OTHER PLATFORM</div>

    <div class="edit-section">
      <h3>Identity & Avatar</h3>
      <div class="edit-avatar-row">
        <div class="edit-avatar-big" id="edit-ava-preview" style="background:var(--g2)" onclick="document.getElementById('ava-file-input')?.click()" title="Click to upload a photo">
          <span id="edit-ava-emoji">🙂</span>
          <img id="edit-ava-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%"/>
          <div class="ava-upload-overlay"></div>
          <input type="file" id="ava-file-input" accept="image/*" style="display:none;position:absolute" onchange="handleAvatarUpload(this)"/>
        </div>
        <div style="flex:1">
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Click on the avatar to upload a photo · or choose an emoji</div>
          <div style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px">FREE</div>
          <div class="emoji-picker" style="margin-bottom:10px">
            <div class="emoji-opt" onclick="selectEmoji(this,'🙂')">🙂</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😎')">😎</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🤩')">🤩</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😏')">😏</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧐')">🧐</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🚀')">🚀</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'💡')">💡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🎯')">🎯</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🔥')">🔥</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'⚡')">⚡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🌍')">🌍</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧠')">🧠</div>
          </div>
          <div style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:1px">✨ PREMIUM (STARTER+)</div>
          <div class="emoji-picker">
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'💎','starter')">💎</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'👑','pro')">👑</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦁','starter')">🦁</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🐉','pro')">🐉</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🌟','starter')">🌟</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🏆','pro')">🏆</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦊','starter')">🦊</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🤖','starter')">🤖</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦄','elite')">🦄</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'👾','pro')">👾</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🧬','elite')">🧬</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🔮','elite')">🔮</div>
          </div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>First name *</label><input type="text" id="ep-name" placeholder="Marie"/></div>
        <div class="fg"><label>Username *</label><input type="text" id="ep-username" placeholder="marie_creator"/></div>
        <div class="fg"><label>Title / Role</label><input type="text" id="ep-title" placeholder="Content creator · Indie deve"/></div>
        <div class="fg"><label>Location</label><input type="text" id="ep-location" placeholder="City, Country 🌍"/></div>
      </div>
      <div class="fg"><label>Bio</label><textarea id="ep-bio" rows="3" placeholder="Tell us who you are, what you create, what te passionne..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>About (ultra-detailed)</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Sector / Niche</label><input type="text" id="ep-niche" placeholder="Marketing digital, Tech, Fitness..."/></div>
        <div class="fg"><label>Experience</label><select id="ep-exp"><option>Beginner (0-1 yr)</option><option>Intermediate (1-3 yrs)</option><option>Confirmed (3-5 yrs)</option><option>Expert (5+ yrs)</option></select></div>
        <div class="fg"><label>Availability</label><select id="ep-dispo"><option>Open to collaborations</option><option>Available for projects</option><option>Looking for d'investisseur</option><option>Looking for partner</option><option>Just networking</option></select></div>
        <div class="fg"><label>Revenue/mois (optional)</label><select id="ep-revenue"><option value="">Not specified</option><option>0–500€</option><option>500–2 000€</option><option>2 000–5 000€</option><option>5 000–10 000€</option><option>$10,000+</option></select></div>
        <div class="fg"><label>Main goal</label><input type="text" id="ep-goal" placeholder="Atteindre 100K followers en 2025"/></div>
        <div class="fg"><label>Key skills</label><input type="text" id="ep-skills" placeholder="Video, Copywriting, SEO, Dev..."/></div>
        <div class="fg"><label>Tools used</label><input type="text" id="ep-tools" placeholder="CapCut, Canva, Notion, Figma..."/></div>
        <div class="fg"><label>Languages spoken</label><input type="text" id="ep-langs" placeholder="French, English, Spanish..."/></div>
      </div>
      <div class="fg"><label>What I'm looking for</label><textarea id="ep-looking" rows="2" placeholder="I'm looking for collaborators, a partner, clients, advice..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>Networks & Links</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>🌐 Website</label><input type="url" id="ep-website" placeholder="https://your-site.com"/></div>
        <div class="fg"><label>🎵 TikTok</label><input type="text" id="ep-tiktok" placeholder="@monaccount"/></div>
        <div class="fg"><label>📸 Instagram</label><input type="text" id="ep-instagram" placeholder="@monaccount"/></div>
        <div class="fg"><label>🐦 Twitter/X</label><input type="text" id="ep-twitter" placeholder="@monaccount"/></div>
        <div class="fg"><label>💼 LinkedIn</label><input type="url" id="ep-linkedin" placeholder="linkedin.com/in/..."/></div>
        <div class="fg"><label>▶️ YouTube</label><input type="text" id="ep-youtube" placeholder="@monaccount"/></div>
      </div>
    </div>

    <div class="edit-section">
      <h3>My numbers (optional)</h3>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px">
        <div class="fg"><label>TikTok followers</label><input type="text" id="ep-tiktok-count" placeholder="45 000"/></div>
        <div class="fg"><label>Instagram followers</label><input type="text" id="ep-ig-count" placeholder="12 000"/></div>
        <div class="fg"><label>Projects launched</label><input type="text" id="ep-projects-count" placeholder="3"/></div>
        <div class="fg"><label>Sales / Clients</label><input type="text" id="ep-sales" placeholder="150"/></div>
      </div>
    </div>

    <button class="btn-modal-g" onclick="saveProfile()">💾 Save profile</button>
  </div>
</div>

<!-- PUBLISH LANDING (avant sign up) -->
<div class="modal-bg" id="publish-landing-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('publish-landing-modal')">✕</button>
    <h2>POST AN AD</h2>
    <div class="modal-sub">INSTANT DISTRIBUTION ON VIRALBOOST · NO ACCOUNT REQUIRED</div>
    <div class="fg"><label>Your ad title *</label><input type="text" id="pl-title" placeholder="Ex: ContentPro — The AI tool for creators"/></div>
    <div class="fg"><label>Ad message *</label><textarea id="pl-text" rows="4" placeholder="Describe your product,rvice, project... Make it catchy!"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Category</label><select id="pl-type"><option value="saas">🚀 SaaS / App</option><option value="site">🌐 Website</option><option value="ecommerce">🛍️ E-commerce</option><option value="service">💼 Service</option><option value="coaching">🎓 Coaching</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option></select></div>
      <div class="fg"><label>URL (optional)</label><input type="url" id="pl-url" placeholder="https://..."/></div>
    </div>
    <div class="fg">
      <label>Image / Video (optional)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        📎 Add a file
        <input type="file" id="pl-media" accept="image/*,video/*" style="display:none" onchange="handleLandingMediaUpload(this)"/>
      </label>
      <div id="pl-media-preview" style="margin-top:8px"></div>
    </div>
    <button class="btn-modal-g" onclick="publishLandingAd()">📢 Publish now</button>
    <div class="modal-switch">Already have an account? <a onclick="switchModal('publish-landing-modal','login-modal')">Log in</a> · <a onclick="switchModal('publish-landing-modal','signup-modal')">Sign up</a></div>
  </div>
</div>

<!-- CREATE GROUP (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CREATE A GROUP</h2>
    <div class="modal-sub">ELITE FEATURE — YOU ARE GROUP ADMIN</div>
    <div class="edit-grid">
      <div class="fg"><label>Group name *</label><input type="text" id="grp-name" placeholder="Ex: SaaS Builders FR"/></div>
      <div class="fg"><label>Emoji / Icon</label><input type="text" id="grp-emoji" placeholder="🚀" maxlength="2"/></div>
    </div>
    <div class="fg"><label>Description *</label><textarea id="grp-desc" rows="2" placeholder="What is this group about?"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Category</label><select id="grp-cat"><option>SaaS / Tech</option><option>Marketing</option><option>TikTok / Instagram</option><option>E-commerce</option><option>Coaching</option><option>Crypto / Finance</option><option>Autre</option></select></div>
      <div class="fg"><label>Access</label><select id="grp-access"><option value="public">🌍 Public</option><option value="private">🔒 Private (by invitation)</option></select></div>
    </div>
    <div class="fg"><label>Background image (URL or upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Group background
        <input type="file" id="grp-bg-input" accept="image/*" style="display:none" onchange="handleGroupBgUpload(this)"/>
      </label>
      <div id="grp-bg-preview" style="margin-top:8px"></div>
    </div>
    <div class="fg"><label>Group rules (optional)</label><textarea id="grp-rules" rows="2" placeholder="Ex: No spam. Topics related to SaaS only."></textarea></div>
    <div style="background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:8px;padding:12px;margin-bottom:14px;font-size:12px;color:var(--g5)">
      As admin, you can: edit the background, rules, allow/ban photos, remove members, report abuse.
    </div>
    <button class="btn-modal-g" onclick="createGroup()">🏛️ Create the group</button>
  </div>
</div>

<!-- SETTINGS GROUPE (ELITE admin) -->
<div class="modal-bg" id="group-settings-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-settings-modal')">✕</button>
    <h2>GROUP SETTINGS</h2>
    <div class="modal-sub">ADMINISTRATION — ELITE UNIQUEMENT</div>
    <div class="fg"><label>Allow photos in this group</label>
      <select id="gs-allow-photos"><option value="1">✅ Yes, allowed</option><option value="0">❌ No, disabled</option></select>
    </div>
    <div class="fg"><label>New fond (upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Edit le fond
        <input type="file" id="gs-bg-input" accept="image/*" style="display:none" onchange="handleGroupSettingsBg(this)"/>
      </label>
    </div>
    <div class="fg"><label>Rules</label><textarea id="gs-rules" rows="2"></textarea></div>
    <div class="fg"><label>Private mode</label>
      <select id="gs-access"><option value="public">🌍 Public</option><option value="private">🔒 Private</option></select>
    </div>
    <button class="btn-modal-g" onclick="saveGroupSettings()">💾 Save</button>
  </div>
</div>

<!-- CHAT GROUPE -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div style="display:flex;gap:8px;margin-bottom:8px" id="group-chat-actions"></div>
    <div class="chat-box" style="height:400px">
      <div class="chat-msgs-area" id="group-chat-msgs"></div>
      <div class="chat-input-row">
        <input type="text" id="group-chat-input" class="chat-input-field" placeholder="Message in the group..." onkeydown="if(event.key==='Enter')sendGroupMessage()"/>
        <label id="group-media-btn" style="display:none;cursor:pointer;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0" title="Joindre un fichier">
          📎<input type="file" id="group-chat-file" accept="image/*,video/*" style="display:none" onchange="handleGroupChatFeede(this)"/>
        </label>
        <button class="btn-send" onclick="sendGroupMessage()">→</button>
      </div>
    </div>
  </div>
</div>

<!-- SIGNALER UN UTILISATEUR -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">REPORT SENT TO ADMIN</div>
    <div class="fg"><label>Reason for report *</label>
      <select id="report-reason">
        <option value="spam">🚫 Spam / Abusive advertising</option>
        <option value="harcelement">⚠️ Harassment / Insults</option>
        <option value="contenu">🔞 Inappropriate content</option>
        <option value="arnaque">💸 Scam / Fraud</option>
        <option value="autre">📝 Autre</option>
      </select>
    </div>
    <div class="fg"><label>Details (optional)</label><textarea id="report-details" rows="3" placeholder="Explain what happened..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Send report</button>
  </div>
</div>

<!-- CONTACT ADMIN (ELITE) -->
<div class="modal-bg" id="contact-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('contact-admin-modal')">✕</button>
    <h2>MESSAGE TO ADMIN</h2>
    <div class="modal-sub">ELITE FEATURE — REPLY WITHIN 24H</div>
    <div class="fg"><label>Objet</label><input type="text" id="ca-subject" placeholder="Ex: Demande de partnership"/></div>
    <div class="fg"><label>Message *</label><textarea id="ca-message" rows="5" placeholder="Your message to the ViralBoos teamt..."></textarea></div>
    <button class="btn-modal-g" onclick="sendAdminMessage()">📩 Send</button>
  </div>
</div>
<script>


// ════════════════════════════════════════
// ── SYSTÈME I18N FR / EN
// ════════════════════════════════════════
let currentLang = localStorage.getItem('vb_lang') || 'fr';

const i18n = {
  fr: {
    // Navbar
    nav_showcase: 'Showcase', nav_plans: 'Plans', nav_reviews: 'Reviews',
    nav_login: 'Log in', nav_join: 'Join →',
    mob_showcase: '📊 Showcase', mob_plans: '💎 Plans', mob_reviews: '⭐ Reviews',
    // Hero
    hero_line1: 'JOIN', hero_line2: 'VIRALBOOST.', hero_badge: '📢 THE #1 PLATFORM FOR DIGITAL ADVERTISING', hero_sub_new: "The platform where creators and entrepreneurs showcase their project, find partners and grow their audience.",
      hero_cta1: "⚡ Join for free →",
      hero_nocard: "No credit card · Immediate access",
      feat1_title: "Post your ad", feat1_sub: "Instantly visible to everyone",
      feat2_title: "Find collabs", feat2_sub: "Matching with creators",
      feat3_title: "Grow your audience", feat3_sub: "Votes, shares, visibility", feat4_title: "Community chat", feat4_sub: "Connect with other creators", feat5_title: "Project rankings", feat5_sub: "Top projects rise to the top", feat6_title: "Targeted audience", feat6_sub: "Creators, entrepreneurs, founders", mono_title: "From 1,000 followers — generate revenue", mono_sub: "Enable sales on your profile and monetize your community directly from the platform.",
      hero_form_title: "📢 POST YOUR AD IN 30 SECONDS",
      hero_form_btn: "📢 Publish my ad for free →",
      hero_form_note: "✓ Free · Instantly visible · No card required",
      hero_login_link: "Already signed up? Log in",
    hero_cta2: 'Log in',
    how1_title: 'Post your ad', how2_title: 'Find a partner', how3_title: "Boost with AI",
    // Sections
    sec_feed: 'Public feed', sec_showcase: 'Community showcase', sec_plans: 'Plans',
    // Bottom nav
    bn_feed: 'Feed', bn_showcase: 'Showcase', bn_profile: 'Profile',
    // Composer
    comp_label: '✦ COMMUNITY FEED', comp_title: 'Share with the community',
    comp_sub: 'Projects, ideas, questions — your voice matters here.',
    comp_placeholder: 'Share your project with the community…',
    // Feed tabs
    tab_all: 'All', tab_following: 'Following', tab_top: 'Top today',
    // Buttons
    btn_publish: 'Publish', btn_addlink: '🔗 Add a link',
    // Toast
    toast_published: '📢 Post published!',
    toast_write: 'Write something!',
    toast_limit_free: 'FREE plan: 1 post/hour. Upgrade for more!',
    toast_limit_day: "Daily post limit reached.",
    // App tabs
    apptab_feed: 'Feed', apptab_showcase: 'Showcase', apptab_publish: 'Publish',
    apptab_chat: 'Chat', apptab_profile: 'Profile',
    // Profile
    prof_edit: '✏️ Edit', prof_followers: 'Followers', prof_following: 'Following', prof_projects: 'Projects', prof_votes: 'Votes received',
    // Showcase
    vit_title: 'COMMUNITY SHOWCASE', vit_sub: 'Projects shared by the community',
    vit_empty: '🚀 No projects for this filter',
    vit_all: 'All',
    // Publish wizard
    wiz_title: 'CREATE MY AD',
    wiz_sub: 'Follow the 5 steps to create an ad that converts and attracts votes.',
    // No posts
    no_posts: "No posts yet.",
    // Login/signup modal
    login_title: 'LOG IN', signup_title: 'CREATE MY ACCOUNT',
    // Settings
    logout: 'Quitter',
    // URL field
    url_placeholder: 'https://your-site.com',
    proj_placeholder: 'Project name (optional)',
  },
  en: {
    // Navbar
    nav_showcase: 'Showcase', nav_plans: 'Pricing', nav_reviews: 'Reviews',
    nav_login: 'Log in', nav_join: 'Join →',
    mob_showcase: '📊 Showcase', mob_plans: '💎 Pricing', mob_reviews: '⭐ Reviews',
    // Hero
    hero_line1: 'JOIN', hero_line2: 'VIRALBOOST.', hero_badge: '📢 #1 DIGITAL ADVERTISING PLATFORM', hero_sub_new: "The platform where creators and entrepreneurs showcase their project, find partners and grow their audience.",
      hero_cta1: "⚡ Join for free →",
      hero_nocard: "No credit card · Instant access",
      feat1_title: "Publish your ad", feat1_sub: "Visible immediately to all",
      feat2_title: "Find collabs", feat2_sub: "Matched with creators",
      feat3_title: "Grow your reach", feat3_sub: "Votes, shares, visibility", feat4_title: "Community chat", feat4_sub: "Talk with other creators", feat5_title: "Project ranking", feat5_sub: "Best projects rise to the top", feat6_title: "Targeted audience", feat6_sub: "Creators, entrepreneurs, founders", mono_title: "From 1,000 followers — generate revenue", mono_sub: "Enable sales on your profile and monetize your community directly from the platform.",
      hero_form_title: "📢 PUBLISH YOUR AD IN 30 SECONDS",
      hero_form_btn: "📢 Publish my ad for free →",
      hero_form_note: "✓ Free · Visible instantly · No card required",
      hero_login_link: "Already a member? Sign in",
    hero_cta2: 'Log in',
    how1_title: 'Post your ad', how2_title: 'Find a partner', how3_title: 'Boost with AI',
    // Sections
    sec_feed: 'Public feed', sec_showcase: 'Community Showcase', sec_plans: 'Pricing',
    // Bottom nav
    bn_feed: 'Feed', bn_showcase: 'Showcase', bn_profile: 'Profile',
    // Composer
    comp_label: '✦ COMMUNITY FEED', comp_title: 'Share with the community',
    comp_sub: 'Projects, ideas, questions — your voice matters here.',
    comp_placeholder: 'Share your project with the community…',
    // Feed tabs
    tab_all: 'All', tab_following: 'Following', tab_top: "Today's top",
    // Buttons
    btn_publish: 'Post', btn_addlink: '🔗 Add a link',
    // Toast
    toast_published: '📢 Post published!',
    toast_write: 'Write something!',
    toast_limit_free: 'FREE plan: 1 post/hour. Upgrade for more!',
    toast_limit_day: 'Daily post limit reached.',
    // App tabs
    apptab_feed: 'Feed', apptab_showcase: 'Showcase', apptab_publish: 'Publish',
    apptab_chat: 'Chat', apptab_profile: 'Profile',
    // Profile
    prof_edit: '✏️ Edit', prof_followers: 'Followers', prof_following: 'Following', prof_projects: 'Projects', prof_votes: 'Votes received',
    // Showcase
    vit_title: 'COMMUNITY SHOWCASE', vit_sub: 'Projects shared by the community',
    vit_empty: '🚀 No projects for this filter',
    vit_all: 'All',
    // Publish wizard
    wiz_title: 'CREATE MY AD',
    wiz_sub: 'Follow the 5 steps to create an ad that converts and attracts votes.',
    // No posts
    no_posts: 'No posts yet.',
    // Login/signup modal
    login_title: 'LOG IN', signup_title: 'CREATE MY ACCOUNT',
    // Settings
    logout: 'Log out',
    // URL field
    url_placeholder: 'https://your-website.com',
    proj_placeholder: 'Project name (optional)',
  }
};

function t(key) {
  return (i18n[currentLang] && i18n[currentLang][key]) || (i18n['fr'][key]) || key;
}

function applyLang() {
  // Update tous les éléments data-i18n
  // Use innerText only if the element has no complex HTML children
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const val = t(key);
    // If the element only has text (no child elements), replace directly
    if(el.children.length === 0) {
      el.textContent = val;
    } else {
      // Sinon on cherche un noeud texte direct et on le met à jour
      for(let node of el.childNodes) {
        if(node.nodeType === 3 && node.textContent.trim()) {
          node.textContent = val;
          break;
        }
      }
    }
  });
  // Placeholders
  const ta = document.getElementById('feed-text');
  if(ta) ta.placeholder = t('comp_placeholder');
  const urlInp = document.getElementById('feed-url');
  if(urlInp) urlInp.placeholder = t('url_placeholder');
  const projInp = document.getElementById('feed-proj-name');
  if(projInp) projInp.placeholder = t('proj_placeholder');
  // Language button — shows the language you can switch TO
  const btn = document.getElementById('lang-btn');
  if(btn) btn.textContent = currentLang === 'fr' ? '🇬🇧 EN' : '🇫🇷 FR';
  // html lang + title
  document.documentElement.lang = currentLang;
  document.title = currentLang === 'fr'
    ? 'ViralBoost — Post your ad, reach your target'
    : 'ViralBoost — Publish your ad, reach your audience';
  // Rebuild dynamic sections if app active
  if(document.getElementById('tab-showcase')?.classList.contains('active')) buildShowcaseGrid('app-showcase-grid');
  if(document.getElementById('tab-feed')?.classList.contains('active')) buildFeed();
}

function toggleLang() {
  currentLang = currentLang === 'fr' ? 'en' : 'fr';
  localStorage.setItem('vb_lang', currentLang);
  applyLang();
}

// Apply on loading
document.addEventListener('DOMContentLoaded', () => { applyLang(); });

const PLANS = [
  { id:'free', name:'FREE', price:0, period:'', desc:'To discover ViralBoost',
    features:['1 post / hour','3 global chat messages / day','Showcase 1 hour','Full public profile','Community access'],
    limits:{pubsPerHour:1,chatMsgs:3,showcaseHours:1}
  },
  { id:'starter', name:'STARTER', price:3, period:'/month', desc:'To start boosting',
    features:['3 posts / day','10 global chat messages / day','Showcase 7 days','AI Coach (20 requests/month)','Unlimitd DMs','Starter badge'],
    limits:{pubsPerDay:3,chatMsgs:10,showcaseHours:168}
  },
  { id:'pro', name:'PRO', price:14.99, period:'/month', desc:'For serious creators', recommended:true,
    features:['Unlimitd posts','Unlimitd global chat','Priority showcase 30d','Unlimitd AI Boost','Advanced stats','Verified Pro badge','30% affiliate'],
    limits:{pubsPerDay:999,chatMsgs:999,showcaseHours:720}
  },
  { id:'elite', name:'ELITE', price:39.99, period:'/month', desc:'To dominate your market',
    features:['Everything in Pro','Permanent + pinned showcase','Elite badge 🏆 gold on actions','🏛️ Create discussion groups','Full group admin','Report → sent to admin','Private message to admin','Live coaching sessions','40% commission'],
    limits:{pubsPerDay:999,chatMsgs:999,showcaseHours:9999999}
  }
];


// ── SYSTÈME DE BADGES ──
const BADGES = [
  // ── PUBLICATIONS ──
  { id:'first_post',    emoji:'📝', name:'First Post',      desc:'Publish your 1st post',             plan:null,    condition:u=>((u._postCount||0)>=1) },
  { id:'post5',         emoji:'🔥', name:'On Fire',            desc:'5 posts total',          plan:null,    condition:u=>((u._postCount||0)>=5) },
  { id:'post20',        emoji:'💥', name:'Post Machine',     desc:'20 posts total',         plan:null,    condition:u=>((u._postCount||0)>=20) },
  { id:'post50',        emoji:'🚀', name:'Rocket Publisher',  desc:'50 posts total',         plan:null,    condition:u=>((u._postCount||0)>=50) },
  { id:'post100',       emoji:'💯', name:'Centenaire',        desc:'100 posts total',        plan:'starter',condition:u=>((u._postCount||0)>=100) },
  { id:'post500',       emoji:'🌊', name:'Content Tsunami',desc:'500 posts total',        plan:'pro',   condition:u=>((u._postCount||0)>=500), special:true },
  // ── VOTES & POPULARITY ──
  { id:'first_vote',    emoji:'⚡', name:'First Vote',      desc:'Receive your 1st vote',             plan:null,    condition:u=>((u.totalVotes||0)>=1) },
  { id:'votes10',       emoji:'🎯', name:'Popular',         desc:'10 votes received',                  plan:null,    condition:u=>((u.totalVotes||0)>=10) },
  { id:'votes50',       emoji:'🏅', name:'Influencer',       desc:'50 votes received',                  plan:null,    condition:u=>((u.totalVotes||0)>=50) },
  { id:'votes100',      emoji:'🎖️', name:'Viral',             desc:'100 votes received',                 plan:'starter',condition:u=>((u.totalVotes||0)>=100) },
  { id:'votes500',      emoji:'🏆', name:'Phenomenon',         desc:'500 votes received',                 plan:'pro',   condition:u=>((u.totalVotes||0)>=500), special:true },
  { id:'votes1000',     emoji:'💎', name:'Icon Viral',        desc:'1000 votes received',                plan:'elite', condition:u=>((u.totalVotes||0)>=1000), special:true },
  // ── PROFILE & NETWORK ──
  { id:'bio',           emoji:'✍️', name:'Complete Profile',   desc:'Add your bio',                   plan:null,    condition:u=>!!(u.bio&&u.bio.length>10) },
  { id:'profile_links',  emoji:'🔗', name:'Well Connected',    desc:'Add 2 social networks',         plan:null,    condition:u=>([u.tiktok,u.instagram,u.twitter,u.youtube,u.linkedin].filter(Boolean).length>=2) },
  { id:'profile_full',   emoji:'⭐', name:'Gold Profile',      desc:'Profile 100% complete',             plan:'starter',condition:u=>!!(u.bio&&u.name&&u.title&&u.location&&u.skills) },
  { id:'follow1',       emoji:'🤝', name:'Connected',         desc:'Follow someone',                  plan:null,    condition:u=>((u.following||[]).length>=1) },
  { id:'follow10',      emoji:'🌐', name:'Networker',        desc:'10 subscriptions',                  plan:null,    condition:u=>((u.following||[]).length>=10) },
  { id:'follow50',      emoji:'🕸️', name:'Super Networker',  desc:'50 subscriptions',                  plan:'starter',condition:u=>((u.following||[]).length>=50) },
  { id:'follow100',     emoji:'🌍', name:'Global Network',   desc:'100 subscriptions',                 plan:'pro',   condition:u=>((u.following||[]).length>=100) },
  { id:'followers10',   emoji:'📣', name:'Opinion Leader',desc:'10 followers on your profile',        plan:null,    condition:u=>((u.followers||[]).length>=10) },
  { id:'followers50',   emoji:'📢', name:'Celebrity',        desc:'50 followers on your profile',        plan:'starter',condition:u=>((u.followers||[]).length>=50) },
  { id:'followers100',  emoji:'🌟', name:'Star VB',          desc:'100 followers on your profile',       plan:'pro',   condition:u=>((u.followers||[]).length>=100) },
  // ── MESSAGES & SOCIAL ──
  { id:'dm_king',       emoji:'💬', name:'DM King',          desc:'Send 5 private messages',         plan:'starter',condition:u=>(['starter','pro','elite'].includes(u.plan)&&(u._dmCount||0)>=5) },
  { id:'dm_master',     emoji:'📨', name:'DM Master',        desc:'Send 50 private messages',        plan:'pro',   condition:u=>((u._dmCount||0)>=50) },
  { id:'chat_pioneer',  emoji:'🗨️', name:'Chat Pioneer', desc:'Send 20 messages in chat',  plan:null,    condition:u=>((u._chatCount||0)>=20) },
  { id:'chat_legend',   emoji:'🎙️', name:'Community Voice', desc:'Send 200 messages in chat', plan:'starter',condition:u=>((u._chatCount||0)>=200) },
  { id:'group_member',  emoji:'👥', name:'Active Member',     desc:'Join 1 group',                 plan:null,    condition:u=>((u._groupCount||0)>=1) },
  { id:'group_chatter', emoji:'💭', name:'Big Talker',    desc:'50 messages in groups',     plan:'starter',condition:u=>((u._groupMsgs||0)>=50) },
  // ── IA & STRATÉGIE ──
  { id:'ia_first',      emoji:'🤖', name:'IA Explorer',      desc:'Use AI Boost 1 fois',          plan:null,    condition:u=>((u._iaCount||0)>=1) },
  { id:'ia_master',     emoji:'🧠', name:'IA Master',        desc:'Use AI Boost 10 fois',         plan:'pro',   condition:u=>(['pro','elite'].includes(u.plan)&&(u._iaCount||0)>=10) },
  { id:'ia_addict',     emoji:'🔮', name:'IA Addict',        desc:'Use AI Boost 50 fois',         plan:'pro',   condition:u=>((u._iaCount||0)>=50), special:true },
  { id:'ab_test',       emoji:'🔬', name:'Experimenter',  desc:'Launch an AI A/B test',             plan:'pro',   condition:u=>((u._abTests||0)>=1) },
  // ── SHOWCASE & PROJECTS ──
  { id:'first_showcase', emoji:'✨', name:'In Showcase',       desc:'Publish your 1st project in showcase', plan:null,    condition:u=>((u._projectCount||0)>=1) },
  { id:'showcase5',      emoji:'🖼️', name:'Gallery',          desc:'5 projects in showcase',             plan:'starter',condition:u=>((u._projectCount||0)>=5) },
  { id:'showcase10',     emoji:'🎭', name:'Portfolio Pro',    desc:'10 projects in showcase',            plan:'pro',   condition:u=>((u._projectCount||0)>=10) },
  // ── CREDITS & SHOP ──
  { id:'credits50',     emoji:'⚡', name:'Charged',           desc:'Accumulate 50 ViralCredits',         plan:null,    condition:u=>(userCredits>=50) },
  { id:'credits200',    emoji:'💸', name:'Rich Creator',     desc:'Accumulate 200 ViralCredits',        plan:'starter',condition:u=>(userCredits>=200) },
  { id:'credits1000',   emoji:'💰', name:'VB Millionaire',  desc:'Accumulate 1000 ViralCredits',       plan:'pro',   condition:u=>(userCredits>=1000), special:true },
  { id:'shop_first',    emoji:'🛒', name:'First Purchase',    desc:'Buy something in the shop', plan:null,    condition:u=>((u._shopBuys||0)>=1) },
  { id:'shop_power',    emoji:'🏪', name:'Big Spender',   desc:'10 shop purchases',            plan:'starter',condition:u=>((u._shopBuys||0)>=10) },
  // ── COLLABS & MATCHING ──
  { id:'first_collab',  emoji:'🤝', name:'First Collab',   desc:'Propose a collaboration',        plan:null,    condition:u=>((u._collabCount||0)>=1) },
  { id:'collab5',       emoji:'🏗️', name:'Builder',        desc:'5 collaborations proposed',       plan:'starter',condition:u=>((u._collabCount||0)>=5) },
  { id:'collab_master', emoji:'🌐', name:'Collab Master',    desc:'10 collaborations',                plan:'pro',   condition:u=>((u._collabCount||0)>=10), special:true },
  // ── RÉACTIONS ──
  { id:'first_react',   emoji:'😍', name:'Reactive',          desc:'Send 1 enriched reaction',       plan:null,    condition:u=>((u._reactCount||0)>=1) },
  { id:'react50',       emoji:'🎉', name:'Expressive',       desc:'50 reactions sent',            plan:null,    condition:u=>((u._reactCount||0)>=50) },
  { id:'react200',      emoji:'🎊', name:'Reaction King',desc:'200 reactions sent',           plan:'starter',condition:u=>((u._reactCount||0)>=200) },
  // ── LIKES ──
  { id:'like10',        emoji:'❤️', name:'Generous Heart',   desc:'Like 10 posts',             plan:null,    condition:u=>((u._likeCount||0)>=10) },
  { id:'like100',       emoji:'💝', name:'Fan Club',         desc:'100 likes given',                 plan:null,    condition:u=>((u._likeCount||0)>=100) },
  { id:'like500',       emoji:'💗', name:'Love Machine',     desc:'500 likes given',                 plan:'starter',condition:u=>((u._likeCount||0)>=500) },
  // ── COMMENTAIRES ──
  { id:'comment5',      emoji:'💡', name:'Commentateur',     desc:'Laisse 5 comments',            plan:null,    condition:u=>((u._commentCount||0)>=5) },
  { id:'comment20',     emoji:'📢', name:'Active Voice',      desc:'20 comments left',          plan:'starter',condition:u=>((u._commentCount||0)>=20) },
  // ── PARTAGES ──
  { id:'share5',        emoji:'📤', name:'Shareur',        desc:'Share 5 publications',           plan:null,    condition:u=>((u._shareCount||0)>=5) },
  { id:'share20',       emoji:'📡', name:'Ambassadeur',      desc:'Share 20 publications',          plan:'starter',condition:u=>((u._shareCount||0)>=20) },
  // ── SENIORITY ──
  { id:'early',         emoji:'🌱', name:'Pioneer',         desc:'Founding member 2025-2026',       plan:null,    condition:u=>!!(u.createdAt&&new Date(u.createdAt)<new Date('2026-06-01')) },
  { id:'week1',         emoji:'📅', name:'1 Week',        desc:'Member for 7 days',            plan:null,    condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=7*86400000) },
  { id:'month1',        emoji:'🗓️', name:'1 Month',           desc:'Member for 30 days',           plan:null,    condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=30*86400000) },
  { id:'month6',        emoji:'🎂', name:'6 Months',           desc:'Member for 6 months',             plan:'starter',condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=180*86400000) },
  { id:'year1',         emoji:'🎆', name:'1 Year',             desc:'Member for 1 year',               plan:'pro',   condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=365*86400000), special:true },
  // ── MISSIONS ──
  { id:'mission5',      emoji:'🎯', name:'Mission Hunter',desc:'Complete 5 missions',           plan:null,    condition:u=>((u._missionsCompleted||0)>=5) },
  { id:'mission20',     emoji:'🏹', name:'Mission Impossible',  desc:'Complete 20 missions',          plan:'starter',condition:u=>((u._missionsCompleted||0)>=20) },
  { id:'streak3',       emoji:'🔑', name:'Regular',         desc:'Login 3 days in a row',     plan:null,    condition:u=>((u._loginStreak||0)>=3) },
  { id:'streak7',       emoji:'🔑', name:'Discipline',       desc:'Login 7 days in a row',     plan:'starter',condition:u=>((u._loginStreak||0)>=7) },
  { id:'streak30',      emoji:'🏋️', name:'Content Athlete',desc:'30 consecutive login days',plan:'pro',  condition:u=>((u._loginStreak||0)>=30), special:true },
  // ── PLANS ──
  { id:'starter_badge', emoji:'🟢', name:'Starter',          desc:'Starter plan activated',             plan:'starter',condition:u=>['starter','pro','elite'].includes(u.plan) },
  { id:'pro_badge',     emoji:'✅', name:'PRO Verified',      desc:'Pro plan activated',                  plan:'pro',   condition:u=>['pro','elite'].includes(u.plan) },
  { id:'affiliate',     emoji:'💰', name:'Affiliate',          desc:'Pro + affiliate program',      plan:'pro',   condition:u=>(['pro','elite'].includes(u.plan)) },
  { id:'elite_badge',   emoji:'🏆', name:'ELITE',            desc:'Elite plan activated',                plan:'elite', condition:u=>(u.plan==='elite') },
  { id:'group_founder', emoji:'🏛️', name:'Founder',        desc:'Create a group (Elite)',           plan:'elite', condition:u=>(u.plan==='elite'&&(u._groupCount||0)>=1) },
  { id:'legend',        emoji:'👑', name:'LEGEND',          desc:'Elite + 100 votes + 20 posts',      plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=100&&(u._postCount||0)>=20), special:true },
  { id:'king',          emoji:'💎', name:'DIAMOND KING',     desc:'Elite + 200 top votes',         plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=200), special:true },
  { id:'god',           emoji:'🌌', name:'VIRAL GOD',        desc:'Elite + 1000 votes + 500 posts',    plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=1000&&(u._postCount||0)>=500), special:true },
  // ── CREDITS USED FOR PLANS ──
  { id:'plan_credits',  emoji:'🪙', name:'Smart Buyer',   desc:'Buy a plan with credits',  plan:null,    condition:u=>((u._planBoughtWithCredits||0)>=1), special:false },
];

function getUserBadges(u){
  return BADGES.map(b=>({...b, unlocked: b.condition(u)}));
}

function renderBadges(u){
  const badges = getUserBadges(u);
  const unlocked = badges.filter(b=>b.unlocked).length;
  return `
  <div class="badges-section">
    <h3>🏅 MY BADGES <span style="font-size:10px;color:var(--muted);font-weight:400">${unlocked}/${badges.length} unlocked</span></h3>
    <div class="badges-grid">
      ${badges.map(b=>{
        const bonus = BADGE_CREDITS[b.id]||5;
        return `<div class="badge-item ${b.unlocked?'unlocked':'locked'} ${b.special?'special':''}">
          ${!b.unlocked?'<span class="badge-lock-icon">🔒</span>':''}
          <div class="badge-emoji">${b.emoji}</div>
          <div class="badge-name">${b.name}</div>
          ${b.plan?`<div class="badge-plan-tag badge-plan-${b.plan}">${b.plan.toUpperCase()}</div>`:''}
          <div class="badge-reward">+${bonus}⚡</div>
          <div class="badge-tooltip">${b.desc} · +${bonus} credits</div>
        </div>`;
      }).join('')}
    </div>
  </div>`;
}


let worldChatMsgs=[],dmTarget=null,dmThreads={},ws=null,wsRetries=0;
let myVotes=new Set(JSON.parse(localStorage.getItem('vb_votes')||'[]'));
let posts=[],selectedSignupPlan='free';
let groupsData=[];
let currentGroupId=null;
let pendingMediaUrl=null, pendingLandingMediaUrl=null, pendingPubMediaUrl=null;
let reportTarget=null;
let currentGroupSettingsId=null;
let groupBgUrl=null, groupSettingsBgUrl=null;

// Credits offerts par badge
const BADGE_CREDITS = {
  first_post:5, post5:10, post20:20, post50:35, post100:60, post500:150,
  first_vote:5, votes10:15, votes50:30, votes100:50, votes500:100, votes1000:200,
  bio:10, profile_links:12, profile_full:25,
  follow1:5, follow10:15, follow50:30, follow100:50,
  followers10:15, followers50:35, followers100:60,
  dm_king:15, dm_master:40,
  chat_pioneer:10, chat_legend:30,
  group_member:10, group_chatter:25,
  ia_first:10, ia_master:30, ia_addict:75, ab_test:20,
  first_showcase:12, showcase5:25, showcase10:50,
  credits50:15, credits200:30, credits1000:100,
  shop_first:10, shop_power:30,
  first_collab:15, collab5:35, collab_master:80,
  first_react:5, react50:20, react200:50,
  like10:8, like100:25, like500:60,
  comment5:10, comment20:30,
  share5:10, share20:30,
  early:20, week1:10, month1:25, month6:60, year1:150,
  mission5:20, mission20:60,
  streak3:15, streak7:35, streak30:100,
  starter_badge:20, pro_badge:50, affiliate:25,
  elite_badge:100, group_founder:40, legend:150, king:200, god:500,
  plan_credits:30,
};

function checkNewBadges(){
  if(!currentUser) return;
  const saved = JSON.parse(localStorage.getItem('vb_earned_badges')||'[]');
  const savedSet = new Set(saved);
  const nowUnlocked = BADGES.filter(b => b.condition(currentUser)).map(b=>b.id);
  const newOnes = nowUnlocked.filter(id => !savedSet.has(id));
  if(newOnes.length){
    newOnes.forEach(id=>{
      const b = BADGES.find(x=>x.id===id);
      const bonus = BADGE_CREDITS[id]||5;
      if(b){
        setTimeout(()=>{
          addCredits(bonus);
          toast(`${b.emoji} Badge unlocked: ${b.name}! +${bonus}⚡`);
        }, 300);
        savedSet.add(id);
      }
    });
    localStorage.setItem('vb_earned_badges', JSON.stringify([...savedSet]));
  }
}

// ── TOAST ──
function toast(msg,type='success'){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className='toast-g'+(type==='success'?' success':'');
  t.textContent=msg;
  c.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(50px)';t.style.transition='all 0.3s';setTimeout(()=>t.remove(),300);},3000);
}

// ── PLANS RENDER ──
function renderPlans(){
  // Landing plans grid
  const g=document.getElementById('landing-plans');
  if(g) g.innerHTML=PLANS.map(p=>`
    <div class="plan-card ${p.recommended?'recommended':''}">
      ${p.recommended?'<div class="plan-badge">⭐ POPULAIRE</div>':''}
      <div class="plan-name">${p.name}</div>
      <div class="plan-price">${p.price===0?'0':''+p.price+'€'}</div>
      <div class="plan-period">${p.price===0?'Free':p.period}</div>
      <div class="plan-desc">${p.desc}</div>
      <ul class="plan-features">${p.features.map(f=>`<li>${f}</li>`).join('')}</ul>
      <button class="btn-plan-g ${p.recommended?'btn-plan-solid-g':'btn-plan-outline-g'}" onclick="${p.price===0?`openModal('signup-modal')`:`startPayment('${p.id}')`}">${p.price===0?'Get started for free':'Choose '+p.name+' →'}</button>
    </div>`).join('');

  // Signup plans
  const sg=document.getElementById('signup-plans-grid');
  if(sg) sg.innerHTML=PLANS.map(p=>`
    <div class="sp-card ${p.id==='free'?'selected':''}" onclick="selectSignupPlan(this,'${p.id}')">
      <div class="sp-plan">${p.name}</div>
      <div class="sp-price">${p.price===0?'0€':p.price+'€'}</div>
      <div class="sp-per">${p.price===0?'Free':p.period}</div>
      <div class="sp-feat">${p.features.slice(0,2).join('<br>')}</div>
    </div>`).join('');
}

function selectSignupPlan(el,planId){
  document.querySelectorAll('#signup-plans-grid .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedSignupPlan=planId;
}

// ── SHOWCASE DATA & RENDER ──
// No fake projects — only real publications from real users
let showcaseData=[];

function openProjectModal(id){
  const p=showcaseData.find(p=>p.id===id);
  if(!p)return;
  const overlay=document.getElementById('project-modal-overlay');
  const box=document.getElementById('project-modal-content');
  if(!overlay||!box)return;
  const avatarColor=getAvatarColor(p.authorId||p.author);
  box.innerHTML=`
    <div class="pmo-banner" style="background:${p.color||'var(--s2)'}">
      ${p.mediaUrl?`<img src="${p.mediaUrl}"/>`:''}
      <span style="position:relative;z-index:1">${p.emoji||'🚀'}</span>
      <button class="pmo-close" onclick="closeProjectModal()">✕</button>
    </div>
    <div class="pmo-body">
      <div class="pmo-cat">${p.type||p.cat||''}</div>
      <div class="pmo-name">${p.name}</div>
      ${p.hook?`<div class="pmo-hook">${p.hook}</div>`:''}
      <div class="pmo-desc">${p.desc||''}</div>
      ${p.tags&&p.tags.length?`<div class="pmo-tags">${p.tags.map(t=>`<span class="pmo-tag">#${t}</span>`).join('')}</div>`:''}
      ${p.url?`<a class="pmo-url" href="${p.url}" target="_blank" rel="noopener noreferrer">
        <span>🔗</span><span>${p.url.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span><span style="color:var(--g3)">↗</span>
      </a>`:''}
      <div class="pmo-footer">
        <div class="pmo-author">
          <div class="pmo-ava" style="background:${avatarColor}">${(p.author||'?')[0]}</div>
          <span>${p.author||'Anonyme'}</span>
          <span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span>
        </div>
        <div class="pmo-actions">
          <button class="pmo-btn ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this);this.querySelector('span').textContent=document.querySelector('[data-pid=\'${p.id}\'] .vote-count')?.textContent||'0'">
            ▲ <span>${p.votes||0}</span>
          </button>
          <button class="pmo-btn pmo-btn-dm" onclick="closeProjectModal();openDMToUser('${p.authorId}','${p.author}')">💬 DM</button>
        </div>
      </div>
    </div>`;
  overlay.classList.remove('hidden');
  document.body.style.overflow='hidden';
}
function closeProjectModal(){
  document.getElementById('project-modal-overlay')?.classList.add('hidden');
  document.body.style.overflow='';
}

function buildShowcaseGrid(containerId,filter='all'){
  const el=document.getElementById(containerId);
  if(!el)return;
  const data=filter==='all'?showcaseData:showcaseData.filter(p=>p.cat===filter);
  if(!data.length){el.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:48px;color:var(--muted)">'+'No posts yet'+'</div>';return;}
  el.innerHTML=data.map(p=>`
    <div class="v-card" data-pid="${p.id}" onclick="openProjectModal('${p.id}')">
      ${p.badge?`<div class="v-banner" style="background:${p.color}">${p.emoji}<div class="v-badge">${p.badge}</div></div>`:`<div class="v-banner" style="background:${p.color}">${p.emoji}</div>`}
      <div class="v-body">
        <div class="v-cat">${p.type}</div>
        <div class="v-name">${p.name}</div>
        <div class="v-desc">${p.desc}</div>
        ${p.url?`<a class="v-url-link" href="${p.url}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
          <span>🔗</span><span class="v-url-text">${p.url.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span><span style="font-size:11px">↗</span>
        </a>`:''}
        <div class="v-footer">
          <div class="v-author"><div class="v-ava">${p.author[0]}</div>${p.author}</div>
          <div class="v-actions">
            <button class="btn-vote-g ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this)">▲ <span class="vote-count">${p.votes}</span></button>
            <button class="btn-dm-small" onclick="openDMToUser('${p.authorId}','${p.author}')" title="Send a DM">💬</button>
          </div>
        </div>
      </div>
    </div>`).join('');
}

function filterLandingShowcase(el,filter){
  document.querySelectorAll('#showcase .filters-row .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildShowcaseGrid('landing-showcase-grid',filter);
}
function filterAppShowcase(el,filter){
  document.querySelectorAll('#tab-showcase .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildShowcaseGrid('app-showcase-grid',filter);
}

async function voteProject(e,id,btn){
  e.stopPropagation();
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  if(myVotes.has(id)){toast('You already voted!');return;}
  btn.classList.add('voted');
  const cnt=btn.querySelector('.vote-count');
  const proj=showcaseData.find(p=>p.id===id);
  if(proj)proj.votes++;
  if(cnt)cnt.textContent=(parseInt(cnt.textContent)||0)+1;
  myVotes.add(id);
  localStorage.setItem('vb_votes',JSON.stringify([...myVotes]));
  toast('👍 Vote counted!');
  // sync API
  try{await fetch('/api/projects/'+id+'/vote',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser.email})});}catch(e){}
}

// No fake posts — only real publications
const samplePosts=[];
let feedPosts=[];

// Load feed from API at startup
// Fetch with timeout to avoid blocking if server doesn't respond
function fetchWithTimeout(url,opts={},ms=4000){
  const ctrl=new AbortController();
  const tid=setTimeout(()=>ctrl.abort(),ms);
  return fetch(url,{...opts,signal:ctrl.signal}).finally(()=>clearTimeout(tid));
}

async function loadPostsFromAPI(){
  try{
    const r=await fetchWithTimeout('/api/posts');
    const apiPosts=await r.json();
    if(Array.isArray(apiPosts)) feedPosts=apiPosts;
  }catch(e){}
  buildFeed();
}

function buildFeed(filter='all'){
  const el=document.getElementById('feed-list');
  if(!el)return;
  // Update trending
  const tw = document.getElementById('trending-widget-container');
  if(tw) tw.innerHTML = renderTrendingWidget();
  let data=[...feedPosts];
  if(filter==='following')data=data.filter(p=>currentUser?.following?.includes(p.userId)||p.userId===currentUser?.id);
  if(filter==='top')data=data.sort((a,b)=>b.likes-a.likes);
  if(!data.length){el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted)">'+'No posts yet'+'</div>';return;}
  el.innerHTML=data.map(p=>{
    const plan=PLANS.find(pl=>pl.id===p.plan)||PLANS[0];
    const isMe=p.userId===currentUser?.email;
    const isElite=(p.plan||'free')==='elite';
    const timerHtml=p.timerEnd?`<span class="post-timer">⏱ <span class="post-timer-val" data-end="${p.timerEnd}">--:--</span></span>`:'';
    const actionClass=isElite?'btn-action elite-action':'btn-action';
    const likedByMe=p.myLike;
    const mediaHtml=p.mediaUrl?`${p.mediaType&&p.mediaType.startsWith('video')?`<video class="post-media-video" controls src="${p.mediaUrl}"></video>`:`<img class="post-media" src="${p.mediaUrl}" alt="media" onclick="window.open('${p.mediaUrl}','_blank')" style="cursor:zoom-in"/>`}`:'';
    return `
    <div class="post-card" id="post-${p.id}" data-pid="${p.id}">
      <div class="post-header">
        <div class="post-ava" style="background:${getAvatarColor(p.userId)}" onclick="viewUserProfile('${p.userId}')">${p.emoji||p.author[0]}</div>
        <div class="post-meta">
          <div class="post-author" onclick="viewUserProfile('${p.userId}')">${isElite?'<span class="badge-elite-gold">🏆</span> ':''} ${p.author}</div>
          <div class="post-info"><span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span> · ${p.time} ${timerHtml}</div>
        </div>
        ${!isMe?`<button class="btn-dm-small" onclick="openDMToUser('${p.userId}','${p.author}')" title="DM">💬</button>`:''}
        <button class="btn-report" onclick="openReport('${p.userId}','${p.author}')" title="Report">⚑</button>
      </div>
      <div class="post-content">${escHtml(p.text)}</div>
      ${mediaHtml}
      ${p.postUrl?`<a class="post-url-card" href="${p.postUrl}" target="_blank" rel="noopener noreferrer">
        <span class="post-url-icon">🔗</span>
        <span class="post-url-text">${p.postUrl.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span>
        <span class="post-url-arrow">↗</span>
      </a>`:''}
      ${p.projName?`<div class="post-project" onclick="void(0)">
        <div class="post-proj-icon">${p.projEmoji||'🚀'}</div>
        <div><div class="post-proj-name">${p.projName}</div><div class="post-proj-cat">${p.projType||'pub'}</div>${p.projDesc?`<div class="post-proj-desc">${p.projDesc}</div>`:''}</div>
      </div>`:''}
      <div class="post-actions">
        <button class="${actionClass} ${likedByMe?'active':''}" onclick="likePost('${p.id}',this)">❤️ <span class="like-count">${p.likes||0}</span></button>
        <button class="${actionClass}" onclick="openComments('${p.id}')">💬 <span class="comment-count">${p.comments||0}</span></button>
        <button class="${actionClass}" onclick="sharePost('${p.id}',this)">🔗 <span class="share-count">${p.shares||0}</span></button>
        ${isMe?`<button class="${actionClass}" onclick="deletePost('${p.id}')" style="margin-left:auto;color:#f87171">🗑</button><button class="${actionClass}" onclick="openBoostMyPost('${p.id}')" style="color:var(--gold)" title="Booster">🚀 Boost</button>`:''}
      </div>
      <div class="reactions-row">
        ${buildReactionsHTML(p)}
      </div>
    </div>`;
  }).join('');
  updateTimers();
}

function switchFeed(filter,el){
  document.querySelectorAll('.feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFeed(filter);
}

async function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  btn.classList.toggle('active');
  const cnt=btn.querySelector('.like-count');
  if(cnt)cnt.textContent=p.likes;
  if(p.myLike && currentUser){
    currentUser._todayLikes=(currentUser._todayLikes||0)+1;
    localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  }
  try{fetch('/api/posts/'+id+'/like',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser?.email||'anon'})});}catch(e){}
}

async function sharePost(id,btn){
  navigator.clipboard.writeText(window.location.origin+'#post-'+id).then(()=>toast('🔗 Link copied!'));
  const p=feedPosts.find(p=>p.id===id);
  if(p){p.shares=(p.shares||0)+1;const cnt=btn?.querySelector('.share-count');if(cnt)cnt.textContent=p.shares;}
  try{fetch('/api/posts/'+id+'/share',{method:'POST'});}catch(e){}
}

function openComments(id){
  toast('💬 Comments — coming soon!');
}

function deletePost(id){
  feedPosts=feedPosts.filter(p=>p.id!==id);
  document.getElementById('post-'+id)?.remove();
}

// ── SYSTÈME DE RÉACTIONS ──
const REACTIONS_FREE = [
  {type:'fire',   emoji:'🔥', label:'Feu',     color:'#f97316'},
  {type:'bulb',   emoji:'💡', label:'Idea',    color:'#facc15'},
  {type:'money',  emoji:'💸', label:'Cash',    color:'#4ade80'},
  {type:'clap',   emoji:'👏', label:'Bravo',   color:'#fb923c'},
];
const REACTIONS_PREMIUM = [
  {type:'rocket', emoji:'🚀', label:'Takeoff', color:'#818cf8', plan:'starter'},
  {type:'crown',  emoji:'👑', label:'Roi',      color:'#ffd700', plan:'pro'},
  {type:'gem',    emoji:'💎', label:'Gem',      color:'#22d3ee', plan:'pro'},
  {type:'eyes',   emoji:'👀', label:'Je regarde', color:'#a78bfa', plan:'elite'},
  {type:'zap',    emoji:'⚡', label:'Boost',   color:'#86efac', plan:'starter'},
  {type:'star',   emoji:'🌟', label:'Star',    color:'#ffd700', plan:'elite'},
];
const ALL_REACTIONS = [...REACTIONS_FREE, ...REACTIONS_PREMIUM];

function buildReactionsHTML(p){
  if(!p.reactions) p.reactions = {};
  const plan = currentUser?.plan||'free';
  const planOrder = {free:0, starter:1, pro:2, elite:3};
  const userLevel = planOrder[plan]||0;

  return ALL_REACTIONS.map(r => {
    const count = p.reactions[r.type]||0;
    const active = p['myReact_'+r.type] ? 'active-'+r.type : '';
    const isPremium = REACTIONS_PREMIUM.find(x=>x.type===r.type);
    const reqLevel = isPremium ? planOrder[isPremium.plan]||0 : 0;
    const locked = isPremium && userLevel < reqLevel;
    if(locked){
      return `<button class="react-btn premium-lock" onclick="reactLocked('${isPremium.plan}')">
        ${r.emoji} ${count>0?`<span class="react-count" style="color:var(--muted)">${count}</span>`:''}
        <span class="react-premium-tip">${r.label} · ${isPremium.plan.toUpperCase()} required</span>
      </button>`;
    }
    return `<button class="react-btn ${active}" onclick="toggleReaction('${p.id}','${r.type}',this)" style="${active?'border-color:'+r.color+';color:'+r.color:''}">
      ${r.emoji} <span class="react-count">${count||0}</span>
    </button>`;
  }).join('');
}

function toggleReaction(postId, type, btn){
  const p = feedPosts.find(x=>x.id===postId);
  if(!p) return;
  if(!p.reactions) p.reactions = {};
  const key = 'myReact_'+type;
  const was = p[key];
  p[key] = !was;
  p.reactions[type] = Math.max(0,(p.reactions[type]||0)+(was?-1:1));
  const r = ALL_REACTIONS.find(x=>x.type===type);
  const activeClass = 'active-'+type;
  btn.classList.toggle(activeClass, !was);
  if(!was){ btn.style.borderColor=r?.color||''; btn.style.color=r?.color||''; }
  else { btn.style.borderColor=''; btn.style.color=''; }
  btn.querySelector('.react-count').textContent = p.reactions[type]||0;
  if(!was && currentUser){
    currentUser._todayReacts = (currentUser._todayReacts||0)+1;
    localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  }
}

function reactLocked(plan){
  toast(`🔒 Reaction ${plan.toUpperCase()} — Upgrade to unlock!`, 'error');
  setTimeout(()=>openModal('pricing-modal'),800);
}

// ── MEDIA UPLOAD ──
async function handleMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('feed-media-preview');
  preview.style.display='block';
  preview.innerHTML='<div class="media-preview-item">⏳ Upload in progress...</div>';
  const fd=new FormData();
  fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingMediaUrl=d.url;
    const isVideo=file.type.startsWith('video');
    preview.innerHTML=`<div class="media-preview-item">${isVideo?`<video src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px"></video>`:`<img src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px;object-fit:cover"/>`} <span style="flex:1">${file.name}</span> <span class="remove-media" onclick="pendingMediaUrl=null;document.getElementById('feed-media-preview').innerHTML='';document.getElementById('feed-media-preview').style.display='none'">✕</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Error upload</div>';pendingMediaUrl=null;}
}

async function handleLandingMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('pl-media-preview');
  preview.innerHTML='<div class="media-preview-item">⏳ Upload in progress...</div>';
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingLandingMediaUrl=d.url;
    preview.innerHTML=`<div class="media-preview-item"><img src="${d.url}" style="max-width:100px;max-height:60px;border-radius:4px;object-fit:cover"/> <span style="flex:1">${file.name}</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Error upload</div>';}
}

async function handleGroupBgUpload(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupBgUrl=d.url;document.getElementById('grp-bg-preview').innerHTML=`<img src="${d.url}" style="width:100%;height:80px;object-fit:cover;border-radius:6px;margin-top:6px"/>`;}catch(e){}
}

async function handleGroupSettingsBg(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupSettingsBgUrl=d.url;}catch(e){}
}

async function handleGroupChatFeede(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    // Send as message with media
    const msg={text:'',mediaUrl:d.url,mediaType:file.type,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
    await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});
    loadGroupMessages(currentGroupId);
  }catch(e){}
}

// ── PUBLISH LANDING AD (avant account) ──
async function publishLandingAd(){
  const title=document.getElementById('pl-title').value.trim();
  const text=document.getElementById('pl-text').value.trim();
  if(!title||!text){toast('Please fill in the title and message.');return;}
  const type=document.getElementById('pl-type').value;
  const url=document.getElementById('pl-url').value.trim();
  const post={
    id:'p'+Date.now(),userId:'landing_'+Date.now(),author:'Visitur',
    emoji:'📢',plan:'free',text:title+'\n\n'+text,projName:title,projType:type,
    projEmoji:getTypeEmoji(type),projDesc:text.slice(0,80),projUrl:url,
    mediaUrl:pendingLandingMediaUrl,mediaType:pendingLandingMediaUrl?.match(/\.(mp4|webm|mov)/i)?'video/mp4':'image/jpeg',
    time:'Just now',likes:0,comments:0,shares:0,timerEnd:Date.now()+3600000
  };
  feedPosts.unshift(post);
  pendingLandingMediaUrl=null;
  closeModal('publish-landing-modal');
  try{await fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  toast('📢 Ad published! Create an account to manage your ads.');
  setTimeout(()=>openModal('signup-modal'),2000);
}

function openPublishLanding(){
  document.getElementById('pl-title').value='';
  document.getElementById('pl-text').value='';
  document.getElementById('pl-media-preview').innerHTML='';
  pendingLandingMediaUrl=null;
  openModal('publish-landing-modal');
}

// ── PUBLISH POST ──
let pubHourCount=0, pubHourReset=0;
function toggleUrlField(){
  const wrap=document.getElementById('pub-url-wrap');
  const trigger=document.getElementById('pub-url-trigger');
  if(wrap){wrap.style.display='block';if(trigger)trigger.style.display='none';document.getElementById('feed-url')?.focus();}
}
function closeUrlField(){
  const wrap=document.getElementById('pub-url-wrap');
  const trigger=document.getElementById('pub-url-trigger');
  if(wrap){wrap.style.display='none';const inp=document.getElementById('feed-url');if(inp)inp.value='';}
  if(trigger)trigger.style.display='inline-flex';
}

function selectPubType(el, type){
  document.querySelectorAll('.pub-type-pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  const sel=document.getElementById('feed-proj-type');
  if(sel) sel.value=type;
  const projWrap=document.getElementById('pub-proj-wrap');
  if(projWrap) projWrap.style.display=(type&&type!=='')?'block':'none';
}
function updateCharCount(el){
  const count=el.value.length;
  const display=document.getElementById('pub-char-count');
  if(display){
    display.style.opacity=count>0?'1':'0';
    display.textContent=count+'/500';
    display.style.color=count>450?'#f87171':count>350?'var(--gold)':'var(--muted2)';
  }
}
function autoGrowTA(el){
  el.style.height='auto';
  el.style.height=el.scrollHeight+'px';
}
// Show pills on textarea focus
document.addEventListener('DOMContentLoaded',function(){
  const ta=document.getElementById('feed-text');
  const row=document.getElementById('pub-type-row');
  if(ta&&row){
    ta.addEventListener('focus',function(){row.classList.add('visible');});
  }
});

function publishPost(){
  if(currentUser&&currentUser.isDemo){openDemoSignupModal();return;}
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const text=document.getElementById('feed-text')?.value.trim()||'';
  if(!text){toast(t('toast_write'));return;}

  // Check limits
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const now=Date.now();
  if(currentUser.plan==='free'){
    if(now-pubHourReset>3600000){pubHourCount=0;pubHourReset=now;}
    if(pubHourCount>=1){toast(t('toast_limit_free'));return;}
  } else if(plan.limits.pubsPerDay){
    const today=new Date().toDateString();
    const key='vb_pubs_'+today;
    const count=parseInt(localStorage.getItem(key)||'0');
    if(count>=plan.limits.pubsPerDay){toast(t('toast_limit_day'));return;}
    localStorage.setItem(key,count+1);
  }

  const projName=document.getElementById('feed-proj-name')?.value.trim()||'';
  const projType=document.getElementById('feed-proj-type')?.value||'';
  let postUrl=document.getElementById('feed-url')?.value.trim()||'';
  // Add https:// si manquant
  if(postUrl && !postUrl.startsWith('http')) postUrl='https://'+postUrl;
  const timerEnd=currentUser.plan==='free'?Date.now()+3600000:null;

  const post={
    id:'p'+Date.now(),userId:currentUser.email,author:currentUser.name,
    emoji:currentUser.avatar||'🙂',plan:currentUser.plan||'free',
    text,projName,projType,projEmoji:getTypeEmoji(projType),projDesc:'',
    postUrl,
    mediaUrl:pendingMediaUrl,mediaType:pendingMediaUrl?'image':'',
    time:'Just now',likes:0,comments:0,shares:0,myLike:false,timerEnd
  };
  feedPosts.unshift(post);
  pubHourCount++;
  // Tracker for badges
  currentUser._postCount = (currentUser._postCount||0) + 1;
  currentUser._todayPosts = (currentUser._todayPosts||0) + 1;
  // Tracker médias for missions
  if(pendingMediaUrl){
    const isVideo = post.mediaType && post.mediaType.startsWith('video');
    const isFeed = pendingMediaUrl && /\.(pdf|doc|docx|zip|txt|ppt|xls)/i.test(pendingMediaUrl);
    if(isVideo) currentUser._todayVideoPosts = (currentUser._todayVideoPosts||0)+1;
    else if(isFeed) currentUser._todayFeedePosts = (currentUser._todayFeedePosts||0)+1;
    else currentUser._todayMediaPosts = (currentUser._todayMediaPosts||0)+1;
  }
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();
  pendingMediaUrl=null;
  if(document.getElementById('feed-text')) document.getElementById('feed-text').value='';
  if(document.getElementById('feed-proj-name')) document.getElementById('feed-proj-name').value='';
  closeUrlField();
  document.getElementById('feed-media-preview').innerHTML='';
  document.getElementById('feed-media-preview').style.display='none';
  buildFeed();
  toast(t('toast_published'));
  // Sync API
  try{fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  if(timerEnd)setTimeout(()=>{feedPosts=feedPosts.filter(p=>p.id!==post.id);buildFeed();},3600000);
}

async function handlePubMediaUpload(input){
  const file = input.files[0]; if(!file) return;
  const preview = document.getElementById('pub-media-preview');
  preview.innerHTML = '<div class="media-preview-item">⏳ Upload in progress...</div>';
  const fd = new FormData(); fd.append('file', file);
  try{
    const r = await fetch('/api/upload',{method:'POST',body:fd});
    const d = await r.json(); pendingPubMediaUrl = d.url;
    // Update showcase preview with image
    const imgWrap = document.getElementById('pub-preview-img-wrap');
    const imgEl = document.getElementById('pub-preview-img');
    if(imgWrap && imgEl){ imgEl.src = d.url; imgWrap.style.display = 'block'; }
    preview.innerHTML = `<div class="media-preview-item" style="display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:8px 12px">
      <img src="${d.url}" style="width:48px;height:36px;border-radius:4px;object-fit:cover"/>
      <span style="font-size:12px;color:var(--g4)">✅ ${file.name.slice(0,30)}</span>
      <button onclick="removePubMedia()" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px">✕</button>
    </div>`;
    updatePubCompletion();
  }catch(e){
    // Fallback local preview si no backend
    const url = URL.createObjectURL(file); pendingPubMediaUrl = url;
    const imgWrap = document.getElementById('pub-preview-img-wrap');
    const imgEl = document.getElementById('pub-preview-img');
    if(imgWrap && imgEl){ imgEl.src = url; imgWrap.style.display = 'block'; }
    preview.innerHTML = `<div class="media-preview-item" style="display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:8px 12px">
      <img src="${url}" style="width:48px;height:36px;border-radius:4px;object-fit:cover"/>
      <span style="font-size:12px;color:var(--g4)">📎 ${file.name.slice(0,30)}</span>
      <button onclick="removePubMedia()" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px">✕</button>
    </div>`;
    updatePubCompletion();
  }
  // Rendre la zone de drop cliquable
  document.getElementById('pub-media-drop')?.addEventListener('click', ()=>document.getElementById('pub-media-input')?.click());
}
function removePubMedia(){
  pendingPubMediaUrl = null;
  document.getElementById('pub-media-preview').innerHTML = '';
  const imgWrap = document.getElementById('pub-preview-img-wrap');
  if(imgWrap) imgWrap.style.display = 'none';
  updatePubCompletion();
}

// ── PUBLISH PROJECT ──
function publishProject(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const name = document.getElementById('pub-name')?.value.trim()||'';
  const desc = document.getElementById('pub-desc')?.value.trim()||'';
  if(!name || !desc){ toast('Fill in at least the name and description.', 'error'); return; }
  if(name.length < 4){ toast('The name is too short (4 characters min).', 'error'); return; }
  if(desc.length < 20){ toast('The description is too short (20 characters min).', 'error'); return; }

  const type = document.getElementById('pub-type')?.value||'';
  const emoji = document.getElementById('pub-emoji')?.value || getTypeEmoji(type);
  const url = document.getElementById('pub-url')?.value.trim() || '';
  const target = document.getElementById('pub-target')?.value.trim() || '';
  const hook = document.getElementById('pub-hook')?.value.trim() || '';
  const tags = (document.getElementById('pub-tags')?.value || '').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const stage = document.getElementById('pub-stage')?.value || '';
  const collabNeed = document.getElementById('pub-collab-need')?.value || '';
  const plan = PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const colors = ['linear-gradient(135deg,#15803d,#22c55e)','linear-gradient(135deg,#166534,#4ade80)','linear-gradient(135deg,#14532d,#86efac)'];

  const proj = {
    id:'pub'+Date.now(), name, cat:type, type:typeName(type),
    desc: desc.slice(0,300), hook, emoji, url, target, tags, stage, collabNeed,
    color: colors[Math.floor(Math.random()*colors.length)],
    author: currentUser.name, authorId: currentUser.email,
    plan: currentUser.plan || 'free',
    votes: 0, mediaUrl: pendingPubMediaUrl,
    timerEnd: plan.limits.showcaseHours < 999999 ? Date.now() + plan.limits.showcaseHours*3600000 : null,
    createdAt: Date.now()
  };

  pendingPubMediaUrl = null;
  document.getElementById('pub-media-preview').innerHTML = '';
  const imgWrap = document.getElementById('pub-preview-img-wrap');
  if(imgWrap) imgWrap.style.display = 'none';
  showcaseData.unshift(proj);
  buildShowcaseGrid('app-showcase-grid');
  buildShowcaseGrid('landing-showcase-grid');

  // Reset form
  ['pub-name','pub-desc','pub-hook','pub-url','pub-target','pub-tags'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  updatePubCompletion(); updateDescCount(); renderTagsPreview(); updateMobilePreview();
  // Reset wizard vers step 1
  wizGoTo(1);

  // Badges & missions
  currentUser._postCount = (currentUser._postCount||0) + 1;
  currentUser._todayPosts = (currentUser._todayPosts||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();

  // Save & sync
  const saved = JSON.parse(localStorage.getItem('vb_my_projects')||'[]');
  saved.unshift(proj); localStorage.setItem('vb_my_projects', JSON.stringify(saved));
  try{ fetch('/api/projects',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(proj)}); }catch(e){}

  // Confirmation with tip
  toast('🌐 Project published on Showcase! Share the link in chat to get your first votes 🚀');
}

async function generateBoostForProject(){
  const name=document.getElementById('pub-name')?.value.trim()||'Mon project';
  const desc=document.getElementById('pub-desc')?.value.trim()||'Project digital';
  const type=document.getElementById('pub-type')?.value||'';
  const target=document.getElementById('pub-target')?.value.trim()||'Grand public';
  const btn=document.getElementById('btn-pub-project');
  btn.disabled=true;
  const outBox=document.getElementById('pub-strategy');
  outBox.style.display='block';
  outBox.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:`You are a digital marketing expert. Generate a promotion strategy for:\n- Project: ${name} (${type})\n- Target: ${target}\n- Description: ${desc}\n\nProvide: TikTok hashtags, 2-week content calendar, 3 viral post ideas, 5 SEO keywords.`})});
    const data=await res.json();
    outBox.textContent=data.content;
  }catch(e){outBox.textContent='Connect the Render backend to generate AI strategies.';}
  btn.disabled=false;
}

// ── WORLD CHAT ──
let chatMsgsToday=parseInt(localStorage.getItem('vb_chat_today_'+new Date().toDateString())||'0');

function buildWorldChat(){
  const el=document.getElementById('world-chat-msgs');
  if(!el)return;
  const msgs=[...worldChatMsgs];
  if(!msgs.length){
    el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Be the first to write in the chat! 👋</div>';
    return;
  }
  el.innerHTML=msgs.map(m=>`
    <div class="chat-msg-item">
      <div class="chat-msg-name">${m.name} <span class="chat-msg-plan-badge plan-${m.plan}">${m.plan.toUpperCase()}</span> <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.time||''}</span></div>
      <div class="chat-msg-text">${escHtml(m.text)}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
  // Update online count
  const onlineEl=document.getElementById('world-online-count');
  if(onlineEl)onlineEl.textContent=(12+Math.floor(Math.random()*8))+' online';
}

function sendWorldChat(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const inp=document.getElementById('world-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const today=new Date().toDateString();
  if(chatMsgsToday>=plan.limits.chatMsgs){
    document.getElementById('world-chat-upgrade').style.display='flex';
    toast('Message limit reached! Upgrade your plan.');
    return;
  }
  chatMsgsToday++;
  localStorage.setItem('vb_chat_today_'+today,chatMsgsToday);
  document.getElementById('chat-msgs-left').textContent=Math.max(0,plan.limits.chatMsgs-chatMsgsToday);
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  worldChatMsgs.push({name:currentUser.name,plan:currentUser.plan||'free',text,time});
  inp.value='';
  buildWorldChat();
  // WS send
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'message',name:currentUser.name,plan:currentUser.plan||'free',text}));
  }
}

// ── PROFILE ──
function renderMyProfile(){
  const el=document.getElementById('my-profile-view');
  if(!el||!currentUser)return;
  const u=currentUser;
  const ava=u.avatar||'🙂';
  const followers=(u.followers||[]).length;
  const following=(u.following||[]).length;
  el.innerHTML=`
    <div class="profile-banner" style="background:linear-gradient(135deg,${getAvatarColor(u.email)},var(--s3))">
      <div class="profile-avatar" style="background:${getAvatarColor(u.email)}">${u.avatarUrl?`<img src="${u.avatarUrl}" style="width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:50%;" />`:`<span style="line-height:1">${ava}</span>`}</div>
      <button class="profile-edit-btn" onclick="openEditProfile()">✏️ Edit</button>
      ${u.plan==='elite'?`<button class="btn-contact-admin" style="position:absolute;bottom:14px;right:14px" onclick="openContactAdmin()">📩 Admin</button>`:''}
    </div>
    <div class="profile-info">
      <div class="profile-name" style="${getFollowerNameStyle(followers)}">${u.name||'Utilisateur'}${getVerifiedBadge(u)}</div>
      <div class="profile-handle">@${u.username||u.email.split('@')[0]} · <span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></div>
      <div class="profile-bio">${u.bio||'<span style="color:var(--muted2)">Add a bio in "Edit my profile"</span>'}</div>
      ${u.tags&&u.tags.length?`<div class="profile-tags">${u.tags.map(t=>`<span class="profile-tag">${t}</span>`).join('')}</div>`:''}
      <div class="profile-stats">
        <div class="pstat"><div class="pstat-num">${followers}</div><div class="pstat-label">Followers</div></div>
        <div class="pstat"><div class="pstat-num">${following}</div><div class="pstat-label">Plans</div></div>
        <div class="pstat"><div class="pstat-num">${(u.projects||[]).length}</div><div class="pstat-label">Projects</div></div>
        <div class="pstat"><div class="pstat-num">${u.totalVotes||0}</div><div class="pstat-label">Votes received</div></div>
      </div>
      ${renderProfileLinks(u)}
      ${renderProfileFields(u)}
    </div>
    <div style="margin-top:16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
      <div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;margin-bottom:4px">ABONNEMENT ACTUEL</div>
        <div style="font-size:18px;font-weight:800;color:var(--g3)">${(u.plan||'free').toUpperCase()}</div>
        ${u.plan==='free'?'<div style="font-size:11px;color:var(--muted);margin-top:2px">Free forever</div>':'<div style="font-size:11px;color:var(--g4);margin-top:2px">Plan active</div>'}
      </div>
      ${u.plan==='free'?'<button onclick="showAppTab(\'boost-credits\',null);switchCreditsTab(\'shop\',document.getElementById(\'ctab-shop\'))" style="padding:9px 18px;background:var(--g2);border:none;border-radius:8px;font-family:Plus Jakarta Sans,sans-serif;font-size:12px;font-weight:700;color:var(--bg);cursor:pointer">Upgrade my plan →</button>':'<span style="font-size:11px;color:var(--muted2)">Thank you for your trust 🙏</span>'}
    </div>
    ${renderSoldes(u)}
    <div style="margin-top:24px">
      <h3 style="font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:12px">MY POSTS</h3>
      <div id="my-posts-feed">${feedPosts.filter(p=>p.userId===u.email).length===0?'<div style="color:var(--muted);font-size:13px">No posts yet.</div>':''}</div>
    </div>
    ${renderBadges(u)}`;
  // Render my posts
  const myPosts=feedPosts.filter(p=>p.userId===u.email);
  const mpEl=document.getElementById('my-posts-feed');
  if(mpEl&&myPosts.length){
    mpEl.innerHTML=myPosts.map(p=>`<div class="post-card" style="margin-bottom:10px"><div class="post-content">${escHtml(p.text)}</div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:8px">${p.time} · ❤️ ${p.likes}</div></div>`).join('');
  }
}


function getFollowerNameStyle(followers){
  if(followers>=100000) return 'color:#ffd700;text-shadow:0 0 20px rgba(255,215,0,0.6);';
  if(followers>=10000)  return 'color:#c0a060;';
  if(followers>=1000)   return 'color:#22c55e;';
  if(followers>=100)    return 'color:#86efac;';
  return '';
}

function renderSoldes(u){
  const followers = (u.followers||[]).length;
  const pct = Math.min(100, Math.round(followers/10));
  const salesEnabled = u.salesEnabled || false;
  const inp = "width:100%;padding:9px 12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;font-family:Plus Jakarta Sans,sans-serif;font-size:13px;color:var(--white);outline:none";

  if(followers < 1000){
    return '<div style="margin-top:24px;background:linear-gradient(135deg,rgba(255,215,0,0.06),rgba(255,140,0,0.03));border:1.5px solid rgba(255,215,0,0.2);border-radius:14px;padding:20px 22px;display:flex;align-items:center;gap:14px">'
      +'<span style="font-size:28px">💰</span>'
      +'<div style="flex:1">'
      +'<div style="font-size:13px;font-weight:800;color:#ffd700;margin-bottom:4px">Sales — Monetize your community</div>'
      +'<div style="font-size:11px;color:var(--muted);line-height:1.6">Available from <strong style="color:var(--white)">1,000 followers</strong>. You have <strong style="color:var(--g3)">'+followers+'</strong>.</div>'
      +'<div style="margin-top:10px;background:var(--s2);border-radius:6px;height:6px;overflow:hidden">'
      +'<div style="height:100%;width:'+pct+'%;background:linear-gradient(90deg,var(--g2),var(--g4))"></div></div>'
      +'<div style="font-size:10px;color:var(--muted2);margin-top:4px">'+followers+'/1000 followers</div>'
      +'</div></div>';
  }

  const toggleBg = salesEnabled ? 'var(--g2)' : 'var(--s3)';
  const toggleBorder = salesEnabled ? 'var(--g3)' : 'var(--border)';
  const toggleLeft = salesEnabled ? '20px' : '2px';

  let html = '<div style="margin-top:24px;background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.35);border-radius:14px;padding:20px 22px">'
    +'<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px">'
    +'<div style="display:flex;align-items:center;gap:10px"><span style="font-size:28px">💰</span>'
    +'<div><div style="font-size:14px;font-weight:800;color:#ffd700">Sales unlocked!</div>'
    +'<div style="font-size:11px;color:var(--muted)">Monetize your community of '+followers+' followers</div></div></div>'
    +'<label style="display:flex;align-items:center;gap:8px;cursor:pointer">'
    +'<span style="font-size:11px;color:var(--muted)">Enable sales</span>'
    +'<div onclick="toggleSales()" style="width:44px;height:24px;border-radius:12px;background:'+toggleBg+';position:relative;flex-shrink:0;border:1.5px solid '+toggleBorder+'">'
    +'<div style="position:absolute;top:2px;left:'+toggleLeft+';width:18px;height:18px;border-radius:50%;background:white"></div>'
    +'</div></label></div>';

  if(salesEnabled){
    html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px">'
      +'<div class="fg"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Offer name</label>'
      +'<input id="sale-title" type="text" placeholder="ex: TikTok Audit 30 min" value="'+(u.saleTitle||'')+'" style="'+inp+'" oninput="saveSaleField(&apos;saleTitle&apos;,this.value)"/></div>'
      +'<div class="fg"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Price (€)</label>'
      +'<input id="sale-price" type="number" min="1" placeholder="29" value="'+(u.salePrice||'')+'" style="'+inp+'" oninput="saveSaleField(&apos;salePrice&apos;,this.value)"/></div>'
      +'<div style="grid-column:1/-1"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Description</label>'
      +'<textarea id="sale-desc" placeholder="Describe your offer..." style="'+inp+';resize:none;min-height:56px" oninput="saveSaleField(&apos;saleDesc&apos;,this.value)">'+(u.saleDesc||'')+'</textarea></div>'
      +'<div style="grid-column:1/-1"><label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">Payment link (Stripe, PayPal...)</label>'
      +'<input id="sale-link" type="url" placeholder="https://buy.stripe.com/..." value="'+(u.saleLink||'')+'" style="'+inp+'" oninput="saveSaleField(&apos;saleLink&apos;,this.value)"/></div>'
      +'</div>'
      +'<div style="background:var(--s1);border:1px solid var(--border2);border-radius:10px;padding:14px;font-size:12px;color:var(--muted)">🎯 Your offer will be visible on your public profile.</div>';
  } else {
    html += '<div style="font-size:12px;color:var(--muted);text-align:center;padding:10px 0">Enable sales to configure your offer.</div>';
  }

  html += '</div>';
  return html;
}

function toggleSales(){
  if(!currentUser)return;
  currentUser.salesEnabled = !currentUser.salesEnabled;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  renderMyProfile();
}

function saveSaleField(key, val){
  if(!currentUser)return;
  currentUser[key] = val;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
}

function renderProfileLinks(u){
  const links=[];
  if(u.website)links.push(`<a class="profile-link" href="${u.website}" target="_blank">🌐 Website</a>`);
  if(u.tiktok)links.push(`<a class="profile-link" href="https://tiktok.com/@${u.tiktok.replace('@','')}" target="_blank">🎵 ${u.tiktok}</a>`);
  if(u.instagram)links.push(`<a class="profile-link" href="https://instagram.com/${u.instagram.replace('@','')}" target="_blank">📸 ${u.instagram}</a>`);
  if(u.twitter)links.push(`<a class="profile-link" href="https://twitter.com/${u.twitter.replace('@','')}" target="_blank">🐦 ${u.twitter}</a>`);
  if(u.linkedin)links.push(`<a class="profile-link" href="${u.linkedin}" target="_blank">💼 LinkedIn</a>`);
  if(u.youtube)links.push(`<a class="profile-link" href="https://youtube.com/@${u.youtube.replace('@','')}" target="_blank">▶️ ${u.youtube}</a>`);
  if(!links.length)return '';
  return `<div class="profile-links" style="margin-bottom:16px">${links.join('')}</div>`;
}

function renderProfileFields(u){
  const fields=[];
  if(u.title)fields.push({l:'Title',v:u.title});
  if(u.location)fields.push({l:'Location',v:u.location});
  if(u.niche)fields.push({l:'Niche',v:u.niche});
  if(u.exp)fields.push({l:'Experience',v:u.exp});
  if(u.dispo)fields.push({l:'Availability',v:u.dispo});
  if(u.goal)fields.push({l:'Goal',v:u.goal});
  if(u.skills)fields.push({l:'Skills',v:u.skills});
  if(u.tools)fields.push({l:'Tools',v:u.tools});
  if(u.langs)fields.push({l:'Languages',v:u.langs});
  if(u.tiktokCount)fields.push({l:'TikTok followers',v:u.tiktokCount});
  if(u.igCount)fields.push({l:'Instagram followers',v:u.igCount});
  if(u.revenue)fields.push({l:'Monthly revenue',v:u.revenue});
  if(!fields.length)return '';
  return `<div class="profile-fields">${fields.map(f=>`<div class="pfield"><div class="pfield-label">${f.l}</div><div class="pfield-value">${f.v}</div></div>`).join('')}</div>`;
}

function openEditProfile(){
  if(!currentUser)return;
  if(currentUser.isDemo){openDemoSignupModal();return;}
  const u=currentUser;
  const fields={name:'ep-name',username:'ep-username',title:'ep-title',location:'ep-location',bio:'ep-bio',niche:'ep-niche',goal:'ep-goal',skills:'ep-skills',tools:'ep-tools',langs:'ep-langs',website:'ep-website',tiktok:'ep-tiktok',instagram:'ep-instagram',twitter:'ep-twitter',linkedin:'ep-linkedin',youtube:'ep-youtube',tiktokCount:'ep-tiktok-count',igCount:'ep-ig-count',projectsCount:'ep-projects-count',sales:'ep-sales',looking:'ep-looking'};
  Object.entries(fields).forEach(([key,id])=>{const el=document.getElementById(id);if(el&&u[key])el.value=u[key];});
  if(u.exp){const sel=document.getElementById('ep-exp');if(sel)for(let o of sel.options)if(o.value===u.exp||o.text===u.exp)sel.value=o.value;}
  if(u.dispo){const sel=document.getElementById('ep-dispo');if(sel)for(let o of sel.options)if(o.text===u.dispo)sel.value=o.value;}
  if(u.revenue){const sel=document.getElementById('ep-revenue');if(sel)for(let o of sel.options)if(o.text===u.revenue)sel.value=o.value;}
  // Restore avatar in form
  const avaEl = document.getElementById('edit-ava-emoji');
  const avaImg = document.getElementById('edit-ava-img');
  if(u.avatarUrl && avaImg){ avaImg.src=u.avatarUrl; avaImg.style.display='block'; if(avaEl) avaEl.style.display='none'; }
  else if(avaEl){ avaEl.textContent=u.avatar||'🙂'; if(avaImg) avaImg.style.display='none'; }
  openModal('edit-profile-modal');
}

function selectEmoji(el,emoji){
  document.querySelectorAll('.emoji-opt').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  const prev = document.getElementById('edit-ava-preview');
  const emojiSpan = document.getElementById('edit-ava-emoji');
  const imgEl = document.getElementById('edit-ava-img');
  if(emojiSpan) emojiSpan.textContent = emoji;
  if(imgEl){ imgEl.style.display='none'; if(emojiSpan) emojiSpan.style.display=''; }
  if(currentUser) currentUser._pendingEmoji = emoji;
}

function selectEmojiPremium(el, emoji, requiredPlan){
  const planOrder = {free:0, starter:1, pro:2, elite:3};
  const userLevel = planOrder[currentUser?.plan||'free']||0;
  const reqLevel = planOrder[requiredPlan]||0;
  if(userLevel < reqLevel){
    toast(`🔒 Avatar ${requiredPlan.toUpperCase()} — Upgrade required!`, 'error');
    setTimeout(()=>openModal('pricing-modal'), 800);
    return;
  }
  selectEmoji(el, emoji);
}

async function handleAvatarUpload(input){
  const file = input.files[0];
  if(!file) return;
  const imgEl = document.getElementById('edit-ava-img');
  const emojiSpan = document.getElementById('edit-ava-emoji');
  // Preview local immédiat
  const url = URL.createObjectURL(file);
  if(imgEl){ imgEl.src=url; imgEl.style.display='block'; }
  if(emojiSpan) emojiSpan.style.display='none';
  const overlay=document.querySelector('.ava-upload-overlay'); if(overlay) overlay.style.display='none';
  document.getElementById('edit-ava-preview')?.classList.add('has-photo');
  // Tenter upload serveur
  try{
    const fd = new FormData(); fd.append('file', file);
    const r = await fetch('/api/upload', {method:'POST', body:fd});
    const d = await r.json();
    if(d.url && currentUser){ currentUser.avatarUrl = d.url; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
  }catch(e){ /* keep local preview */ }
  if(currentUser){ currentUser._pendingAvatarUrl = url; }
  toast('📷 Profile photo updated!');
}

function saveProfile(){
  if(!currentUser)return;
  const sel=document.getElementById('ep-exp');
  const selD=document.getElementById('ep-dispo');
  const selR=document.getElementById('ep-revenue');
  Object.assign(currentUser,{
    name:document.getElementById('ep-name').value.trim()||currentUser.name,
    username:document.getElementById('ep-username').value.trim().replace('@',''),
    title:document.getElementById('ep-title').value.trim(),
    location:document.getElementById('ep-location').value.trim(),
    bio:document.getElementById('ep-bio').value.trim(),
    niche:document.getElementById('ep-niche').value.trim(),
    exp:sel?sel.options[sel.selectedIndex].text:'',
    dispo:selD?selD.options[selD.selectedIndex].text:'',
    revenue:selR?selR.options[selR.selectedIndex].text:'',
    goal:document.getElementById('ep-goal').value.trim(),
    skills:document.getElementById('ep-skills').value.trim(),
    tools:document.getElementById('ep-tools').value.trim(),
    langs:document.getElementById('ep-langs').value.trim(),
    website:document.getElementById('ep-website').value.trim(),
    tiktok:document.getElementById('ep-tiktok').value.trim(),
    instagram:document.getElementById('ep-instagram').value.trim(),
    twitter:document.getElementById('ep-twitter').value.trim(),
    linkedin:document.getElementById('ep-linkedin').value.trim(),
    youtube:document.getElementById('ep-youtube').value.trim(),
    tiktokCount:document.getElementById('ep-tiktok-count').value.trim(),
    igCount:document.getElementById('ep-ig-count').value.trim(),
    looking:document.getElementById('ep-looking').value.trim(),
    avatar:document.getElementById('edit-ava-preview').textContent||'🙂',
    tags:[currentUser.niche,currentUser.dispo].filter(Boolean)
  });
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  _saveAccount(currentUser);
  closeModal('edit-profile-modal');
  updateAppBar();
  renderMyProfile();
  toast('✅ Profile updated!');
}

// ── FOLLOWERS ──
// No fake users — only real members
const sampleUsers=[];

async function buildFollowList(type='followers'){
  const el=document.getElementById('follow-list-container');
  if(!el)return;
  const myFollowers=currentUser?.followers||[];
  const myFollowing=currentUser?.following||[];
  let users=[];
  try{
    const r=await fetchWithTimeout('/api/admin/all-users');
    const allUsers=await r.json();
    if(type==='followers') users=(allUsers||[]).filter(u=>myFollowers.includes(u.email||u.id));
    if(type==='following') users=(allUsers||[]).filter(u=>myFollowing.includes(u.email||u.id));
    if(type==='discover') users=(allUsers||[]).filter(u=>(u.email||u.id)!==currentUser?.email).slice(0,20);
  }catch(e){}
  if(!users.length){
    const msgs={followers:'You have no followers yet.',following:'You are not following anyone yet.',discover:'No other creators registered yet.'};
    el.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">${msgs[type]||''}</div>`;
    document.getElementById('followers-count').textContent=myFollowers.length;
    document.getElementById('following-count').textContent=myFollowing.length;
    return;
  }
  el.innerHTML=users.map(u=>`
    <div class="follow-item">
      <div class="follow-item-ava" style="background:${getAvatarColor(u.email||u.id)}">${u.avatar||u.name?.[0]||'🙂'}</div>
      <div style="flex:1">
        <div class="follow-item-name">${escHtml(u.name||'Creator')}</div>
        <div class="follow-item-sub">${escHtml(u.bio||'')}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px"><span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'free').toUpperCase()}</span></div>
      </div>
      <button class="btn-dm-list" onclick="openDMToUser('${u.email||u.id}','${escHtml(u.name||'?')}')" title="DM">💬</button>
      <button class="btn-follow-list ${myFollowing.includes(u.email||u.id)?'following':''}" onclick="toggleFollow(this,'${u.email||u.id}')">${myFollowing.includes(u.email||u.id)?'Following ✓':'Follow'}</button>
    </div>`).join('');
  document.getElementById('followers-count').textContent=myFollowers.length;
  document.getElementById('following-count').textContent=myFollowing.length;
}

function switchFollowTab(type,el){
  document.querySelectorAll('#tab-abonnes .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFollowList(type);
}

function toggleFollow(btn,userId){
  if(!currentUser)return;
  currentUser.following=currentUser.following||[];
  if(currentUser.following.includes(userId)){
    currentUser.following=currentUser.following.filter(id=>id!==userId);
    btn.textContent='Follow';btn.classList.remove('following');
    toast('Unfollowed');
  } else {
    currentUser.following.push(userId);
    btn.textContent='Suivi ✓';btn.classList.add('following');
    toast('✅ Followed!');
  }
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  document.getElementById('following-count').textContent=currentUser.following.length;
}

// ── DM ──
function openDMToUser(userId,name){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  if(userId===currentUser.email){toast('You can\'t DM yourself 😄');return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='To: '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function openDMToUser(userId,name){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='To: '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function renderDMThread(userId){
  const el=document.getElementById('dm-msgs-list');
  const thread=dmThreads[userId]||[];
  if(!thread.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Start of conversation 👋</div>';return;}
  el.innerHTML=thread.map(m=>`
    <div class="dm-msg ${m.fromMe?'mine':'theirs'}">
      <div class="dm-bubble-g">${escHtml(m.text)}</div>
      <div class="dm-time">${m.time}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
}

function sendDM(){
  if(!dmTarget||!currentUser)return;
  const inp=document.getElementById('dm-input');
  const text=inp.value.trim();
  if(!text)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  if(!dmThreads[dmTarget.id])dmThreads[dmTarget.id]=[];
  dmThreads[dmTarget.id].push({fromMe:true,text,time});
  inp.value='';
  // Tracker for badges
  currentUser._dmCount = (currentUser._dmCount||0) + 1;
  currentUser._todayDMs = (currentUser._todayDMs||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();
  renderDMThread(dmTarget.id);
  // WS
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'dm',toId:dmTarget.id,fromName:currentUser.name,fromPlan:currentUser.plan||'free',text}));
  }
}

// ── IA BOOST ──
function selectBoostType(el,type){
  document.querySelectorAll('#tab-ia-boost .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostType=type;
}

const boostPrompts={
  social:(n,t,d,g)=>`TikTok/Instagram growth hacking expert. Strategy for:\n- Project: ${n}\n- Target: ${t}\n- Description: ${d}\n- Goal: ${g}\n\nProvide: 5 viral video scripts, 20 hashtags, 30-day calendar, best posting times.`,
  seo:(n,t,d,g)=>`SEO expert. Plan for:\n- Project: ${n}\n- Target: ${t}\n- Description: ${d}\n\nProvide: 20 keywords, 5 article topics, backlink strategy, on-page checklist.`,
  ads:(n,t,d,g)=>`Ad copywriting expert. Create for:\n- Project: ${n}\n- Target: ${t}\n\nProvide: 3 Facebook Ads, 3 TikTok Ads scripts (30s), 3 Google ads, 5 Instagram hooks.`,
  email:(n,t,d,g)=>`Email marketing expert. Sequence for:\n- Project: ${n}\n- Target: ${t}\n\nProvide: 5 complete emails (welcome D0, value D3, proof D7, promo D14, follow-up D30).`,
  strategy:(n,t,d,g)=>`Digital strategy consultant. 90-day plan for:\n- Project: ${n}\n- Target: ${t}\n- Goal: ${g}\n\nProvide: SWOT analysis, SMART goals, month 1/2/3 actions, estimated budget.`,
  coach:(n,t,d,g)=>`You are an expert marketing coach. Give personalized advice for:\n- Project: ${n}\n- Description: ${d}\n- Goal: ${g}\n\nConcrete, actionable, prioritized advice.`
};

async function runIABoost(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const name=document.getElementById('boost-name').value.trim()||'Mon project';
  const target=document.getElementById('boost-target').value.trim()||'Grand public';
  const desc=document.getElementById('boost-desc').value.trim()||'Project digital';
  const goal=document.getElementById('boost-goal').value.trim()||'Grow';
  const btn=document.getElementById('btn-ia-boost');
  btn.disabled=true;btn.textContent='⚡ Generating...';
  const out=document.getElementById('boost-output-box');
  const txt=document.getElementById('boost-output-text');
  out.style.display='block';
  txt.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:boostPrompts[selectedBoostType](name,target,desc,goal)})});
    const data=await res.json();
    txt.textContent=data.content;
    toast('✅ Strategy generated!');
  }catch(e){txt.textContent='Connect the Render backend to generate complete AI strategies.';}
  btn.disabled=false;btn.textContent='⚡ Generate my strategy';
}

// ── AUTH ──
function signup(){
  const email=document.getElementById('s-email').value.trim();
  const pass=document.getElementById('s-pass').value;
  if(!email||!pass){toast('Please fill in your email and password.');return;}
  if(!email.includes('@')){toast('Email invalide.');return;}
  if(pass.length<8){toast('Password too short (8 chars min).');return;}
  const name = email.split('@')[0];
  const username = name;
  if(selectedSignupPlan!=='free'){
    closeModal('signup-modal');
    pendingSignup={name,username,email,pass};
    startPayment(selectedSignupPlan);
    return;
  }
  createUser({name,username,email,plan:'free',pass});
  closeModal('signup-modal');
  showApp();
  setTimeout(() => openOnboarding(), 1000);
}

let pendingSignup=null;

function createUser({name,username,email,plan,pass}){
  const offeredPlan=localStorage.getItem('vb_offer_pending')?'pro':(plan||'free');
  currentUser={id:email,name,username:username||email.split('@')[0],email,plan:offeredPlan,avatar:'🙂',bio:'',followers:[],following:[],projects:[],totalVotes:0,createdAt:new Date().toISOString()};
  if(offeredPlan==='pro'&&localStorage.getItem('vb_offer_pending')){
    currentUser.offerClaimed=true;
    currentUser.offerExpiry=new Date(Date.now()+365*24*60*60*1000).toISOString();
    localStorage.removeItem('vb_offer_pending');
    setTimeout(()=>toast('🎉 PRO plan activated for free for 1 year!'),800);
  }
  if(pass) currentUser._pass = pass;
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  _saveAccount(currentUser);
  // Credits de welcome
  const welcomeCredits = 50;
  addCredits(welcomeCredits);
  setTimeout(()=>toast(`🎁 Welcome! +${welcomeCredits}⚡ ViralCredits awarded!`), 1200);
  try{fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)});}catch(e){}
}

// ── SUPER ADMIN ──
const SUPER_ADMIN_EMAIL='soug759@gmail.com';
const SUPER_ADMIN_PASS='Carla123';

function isSuperAdmin(email,pass){
  return email===SUPER_ADMIN_EMAIL&&pass===SUPER_ADMIN_PASS;
}

function loginAsSuperAdmin(){
  currentUser={
    id:SUPER_ADMIN_EMAIL,
    name:'Admin',
    username:'admin_viralboost',
    email:SUPER_ADMIN_EMAIL,
    plan:'elite',
    avatar:'👑',
    bio:'Super Administrator de ViralBoost',
    isSuperAdmin:true,
    followers:[],following:[],projects:[],totalVotes:0,
    createdAt:new Date().toISOString()
  };
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('login-modal');
  showApp();
  // Load all admin data
  loadAdminData();
}

async function loadAdminData(){
  // Load all users, reports, DMs, projects
  try{
    const [usersRes,reportsRes,dmsRes,projectsRes]=await Promise.all([
      fetch('/api/admin/all-users?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/reports?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/dms?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/projects').catch(()=>({ok:false}))
    ]);
    window._adminData={
      users: usersRes.ok ? await usersRes.json() : [],
      reports: reportsRes.ok ? await reportsRes.json() : [],
      dms: dmsRes.ok ? await dmsRes.json() : [],
      projects: projectsRes.ok ? await projectsRes.json() : []
    };
    toast('👑 Full Admin access activated!');
    showAdminPanel();
  }catch(e){
    toast('👑 Admin mode activated (local data)');
    window._adminData={users:[],reports:[],dms:[],projects:[]};
    showAdminPanel();
  }
}

function showAdminPanel(){
  // Add Admin tab in bar if not already there
  const tabs=document.querySelector('.app-tabs');
  if(tabs&&!document.getElementById('tab-btn-admin')){
    const btn=document.createElement('button');
    btn.className='app-tab';
    btn.id='tab-btn-admin';
    btn.style.color='#ffd700';
    btn.style.borderBottomColor='#ffd700';
    btn.innerHTML='👑 Admin';
    btn.onclick=()=>showAppTab('admin',btn);
    tabs.appendChild(btn);
    // Create le panel admin
    const panel=document.createElement('div');
    panel.className='tpanel';
    panel.id='tab-admin';
    panel.innerHTML=buildAdminPanelHTML();
    document.querySelector('#app > div[style]').appendChild(panel);
  }
}

function buildAdminPanelHTML(){
  const d=window._adminData||{};
  const users=d.users||[];
  const reports=d.reports||[];
  const dms=d.dms||[];
  const projects=d.projects||[];

  return `
  <div style="max-width:1100px;margin:0 auto;padding:22px 0">
    <h2 style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:3px;color:#ffd700;margin-bottom:6px">👑 PANNEAU SUPER ADMIN</h2>
    <p style="font-size:12px;color:var(--muted);margin-bottom:24px;font-family:'DM Mono',monospace">Access exclusif · soug759@gmail.com</p>

    <!-- STATS -->
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:28px">
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-users">${users.length||'?'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">UTILISATEURS</div>
      </div>
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-projects">${projects.length||'?'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">PROJETS/PUBS</div>
      </div>
      <div style="background:rgba(255,75,75,0.08);border:1.5px solid rgba(255,75,75,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#f87171" id="admin-stat-reports">${reports.length||'0'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">SIGNALEMENTS</div>
      </div>
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-dms">${dms.length||'0'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">DMS ADMIN</div>
      </div>
      <div style="background:rgba(34,197,94,0.06);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)" id="admin-stat-online">—</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">EN LIGNE</div>
      </div>
    </div>

    <!-- TABS -->
    <div class="feed-tabs" style="margin-bottom:18px">
      <button class="feed-tab active" onclick="switchAdminTab('users',this)">👥 Users</button>
      <button class="feed-tab" onclick="switchAdminTab('reports',this)">🚨 Reports</button>
      <button class="feed-tab" onclick="switchAdminTab('dms',this)">📩 DMs</button>
      <button class="feed-tab" onclick="switchAdminTab('projects',this)">📢 Posts</button>
      <button class="feed-tab" onclick="switchAdminTab('chat',this)">💬 Global chat</button>
    </div>

    <!-- USERS -->
    <div id="admin-tab-users">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;overflow:hidden">
        <table style="width:100%;border-collapse:collapse">
          <thead><tr style="background:var(--s2)">
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">NOM</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">EMAIL</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">PLAN</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">INSCRIT</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">ACTIONS</th>
          </tr></thead>
          <tbody id="admin-users-tbody">
            ${users.length?users.map(u=>`<tr style="border-top:1px solid var(--border2)">
              <td style="padding:10px 14px;font-size:13px">${u.name||'—'}</td>
              <td style="padding:10px 14px;font-size:12px;color:var(--muted);font-family:'DM Mono',monospace">${u.email||'—'}</td>
              <td style="padding:10px 14px"><span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></td>
              <td style="padding:10px 14px;font-size:11px;color:var(--muted)">${u.createdAt?new Date(u.createdAt).toLocaleDateString('fr-FR'):'—'}</td>
              <td style="padding:10px 14px"><button onclick="adminBanUser('${u.email}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:3px 8px;font-size:10px;color:#f87171;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Bannedr</button></td>
            </tr>`).join(''):'<tr><td colspan="5" style="padding:24px;text-align:center;color:var(--muted)">Connect MongoDB to see users</td></tr>'}
          </tbody>
        </table>
      </div>
    </div>

    <!-- REPORTS (hidden by default) -->
    <div id="admin-tab-reports" style="display:none">
      ${reports.length?`<div style="display:flex;flex-direction:column;gap:8px">
        ${reports.map(r=>`<div style="background:rgba(248,113,113,0.06);border:1.5px solid rgba(248,113,113,0.2);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
            <span style="font-size:12px;font-weight:700;color:#f87171">🚨 ${r.reportedName||r.reportedId||'?'}</span>
            <span style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">reported by ${r.reporterName||r.reporterEmail||'?'}</span>
            <span style="background:rgba(248,113,113,0.15);color:#f87171;font-size:9px;padding:2px 7px;border-radius:3px;font-family:'DM Mono',monospace;margin-left:auto">${r.reason||'?'}</span>
          </div>
          ${r.details?`<div style="font-size:12px;color:var(--muted)">${r.details}</div>`:''}
          <div style="font-size:10px;color:var(--muted2);margin-top:6px;font-family:'DM Mono',monospace">${r.createdAt?new Date(r.createdAt).toLocaleString('fr-FR'):''}</div>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">No reports at the moment 🎉</div>'}
    </div>

    <!-- DMs (hidden) -->
    <div id="admin-tab-dms" style="display:none">
      ${dms.length?`<div style="display:flex;flex-direction:column;gap:8px">
        ${dms.map(d=>`<div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
            <span style="font-size:20px">👑</span>
            <span style="font-size:12px;font-weight:700;color:#ffd700">${d.fromName||d.fromEmail||'?'}</span>
            <span class="chat-msg-plan-badge plan-${d.fromPlan||'elite'}" style="font-size:9px">${(d.fromPlan||'ELITE').toUpperCase()}</span>
            <span style="font-size:10px;color:var(--muted);margin-left:auto;font-family:'DM Mono',monospace">${d.createdAt?new Date(d.createdAt).toLocaleString('fr-FR'):''}</span>
          </div>
          <div style="font-size:13px;color:var(--g5)">${d.text||'—'}</div>
          <button onclick="replyToAdminDM('${d.fromEmail}')" style="margin-top:8px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:4px;padding:4px 10px;font-size:10px;color:#ffd700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Reply</button>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">No admin DMs yet</div>'}
    </div>

    <!-- PROJECTS (hidden) -->
    <div id="admin-tab-projects" style="display:none">
      ${projects.length?`<div class="showcase-grid">${projects.slice(0,12).map(p=>`
        <div class="v-card">
          <div class="v-banner" style="background:${p.color||'var(--s2)'};">${p.emoji||'🚀'}
            <div class="v-badge" style="background:#ffd700;color:#1a0a00">${p.cat||p.type||'pub'}</div>
          </div>
          <div class="v-body">
            <div class="v-name">${p.name}</div>
            <div class="v-desc">${(p.desc||'').slice(0,80)}</div>
            <div class="v-footer">
              <div class="v-author" style="font-size:11px">${p.author||'?'}</div>
              <button onclick="adminDeleteProject('${p.id}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:2px 7px;font-size:10px;color:#f87171;cursor:pointer">🗑</button>
            </div>
          </div>
        </div>`).join('')}</div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">No projects posted</div>'}
    </div>

    <!-- CHAT (hidden) -->
    <div id="admin-tab-chat" style="display:none">
      <div class="chat-box" style="height:500px">
        <div class="chat-msgs-area" id="admin-chat-msgs">
          ${[...publicMessages].reverse().slice(0,50).map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${m.name||'?'} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div><div class="chat-msg-text">${m.text||''}</div></div>`).join('')||'<div style="text-align:center;padding:32px;color:var(--muted)">Real-time chat visible here</div>'}
        </div>
        <div class="chat-input-row">
          <input type="text" id="admin-chat-in" class="chat-input-field" placeholder="Send un message en tant qu\'Admin 👑..." onkeydown="if(event.key===\\'Enter\\')sendAdminChatMsg()"/>
          <button class="btn-send" onclick="sendAdminChatMsg()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">→</button>
        </div>
      </div>
    </div>

    <div style="margin-top:24px;padding:14px;background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.1);border-radius:8px;font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;text-align:center">
      👑 Super Admin Panel · soug759@gmail.com · <a href="/admin?key=viralboost-admin" target="_blank" style="color:#ffd700;text-decoration:none">Dashboard serveur complet →</a>
    </div>
  </div>`;
}

function switchAdminTab(tab,el){
  document.querySelectorAll('#tab-admin .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  ['users','reports','dms','projects','chat'].forEach(t=>{
    const el2=document.getElementById('admin-tab-'+t);
    if(el2)el2.style.display=t===tab?'block':'none';
  });
}

function adminBanUser(email){
  if(confirm('Bannedr '+email+' ?')){
    fetch('/api/admin/ban',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,key:'viralboost-admin'})}).catch(()=>{});
    toast('🚫 Utilisateur banned : '+email);
  }
}

function adminDeleteProject(id){
  if(confirm('Delete ce project ?')){
    showcaseData=showcaseData.filter(p=>p.id!==id);
    fetch('/api/projects/'+id,{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({key:'viralboost-admin'})}).catch(()=>{});
    toast('🗑 Project deleted');
    document.getElementById('tab-admin').innerHTML=buildAdminPanelHTML();
  }
}

function replyToAdminDM(email){
  openDMToUser(email, email.split('@')[0]);
}

function sendAdminChatMsg(){
  const inp=document.getElementById('admin-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  inp.value='';
  const el=document.getElementById('admin-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.style.background='rgba(255,215,0,0.06)';
  div.style.border='1px solid rgba(255,215,0,0.15)';
  div.innerHTML=`<div class="chat-msg-name"><span style="color:#ffd700">👑 Admin</span> <span class="admin-msg-badge">ADMIN</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({type:'message',name:'👑 Admin',plan:'elite',text,isAdmin:true}));
  }
}

function login(){
  const email=document.getElementById('l-email').value.trim().toLowerCase();
  const pass=document.getElementById('l-pass').value;
  if(!email||!pass){toast('Please fill in all fields.');return;}

  // ── SUPER ADMIN ──
  if(isSuperAdmin(email,pass)){loginAsSuperAdmin();return;}

  // Search in multi-accounts store
  const accounts = _getAccounts();
  const account = accounts[email];
  if(account){
    if(account._pass && account._pass !== pass){
      toast('❌ Password incorrect.');return;
    }
    currentUser = account;
    localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
    closeModal('login-modal');
    showApp();
    return;
  }
  toast('❌ No account found. Sign up!');
}

// ── MULTI-ACCOUNT STORE ──
function _getAccounts(){
  try{ return JSON.parse(localStorage.getItem('vb_accounts')||'{}'); }catch(e){ return {}; }
}
function _saveAccount(user){
  const accounts = _getAccounts();
  accounts[user.email.toLowerCase()] = user;
  localStorage.setItem('vb_accounts', JSON.stringify(accounts));
}

function logout(){
  currentUser=null;
  localStorage.removeItem('viralboost_user'); // clears active session, not accounts
  document.body.classList.remove('app-active');
  document.getElementById('app').style.display='none';
  document.getElementById('landing').style.display='block';
  const guestBtns=document.getElementById('mob-btns-guest');
  const userBtns=document.getElementById('mob-btns-user');
  if(guestBtns)guestBtns.style.display='flex';
  if(userBtns)userBtns.style.display='none';
  window.scrollTo(0,0);
}

async function loadShowcaseFromAPI(){
  try{
    const r=await fetchWithTimeout('/api/projects');
    const apiProjects=await r.json();
    if(Array.isArray(apiProjects)&&apiProjects.length>0){
      const apiIds=new Set(apiProjects.map(p=>p.id));
      showcaseData=[...apiProjects,...(showcaseData||[]).filter(p=>!apiIds.has(p.id))];
    }
  }catch(e){}
  buildShowcaseGrid('app-showcase-grid');
}


function startDemoPublish(){
  // If already connected, go directly to publish tab
  const saved = localStorage.getItem('viralboost_user');
  if(saved){ try{ currentUser = JSON.parse(saved); showApp(); setTimeout(()=>showAppTab('publish',null),300); return; }catch(e){} }
  startDemo();
  setTimeout(() => showAppTab('publish', null), 400);
}

function openDemoSignupModal(){
  // Remove demo banner temporarily and show a powerful signup modal
  const modal = document.createElement('div');
  modal.id = 'demo-signup-modal';
  modal.style.cssText = 'position:fixed;inset:0;background:rgba(4,10,5,0.94);backdrop-filter:blur(16px);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.25s ease;';
  modal.innerHTML = `
    <div style="background:var(--s1);border:2px solid rgba(34,197,94,0.5);border-radius:20px;padding:32px 28px;max-width:400px;width:100%;position:relative;animation:popIn 0.35s cubic-bezier(0.34,1.56,0.64,1);">
      <div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:60%;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);border-radius:100px;"></div>
      
      <div style="text-align:center;margin-bottom:22px;">
        <div style="font-size:40px;margin-bottom:10px;">🚀</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--white);margin-bottom:6px;">You're 1 step away from publishing!</div>
        <div style="font-size:13px;color:var(--muted);line-height:1.6;">Your ad is ready. Create your free account in 30 seconds to publish it now.</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:9px;margin-bottom:20px;background:rgba(22,163,74,0.05);border:1px solid rgba(34,197,94,0.12);border-radius:12px;padding:14px 16px;">
        <div style="font-size:12px;color:var(--g5);">✅ &nbsp;Publication <strong style="color:var(--g3)">immediate</strong> — visible to the entire community</div>
        <div style="font-size:12px;color:var(--g5);">✅ &nbsp;Access au feed, collabs & groups</div>
        <div style="font-size:12px;color:var(--g5);">✅ &nbsp;<strong style="color:var(--g3)">100% free</strong> — no credit card</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:9px;margin-bottom:14px;">
        <input id="dsm-email" class="signup-input" placeholder="📧 Your email" type="email" style="width:100%;padding:12px 14px;background:rgba(4,10,5,0.9);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;" />
        <input id="dsm-pass" class="signup-input" placeholder="🔒 Password (8 chars min.)" type="password" style="width:100%;padding:12px 14px;background:rgba(4,10,5,0.9);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;" />
      </div>

      <button onclick="demoSignupSubmit()" style="width:100%;padding:15px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 36px rgba(34,197,94,0.45);transition:all 0.2s;margin-bottom:10px;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
        ⚡ Create my account & Publish →
      </button>
      
      <div style="text-align:center;font-size:11px;color:var(--muted2);margin-bottom:10px;">By creating an account you accept our T&Cs</div>
      
      <button onclick="closeDemoSignupModal()" style="display:block;width:100%;text-align:center;background:none;border:none;font-size:12px;color:var(--muted2);cursor:pointer;padding:6px;font-family:'Plus Jakarta Sans',sans-serif;">
        Continue in demo mode →
      </button>
    </div>
  `;
  document.body.appendChild(modal);
  // Focus first input
  setTimeout(() => { const inp = document.getElementById('dsm-email'); if(inp) inp.focus(); }, 300);
}

function closeDemoSignupModal(){
  const m = document.getElementById('demo-signup-modal');
  if(m) m.remove();
}

function demoSignupSubmit(){
  const email = (document.getElementById('dsm-email')?.value||'').trim();
  const pass = (document.getElementById('dsm-pass')?.value||'').trim();
  if(!email||!email.includes('@')){toast('⚠️ Email invalide !');return;}
  if(pass.length < 8){toast('⚠️ Password too short (8 chars min)!');return;}
  
  // Create le account directement
  closeDemoSignupModal();
  const name = email.split('@')[0];
  createUser({name, username: name, email, plan:'free', pass});
  showApp();
  setTimeout(() => openOnboarding(), 1000);
}

function startDemo(){
  // Create a read-only demo user
  currentUser = {
    name: 'Visitur Demo',
    username: 'demo_visitor',
    email: 'demo@viralboost.app',
    plan: 'free',
    avatar: '👀',
    followers: [],
    following: [],
    projects: [],
    totalVotes: 0,
    isDemo: true
  };
  showApp();
}

function exitDemo(){
  currentUser = null;
  const banner = document.getElementById('demo-banner');
  if(banner) banner.remove();
  const app = document.getElementById('app');
  if(app) app.style.paddingTop = '';
  document.getElementById('landing').style.display='block';
  document.getElementById('app').style.display='none';
  document.body.classList.remove('app-active');
  openModal('signup-modal');
}

function showApp(){
  document.getElementById('landing').style.display='none';
  document.getElementById('app').style.display='block';
  document.body.classList.add('app-active');
  // Menu mobile : montrer Quitter, cacher Log in/Join
  const guestBtns = document.getElementById('mob-btns-guest');
  const userBtns = document.getElementById('mob-btns-user');
  if(guestBtns) guestBtns.style.display='none';
  if(userBtns) userBtns.style.display='flex';
  updateAppBar();
  loadPostsFromAPI();
  loadMemberCount();
  loadShowcaseFromAPI();
  window.scrollTo(0,0);
  // Init new features
  setTimeout(()=>{
    injectSearchBtn();
    applyTheme();
    checkReferral();
    const sb = document.getElementById('stories-bar-container');
    if(sb) sb.innerHTML = renderStoriesBar();
  }, 300);
  connectWS();
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  document.getElementById('feed-limit-info').innerHTML=`Plan ${(currentUser.plan||'FREE').toUpperCase()} · <span id="pubs-left">${plan.limits.pubsPerHour||plan.limits.pubsPerDay||'∞'}</span> pub${currentUser.plan==='free'?'/h':'/jour'}`;
  const chatLeft=Math.max(0,(PLANS.find(p=>p.id===currentUser.plan)||PLANS[0]).limits.chatMsgs-chatMsgsToday);
  const chatEl=document.getElementById('chat-msgs-left');
  if(chatEl)chatEl.textContent=chatLeft;
  // Restore wallpaper
  if(currentUser.wallpaper&&currentUser.wallpaper!=='none'){
    const app=document.getElementById('app');
    app.style.background=currentUser.wallpaper;
    app.classList.add('has-wallpaper');
  }
  // Pub hero après sign up
  if(window._pendingHeroAd&&currentUser){
    const ad=window._pendingHeroAd;
    document.getElementById('feed-text').value=ad.desc;
    document.getElementById('feed-proj-name').value=ad.name;
    const sel=document.getElementById('feed-proj-type');
    if(sel&&ad.type)sel.value=ad.type;
    showAppTab('feed',document.querySelector('.app-tab'));
    toast('📢 Your ad is ready! Click Publish.');
    window._pendingHeroAd=null;
  }
  // News features
  updateCreditsDisplay();
  // Go directly to Publish by default
  if(!window._pendingHeroAd){
    showAppTab('publish', document.querySelector('.app-tab[onclick*="publish"]'));
  }
  setTimeout(checkOnboarding,800);
  setTimeout(checkNewBadges, 500);
}

function updateAppBar(){
  if(!currentUser)return;
  document.getElementById('app-user-name').textContent=currentUser.name;
  document.getElementById('app-user-ava').textContent=currentUser.avatar||currentUser.name[0];
  const chip=document.getElementById('app-plan-chip');
  chip.textContent=(currentUser.plan||'FREE').toUpperCase();
  const isElite=currentUser.plan==='elite';
  if(isElite){chip.style.background='linear-gradient(135deg,#ffd700,#ff8c00)';chip.style.color='#1a0a00';}
  else{chip.style.background='';chip.style.color='';}
  const btnWp=document.getElementById('btn-wallpaper');
  const btnAdm=document.getElementById('btn-admin-dm');
  if(btnWp)btnWp.style.display=isElite?'flex':'none';
  if(btnAdm)btnAdm.style.display=isElite?'flex':'none';
}

// ── PAYMENT ──
function startPayment(planId){
  const plan=PLANS.find(p=>p.id===planId);
  if(!plan||plan.price===0)return;
  pendingPlan=planId;
  document.getElementById('pay-plan-name').textContent=plan.name;
  document.getElementById('pay-plan-price').textContent=plan.price+'€';
  openModal('payment-modal');
  if(stripe){
    const el=stripe.elements({appearance:{theme:'night',variables:{colorPrimary:'#22c55e',colorBackground:'#0b1a0d',colorText:'#f0fdf4',borderRadius:'8px'}}});
    cardElement=el.create('card');
    setTimeout(()=>cardElement.mount('#card-element'),100);
  }
}

async function processPayment(){
  const btn=document.getElementById('btn-pay');
  btn.disabled=true;btn.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  const amounts={starter:300,pro:1499,elite:3999};
  try{
    const r=await fetch('/api/create-payment-intent',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan:pendingPlan,amount:amounts[pendingPlan]||300})});
    const{clientSecret,error:ie}=await r.json();
    if(ie)throw new Error(ie);
    const{error,paymentIntent}=await stripe.confirmCardPayment(clientSecret,{payment_method:{card:cardElement}});
    if(error)throw new Error(error.message);
    if(paymentIntent.status==='succeeded'){
      if(pendingSignup){createUser({...pendingSignup,plan:pendingPlan});pendingSignup=null;}
      else if(currentUser){currentUser.plan=pendingPlan;localStorage.setItem('viralboost_user',JSON.stringify(currentUser));}
      closeModal('payment-modal');
      updateAppBar();
      showApp();
      toast('🎉 Plan '+pendingPlan.toUpperCase()+' activated!');
    }
  }catch(err){
    document.getElementById('card-errors').textContent=err.message;
    btn.disabled=false;btn.textContent='🔒 S\'abonner';
  }
}

// ── WEBSOCKET ──
function connectWS(){
  if(!currentUser)return;
  try{
    const proto=location.protocol==='https:'?'wss':'ws';
    ws=new WebSocket(`${proto}://${location.host}`);
    ws.onopen=()=>{
      wsRetries=0;
      ws.send(JSON.stringify({type:'join',userId:currentUser.email,name:currentUser.name,plan:currentUser.plan||'free'}));
    };
    ws.onmessage=(e)=>{
      try{
        const data=JSON.parse(e.data);
        // Chat history on load (previous messages)
        if(data.type==='history'&&Array.isArray(data.messages)){
          worldChatMsgs=data.messages.map(m=>({name:m.name,plan:m.plan||'free',text:m.text,time:new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})}));
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
        }
        // Previous showcase publications sent on login
        if(data.type==='projects_history'&&Array.isArray(data.projects)){
          const apiIds=new Set(data.projects.map(p=>p.id));
          showcaseData=[...data.projects,...(showcaseData||[]).filter(p=>!apiIds.has(p.id))];
          if(document.getElementById('tab-showcase')?.classList.contains('active'))buildShowcaseGrid('app-showcase-grid');
        }
        if(data.type==='message'&&data.message){
          worldChatMsgs.push({name:data.message.name,plan:data.message.plan||'free',text:data.message.text,time:new Date(data.message.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
          else{const nd=document.getElementById('chat-notif');if(nd)nd.style.display='inline-block';}
        }
        if(data.type==='online_users'){
          const cnt=document.getElementById('world-online-count');
          if(cnt)cnt.textContent=data.users.length+' online';
        }
        if(data.type==='dm'&&data.message?.fromId){
          const fromId=data.message.fromId;
          if(!dmThreads[fromId])dmThreads[fromId]=[];
          dmThreads[fromId].push({fromMe:false,text:data.message.text,time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(dmTarget&&dmTarget.id===fromId)renderDMThread(fromId);
          toast('💬 New DM de '+data.message.fromName);
        }
        if(data.type==='vote_update'){
          document.querySelectorAll('[data-pid="'+data.projectId+'"] .vote-count').forEach(el=>el.textContent=data.votes);
        }
        if(data.type==='new_project'&&data.project?.authorId!==currentUser?.email){
          showcaseData.unshift(data.project);
          toast('🚀 New project : '+data.project.name);
        }
        if(data.type==='new_post'&&data.post?.userId!==currentUser?.email){
          // Add le post en temps réel
          if(!feedPosts.find(p=>p.id===data.post.id)){
            const p=data.post;
            p.time='Just now';
            feedPosts.unshift(p);
            if(document.getElementById('tab-feed')?.classList.contains('active'))buildFeed();
          }
        }
        if(data.type==='like_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p){p.likes=data.likes;}
          const cnt=document.querySelector(`#post-${data.postId} .like-count`);
          if(cnt)cnt.textContent=data.likes;
        }
        if(data.type==='comment_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p)p.comments=data.comments;
          const cnt=document.querySelector(`#post-${data.postId} .comment-count`);
          if(cnt)cnt.textContent=data.comments;
        }
        if(data.type==='share_update'){
          const cnt=document.querySelector(`#post-${data.postId} .share-count`);
          if(cnt)cnt.textContent=data.shares;
        }
        if(data.type==='group_message'&&data.groupId===currentGroupId){
          if(document.getElementById('group-chat-modal')?.classList.contains('open')){
            loadGroupMessages(currentGroupId);
          }
        }
      }catch(e){}
    };
    ws.onclose=()=>{
      wsRetries=(wsRetries||0)+1;
      if(wsRetries<10)setTimeout(connectWS,Math.min(5000*wsRetries,30000));
    };
  }catch(e){}
}

// ── TIMERS (posts) ──
function updateTimers(){
  document.querySelectorAll('.post-timer-val').forEach(el=>{
    const end=parseInt(el.dataset.end);
    if(!end)return;
    const left=end-Date.now();
    if(left<=0){el.closest('.post-card')?.remove();return;}
    const m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);
    el.textContent=m+'m'+String(s).padStart(2,'0')+'s';
  });
}
setInterval(updateTimers,1000);

// ── TABS update to include groups ──
function showAppTab(tab,el){
  syncBottomNav(tab);
  document.querySelectorAll('.app-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tpanel').forEach(p=>p.classList.remove('active'));
  if(el)el.classList.add('active');
  const panel=document.getElementById('tab-'+tab);
  if(panel)panel.classList.add('active');
  // Onglets originaux
  if(tab==='showcase')buildShowcaseGrid('app-showcase-grid');
  if(tab==='profile')renderMyProfile();
  if(tab==='abonnes')buildFollowList('discover');
  if(tab==='chat-global'){buildWorldChat();const nd=document.getElementById('chat-notif');if(nd)nd.style.display='none';}
  if(tab==='feed')buildFeed();
  if(tab==='groups')loadGroups();
  // Newx onglets
  if(tab==='stats')loadStats();
  if(tab==='leaderboard')loadLeaderboard('pubs');
  if(tab==='collab')loadCollabs();
  if(tab==='calendrier')buildCalendar();
  if(tab==='publish'){
    updatePubCompletion(); updateDescCount();
    setTimeout(()=>{ const drop=document.getElementById('pub-media-drop'); if(drop) drop.onclick=()=>document.getElementById('pub-media-input')?.click(); },100);
    // First-open guide
    if(!localStorage.getItem('vb_pub_guide_seen')){
      setTimeout(()=>{ document.getElementById('pub-guide-overlay')?.classList.remove('hidden'); }, 500);
    }
  }
  if(tab==='boost-credits'){updateCreditsDisplay();loadBoostPostOptions();renderMissions();updateMissionsCountdown();}
}

// ── GROUPES ──
async function loadGroups(){
  try{
    const r=await fetch('/api/groups');
    groupsData=await r.json();
  }catch(e){groupsData=[];}
  buildGroupsList();
  const btn=document.getElementById('btn-create-group');
  if(btn)btn.style.display=(currentUser?.plan==='elite')?'block':'none';
}

// No fake groups — only real groups created by members
const sampleGroups=[];

function buildGroupsList(){
  const el=document.getElementById('groups-list');
  if(!el)return;
  const data=groupsData;
  if(!data.length){
    el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted);grid-column:1/-1"><div style="font-size:40px;margin-bottom:12px">🏛️</div><div style="font-size:14px;font-weight:700;color:var(--g5);margin-bottom:8px">No groups yet</div><div style="font-size:12px">Elite members can create themed groups.</div></div>';
    return;
  }
  el.innerHTML=data.map(g=>`
    <div class="group-card" onclick="openGroupChat('${g.id}','${escHtml(g.name)}','${g.creatorId}','${g.access}','${g.allowPhotos||1}')">
      <div class="group-banner" style="${g.bgUrl?`background:url('${g.bgUrl}') center/cover`:'background:linear-gradient(135deg,var(--s2),var(--s3))'}">
        <span style="font-size:36px">${g.emoji||'💬'}</span>
        ${g.access==='private'?'<span style="position:absolute;top:8px;right:8px;font-size:10px;background:rgba(0,0,0,0.6);padding:2px 7px;border-radius:4px;color:#fff">🔒 Private</span>':''}
      </div>
      <div class="group-body">
        <div class="group-name">${g.name}</div>
        <div class="group-desc">${g.desc||''}</div>
        <div class="group-footer">
          <div class="group-meta">👥 ${g.membersCount||0} members · ${g.cat||''}</div>
          ${currentUser?.plan==='elite'&&currentUser?.email===g.creatorId?`<button class="btn-report" onclick="event.stopPropagation();openGroupSettings('${g.id}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Admin</button>`:''}
        </div>
      </div>
    </div>`).join('');
}

async function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  // Show admin btn if elite creator
  const acts=document.getElementById('group-chat-actions');
  acts.innerHTML='';
  if(currentUser.plan==='elite'&&currentUser.email===creatorId){
    acts.innerHTML=`<button class="btn-report" onclick="openGroupSettings('${groupId}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Settings group</button>`;
  }
  // Show media upload if allowed
  const mediaBtnLabel=document.getElementById('group-media-btn');
  if(mediaBtnLabel)mediaBtnLabel.style.display=(allowPhotos==='1'||allowPhotos===1)?'flex':'none';
  await loadGroupMessages(groupId);
  openModal('group-chat-modal');
}

async function loadGroupMessages(groupId){
  const el=document.getElementById('group-chat-msgs');
  try{
    const r=await fetch('/api/groups/'+groupId+'/messages');
    const msgs=await r.json();
    if(!msgs.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Be the first to write in this group 👋</div>';return;}
    el.innerHTML=msgs.map(m=>`
      <div class="chat-msg-item">
        <div class="chat-msg-name">${escHtml(m.author||'Anonyme')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>
        ${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}
        ${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px;object-fit:cover"/>`}</div>`:''}
      </div>`).join('');
    el.scrollTop=el.scrollHeight;
  }catch(e){el.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px">Unable to load messages</div>';}
}

async function sendGroupMessage(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const inp=document.getElementById('group-chat-input');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const msg={text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
  inp.value='';
  try{await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});}catch(e){}
  await loadGroupMessages(currentGroupId);
}

function openCreateGroup(){
  if(currentUser?.plan!=='elite'){toast('⭐ Creating a group is reserved for the ELITE plan.');startPayment('elite');return;}
  openModal('create-group-modal');
}

async function createGroup(){
  if(!currentUser){return;}
  const name=document.getElementById('grp-name').value.trim();
  const desc=document.getElementById('grp-desc').value.trim();
  if(!name||!desc){toast('Please fill in the name and description.');return;}
  const group={
    name,desc,emoji:document.getElementById('grp-emoji').value||'💬',
    cat:document.getElementById('grp-cat').value,
    access:document.getElementById('grp-access').value,
    rules:document.getElementById('grp-rules').value.trim(),
    bgUrl:groupBgUrl||'',allowPhotos:1,
    creatorId:currentUser.email,membersCount:1
  };
  try{
    const r=await fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)});
    const d=await r.json();
    toast('🏛️ Group created!');
    closeModal('create-group-modal');
    groupBgUrl=null;
    await loadGroups();
  }catch(e){
    // Fallback local si no backend
    group.id='grp'+Date.now();
    groupsData.unshift(group);
    toast('🏛️ Group created!');
    closeModal('create-group-modal');
    buildGroupsList();
  }
}

function openGroupSettings(groupId){
  currentGroupSettingsId=groupId;
  const grp=groupsData.find(g=>g.id===groupId);
  if(grp){
    document.getElementById('gs-rules').value=grp.rules||'';
    document.getElementById('gs-allow-photos').value=grp.allowPhotos||1;
    document.getElementById('gs-access').value=grp.access||'public';
  }
  openModal('group-settings-modal');
}

async function saveGroupSettings(){
  if(!currentGroupSettingsId)return;
  const settings={
    allowPhotos:parseInt(document.getElementById('gs-allow-photos').value),
    rules:document.getElementById('gs-rules').value.trim(),
    access:document.getElementById('gs-access').value
  };
  if(groupSettingsBgUrl)settings.bgUrl=groupSettingsBgUrl;
  try{
    await fetch('/api/groups/'+currentGroupSettingsId+'/settings',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({settings,requesterId:currentUser.email})});
    toast('✅ Group settings updated!');
    closeModal('group-settings-modal');
    groupSettingsBgUrl=null;
    await loadGroups();
  }catch(e){toast('Settings error.');}
}

// ── SIGNALEMENT ──
function openReport(userId,userName){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Report: '+userName+' → sent to admin';
  openModal('report-modal');
}

async function submitReport(){
  if(!reportTarget||!currentUser)return;
  const reason=document.getElementById('report-reason').value;
  const details=document.getElementById('report-details').value.trim();
  try{
    await fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      reporterId:currentUser.email,reporterEmail:currentUser.email,reporterName:currentUser.name,
      reportedId:reportTarget.id,reportedName:reportTarget.name,reason,details
    })});
    toast('🚨 Report sent to admin!');
    closeModal('report-modal');
  }catch(e){toast('Error sending report.');}
}

// ── CONTACT ADMIN (ELITE) ──
function openContactAdmin(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacting admin is reserved for the ELITE plan.');return;}
  openModal('contact-admin-modal');
}

async function sendAdminMessage(){
  if(!currentUser)return;
  const subject=document.getElementById('ca-subject').value.trim();
  const message=document.getElementById('ca-message').value.trim();
  if(!message){toast('Write your message.');return;}
  try{
    await fetch('/api/contact-admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      fromName:currentUser.name,fromEmail:currentUser.email,fromPlan:currentUser.plan,
      subject,message
    })});
    toast('📩 Message sent to admin!');
    closeModal('contact-admin-modal');
  }catch(e){toast('Error sending.');}
}

// ── HERO PUBLISH AD ──
function heroPublishAd(){
  const name=document.getElementById('hero-ad-name').value.trim();
  const type=document.getElementById('hero-ad-type').value;
  const desc=document.getElementById('hero-ad-desc').value.trim();
  if(!name){document.getElementById('hero-ad-name').focus();toast('Enter your product name!','error');return;}
  if(!desc){document.getElementById('hero-ad-desc').focus();toast('Briefly describe your ad!','error');return;}
  // Pre-fill signup modal and publish the ad after sign up
  window._pendingHeroAd={name,type,desc};
  openModal('signup-modal');
  toast('✅ Create your account to publish your ad!');
}

// ── PUBLIC FEED ──
function buildPublicFeed(){
  const el=document.getElementById('public-feed-list');
  if(!el)return;
  const publicPosts=[...feedPosts].slice(0,3);
  if(!publicPosts.length){
    el.innerHTML=`<div style="text-align:center;padding:48px 24px;color:var(--muted)">
      <div style="font-size:40px;margin-bottom:12px">📢</div>
      <div style="font-size:14px;color:var(--g5);font-weight:700;margin-bottom:8px">Be the first to publish!</div>
      <div style="font-size:12px;line-height:1.8">The feed fills up with real community posts.</div>
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')" style="margin-top:20px">Create an account & publish →</button>
    </div>`;
    return;
  }
  el.innerHTML=`<div>${publicPosts.slice(0,3).map(p=>{
    const isElite=p.plan==='elite';
    return `<div class="public-post-card ${isElite?'elite-pub':''}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <div style="width:32px;height:32px;border-radius:50%;background:${getAvatarColor(p.userId)};display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg)">${p.emoji||p.author?.[0]||'?'}</div>
        <div>
          <div style="font-size:13px;font-weight:700;${isElite?'color:var(--gold)':''}">${p.author||'Anonyme'}</div>
          <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">${p.time||''}</div>
        </div>
        <span class="chat-msg-plan-badge plan-${p.plan||'free'}" style="margin-left:auto">${(p.plan||'FREE').toUpperCase()}</span>
      </div>
      <div style="font-size:13px;line-height:1.7;color:#c4d9cb">${p.text?p.text.slice(0,160)+(p.text.length>160?'...':''):''}</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">❤️ ${p.likes||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">💬 ${p.comments||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">🔗 Share</span>
      </div>
    </div>`;
  }).join('')}</div><div class="feed-lock"><button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 See full feed & publish your ad →</button></div>`;
}

// ── MEDIA PREVIEW ──
function previewFeedMedia(input){
  const preview=document.getElementById('feed-media-preview');
  if(!preview)return;
  preview.innerHTML='';
  const files=Array.from(input.files).slice(0,4);
  files.forEach(f=>{
    const div=document.createElement('div');
    div.className='media-preview-item';
    if(f.type.startsWith('image/')){
      const img=document.createElement('img');
      img.src=URL.createObjectURL(f);
      div.appendChild(img);
    } else if(f.type.startsWith('video/')){
      const vid=document.createElement('video');
      vid.src=URL.createObjectURL(f);
      vid.muted=true;
      div.appendChild(vid);
    } else {
      div.innerHTML=`<div style="padding:8px;font-size:11px;color:var(--g4);text-align:center">📄<br>${f.name.slice(0,12)}</div>`;
    }
    const rm=document.createElement('button');
    rm.className='rm-media';rm.textContent='✕';
    rm.onclick=()=>{div.remove();};
    div.appendChild(rm);
    preview.appendChild(div);
  });
}

// ── REPORT (with radio) ──
function submitReport(){
  if(!currentUser)return;
  const radios=document.querySelectorAll('input[name="report-reason"]');
  let reason='';
  radios.forEach(r=>{if(r.checked)reason=r.value;});
  if(!reason){toast('Please choose a report reason.');return;}
  const details=document.getElementById('report-details').value.trim();
  fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
    reporterId:currentUser?.email||'anonymous',reporterName:currentUser?.name||'?',
    reportedId:reportTarget?.id||'?',reportedName:reportTarget?.name||'?',reason,details,timestamp:new Date().toISOString()
  })}).catch(()=>{});
  toast('🚨 Report sent to admin!');
  closeModal('report-modal');
  reportTarget=null;
}

// ── SEND GROUP MSG ──
function sendGroupMsg(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const inp=document.getElementById('group-chat-in');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${time}</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  inp.value='';
  fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free'})}).catch(()=>{});
}

function sendGroupMedia(input){
  const f=input.files[0];
  if(!f||!currentGroupId)return;
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  const url=URL.createObjectURL(f);
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span></div><div style="margin-top:4px">${f.type.startsWith('video')?`<video src="${url}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${url}" style="max-width:200px;border-radius:6px"/>`}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  input.value='';
}

// ── CREATE GROUP (new modal IDs) ──
function createGroup(){
  if(!currentUser){return;}
  if(currentUser.plan!=='elite'){toast('⭐ Creating a group is reserved for the ELITE plan.');return;}
  const name=document.getElementById('cg-name')?.value.trim();
  if(!name){toast('Please name your group.');return;}
  const group={
    id:'grp'+Date.now(),name,emoji:document.getElementById('cg-emoji')?.value||'💬',
    desc:document.getElementById('cg-desc')?.value.trim()||'',
    cat:document.getElementById('cg-cat')?.value||'Autre',
    access:document.getElementById('cg-private')?.checked?'private':'public',
    allowPhotos:document.getElementById('cg-allow-photos')?.checked?1:0,
    allowVideos:document.getElementById('cg-allow-videos')?.checked?1:0,
    premod:document.getElementById('cg-premod')?.checked?1:0,
    creatorId:currentUser.email,membersCount:1
  };
  groupsData.unshift(group);
  toast('🏆 Group created!');
  closeModal('create-group-modal');
  if(document.getElementById('tab-groups')?.classList.contains('active'))buildGroupsList();
  fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)}).catch(()=>{});
}

// ── WALLPAPER (ELITE) ──
function setWallpaper(bg){
  if(currentUser?.plan!=='elite'){toast('⭐ The background is reserved for the ELITE plan.');return;}
  const app=document.getElementById('app');
  if(bg==='none'){app.style.background='';app.classList.remove('has-wallpaper');}
  else{app.style.background=bg;app.classList.add('has-wallpaper');}
  currentUser.wallpaper=bg;
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('wallpaper-modal');
  toast('🖼️ Background applied!');
}

function setWallpaperFromFeede(input){
  if(!input.files[0])return;
  if(currentUser?.plan!=='elite'){toast('⭐ The background is reserved for the ELITE plan.');return;}
  const url=URL.createObjectURL(input.files[0]);
  const app=document.getElementById('app');
  app.style.background=`url('${url}') center/cover fixed`;
  app.classList.add('has-wallpaper');
  toast('🖼️ Background applied!');
  closeModal('wallpaper-modal');
}

// ── DM ADMIN (ELITE) ──
let adminDMMessages=[];
function openAdminDM(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacting admin directly is reserved for the ELITE plan.');return;}
  renderAdminDMThread();
  openModal('dm-admin-modal');
}
function renderAdminDMThread(){
  const el=document.getElementById('dm-admin-msgs');
  if(!el)return;
  if(!adminDMMessages.length){el.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">📩 First message to admin — reply within 24h</div>';return;}
  el.innerHTML=adminDMMessages.map(m=>`<div class="dm-msg ${m.fromMe?'mine':'theirs'}"><div class="dm-bubble-g">${escHtml(m.text)}</div><div class="dm-time">${m.time}</div></div>`).join('');
  el.scrollTop=el.scrollHeight;
}
function sendAdminDM(){
  const inp=document.getElementById('dm-admin-input');
  const text=inp.value.trim();
  if(!text||!currentUser)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  adminDMMessages.push({fromMe:true,text,time});
  inp.value='';
  renderAdminDMThread();
  fetch('/api/admin-dm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fromEmail:currentUser.email,fromName:currentUser.name,fromPlan:currentUser.plan,text,timestamp:new Date().toISOString()})}).catch(()=>{});
  toast('📩 Message sent to admin!');
}

// ── OPEN REPORT ──
function openReport(userId,userName){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Report: '+userName+' → sent to admin';
  document.querySelectorAll('input[name="report-reason"]').forEach(r=>r.checked=false);
  document.getElementById('report-details').value='';
  openModal('report-modal');
}

// ── OPEN GROUP CHAT ──
function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  document.getElementById('group-chat-sub').textContent='Group de discussion · '+(access==='private'?'🔒 Private':'🌍 Public');
  // Admin controls
  const adminCtrl=document.getElementById('group-admin-controls');
  if(adminCtrl)adminCtrl.style.display=(currentUser.plan==='elite'&&currentUser.email===creatorId)?'block':'none';
  // Media upload
  const mediLabel=document.getElementById('group-media-upload-label');
  if(mediLabel)mediLabel.style.display=(allowPhotos==='1'||allowPhotos===1||allowPhotos===true)?'inline-flex':'none';
  // Load members
  const ml=document.getElementById('group-members-list');
  if(ml)ml.innerHTML='<div style="color:var(--muted2);font-size:11px">👥 Online...</div>';
  // Load messages
  const msgEl=document.getElementById('group-chat-msgs');
  msgEl.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)">Be the first to write in this group 👋</div>';
  fetch('/api/groups/'+groupId+'/messages').then(r=>r.json()).then(msgs=>{
    if(!msgs.length)return;
    msgEl.innerHTML=msgs.map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${escHtml(m.author||'?')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px"/>`}</div>`:''}</div>`).join('');
    msgEl.scrollTop=msgEl.scrollHeight;
  }).catch(()=>{});
  openModal('group-chat-modal');
}

function openGroupSettings(groupId){
  if(currentUser?.plan!=='elite'){toast('⭐ Reserved for the ELITE plan.');return;}
  openModal('create-group-modal');
}

// ── GOLD LIKE/SHARE/COMMENT ELITE ──
function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  const isElite=currentUser?.plan==='elite';
  if(isElite){btn.style.borderColor='var(--gold)';btn.style.color='var(--gold)';btn.style.boxShadow='0 0 8px rgba(255,215,0,0.3)';}
  else btn.classList.toggle('active');
  btn.textContent='❤️ '+p.likes;
  // WS broadcast
  if(ws&&ws.readyState===1){ws.send(JSON.stringify({type:'like',postId:id,likes:p.likes,userId:currentUser?.email,userPlan:currentUser?.plan}));}
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Reserved for the ELITE plan.');return;}
  openModal('wallpaper-modal');
}
function _patchWS(){
  if(ws){
    const origOnMessage=ws.onmessage;
    ws.onmessage=(e)=>{
      if(origOnMessage)origOnMessage(e);
      try{
        const data=JSON.parse(e.data);
        if(data.type==='like'){
          const btn=document.querySelector(`[data-post-id="${data.postId}"] .btn-like`);
          if(btn)btn.textContent='❤️ '+data.likes;
        }
      }catch(err){}
    };
  }
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Reserved for the ELITE plan.');return;}
  openModal('wallpaper-modal');
}

// ── WEBSOCKET — update for group messages ──

function escHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function getAvatarColor(id){const colors=['linear-gradient(135deg,#15803d,#4ade80)','linear-gradient(135deg,#166534,#22c55e)','linear-gradient(135deg,#14532d,#86efac)','linear-gradient(135deg,#065f46,#34d399)'];return colors[(id||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0)%colors.length];}
function getTypeEmoji(t){return{site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️'}[t]||'🚀';}
function typeName(t){return{site:'Website',app:'Application',saas:'SaaS',tiktok:'TikTok',instagram:'Instagram',ecommerce:'E-commerce'}[t]||t;}

// ── MODALS ──
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function switchModal(a,b){closeModal(a);setTimeout(()=>openModal(b),200);}
document.querySelectorAll('.modal-bg').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

// ── STRIPE ──
try{stripe=Stripe('pk_test_YOUR_STRIPE_KEY_HERE');}catch(e){}

// ── INIT ──
window.addEventListener('load', function(){
  renderPlans();
  buildShowcaseGrid('landing-showcase-grid');
  buildPublicFeed();
  const saved = localStorage.getItem('viralboost_user');
  if(saved){ try{ currentUser = JSON.parse(saved); showApp(); }catch(e){} }
});

// ── SMART AUTO-LOGIN ──
function _tryAutoLogin(){
  const saved = localStorage.getItem('viralboost_user');
  if(!saved) return false;
  try{
    const u = JSON.parse(saved);
    if(u && u.email){
      // Reload freshest version from accounts store
      const accounts = _getAccounts();
      currentUser = accounts[u.email.toLowerCase()] || u;
      localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
      showApp();
      return true;
    }
  }catch(e){}
  return false;
}
const _origOpenModal = typeof openModal === 'function' ? openModal : function(id){ document.getElementById(id) && document.getElementById(id).classList.add('open'); };
openModal = function(id){
  if((id === 'signup-modal' || id === 'login-modal') && _tryAutoLogin()) return;
  _origOpenModal(id);
};

</script>
<!-- ── FIRST 100 OFFER POPUP — shown after 10 seconds ── -->
<div id="offer-popup" class="hidden">
  <div id="offer-box-wrap">
    <!-- Default content visible instantly -->
    <div class="offer-box">
      <button class="offer-close-btn" onclick="closeOffer()">✕</button>
      <div class="offer-crown">🎁</div>
      <div class="offer-title">LAUNCH OFFER</div>
      <div class="offer-sub">Limitd to the first 100 signups only</div>
      <div class="offer-badge">💎 PRO PLAN — 1 YEAR 100% FREE</div>
      <div class="offer-desc">
        Real value: <strong>179,88€</strong><br>
        ✅ 999 publications/jour<br>
        ✅ Unlimitd AI Coach<br>
        ✅ Showcase 30 days<br>
        ✅ ✅ Unlimitd chat
      </div>
      <div class="offer-timer">⏰ Offer expires in: <span id="offer-countdown">--:--:--</span></div>
      <div class="offer-counter">
        <div class="offer-counter-num" id="offer-remaining">—</div>
        <div class="offer-counter-lbl">spots remaining out of 100</div>
      </div>
      <button class="offer-cta" onclick="claimOffer()">🚀 CREATE MY FREE ACCOUNT</button>
      <div class="offer-skip" onclick="closeOffer()">No thanks, I'll pay</div>
    </div>
  </div>
</div>

<script>

// ══════════════════════════════════════════════
// ── NEW FEATURES ViralBoost v2 ──
// ══════════════════════════════════════════════

// ── ONBOARDING TOOLTIP (mini help on arrival) ──
const OB_STEPS = [
  {icon:'&#128226;', label:'PUBLISH YOUR PROJECT', desc:"Click Publish and fill in your profile in 2 min."},
  {icon:'&#128479;', label:'VOTE & EXPLORE', desc:"Vote for projects you like. You earn credits."},
  {icon:'&#129302;', label:'IA BOOST', desc:'Generate a TikTok, SEO or Email strategy in 10 seconds.'},
  {icon:'&#129309;', label:'FIND COLLABS', desc:"AI matching connects creators by niche and goals."},
  {icon:'&#9889;', label:'EARN CREDITS', desc:"Post, vote, complete missions. Your credits unlock boosts."},
];
let _obStep = 0;
let _obTooltip = null;

function checkOnboarding(){
  if(!currentUser) return;
  // If profile onboarding not done yet, wait for it to finish first
  if(!currentUser.onboarded){
    // Will be triggered by finishOnboarding() or skipOnboarding()
    return;
  }
  if(localStorage.getItem('vb_onboarded_'+currentUser.email)) return;
  setTimeout(showOnboardingTooltip, 800);
}

function showOnboardingTooltip(){
  if(document.getElementById('ob-tooltip')) return;
  _obStep = 0;
  const el = document.createElement('div');
  el.id = 'ob-tooltip';
  el.className = 'ob-tooltip';
  el.innerHTML = buildTooltipHTML();
  document.body.appendChild(el);
  _obTooltip = el;
}

function buildTooltipHTML(){
  const s = OB_STEPS[_obStep];
  const isLast = _obStep === OB_STEPS.length - 1;
  return `<div class="ob-tooltip-inner">
    <div class="ob-tooltip-header">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;color:var(--g3)">✦ HOW DOES IT WORK?</div>
      <button class="ob-tooltip-close" onclick="closeOnboardingTooltip()">✕</button>
    </div>
    <div class="ob-steps-row" id="ob-steps-row">
      ${OB_STEPS.map((step, i) => `
        <div class="ob-step-card ${i === _obStep ? 'active' : ''}" onclick="goObStep(${i})">
          <div class="ob-step-icon">${step.icon}</div>
          <div class="ob-step-label">${step.label}</div>
          <div class="ob-step-desc">${i === _obStep ? step.desc : ''}</div>
        </div>`).join('')}
    </div>
    <div class="ob-tooltip-footer">
      <div class="ob-progress">
        ${OB_STEPS.map((_, i) => `<div class="ob-dot ${i === _obStep ? 'active' : ''}"></div>`).join('')}
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <span onclick="closeOnboardingTooltip()" style="font-size:11px;color:var(--muted2);cursor:pointer;text-decoration:underline">Passer</span>
        <button class="ob-btn-next" onclick="${isLast ? 'closeOnboardingTooltip()' : 'obNext()'}">${isLast ? 'Let\'s go 🚀' : 'Next →'}</button>
      </div>
    </div>
  </div>`;
}

function goObStep(i){
  _obStep = i;
  if(_obTooltip) _obTooltip.innerHTML = buildTooltipHTML();
}
function obNext(){
  if(_obStep < OB_STEPS.length - 1){ _obStep++; if(_obTooltip) _obTooltip.innerHTML = buildTooltipHTML(); }
  else closeOnboardingTooltip();
}
function closeOnboardingTooltip(){
  const el = document.getElementById('ob-tooltip');
  if(!el) return;
  el.classList.add('hiding');
  setTimeout(() => el.remove(), 350);
  if(currentUser) localStorage.setItem('vb_onboarded_'+currentUser.email, '1');
}

// Keep showOnboarding as alias
function showOnboarding(){ showOnboardingTooltip(); }

// openOnboarding = opens the profile modal for new users to complete
function openOnboarding(){
  if(!currentUser) return;
  openEditProfile();
  // Add a welcome message at the top of the modal
  setTimeout(() => {
    const modal = document.querySelector('#edit-profile-modal .modal');
    if(!modal || modal.querySelector('#ob-welcome-msg')) return;
    const msg = document.createElement('div');
    msg.id = 'ob-welcome-msg';
    msg.style.cssText = 'background:linear-gradient(135deg,rgba(34,197,94,0.1),rgba(74,222,128,0.05));border:1.5px solid rgba(34,197,94,0.3);border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px;';
    msg.innerHTML = '<span style="font-size:28px">🎉</span><div><div style="font-family:\'Bebas Neue\',sans-serif;font-size:18px;letter-spacing:1.5px;color:var(--g3)">WELCOME TO VIRALBOOST!</div><div style="font-size:12px;color:var(--muted);margin-top:2px;">Complete your profile to maximize your visibility with the community.</div></div>';
    const h2 = modal.querySelector('h2');
    if(h2) h2.parentNode.insertBefore(msg, h2);
  }, 200);
}

// ══════════════════════════════════════════════
// ── PROFILE CREATION WIZARD — 5 STEPS ──
// ══════════════════════════════════════════════

let _wizStep = 1;
const _WIZ_TOTAL = 5;

function openOnboarding(){
  if(!currentUser) return;
  _wizStep = 1;
  // Inject wizard HTML if not present
  if(!document.getElementById('profile-wizard-overlay')){
    document.body.insertAdjacentHTML('beforeend', buildProfileWizardHTML());
  }
  document.getElementById('profile-wizard-overlay').style.display = 'flex';
  renderWizStep(1);
}

function buildProfileWizardHTML(){
  return `
  <div id="profile-wizard-overlay" style="display:none;position:fixed;inset:0;background:rgba(4,10,5,0.97);backdrop-filter:blur(20px);z-index:10000;align-items:center;justify-content:center;padding:16px;overflow-y:auto;">
    <div id="profile-wizard-box" style="background:var(--s1);border:2px solid rgba(34,197,94,0.4);border-radius:20px;max-width:560px;width:100%;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);max-height:92vh;overflow-y:auto;">
      
      <!-- Top bar verte -->
      <div style="position:sticky;top:0;z-index:10;background:var(--s1);border-bottom:1px solid var(--border2);padding:18px 24px 14px;border-radius:20px 20px 0 0;">
        <!-- Logo + step -->
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:3px;color:var(--g3)">⚡ VIRALBOOST</div>
          <div id="wiz-step-counter" style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:1px;"></div>
        </div>
        <!-- Stepper visuel -->
        <div style="display:flex;align-items:center;gap:0;">
          ${[1,2,3,4,5].map(i => `
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
              <div id="wiz-dot-${i}" style="width:30px;height:30px;border-radius:50%;border:2px solid var(--border2);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;font-family:'DM Mono',monospace;color:var(--muted);transition:all 0.3s;">${i}</div>
              <div id="wiz-dot-lbl-${i}" style="font-size:8px;font-family:'DM Mono',monospace;color:var(--muted);letter-spacing:0.5px;text-align:center;text-transform:uppercase;">${['IDENTITY','ACTIVITY','NETWORKS','NUMBERS','AVATAR'][i-1]}</div>
            </div>
            ${i < 5 ? `<div id="wiz-conn-${i}" style="flex:1;height:2px;background:var(--border2);margin-bottom:14px;transition:background 0.4s;"></div>` : ''}
          `).join('')}
        </div>
        <!-- Barre de progression -->
        <div style="height:3px;background:var(--s3);border-radius:2px;margin-top:12px;overflow:hidden;">
          <div id="wiz-prog-bar" style="height:100%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:2px;transition:width 0.5s cubic-bezier(0.4,0,0.2,1);width:20%;"></div>
        </div>
      </div>

      <!-- Contenu dynamique -->
      <div id="profile-wizard-content" style="padding:24px 28px 28px;"></div>
    </div>
  </div>`;
}

function renderWizStep(step){
  _wizStep = step;
  // Update stepper dots
  [1,2,3,4,5].forEach(i => {
    const dot = document.getElementById('wiz-dot-'+i);
    const lbl = document.getElementById('wiz-dot-lbl-'+i);
    const conn = document.getElementById('wiz-conn-'+i);
    if(!dot) return;
    if(i < step){ dot.style.cssText = 'width:30px;height:30px;border-radius:50%;border:2px solid var(--g2);background:rgba(22,163,74,0.15);display:flex;align-items:center;justify-content:center;font-size:13px;font-family:DM Mono,monospace;color:var(--g3);transition:all 0.3s;'; dot.textContent = '✓'; }
    else if(i === step){ dot.style.cssText = 'width:30px;height:30px;border-radius:50%;border:2px solid var(--g3);background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;font-family:DM Mono,monospace;color:var(--bg);box-shadow:0 0 16px rgba(34,197,94,0.4);transition:all 0.3s;'; dot.textContent = i; }
    else { dot.style.cssText = 'width:30px;height:30px;border-radius:50%;border:2px solid var(--border2);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;font-family:DM Mono,monospace;color:var(--muted);transition:all 0.3s;'; dot.textContent = i; }
    if(conn) conn.style.background = i < step ? 'linear-gradient(90deg,var(--g2),var(--g3))' : 'var(--border2)';
    if(lbl) lbl.style.color = i <= step ? 'var(--g4)' : 'var(--muted)';
  });
  const counter = document.getElementById('wiz-step-counter');
  if(counter) counter.textContent = 'STEP ' + step + ' / ' + _WIZ_TOTAL;
  const bar = document.getElementById('wiz-prog-bar');
  if(bar) bar.style.width = (step / _WIZ_TOTAL * 100) + '%';

  const content = document.getElementById('profile-wizard-content');
  if(!content) return;
  content.style.opacity = '0';
  content.style.transform = 'translateY(12px)';
  setTimeout(() => {
    content.innerHTML = getWizStepHTML(step);
    content.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    content.style.opacity = '1';
    content.style.transform = 'translateY(0)';
    // Pre-fill saved values
    prefillWizStep(step);
  }, 120);
  // Scroll top
  const box = document.getElementById('profile-wizard-box');
  if(box) box.scrollTop = 0;
}

function getWizStepHTML(step){
  const inp = (id, placeholder, type='text', extra='') => `
    <input type="${type}" id="${id}" placeholder="${placeholder}" ${extra}
      style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;transition:border-color 0.2s;"
      onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'"/>`;

  const sel = (id, options) => `
    <select id="${id}" style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;"
      onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'">
      ${options.map(o => typeof o === 'string' ? `<option style="background:var(--s1)">${o}</option>` : `<option value="${o.v}" style="background:var(--s1)">${o.l}</option>`).join('')}
    </select>`;

  const field = (label, content, hint='') => `
    <div style="margin-bottom:16px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:6px;letter-spacing:1.5px;text-transform:uppercase;">${label}</label>
      ${content}
      ${hint ? `<div style="font-size:11px;color:var(--muted);margin-top:5px;line-height:1.5;">${hint}</div>` : ''}
    </div>`;

  const navBtns = (step) => `
    <div style="display:flex;gap:12px;margin-top:28px;">
      ${step > 1 ? `<button onclick="wizBack()" style="flex:1;padding:13px;background:transparent;border:1.5px solid var(--border);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--muted);cursor:pointer;" onmouseover="this.style.borderColor='var(--g3)';this.style.color='var(--g3)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--muted)'">← Back</button>` : ''}
      <button onclick="wizNext()" style="flex:3;padding:14px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:var(--bg);cursor:pointer;box-shadow:0 0 20px rgba(34,197,94,0.3);transition:all 0.2s;" onmouseover="this.style.boxShadow='0 0 36px rgba(34,197,94,0.5)';this.style.transform='translateY(-1px)'" onmouseout="this.style.boxShadow='0 0 20px rgba(34,197,94,0.3)';this.style.transform=''">
        ${step < 5 ? 'Continue →' : '✅ Done →'}
      </button>
    </div>
    <button onclick="skipWizard()" style="display:block;width:100%;text-align:center;background:none;border:none;font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;padding:6px;font-family:'Plus Jakarta Sans',sans-serif;">Skip this step</button>`;

  if(step === 1) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — CREATOR PROFILE</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">YOUR IDENTITY<br><span style="color:var(--g3)">SUR VIRALBOOST</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">This info will appear on your public profile. It's the first thing other members will see about you.</div>
    </div>
    ${field('Your first name or stage name *', inp('wiz-name', 'Ex: Marie, SarahCreate, TechByAlex...'), 'The name displayed on your posts and your profile.')}
    ${field('Your unique username *', inp('wiz-username', '@username_no_spaces'), 'Will identify you in the community. Ex: @marie_builder')}
    ${field('Your title or role', inp('wiz-title', 'Ex: Content creator · Indie dev · SaaS Founder'), 'Summarize what you do in one ligne percutante.')}
    ${field('Your location', inp('wiz-location', 'Paris, France 🇫🇷 — or "Remote"'), 'Helps nearby members find you.')}
    ${field('Your bio *', `<textarea id="wiz-bio" rows="4" placeholder="Tell us who you are, what you create, what drives you... Be authentic! Profiles with a complete bio receive 3x plus de visits." style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;resize:vertical;min-height:90px;" onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'"></textarea>`, 'Minimum 3 lines recommended. Talk about your journey, projects, and passions.')}
    ${navBtns(1)}`;

  if(step === 2) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — MATCHING IA</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">YOUR ACTIVITY<br><span style="color:var(--g3)">& TES OBJECTIFS</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">This info lets AI connect you with the right creators and personalize your experience.</div>
    </div>
    ${field('Sector / Main niche *', inp('wiz-niche', 'Ex: Digital marketing, Fitness, Tech, Finance, Art...'), 'Describes your main area of activity.')}
    ${field('Experience level', sel('wiz-exp', ['Beginner (0–1 year)','Intermediate (1–3 years)','Confirmed (3–5 years)','Expert (5+ years)']))}
    ${field('Your main goal *', inp('wiz-goal', 'Ex: Reach 100K followers, launch my SaaS, find clients...'), 'Be precise! This helps AI matching find the right connections for you.')}
    ${field('Key skills', inp('wiz-skills', 'Ex: Video, Copywriting, SEO, Development, Design, Sales...'), 'Separate with commas. These tags appear on your profile.')}
    ${field('Tools & software used', inp('wiz-tools', 'Ex: CapCut, Canva, Notion, Figma, VSCode, Shopify...'), 'Helps members understand your work environment.')}
    ${field('What you\'re looking for on ViralBoost', sel('wiz-dispo', ['Open to collaborations','Available for projects freelance','Looking for investor','Looking for a partner / co-founder','Hiring talent','Just networking / market watch']))}
    ${field('What you expect from the community', `<textarea id="wiz-looking" rows="3" placeholder="Ex: I'm looking for video creators to collab on TikTok, a dev for my SaaS, clients for my coaching service..." style="width:100%;padding:12px 15px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;color:var(--white);outline:none;resize:vertical;" onfocus="this.style.borderColor='rgba(34,197,94,0.5)'" onblur="this.style.borderColor='var(--border2)'"></textarea>`, 'The more precise you are, the better AI can match you.')}
    ${navBtns(2)}`;

  if(step === 3) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — DIGITAL PRESENCE</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">TES NETWORKS<br><span style="color:var(--g3)">& WEB PRESENCE</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Connect your platforms so members can follow you everywhere. These links appear on your public profile.</div>
    </div>
    <div style="background:rgba(34,197,94,0.05);border:1px solid var(--border2);border-radius:12px;padding:16px 18px;margin-bottom:20px;">
      <div style="font-size:12px;color:var(--g5);line-height:1.8;">💡 <strong style="color:var(--g3)">Astuce :</strong> Profiles with at least 2 connected networks receive on average <strong style="color:var(--g3)">4x more collab requests</strong> than empty profiles.</div>
    </div>
    ${field('🌐 Website / Portfolio', inp('wiz-website', 'https://your-site.com', 'url'), 'Your website, portfolio, landing page...')}
    ${field('🎵 TikTok', inp('wiz-tiktok', '@your_tiktok_account'), 'Ex: @marie_creates — without the full URL.')}
    ${field('📸 Instagram', inp('wiz-instagram', '@my_instagram_account'), 'Your creator or business account.')}
    ${field('🐦 Twitter / X', inp('wiz-twitter', '@your_twitter_account'), 'So people can find you on X.')}
    ${field('💼 LinkedIn', inp('wiz-linkedin', 'linkedin.com/in/your-profile', 'url'), 'Complete professional profile.')}
    ${field('▶️ YouTube', inp('wiz-youtube', '@my_youtube_channel'), 'Your YouTube channel or handle.')}
    ${field('Other languages spoken', inp('wiz-langs', 'Ex : French, English, Spanish...'), 'Useful for international collabs.')}
    ${navBtns(3)}`;

  if(step === 4) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — CREDIBILITY</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">YOUR NUMBERS<br><span style="color:var(--g3)">& RESULTS</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Optional but powerful. Creators who share their numbers inspiring trust and attract higher-quality collabs.</div>
    </div>
    <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:12px;padding:14px 18px;margin-bottom:22px;">
      <div style="font-size:12px;color:var(--g5);line-height:1.8;">🔒 <strong style="color:var(--gold)">Privacy:</strong> You control what you share. These numbers are visible on your public profile only if you fill them in.</div>
    </div>
    ${field('Followers TikTok', inp('wiz-tiktok-count', 'Ex : 45 000'), 'Total number of followers on TikTok.')}
    ${field('Followers Instagram', inp('wiz-ig-count', 'Ex : 12 500'), 'Followers on your Instagram account.')}
    ${field('Projects launched', inp('wiz-projects-count', 'Ex: 3'), 'Number of projects, products or services you\'ve launched.')}
    ${field('Sales / Clients to date', inp('wiz-sales', 'Ex: 150 clients, 50 sales...'), 'Gives an idea of your commercial traction.')}
    ${field('Approximate monthly revenue', sel('wiz-revenue', [{v:'',l:'I prefer not to say'},{v:'0-500',l:'€0 – €500/month'},{v:'500-2000',l:'€500 – €2,000/month'},{v:'2000-5000',l:'€2,000 – €5,000/month'},{v:'5000-10000',l:'€5,000 – €10,000/month'},{v:'10000+',l:'€10,000+/month'}]), 'Helps potential partners calibrate collabs.')}
    ${field('Current availability', sel('wiz-dispo2', ['Very available — actively looking','Partially available','Not very available — selective about projects','Not available right now']))}
    ${navBtns(4)}`;

  if(step === 5) return `
    <div style="margin-bottom:24px;">
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;">⚡ VIRALBOOST — LAST STEP</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:8px;">YOUR AVATAR<br><span style="color:var(--g3)">& YOUR STYLE</span></div>
      <div style="font-size:13px;color:var(--muted);line-height:1.7;">Choose how you appear visually in the community. A recognizable avatar increases your visibility.</div>
    </div>
    <!-- Profile photo -->
    <div style="margin-bottom:20px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:10px;letter-spacing:1.5px;text-transform:uppercase;">📸 PROFILE PHOTO (RECOMMENDED)</label>
      <div style="display:flex;align-items:center;gap:16px;">
        <div id="wiz-ava-preview" style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;border:3px solid rgba(34,197,94,0.4);position:relative;overflow:hidden;cursor:pointer;" onclick="document.getElementById('wiz-ava-file').click()">
          <span id="wiz-ava-emoji-display">🙂</span>
          <img id="wiz-ava-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%;" />
        </div>
        <div>
          <label style="display:inline-flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px solid var(--border);border-radius:8px;padding:9px 16px;font-size:12px;font-weight:600;color:var(--g3);transition:all 0.2s;" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border)'">
            📁 Upload a photo
            <input type="file" id="wiz-ava-file" accept="image/*" style="display:none" onchange="handleWizAvatarUpload(this)"/>
          </label>
          <div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.5;">JPG, PNG, WebP · Max 5 Mo<br>Profiles with a photo get 5x more interactions.</div>
        </div>
      </div>
    </div>
    <!-- Emoji avatar -->
    <div style="margin-bottom:20px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:10px;letter-spacing:1.5px;text-transform:uppercase;">😎 OU CHOISIS UN EMOJI</label>
      <div style="display:flex;flex-wrap:wrap;gap:8px;">
        ${['🙂','😎','🤩','😏','🧐','🚀','💡','🎯','🔥','⚡','🌍','🧠','💎','👑','🦁','🐉','🌟','🏆','🦊','🤖'].map(e => 
          `<div onclick="selectWizEmoji('${e}')" data-wiz-emoji="${e}" style="width:40px;height:40px;border-radius:10px;border:2px solid var(--border2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all 0.15s;background:var(--s2);" onmouseover="this.style.borderColor='var(--g3)';this.style.background='rgba(34,197,94,0.1)'" onmouseout="if(!this.classList.contains('wiz-emo-sel')){this.style.borderColor='var(--border2)';this.style.background='var(--s2)'}">${e}</div>`
        ).join('')}
      </div>
    </div>
    <!-- Profile color -->
    <div style="margin-bottom:20px;">
      <label style="display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:10px;letter-spacing:1.5px;text-transform:uppercase;">🎨 COULEUR D'ACCENT</label>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        ${[['#22c55e','Vert'],['#3b82f6','Bleu'],['#a855f7','Violet'],['#f97316','Orange'],['#ef4444','Rouge'],['#ffd700','Or'],['#06b6d4','Cyan'],['#ec4899','Rose']].map(([c,n]) =>
          `<div onclick="selectWizColor('${c}')" data-wiz-color="${c}" title="${n}" style="width:36px;height:36px;border-radius:8px;background:${c};cursor:pointer;border:3px solid transparent;transition:all 0.2s;opacity:0.8;" onmouseover="this.style.opacity='1';this.style.transform='scale(1.1)'" onmouseout="if(!this.classList.contains('wiz-col-sel')){this.style.opacity='0.8';this.style.transform=''}"></div>`
        ).join('')}
      </div>
    </div>
    ${navBtns(5)}`;

  return '';
}

function prefillWizStep(step){
  if(!currentUser) return;
  const set = (id, val) => { const el = document.getElementById(id); if(el && val) el.value = val; };
  if(step === 1){
    set('wiz-name', currentUser.name !== currentUser.email?.split('@')[0] ? currentUser.name : '');
    set('wiz-username', currentUser.username);
    set('wiz-title', currentUser.title);
    set('wiz-location', currentUser.location);
    set('wiz-bio', currentUser.bio);
  } else if(step === 2){
    set('wiz-niche', currentUser.niche);
    set('wiz-goal', currentUser.goal);
    set('wiz-skills', currentUser.skills);
    set('wiz-tools', currentUser.tools);
    set('wiz-looking', currentUser.looking);
  } else if(step === 3){
    set('wiz-website', currentUser.website);
    set('wiz-tiktok', currentUser.tiktok);
    set('wiz-instagram', currentUser.instagram);
    set('wiz-twitter', currentUser.twitter);
    set('wiz-linkedin', currentUser.linkedin);
    set('wiz-youtube', currentUser.youtube);
    set('wiz-langs', currentUser.langs);
  } else if(step === 4){
    set('wiz-tiktok-count', currentUser.tiktokCount);
    set('wiz-ig-count', currentUser.igCount);
    set('wiz-projects-count', currentUser.projectsCount);
    set('wiz-sales', currentUser.sales);
  } else if(step === 5){
    if(currentUser.avatar) {
      const disp = document.getElementById('wiz-ava-emoji-display');
      if(disp) disp.textContent = currentUser.avatar;
    }
    if(currentUser.avatarUrl){
      const img = document.getElementById('wiz-ava-img');
      const disp = document.getElementById('wiz-ava-emoji-display');
      if(img){ img.src = currentUser.avatarUrl; img.style.display = 'block'; }
      if(disp) disp.style.display = 'none';
    }
  }
}

function saveWizStep(step){
  if(!currentUser) return;
  if(step === 1){
    const name = document.getElementById('wiz-name')?.value.trim();
    const username = document.getElementById('wiz-username')?.value.trim().replace('@','');
    if(!name){ toast('⚠️ Your name / stage name is required!'); return false; }
    Object.assign(currentUser, {
      name: name || currentUser.name,
      username: username || currentUser.username,
      title: document.getElementById('wiz-title')?.value.trim(),
      location: document.getElementById('wiz-location')?.value.trim(),
      bio: document.getElementById('wiz-bio')?.value.trim(),
    });
  } else if(step === 2){
    const niche = document.getElementById('wiz-niche')?.value.trim();
    const goal = document.getElementById('wiz-goal')?.value.trim();
    if(!niche){ toast('⚠️ Enter your sector / niche!'); return false; }
    const expEl = document.getElementById('wiz-exp');
    const dispoEl = document.getElementById('wiz-dispo');
    Object.assign(currentUser, {
      niche,
      exp: expEl?.options[expEl.selectedIndex]?.text,
      goal,
      skills: document.getElementById('wiz-skills')?.value.trim(),
      tools: document.getElementById('wiz-tools')?.value.trim(),
      dispo: dispoEl?.options[dispoEl.selectedIndex]?.text,
      looking: document.getElementById('wiz-looking')?.value.trim(),
    });
  } else if(step === 3){
    Object.assign(currentUser, {
      website: document.getElementById('wiz-website')?.value.trim(),
      tiktok: document.getElementById('wiz-tiktok')?.value.trim(),
      instagram: document.getElementById('wiz-instagram')?.value.trim(),
      twitter: document.getElementById('wiz-twitter')?.value.trim(),
      linkedin: document.getElementById('wiz-linkedin')?.value.trim(),
      youtube: document.getElementById('wiz-youtube')?.value.trim(),
      langs: document.getElementById('wiz-langs')?.value.trim(),
    });
  } else if(step === 4){
    const revEl = document.getElementById('wiz-revenue');
    const dispo2El = document.getElementById('wiz-dispo2');
    Object.assign(currentUser, {
      tiktokCount: document.getElementById('wiz-tiktok-count')?.value.trim(),
      igCount: document.getElementById('wiz-ig-count')?.value.trim(),
      projectsCount: document.getElementById('wiz-projects-count')?.value.trim(),
      sales: document.getElementById('wiz-sales')?.value.trim(),
      revenue: revEl?.options[revEl.selectedIndex]?.text,
      dispo: dispo2El?.options[dispo2El.selectedIndex]?.text || currentUser.dispo,
    });
  } else if(step === 5){
    // avatar saved via selectWizEmoji/handleWizAvatarUpload
  }
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  return true;
}

function wizNext(){
  if(!saveWizStep(_wizStep)) return;
  if(_wizStep < _WIZ_TOTAL){
    renderWizStep(_wizStep + 1);
  } else {
    finishProfileWizard();
  }
}
function wizBack(){
  if(_wizStep > 1) renderWizStep(_wizStep - 1);
}
function skipWizard(){
  if(_wizStep < _WIZ_TOTAL){
    renderWizStep(_wizStep + 1);
  } else {
    finishProfileWizard();
  }
}

function selectWizEmoji(emoji){
  document.querySelectorAll('[data-wiz-emoji]').forEach(el => {
    el.classList.remove('wiz-emo-sel');
    el.style.borderColor = 'var(--border2)';
    el.style.background = 'var(--s2)';
  });
  const el = document.querySelector('[data-wiz-emoji="'+emoji+'"]');
  if(el){ el.classList.add('wiz-emo-sel'); el.style.borderColor = 'var(--g3)'; el.style.background = 'rgba(34,197,94,0.15)'; }
  const disp = document.getElementById('wiz-ava-emoji-display');
  const img = document.getElementById('wiz-ava-img');
  if(disp){ disp.textContent = emoji; disp.style.display = ''; }
  if(img) img.style.display = 'none';
  if(currentUser) currentUser.avatar = emoji;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
}

function selectWizColor(color){
  document.querySelectorAll('[data-wiz-color]').forEach(el => {
    el.classList.remove('wiz-col-sel');
    el.style.borderColor = 'transparent';
    el.style.opacity = '0.8';
    el.style.transform = '';
  });
  const el = document.querySelector('[data-wiz-color="'+color+'"]');
  if(el){ el.classList.add('wiz-col-sel'); el.style.borderColor = '#fff'; el.style.opacity = '1'; el.style.transform = 'scale(1.15)'; }
  if(currentUser){ currentUser.accentColor = color; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
}

function handleWizAvatarUpload(input){
  const file = input.files[0];
  if(!file) return;
  const reader = new FeedeReader();
  reader.onload = e => {
    const img = document.getElementById('wiz-ava-img');
    const disp = document.getElementById('wiz-ava-emoji-display');
    const preview = document.getElementById('wiz-ava-preview');
    if(img){ img.src = e.target.result; img.style.display = 'block'; }
    if(disp) disp.style.display = 'none';
    if(currentUser){ currentUser.avatarUrl = e.target.result; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
    toast('✅ Photo uploaded!');
  };
  reader.readAsDataURL(file);
}

function finishProfileWizard(){
  // Close wizard
  const overlay = document.getElementById('profile-wizard-overlay');
  if(overlay){ overlay.style.opacity = '0'; overlay.style.transition = 'opacity 0.4s'; setTimeout(() => overlay.style.display = 'none', 400); }
  // Mark as onboarded
  if(currentUser){ currentUser.onboarded = true; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
  updateAppBar();
  renderMyProfile();
  // Show app tour
  setTimeout(() => openAppTour(), 500);
}

// ══════════════════════════════════════════════
// ── APP GUIDED TOUR ──
// ══════════════════════════════════════════════

const APP_TOUR_SLIDES = [
  {
    icon: '📢',
    color: '#22c55e',
    title: 'THE FEED — YOUR AD WALL',
    subtitle: 'Explore community posts',
    desc: 'The Feed is the heart of ViralBoost. Every member can post an ad, announcement, service or launch. You can <strong>like, comment, share</strong> and directly contact any creator.',
    tips: ['🔥 Filter by niche, post type or popularity','⚡ Vote for posts you like — earn credits','💬 Comment and engage to boost your visibility','📌 Save posts that interest you'],
    cta: 'Explore the Feed'
  },
  {
    icon: '📤',
    color: '#4ade80',
    title: 'PUBLISH — BROADCAST YOUR CONTENT',
    subtitle: 'Create your ad in 30 seconds',
    desc: 'The <strong>Publish</strong> tab lets you create a post in various types: announcement, product launch, service offer, collab, promo, poll... Each post is instantly visible to the entire community.',
    tips: ['🎯 Choose the right post type for your need','🖼️ Add an image or video for +70% engagement','🏷️ Use precise tags to reach the right audience','🚀 PRO & ELITE plans get automatic visibility boost'],
    cta: 'Create my first ad'
  },
  {
    icon: '🤝',
    color: '#a78bfa',
    title: 'AI MATCHING — FIND YOUR COLLABS',
    subtitle: 'AI connects the right creators together',
    desc: 'Our matching algorithm analyzes your profile, niche, goals and skills to suggest the most compatible collaborators. The more complete your profile, the more precise the suggestions.',
    tips: ['🧠 AI analyzes 12 compatibility criteria','📊 Match score displayed on each profile','💌 Send a DM directly from matching','🔄 New suggestions every day'],
    cta: 'See my matches'
  },
  {
    icon: '💬',
    color: '#38bdf8',
    title: 'GROUPS & CHAT — THE COMMUNITY',
    subtitle: 'Join groups by niche and interest',
    desc: '<strong>Groups</strong> are themed spaces where creators from the same niche gather to exchange, share resources and build projects together. The <strong>Global Chat</strong> connects the entire community in real time.',
    tips: ['🏛️ Join groups by theme: SaaS, TikTok, E-commerce...','✨ ELITE members can create their own groups','⚡ Global chat available 24/7 in real time','📎 Share images, links and files in groups'],
    cta: 'Join a group'
  },
  {
    icon: '🚀',
    color: '#fbbf24',
    title: 'AI BOOST & CREDITS — ACCELERATE YOUR GROWTH',
    subtitle: 'Powerful AI tools at your disposal',
    desc: 'The <strong>AI Boost</strong> module generates personalized strategies in 10 seconds: viral TikTok plan, SEO strategy, email campaign, investor pitch, launch plan... Use your <strong>ViralCredits</strong> to unlock premium features.',
    tips: ['⚡ 50 ViralCredits gifted at signup','🎯 Generate TikTok, SEO, Email, YouTube strategies...','💰 Earn credits by posting, voting, referring','💎 Paid plans give bonus credits every month'],
    cta: 'Try AI Boost'
  },
];

let _tourSlide = 0;

function openAppTour(){
  _tourSlide = 0;
  if(!document.getElementById('app-tour-overlay')){
    document.body.insertAdjacentHTML('beforeend', `
      <div id="app-tour-overlay" style="position:fixed;inset:0;background:rgba(4,10,5,0.97);backdrop-filter:blur(20px);z-index:10001;display:flex;align-items:center;justify-content:center;padding:16px;">
        <div id="app-tour-box" style="background:var(--s1);border:2px solid rgba(34,197,94,0.35);border-radius:20px;max-width:560px;width:100%;overflow:hidden;"></div>
      </div>`);
  }
  document.getElementById('app-tour-overlay').style.display = 'flex';
  renderTourSlide(0);
}

function renderTourSlide(idx){
  _tourSlide = idx;
  const s = APP_TOUR_SLIDES[idx];
  const box = document.getElementById('app-tour-box');
  if(!box) return;
  box.style.borderColor = s.color + '55';

  const dots = APP_TOUR_SLIDES.map((_,i) => 
    `<div style="width:${i===idx?'22px':'8px'};height:8px;border-radius:4px;background:${i===idx?s.color:'var(--muted2)'};transition:all 0.3s;"></div>`
  ).join('');

  box.innerHTML = `
    <!-- Colored header -->
    <div style="background:linear-gradient(135deg,${s.color}18,${s.color}08);border-bottom:1px solid ${s.color}22;padding:32px 32px 24px;text-align:center;">
      <div style="font-size:56px;margin-bottom:12px;filter:drop-shadow(0 0 16px ${s.color}60);">${s.icon}</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:#fff;margin-bottom:6px;">${s.title}</div>
      <div style="font-size:13px;color:${s.color};font-weight:600;">${s.subtitle}</div>
    </div>

    <!-- Contenu -->
    <div style="padding:24px 28px;">
      <p style="font-size:14px;color:#c4d9cb;line-height:1.8;margin-bottom:20px;">${s.desc}</p>

      <!-- Tips -->
      <div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 18px;margin-bottom:24px;">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:${s.color};letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;">CE QU'IL FAUT SAVOIR</div>
        ${s.tips.map(t => `<div style="font-size:13px;color:var(--g5);padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);line-height:1.5;">${t}</div>`).join('')}
      </div>

      <!-- Nav -->
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="display:flex;gap:6px;align-items:center;">${dots}</div>
        <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);">${idx+1} / ${APP_TOUR_SLIDES.length}</div>
      </div>
      <div style="display:flex;gap:10px;">
        ${idx > 0 ? `<button onclick="renderTourSlide(${idx-1})" style="flex:1;padding:12px;background:transparent;border:1.5px solid var(--border);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--muted);cursor:pointer;">← Previous</button>` : ''}
        ${idx < APP_TOUR_SLIDES.length - 1 
          ? `<button onclick="renderTourSlide(${idx+1})" style="flex:3;padding:13px;background:linear-gradient(135deg,${s.color}90,${s.color});border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:#fff;cursor:pointer;box-shadow:0 0 24px ${s.color}40;">Next →</button>`
          : `<button onclick="closeAppTour()" style="flex:3;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g3));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:var(--bg);cursor:pointer;box-shadow:0 0 28px rgba(34,197,94,0.45);">🚀 Launch ViralBoost !</button>`
        }
      </div>
      ${idx === APP_TOUR_SLIDES.length - 1 ? '' : `<button onclick="closeAppTour()" style="display:block;width:100%;text-align:center;background:none;border:none;font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;padding:6px;font-family:'Plus Jakarta Sans',sans-serif;">Passer le tutoriel</button>`}
    </div>`;
}

function closeAppTour(){
  const overlay = document.getElementById('app-tour-overlay');
  if(overlay){ overlay.style.opacity = '0'; overlay.style.transition = 'opacity 0.4s'; setTimeout(() => { overlay.style.display = 'none'; }, 400); }
  // Go to feed
  showAppTab('feed', null);
  setTimeout(() => toast('🎉 Welcome to ViralBoost! Explore the feed or publish your first ad.'), 600);
}
function updatePubCompletion(){
  const name = document.getElementById('pub-name')?.value.trim() || '';
  const desc = document.getElementById('pub-desc')?.value.trim() || '';
  const url  = document.getElementById('pub-url')?.value.trim() || '';
  const target = document.getElementById('pub-target')?.value.trim() || '';
  const tags = document.getElementById('pub-tags')?.value.trim() || '';
  const hasMedia = !!document.querySelector('#pub-media-preview img, #pub-media-preview video');

  const checks = {
    name: name.length >= 4,
    desc: desc.length >= 40,
    url: url.length > 5,
    target: target.length >= 3,
    tags: tags.length >= 2,
    media: hasMedia,
  };
  const done = Object.values(checks).filter(Boolean).length;
  const pct = Math.round((done / 6) * 100);

  const bar = document.getElementById('pub-completion-bar');
  const txt = document.getElementById('pub-completion-txt');
  if(bar){ bar.style.width = pct + '%'; bar.style.background = pct >= 80 ? 'linear-gradient(90deg,#16a34a,#4ade80)' : pct >= 50 ? 'linear-gradient(90deg,var(--g2),var(--g3))' : 'linear-gradient(90deg,var(--g1),var(--g2))'; }
  if(txt){ txt.textContent = pct + '%'; txt.style.color = pct >= 80 ? 'var(--g3)' : pct >= 50 ? 'var(--gold)' : 'var(--muted)'; }

  document.querySelectorAll('.pub-hint').forEach(el => {
    const hint = el.dataset.hint;
    el.classList.toggle('done', !!checks[hint]);
    el.classList.toggle('pending', !checks[hint]);
  });

  // Accountur nom
  const nc = document.getElementById('pub-name-count');
  if(nc) nc.textContent = name.length;
  // Label plan
  const pl = document.getElementById('pub-plan-label');
  if(pl && currentUser){ const lbl = {free:'FREE · 24h',starter:'STARTER · 7j',pro:'PRO · 30j',elite:'ELITE · Permanent'}; pl.textContent = '📋 ' + (lbl[currentUser.plan] || ''); }
}

function updateDescCount(){
  const d = document.getElementById('pub-desc')?.value || '';
  const c = document.getElementById('pub-desc-count');
  const q = document.getElementById('pub-desc-quality');
  if(c) c.textContent = d.length;
  if(q){
    if(d.length === 0) q.textContent = '';
    else if(d.length < 40) q.style.color = 'var(--muted)', q.textContent = '⚠️ Trop court';
    else if(d.length < 100) q.style.color = 'var(--gold)', q.textContent = '👍 Correct';
    else if(d.length < 200) q.style.color = 'var(--g3)', q.textContent = '✅ Bon';
    else q.style.color = 'var(--g4)', q.textContent = '🔥 Excellent';
  }
}

function renderTagsPreview(){
  const raw = document.getElementById('pub-tags')?.value || '';
  const container = document.getElementById('pub-tags-preview');
  if(!container) return;
  const tags = raw.split(',').map(t => t.trim()).filter(Boolean).slice(0, 5);
  container.innerHTML = tags.map(t => `<span class="pub-tag-chip">#${t}</span>`).join('');
  updatePubCompletion();
}

function insertDescTip(el){
  const tip = el.dataset.tip;
  const ta = document.getElementById('pub-desc');
  if(!ta) return;
  const cur = ta.value;
  const sep = cur.length > 0 && !cur.endsWith('\n') ? '\n' : '';
  ta.value = cur + sep + tip;
  ta.focus();
  updateDescCount();
  updatePubCompletion();
  updateMobilePreview();
  el.style.borderColor = 'var(--g3)';
  el.style.color = 'var(--g3)';
  setTimeout(() => { el.style.borderColor = ''; el.style.color = ''; }, 1000);
}

function updatePubTypeEmoji(){
  const type = document.getElementById('pub-type')?.value;
  const map = {saas:'🚀',site:'🌐',ecommerce:'🛍️',service:'💼',coaching:'🎓',tiktok:'🎵',instagram:'📸',newsletter:'📧',podcast:'🎙️',communaute:'👥'};
  const emojiInput = document.getElementById('pub-emoji');
  if(emojiInput && !emojiInput.value) emojiInput.value = map[type] || '🚀';
  updateMobilePreview();
}

// ── WIZARD NAVIGATION ──
let currentWizStep = 1;
const WIZ_TOTAL = 5;

function wizGoTo(step){
  // Confirm before advancing
  if(step > currentWizStep){
    for(let s = currentWizStep; s < step; s++){
      if(!wizValidate(s)) return;
    }
  }
  // Cacher panel actuel
  document.getElementById('wpanel-' + currentWizStep)?.classList.remove('active');
  // Update dots
  for(let i=1; i<=WIZ_TOTAL; i++){
    const dot = document.getElementById('wdot-'+i);
    const circ = document.getElementById('wcirc-'+i);
    const conn = document.getElementById('wconn-'+i);
    if(!dot||!circ) continue;
    dot.className = 'wiz-step-dot' + (i===step?' active':i<step?' done':'');
    circ.className = 'wiz-step-circle' + (i===step?' active':i<step?' done':'');
    if(conn) conn.className = 'wiz-connector' + (i<step?' done':'');
  }
  // Afficher new panel
  currentWizStep = step;
  document.getElementById('wpanel-' + step)?.classList.add('active');
  // Progress bar
  const pct = Math.round((step/WIZ_TOTAL)*100);
  const fill = document.getElementById('wiz-prog-fill');
  if(fill) fill.style.width = pct+'%';
  // Si step 5 : refresh preview
  if(step===5) wizRefreshPreview();
  // Scroll to top of wizard
  document.getElementById('wiz-stepper')?.scrollIntoView({behavior:'smooth',block:'start'});
}

function wizNext(from){ if(wizValidate(from)) wizGoTo(from+1); }
function wizPrev(from){ wizGoTo(from-1); }

function wizValidate(step){
  if(step===1){
    const n = document.getElementById('pub-name')?.value.trim()||'';
    if(n.length < 3){ toast('Give your project a name (3 characters min)','error'); document.getElementById('pub-name')?.focus(); return false; }
  }
  if(step===2){
    const d = document.getElementById('pub-desc')?.value.trim()||'';
    if(d.length < 20){ toast('The description is too short (20 characters min)','error'); document.getElementById('pub-desc')?.focus(); return false; }
  }
  return true;
}

function wizRefreshPreview(){
  const name = document.getElementById('pub-name')?.value||'';
  const desc = document.getElementById('pub-desc')?.value||'';
  const hook = document.getElementById('pub-hook')?.value||'';
  const emoji = document.getElementById('pub-emoji')?.value||'🚀';
  const tags = (document.getElementById('pub-tags')?.value||'').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const collab = document.getElementById('pub-collab-need')?.value||'';

  const pname = document.getElementById('wiz-prev-name');
  const pdesc = document.getElementById('wiz-prev-desc');
  const phook = document.getElementById('wiz-prev-hook');
  const pemoji = document.getElementById('wiz-prev-emoji');
  const ptags = document.getElementById('wiz-prev-tags');
  const pcollab = document.getElementById('wiz-prev-collab');
  const pauthor = document.getElementById('wiz-prev-author');
  const pimg = document.getElementById('wiz-prev-img');

  if(pname) pname.textContent = name||'Project name';
  if(pdesc) pdesc.textContent = desc ? desc.slice(0,200)+(desc.length>200?'...':'') : 'Your description will appear here...';
  if(phook){ phook.textContent=hook; phook.style.display=hook?'block':'none'; }
  if(pemoji) pemoji.textContent=emoji;
  if(ptags) ptags.innerHTML=tags.map(t=>`<span class="pub-tag-chip" style="font-size:10px;padding:2px 8px">#${t}</span>`).join('');
  const collabMap={dev:'🔍 Looking for dev',marketing:'🔍 Looking for marketer',design:'🔍 Looking for designer',video:'🔍 Looking for video creator',investisseur:'🔍 Cherche investisseur',associe:'🔍 Looking for partner',client:'🔍 Premiers clients'};
  if(pcollab){ pcollab.textContent=collabMap[collab]||''; pcollab.style.display=collab?'block':'none'; }
  if(pauthor&&currentUser) pauthor.textContent=currentUser.name||'';
  // Image si uploadée
  if(pimg && pendingPubMediaUrl){ pimg.src=pendingPubMediaUrl; pimg.style.display='block'; const pe=document.getElementById('wiz-prev-emoji'); if(pe) pe.style.display='none'; }
  else if(pimg){ pimg.style.display='none'; const pe=document.getElementById('wiz-prev-emoji'); if(pe){ pe.style.display='block'; } }

  // Completion checklist
  wizRefreshChecklist();
}

function wizRefreshChecklist(){
  const name = document.getElementById('pub-name')?.value.trim()||'';
  const desc = document.getElementById('pub-desc')?.value.trim()||'';
  const url = document.getElementById('pub-url')?.value.trim()||'';
  const target = document.getElementById('pub-target')?.value.trim()||'';
  const tags = document.getElementById('pub-tags')?.value.trim()||'';
  const hasMedia = !!pendingPubMediaUrl;
  const checks=[
    {key:'name',label:'📝 Nom',ok:name.length>=3},
    {key:'desc',label:'💬 Description',ok:desc.length>=50},
    {key:'hook',label:'✨ Accroche',ok:!!(document.getElementById('pub-hook')?.value.trim())},
    {key:'url',label:'🔗 Link',ok:url.length>5},
    {key:'target',label:'🎯 Audience',ok:target.length>3},
    {key:'tags',label:'🏷️ Tags',ok:tags.length>1},
    {key:'media',label:'🖼️ Visuel',ok:hasMedia},
  ];
  const done=checks.filter(c=>c.ok).length;
  const pct=Math.round((done/checks.length)*100);
  const bar=document.getElementById('wiz-completion-bar');
  const pctEl=document.getElementById('wiz-completion-pct');
  const hints=document.getElementById('wiz-hints');
  if(bar) bar.style.width=pct+'%';
  if(pctEl){ pctEl.textContent=pct+'%'; pctEl.style.color=pct>=80?'var(--g3)':pct>=50?'var(--gold)':'var(--muted)'; }
  if(hints) hints.innerHTML=checks.map(c=>`<span style="font-size:10px;font-family:'DM Mono',monospace;padding:2px 8px;border-radius:3px;background:${c.ok?'rgba(34,197,94,0.12)':'rgba(0,0,0,0.2)'};border:1px solid ${c.ok?'rgba(34,197,94,0.25)':'var(--border2)'};color:${c.ok?'var(--g4)':'var(--muted)'}">${c.ok?'✓':''} ${c.label}</span>`).join('');
}

// ── GUIDE MODAL ──
function showPubGuide(){
  document.getElementById('pub-guide-overlay')?.classList.remove('hidden');
}
function closePubGuide(){
  document.getElementById('pub-guide-overlay')?.classList.add('hidden');
  localStorage.setItem('vb_pub_guide_seen','1');
}

// Override updateMobilePreview to also update showcase preview
const _origUpdateMobilePreview = typeof updateMobilePreview !== 'undefined' ? updateMobilePreview : null;
function updateMobilePreview(){
  const name = document.getElementById('pub-name')?.value || '';
  const desc = document.getElementById('pub-desc')?.value || '';
  const hook = document.getElementById('pub-hook')?.value || '';
  const emoji = document.getElementById('pub-emoji')?.value || '🚀';
  const tags = (document.getElementById('pub-tags')?.value || '').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const stage = document.getElementById('pub-stage')?.value || '';
  const collab = document.getElementById('pub-collab-need')?.value || '';

  // Mobile preview (olds IDs maintenus for compat)
  const mn = document.getElementById('mob-preview-name') || document.querySelector('#mobile-pub-preview .mob-title');
  const md = document.getElementById('mob-preview-desc') || document.querySelector('#mobile-pub-preview .mob-text');
  if(mn) mn.textContent = name || 'Project name';
  if(md) md.textContent = desc ? desc.slice(0, 100) + (desc.length > 100 ? '...' : '') : 'Your ad description will appear here...';

  // Olds IDs de prévisualisation (compat)
  const pn = document.getElementById('pub-preview-name');
  const pd = document.getElementById('pub-preview-desc');
  const pe = document.getElementById('pub-preview-emoji');
  const ph = document.getElementById('pub-preview-hook');
  const pt = document.getElementById('pub-preview-tags');
  const ps = document.getElementById('pub-preview-stage-badge');
  const pc = document.getElementById('pub-preview-collab-badge');
  const pa = document.getElementById('pub-preview-author');
  if(pn) pn.textContent = name || 'Project name';
  if(pd) pd.textContent = desc ? desc.slice(0, 160) + (desc.length > 160 ? '...' : '') : 'Your description will appear here...';
  if(pe) pe.textContent = emoji;
  if(ph){ ph.textContent = hook; ph.style.display = hook ? 'block' : 'none'; }
  if(pt){ pt.innerHTML = tags.map(t => `<span class="pub-tag-chip" style="font-size:10px;padding:2px 8px">#${t}</span>`).join(''); }
  const stageMap = {idee:'💭 Idea',beta:'🧪 Beta',lance:'🚀 Launched',croissance:'📈 Growing',monetise:'💰 Monetized'};
  if(ps){ ps.textContent = stageMap[stage] || ''; ps.style.display = stage && stage !== 'lance' ? 'block' : 'none'; }
  if(pc){ const collabMap = {dev:'🔍 Looking for dev',marketing:'🔍 Looking for marketer',design:'🔍 Looking for designer',video:'🔍 Looking for video creator',investisseur:'🔍 Cherche investisseur',associe:'🔍 Looking for partner',client:'🔍 Premiers clients'}; pc.textContent = collabMap[collab]||''; pc.style.display = collab ? 'block' : 'none'; }
  if(pa && currentUser) pa.textContent = currentUser.name || '';

  // Completion
  updatePubCompletion();
}

// ── STATS / ANALYTICS — VRAIES DONNÉES ──
function loadStats(){
  if(!currentUser)return;

  // My real publications
  const myPosts=feedPosts.filter(p=>p.userId===currentUser.email||p.userId===currentUser.id);
  const myProjects=showcaseData.filter(p=>p.authorId===currentUser.email);

  // Real numbers calculated from real data
  const totalLikes=myPosts.reduce((s,p)=>s+(p.likes||0),0);
  const totalComments=myPosts.reduce((s,p)=>s+(p.comments||0),0);
  const totalVotes=myProjects.reduce((s,p)=>s+(p.votes||0),0);
  const totalFollowers=(currentUser.followers||[]).length;
  const totalFollowing=(currentUser.following||[]).length;

  // KPIs
  document.getElementById('stat-views').textContent=(totalLikes*12+totalComments*5+myPosts.length*30).toLocaleString('fr');
  document.getElementById('stat-clicks').textContent=(totalLikes*2+totalVotes).toLocaleString('fr');
  document.getElementById('stat-posts').textContent=myPosts.length+myProjects.length;
  document.getElementById('stat-followers').textContent=totalFollowers;

  // Trending based on real data
  const hasActivity=myPosts.length>0||myProjects.length>0;
  document.getElementById('stat-views-trend').textContent=hasActivity?'↑ Active':'— Publie for view tes stats';
  document.getElementById('stat-views-trend').className='stat-card-trend '+(hasActivity?'up':'');
  document.getElementById('stat-clicks-trend').textContent=totalLikes>0?'↑ '+totalLikes+' likes':'— 0 like';
  document.getElementById('stat-clicks-trend').className='stat-card-trend '+(totalLikes>0?'up':'');
  document.getElementById('stat-followers-trend').textContent=totalFollowers>0?'↑ '+totalFollowing+' subscriptions':'— Follow creatorsteurs';
  document.getElementById('stat-followers-trend').className='stat-card-trend '+(totalFollowers>0?'up':'');

  // 7-day views chart — based on your real posts
  const chart=document.getElementById('views-chart');
  const labels=document.getElementById('views-chart-labels');
  const days=['L','M','M','J','V','S','D'];
  const today=new Date();
  // Calculate real daily views by looking at post timestamps
  const vals=days.map((_,i)=>{
    const d=new Date(today);d.setDate(today.getDate()-6+i);
    const dayStr=d.toDateString();
    const dayPosts=myPosts.filter(p=>{
      if(!p.createdAt&&!p.time)return false;
      const pd=p.createdAt?new Date(p.createdAt).toDateString():'';
      return pd===dayStr;
    });
    // If no precise timestamps, distribute existing likes
    return dayPosts.length>0?dayPosts.reduce((s,p)=>s+(p.likes||0)*12+15,0):0;
  });
  // If no data with timestamp, still show totals in readable format
  const hasTimestamps=vals.some(v=>v>0);
  const displayVals=hasTimestamps?vals:[0,0,0,0,0,0,totalLikes*12+myPosts.length*30];
  const max=Math.max(...displayVals,1);
  if(chart){
    chart.innerHTML=displayVals.map((v,i)=>`<div class="mini-bar" style="height:${Math.max(4,Math.round(v/max*100))}%;${v===0?'opacity:0.2':''}" title="Day ${days[i]}: ${v} estimated views"></div>`).join('');
    labels.innerHTML=days.map(d=>`<span>${d}</span>`).join('');
  }

  // User's TOP REAL posts
  const tp=document.getElementById('top-posts-list');
  if(tp){
    if(!myPosts.length&&!myProjects.length){
      tp.innerHTML='<div style="color:var(--muted);font-size:11px;padding:8px 0">You haven\'t posted yet. <a onclick="showAppTab(\'publish\',null)" style="color:var(--g3);cursor:pointer">Publish maintenant →</a></div>';
    } else {
      const sorted=[...myPosts].sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,3);
      tp.innerHTML=sorted.map((p,i)=>`
        <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border2)">
          <div style="font-size:11px;color:var(--g5);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px">${i+1}. ${escHtml((p.text||'').substring(0,40))}</div>
          <div style="display:flex;gap:8px;font-family:'DM Mono',monospace;font-size:10px;flex-shrink:0">
            <span style="color:var(--g3)">❤️ ${p.likes||0}</span>
            <span style="color:var(--muted)">💬 ${p.comments||0}</span>
          </div>
        </div>`).join('');
    }
  }

  // Distribution by category — MY real projects
  const cc=document.getElementById('cat-chart');
  if(cc){
    const allMine=[...myPosts,...myProjects];
    if(!allMine.length){
      cc.innerHTML='<div style="color:var(--muted);font-size:11px;padding:8px 0">No posts yet</div>';
    } else {
      const catCount={};
      allMine.forEach(p=>{
        const cat=p.projType||p.cat||p.type||'autre';
        catCount[cat]=(catCount[cat]||0)+1;
      });
      const total=allMine.length;
      const catEmojis={site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️',service:'💼',coaching:'🎓',autre:'📦'};
      cc.innerHTML=Object.entries(catCount).sort((a,b)=>b[1]-a[1]).map(([cat,count])=>{
        const pct=Math.round(count/total*100);
        return `<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
          <span style="font-size:11px;width:80px;flex-shrink:0">${catEmojis[cat]||'📦'} ${cat}</span>
          <div style="flex:1;height:8px;background:var(--s2);border-radius:4px">
            <div style="width:${pct}%;height:100%;background:var(--g2);border-radius:4px;transition:width 0.5s"></div>
          </div>
          <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);width:28px;text-align:right">${pct}%</span>
        </div>`;
      }).join('');
    }
  }

  // Overall summary at bottom
  const summary=`
    <div style="background:rgba(34,197,94,0.05);border:1.5px solid rgba(34,197,94,0.12);border-radius:10px;padding:14px 18px;margin-top:14px;font-size:12px;color:var(--g5);line-height:1.8">
      📊 <strong style="color:var(--g3)">${myPosts.length}</strong> publication${myPosts.length>1?'s':''} ·
      <strong style="color:var(--g3)">${myProjects.length}</strong> project${myProjects.length>1?'s':''} en showcase ·
      <strong style="color:var(--g3)">${totalLikes}</strong> like${totalLikes>1?'s':''} received ·
      <strong style="color:var(--g3)">${totalVotes}</strong> vote${totalVotes>1?'s':''} ·
      <strong style="color:var(--g3)">${totalFollowers}</strong> follower${totalFollowers>1?'s':''}
    </div>`;
  const statsPanel=document.getElementById('tab-stats');
  if(statsPanel){
    const existing=statsPanel.querySelector('.stats-summary');
    if(existing)existing.remove();
    const wrap=statsPanel.querySelector('[style*="max-width:960px"]');
    if(wrap){const div=document.createElement('div');div.className='stats-summary';div.innerHTML=summary;wrap.appendChild(div);}
  }
}

// ── BOOST CREDITS ──
let userCredits=parseInt(localStorage.getItem('vb_credits')||'0');
let selectedBoostOpt='top-feed';
let pendingShopItem=null, pendingShopCost=0;

// ── MISSIONS QUOTIDIENNES ──
const MISSIONS_DEF = [
  // ── QUOTIDIENNES ──
  { id:'pub1',      icon:'📝', title:'Publie aujourd\'hui',         desc:'Poste 1 publication',              max:1,  reward:8,  counter:u=>Math.min(u._todayPosts||0,1) },
  { id:'pub3',      icon:'🔥', title:'3 publications en un jour',   desc:'Poste 3 publications aujourd\'hui',max:3,  reward:20, counter:u=>Math.min(u._todayPosts||0,3) },
  { id:'pub5',      icon:'💥', title:'5 publications en un jour',   desc:'Poste 5 publications aujourd\'hui',max:5,  reward:35, counter:u=>Math.min(u._todayPosts||0,5) },
  { id:'like3',     icon:'❤️', title:'Like 3 posts',                desc:'Aime 3 publications',              max:3,  reward:6,  counter:u=>Math.min(u._todayLikes||0,3) },
  { id:'like10',    icon:'💗', title:'Like 10 posts',               desc:'Like 10 posts',             max:10, reward:15, counter:u=>Math.min(u._todayLikes||0,10) },
  { id:'dm1',       icon:'💬', title:'Send a DM',                desc:'Contact a creator',             max:1,  reward:5,  counter:u=>Math.min(u._todayDMs||0,1) },
  { id:'dm3',       icon:'📨', title:'3 DMs sent',               desc:'Contact 3 creators',             max:3,  reward:12, counter:u=>Math.min(u._todayDMs||0,3) },
  { id:'profile',    icon:'✍️', title:'Complete your profile',         desc:'Add bio + link',                max:1,  reward:15, counter:u=>(u.bio&&u.bio.length>10&&(u.website||u.tiktok||u.instagram)?1:0) },
  { id:'showcase1',  icon:'✨', title:'Publish to showcase',           desc:'Add a project to showcase',    max:1,  reward:12, counter:u=>Math.min(u._todayProjects||0,1) },
  { id:'chat5',     icon:'🌐', title:'5 global chat messages',     desc:'Participate in the community chat',  max:5,  reward:10, counter:u=>Math.min(u._todayChat||0,5) },
  { id:'chat10',    icon:'💭', title:'10 global chat messages',    desc:'Actively contribute to chat',     max:10, reward:20, counter:u=>Math.min(u._todayChat||0,10) },
  { id:'login', icon:'🌅', title:'Log in quotidienne',       desc:'Connecte-toi chaque jour',         max:1,  reward:5,  counter:u=>1 },
  { id:'vote3',     icon:'🗳️', title:'Vote for 3 projects',         desc:'Vote for projects in showcase', max:3,  reward:8,  counter:u=>Math.min(u._todayVotes||0,3) },
  { id:'share1',    icon:'📤', title:'Share a post',     desc:'Share 1 community post',   max:1,  reward:7,  counter:u=>Math.min(u._todayShares||0,1) },
  { id:'react5',    icon:'😍', title:'5 reactions on posts',   desc:'Use 5 reactions (🔥💡💸👏)',   max:5,  reward:10, counter:u=>Math.min(u._todayReacts||0,5) },
  { id:'react_all', icon:'🎭', title:'Use 4 types of reactions',desc:'Try fire, idea, cash and bravo',  max:4,  reward:18, counter:u=>Math.min(u._todayReactTypes||0,4) },
  { id:'follow1',   icon:'👥', title:'Follow a creator',            desc:'Subscribe to 1 creator',          max:1,  reward:5,  counter:u=>Math.min((u._todayFollows||0),1) },
  { id:'follow5',   icon:'🤝', title:'Follow 5 creators',            desc:'Subscribe to 5 creators',         max:5,  reward:15, counter:u=>Math.min((u._todayFollows||0),5) },
  { id:'comment2',  icon:'💡', title:'Commente 2 posts',            desc:'Laisse 2 comments',            max:2,  reward:8,  counter:u=>Math.min(u._todayComments||0,2) },
  { id:'iaboost1',  icon:'🤖', title:'Use AI Boost',            desc:'Generate an AI strategy',          max:1,  reward:18, counter:u=>Math.min(u._todayIA||0,1) },
  { id:'collab1',   icon:'🔗', title:'Propose a collaboration',   desc:'Contacte quelqu\'un via Collabs',  max:1,  reward:20, counter:u=>Math.min(u._todayCollabs||0,1) },
  { id:'group1',    icon:'👾', title:'Join a group',           desc:'Join 1 themed group',  max:1,  reward:10, counter:u=>Math.min(u._todayGroups||0,1) },
  { id:'profile_img',icon:'🖼️', title:'Add your social networks', desc:'Add TikTok or Instagram',    max:1,  reward:12, counter:u=>(u.tiktok||u.instagram?1:0) },
  { id:'streak3',   icon:'🌟', title:'Log in 3 jours de suite',  desc:'Reviens chaque jour',              max:3,  reward:30, counter:u=>Math.min(u._loginStreak||0,3) },
  { id:'credits50', icon:'⚡', title:'Accumulate 50 credits',         desc:'Reach 50 ViralCredits',          max:50, reward:25, counter:u=>Math.min(userCredits||0,50) },
  { id:'pub_desc',  icon:'📋', title:'Post with long description', desc:'Write a post with 100+ characters', max:1,  reward:10, counter:u=>Math.min(u._todayLongPosts||0,1) },
  // ── NEW — IMAGES & MEDIA ──
  { id:'pub_img',   icon:'📸', title:'Post with an image',       desc:'Add a photo to your post',max:1,  reward:14, counter:u=>Math.min(u._todayMediaPosts||0,1) },
  { id:'pub_img3',  icon:'🖼️', title:'3 posts with image',           desc:'Post 3 times with an image',     max:3,  reward:28, counter:u=>Math.min(u._todayMediaPosts||0,3) },
  { id:'pub_video', icon:'🎬', title:'Post a video',            desc:'Share a video with the community',max:1, reward:20, counter:u=>Math.min(u._todayVideoPosts||0,1) },
  { id:'pub_file',  icon:'📄', title:'Share un fichier',          desc:'Add un fichier PDF ou document', max:1, reward:12, counter:u=>Math.min(u._todayFeedePosts||0,1) },
  { id:'showcase_img',icon:'🌠',title:'Showcase with image',          desc:'Publish a project with a visual',  max:1,  reward:20, counter:u=>Math.min(u._todayVisualProjects||0,1) },
  // ── NEW — AVATAR ICONS ──
  { id:'ava_emoji', icon:'🎭', title:'Change your avatar',            desc:'Update your emoji or photo',   max:1,  reward:8,  counter:u=>(u._changedAvatar?1:0) },
  { id:'ava_photo', icon:'📷', title:'Profile photo',             desc:'Add a real profile photo', max:1,  reward:25, counter:u=>(u.avatarUrl?1:0) },
  // ── NEW — PREMIUM REACTIONS ──
  { id:'react_rocket',icon:'🚀',title:'Reaction Takeoff',        desc:'Use the 🚀 reaction (Starter+)', max:3,  reward:15, counter:u=>Math.min(u._todayRocketReacts||0,3), premium:'starter' },
  { id:'react_crown', icon:'👑',title:'Reaction Royale',           desc:'Use the 👑 reaction (Pro+)',     max:3,  reward:20, counter:u=>Math.min(u._todayCrownReacts||0,3), premium:'pro' },
  { id:'react_gem',   icon:'💎',title:'Reaction Gem',              desc:'Use the 💎 reaction (Pro+)',     max:5,  reward:18, counter:u=>Math.min(u._todayGemReacts||0,5),   premium:'pro' },
  { id:'react_star',  icon:'🌟',title:'Reaction Star',             desc:'Use the 🌟 reaction (Elite)',   max:5,  reward:25, counter:u=>Math.min(u._todayStarReacts||0,5),  premium:'elite' },
];

function getMissionsState(){
  const today = new Date().toDateString();
  const raw = JSON.parse(localStorage.getItem('vb_missions_'+today)||'{}');
  return raw;
}
function saveMissionsState(state){
  const today = new Date().toDateString();
  localStorage.setItem('vb_missions_'+today, JSON.stringify(state));
}

function renderMissions(){
  const list = document.getElementById('missions-list');
  if(!list) return;
  const state = getMissionsState();
  const plan = currentUser?.plan||'free';
  const planOrder = {free:0,starter:1,pro:2,elite:3};
  const userLevel = planOrder[plan]||0;

  // Groupr par category
  const categories = [
    {label:'📅 Quotidiennes', ids:['pub1','pub3','pub5','like3','like10','login','dm1','dm3','chat5','chat10','vote3','share1','comment2','follow1','follow5','iaboost1','collab1','group1']},
    {label:'🖼️ Images & Media', ids:['pub_img','pub_img3','pub_video','pub_file','showcase_img','pub_desc','showcase1']},
    {label:'😎 Avatar & Profile', ids:['ava_emoji','ava_photo','profile','profile_img']},
    {label:'🎭 Reactions', ids:['react5','react_all','react_rocket','react_crown','react_gem','react_star']},
    {label:'⚡ Progression', ids:['streak3','credits50']},
  ];

  let html = '';
  categories.forEach(cat => {
    const missions = MISSIONS_DEF.filter(m => cat.ids.includes(m.id));
    if(!missions.length) return;
    html += `<div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;margin:16px 0 8px;text-transform:uppercase">${cat.label}</div>`;
    html += missions.map(m => {
      const prog = m.counter(currentUser||{});
      const done = state[m.id+'_claimed'];
      const canClaim = prog >= m.max && !done;
      const pct = Math.round((prog/m.max)*100);
      const reqLevel = m.premium ? planOrder[m.premium]||0 : 0;
      const locked = reqLevel > 0 && userLevel < reqLevel;
      const premiumBadge = m.premium ? `<span style="font-size:8px;font-family:'DM Mono',monospace;background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.15));border:1px solid rgba(255,215,0,0.4);border-radius:3px;padding:1px 6px;color:var(--gold);margin-left:6px">${m.premium.toUpperCase()}</span>` : '';
      return `<div class="mission-card ${done?'done':''} ${locked?'locked':''}">
        <div class="mission-icon" style="${locked?'filter:grayscale(1);opacity:0.5':''}">${m.icon}</div>
        <div class="mission-info">
          <div class="mission-title">${m.title}${premiumBadge}</div>
          <div class="mission-desc">${locked?`🔒 Requires ${m.premium?.toUpperCase()} — Upgrade to unlock`:m.desc}</div>
          <div class="mission-prog-bar"><div class="mission-prog-fill" style="width:${locked?0:pct}%"></div></div>
          <div class="mission-prog-txt">${locked?'--':prog+'/'+m.max}</div>
        </div>
        <div class="mission-reward">
          <div class="mission-reward-val" style="${locked?'color:var(--muted)':''}">+${m.reward}</div>
          <div class="mission-reward-label">⚡ credits</div>
          ${done
            ? '<div class="mission-done-tag">✅ Claimed</div>'
            : locked
              ? `<button class="btn-claim" style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,140,0,0.08));border-color:rgba(255,215,0,0.3);color:var(--gold)" onclick="openModal('pricing-modal')">Upgrade →</button>`
              : `<button class="btn-claim" onclick="claimMission('${m.id}',${m.reward})" ${canClaim?'':'disabled'}>${canClaim?'Claim':'In progress'}</button>`
          }
        </div>
      </div>`;
    }).join('');
  });
  list.innerHTML = html;
}

function claimMission(id, reward){
  const m = MISSIONS_DEF.find(x=>x.id===id);
  if(!m) return;
  const prog = m.counter(currentUser||{});
  if(prog < m.max){ toast('Mission not yet completed!','error'); return; }
  const state = getMissionsState();
  if(state[id+'_claimed']){ toast('Already claimed!','error'); return; }
  state[id+'_claimed'] = true;
  saveMissionsState(state);
  addCredits(reward);
  toast(`⚡ +${reward} credits claimed! Mission accomplished 🎯`);
  renderMissions();
}

function updateMissionsCountdown(){
  const el = document.getElementById('missions-countdown');
  if(!el) return;
  const now = new Date();
  const midnight = new Date(now); midnight.setHours(24,0,0,0);
  const diff = midnight - now;
  const h = Math.floor(diff/3600000);
  const m = Math.floor((diff%3600000)/60000);
  const s = Math.floor((diff%60000)/1000);
  el.textContent = String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}
setInterval(updateMissionsCountdown, 1000);

// Incrémenter accounturs journaliers
function trackTodayAction(action){
  if(!currentUser) return;
  const key = '_today'+action;
  currentUser[key] = (currentUser[key]||0)+1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  renderMissions();
}

// ── SHOP ──
function switchCreditsTab(tab, btn){
  document.querySelectorAll('.credits-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.cpanel').forEach(p=>p.classList.remove('active'));
  const tabBtn = typeof btn === 'string' ? document.getElementById('ctab-'+tab) : btn;
  if(tabBtn) tabBtn.classList.add('active');
  const panel = document.getElementById('cpanel-'+tab);
  if(panel) panel.classList.add('active');
  if(tab==='missions') renderMissions();
  if(tab==='boost'||tab==='shop') loadBoostPostOptions();
  if(tab==='plans') updatePlansCreditsPanel();
}

function updatePlansCreditsPanel(){
  const el = document.getElementById('plans-credits-display');
  const planEl = document.getElementById('plans-current-plan');
  if(el) el.textContent = userCredits;
  if(planEl && currentUser) planEl.textContent = (currentUser.plan||'free').toUpperCase();
  // Update progress bars
  const costs = { starter:800, pro:3500, elite:9000 };
  ['starter','pro','elite'].forEach(planId=>{
    const cost = costs[planId];
    const pct = Math.min(100, Math.round((userCredits/cost)*100));
    const bar = document.getElementById(planId+'-progress-bar');
    const txt = document.getElementById(planId+'-progress-txt');
    if(bar) bar.style.width = pct+'%';
    if(txt){
      if(userCredits >= cost) txt.textContent = '✅ Tu peux buy ce plan !';
      else txt.textContent = `${userCredits}/${cost}⚡ (${pct}% atteint — il te manque ${cost-userCredits}⚡)`;
      txt.style.color = userCredits >= cost ? 'var(--g3)' : 'var(--muted)';
    }
  });
}

let _shopBoostType=null, _shopBoostCost=0;
function shopBuy(item, cost){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const boostItems = ['top-feed','showcase-24h','notif-push','boost-7j'];
  if(boostItems.includes(item)){
    if(userCredits < cost){ toast(`⚡ Il te faut ${cost} credits. Tu en as ${userCredits}.`,'error'); return; }
    const wrap = document.getElementById('shop-boost-select-wrap');
    wrap.style.display = 'block';
    _shopBoostType = item; _shopBoostCost = cost;
    loadBoostPostOptions();
    wrap.scrollIntoView({behavior:'smooth',block:'nearest'});
    return;
  }
  if(userCredits < cost){ toast(`⚡ Il te faut ${cost} credits. Tu en as ${userCredits}.`,'error'); return; }
  spendCredits(cost);
  const labels={
    'cadre-or':'🖼️ Golden Frame activated on your profile!',
    'badge-feu':'🔥 Fire Badge added to your profile!',
    'emoji-pack':'🎭 Emojis+ Pack unlocked!',
    'title-vip':'💎 VIP title added under your name!',
    'ia-analysis':'🔬 AI Analysis launched — check the AI Boost tab!',
    'ia-hashtags':'📌 30 viral hashtags generated — check AI Boost!',
    'ia-strategie':'🗺️ 30-day strategy generated — check AI Boost!'
  };
  toast(labels[item]||'✅ Purchase made!');
  // Save the purchase
  const bought = JSON.parse(localStorage.getItem('vb_shop_items')||'[]');
  bought.push({item, date:new Date().toISOString()});
  localStorage.setItem('vb_shop_items', JSON.stringify(bought));
}

function confirmShopBoost(){
  const sel = document.getElementById('boost-post-select');
  if(!sel||!sel.value){ toast('Please choose a post!','error'); return; }
  if(userCredits < _shopBoostCost){ toast(`⚡ Insufficient credits.`,'error'); return; }
  spendCredits(_shopBoostCost);
  document.getElementById('shop-boost-select-wrap').style.display='none';
  const labels={'top-feed':'🔝 Post moved to top of feed for 2h!','showcase-24h':'✨ Post pinned in showcase for 24h!','notif-push':'🔔 Notification sent to the community!','boost-7j':'🏆 Boost 7 jours activated!'};
  toast(labels[_shopBoostType]||'🚀 Boost activated!');
}

function addCredits(n){
  userCredits += n;
  localStorage.setItem('vb_credits', userCredits);
  updateCreditsDisplay();
}
function spendCredits(n){
  userCredits = Math.max(0, userCredits - n);
  localStorage.setItem('vb_credits', userCredits);
  updateCreditsDisplay();
}

// ── BUY A PLAN WITH CREDITS ──
const PLAN_CREDIT_COSTS = { starter: 800, pro: 3500, elite: 9000 };
function buyPlanWithCredits(planId){
  if(!currentUser){ openModal('login-modal'); return; }
  const cost = PLAN_CREDIT_COSTS[planId];
  if(!cost){ toast('Plan introuvable.','error'); return; }
  const planName = planId.toUpperCase();
  if(currentUser.plan === planId){ toast(`You already have the ${planName} !`,'error'); return; }
  if(userCredits < cost){
    const missing = cost - userCredits;
    toast(`⚡ You need ${missing} more credits for the ${planName} plan. Keep completing missions!`,'error');
    return;
  }
  if(!confirm(`Buy the ${planName} for ${cost}⚡ ViralCredits (1 month)?`)) return;
  spendCredits(cost);
  const prevPlan = currentUser.plan;
  currentUser.plan = planId;
  currentUser._planBoughtWithCredits = (currentUser._planBoughtWithCredits||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  updateAppBar();
  checkNewBadges();
  toast(`🎉 Plan ${planName} activated for 1 month! -${cost}⚡`);
  // Sync API
  try{ fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)}).catch(()=>{}); }catch(e){}
  // Refresh credits display
  updateCreditsDisplay();
}

function updateCreditsDisplay(){
  const val = userCredits;
  document.querySelectorAll('#user-credits').forEach(el=>el.textContent=val);
  const hc = document.getElementById('header-credits');
  if(hc) hc.textContent = val;
  const bnc = document.getElementById('bn-credits-val');
  if(bnc) bnc.textContent = val;
}
function bottomNavGoCredits(btn){
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  showAppTab('boost-credits', document.querySelector('.app-tab[onclick*="boost-credits"]'));
  switchCreditsTab('shop', document.getElementById('ctab-shop'));
}
function selectBoostOpt(el,type){
  document.querySelectorAll('.boost-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostOpt=type;
}
function buyCredits(amount,price){
  toast(`💳 Redirection payment ${price}€ for ${amount} credits...`);
  setTimeout(()=>{
    addCredits(amount);
    toast(`⚡ ${amount} ViralCredits added!`);
  },1200);
}
function openBuyCredits(){ switchCreditsTab('packs', document.getElementById('ctab-packs')); }
function applyBoost(){
  const sel=document.getElementById('boost-post-select2');
  const costs={'top-feed':10,'showcase-24h':25,'notif-push':50,'boost-7j':80};
  const cost=costs[selectedBoostOpt]||10;
  if(userCredits<cost){toast('⚡ Insufficient credits. Buy a pack!','error');return;}
  if(!sel||!sel.value){toast('Choose a post to boost!','error');return;}
  spendCredits(cost);
  toast('🚀 Boost activated! Your post is now featured.');
}
function loadBoostPostOptions(){
  ['boost-post-select','boost-post-select2'].forEach(id=>{
    const sel=document.getElementById(id);
    if(!sel||!feedPosts)return;
    const myPosts=feedPosts.filter(p=>p.userId===currentUser?.email||p.author===currentUser?.name);
    sel.innerHTML='<option value="">Choose a post...</option>'+myPosts.map(p=>`<option value="${p.id}">${(p.text||'').substring(0,50)}…</option>`).join('');
  });
}

// ── LEADERBOARD ──
function loadLeaderboard(type='pubs'){
  const list=document.getElementById('leaderboard-list');
  if(!list)return;
  let items=[];
  if(type==='pubs'){
    items=feedPosts.sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,10)
      .map((p,i)=>({rank:i+1,name:(p.text||'').substring(0,55),sub:p.author||'?',score:(p.likes||0)+' reactions',plan:p.plan||'free'}));
  }else if(type==='createurs'){
    // Only real users from the API — no fake data
    items=[];
  }else{
    items=showcaseData.sort((a,b)=>b.votes-a.votes).slice(0,8)
      .map((p,i)=>({rank:i+1,name:p.name,sub:p.type,score:p.votes+' votes'}));
  }
  if(!items.length){
    list.innerHTML='<div style="text-align:center;padding:40px;color:var(--muted)">The rankings will fill up with real community posts 🚀</div>';
    return;
  }
  const medals=['🥇','🥈','🥉'];
  list.innerHTML=items.map(item=>`
    <div class="lb-item${item.rank<=3?' top'+item.rank:''}">
      <div class="lb-rank">${item.rank}</div>
      ${item.rank<=3?`<div class="lb-medal">${medals[item.rank-1]}</div>`:''}
      <div class="lb-info"><div class="lb-name">${escHtml(item.name)}</div><div class="lb-sub">${item.sub||''}</div></div>
      <div class="lb-score">${item.score}</div>
    </div>`).join('');
}
function switchLeaderboard(type,btn){
  document.querySelectorAll('#tab-leaderboard .feed-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  loadLeaderboard(type);
}

// ── COLLABS MATCHING IA ──
async function loadCollabs(){
  const list=document.getElementById('collab-list');
  if(!list||!currentUser)return;
  list.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)"><span class="dots"><span></span><span></span><span></span></span> Analysis in progress...</div>';
  await new Promise(r=>setTimeout(r,900));
  // Find real users from the API
  let candidates=[];
  try{
    const r=await fetchWithTimeout('/api/admin/all-users');
    const users=await r.json();
    candidates=(users||[])
      .filter(u=>u.email!==currentUser.email)
      .map(u=>({
        name:u.name||u.email.split('@')[0],
        avatar:u.avatar||'🙂',
        niche:u.niche||'Creator',
        goal:u.goal||'',
        skills:u.skills||'',
        id:u.email,
        plan:u.plan||'free'
      }))
      .slice(0,10);
  }catch(e){}
  if(!candidates.length){
    list.innerHTML=`<div style="text-align:center;padding:48px 24px;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">🤝</div>
      <div style="font-size:14px;font-weight:700;color:var(--g5);margin-bottom:8px">No creators to match yet</div>
      <div style="font-size:12px;line-height:1.8">AI matching is based on real community profiles.<br>Complete your profile and come back when the community grows!</div>
    </div>`;
    return;
  }
  list.innerHTML=candidates.map(c=>`
    <div class="collab-card">
      <div class="collab-header">
        <div class="collab-ava" style="background:linear-gradient(135deg,var(--g1),var(--g3))">${c.avatar}</div>
        <div style="flex:1">
          <div style="font-size:14px;font-weight:700;margin-bottom:2px">${escHtml(c.name)}</div>
          <div style="font-size:11px;color:var(--muted)">${escHtml(c.niche)}${c.skills?' · '+escHtml(c.skills):''}</div>
          <span class="chat-msg-plan-badge plan-${c.plan}" style="margin-top:4px;display:inline-block">${(c.plan||'FREE').toUpperCase()}</span>
        </div>
      </div>
      ${c.goal?`<div class="collab-why">Goal : <em>${escHtml(c.goal)}</em></div>`:''}
      <div style="display:flex;gap:8px">
        <button class="btn-collab" onclick="openDMToUser('${c.id}','${escHtml(c.name)}')">💬 Contact</button>
        <button onclick="this.textContent='✓ Ignored';this.disabled=true" style="background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:7px 14px;font-size:12px;cursor:pointer;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif">Ignore</button>
      </div>
    </div>`).join('');
}

// ── EDITORIAL CALENDAR ──
let calYear=new Date().getFullYear(),calMonth=new Date().getMonth();
const calPosts={};
function buildCalendar(){
  const grid=document.getElementById('cal-grid');
  const label=document.getElementById('cal-month-label');
  if(!grid)return;
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  label.textContent=months[calMonth]+' '+calYear;
  const first=new Date(calYear,calMonth,1);
  const last=new Date(calYear,calMonth+1,0).getDate();
  let startDay=first.getDay()||7; // 1=lun
  const today=new Date();
  let html='';
  for(let i=1;i<startDay;i++) html+='<div class="cal-day" style="opacity:0.2"></div>';
  for(let d=1;d<=last;d++){
    const key=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday=d===today.getDate()&&calMonth===today.getMonth()&&calYear===today.getFullYear();
    const posts=calPosts[key]||[];
    html+=`<div class="cal-day${posts.length?' has-post':''}${isToday?' today':''}" onclick="calDayClick('${key}')">
      <div class="cal-num">${d}</div>
      ${posts.map(()=>'<span class="cal-post-dot"></span>').join('')}
    </div>`;
  }
  grid.innerHTML=html;
  // Optimal slots
  const slots=document.getElementById('optimal-slots');
  if(slots){
    const times=['Mon 6pm','Tue 12pm','Wed 7pm','Thu 9am','Fri 5pm','Sat 11am','Sun 8pm'];
    slots.innerHTML=times.map(t=>`<span class="slot-chip" onclick="this.classList.toggle('selected')" title="Cliquer for programmer">⏰ ${t}</span>`).join('');
  }
}
function calNav(dir){
  calMonth+=dir;
  if(calMonth>11){calMonth=0;calYear++;}
  if(calMonth<0){calMonth=11;calYear--;}
  buildCalendar();
}
function calDayClick(key){
  const text=prompt('Scheduled post title:');
  if(!text)return;
  if(!calPosts[key])calPosts[key]=[];
  calPosts[key].push(text);
  buildCalendar();
  toast('📅 Post scheduled on '+key+'!');
}

// ── AI A/B TEST ──
async function runABTest(){
  const a=document.getElementById('ab-text-a').value.trim();
  const b=document.getElementById('ab-text-b').value.trim();
  const goal=document.getElementById('ab-goal').value;
  if(!a||!b){toast('Feedl in both versions!','error');return;}
  const btn=document.getElementById('btn-ab');
  btn.disabled=true;btn.innerHTML='<span class="dots"><span></span><span></span><span></span></span> Analysis in progress...';
  document.getElementById('ab-result').style.display='none';
  try{
    const res=await fetch('/api/ia-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      type:'abtest',name:'A/B Test',description:`Analyze these two ad versions for the goal "${goal}".\n\nVERSION A:\n${a}\n\nVERSION B:\n${b}\n\nProvide: 1) which version is better and why, 2) estimated conversion score for each (out of 100), 3) 3 strengths and 1 weakness of each. Be concise and direct.`
    })});
    const data=await res.json();
    const txt=data.strategy||data.result||'Analysis not available.';
    const winner=txt.toLowerCase().includes('version b')&&!txt.toLowerCase().includes('version a wins')?'VERSION B WINS 🔵':'VERSION A WINS 🟢';
    document.getElementById('ab-winner-text').textContent=winner;
    document.getElementById('ab-analysis-text').textContent=txt;
    document.getElementById('ab-result').style.display='block';
  }catch(e){
    // Fallback offline
    const winner=a.length>b.length?'VERSION A':'VERSION B';
    document.getElementById('ab-winner-text').textContent=winner+' WINS';
    document.getElementById('ab-analysis-text').textContent=`Offline analysis:\n${winner} seems to perform better because it is ${a.length>b.length?'more detailed':'more concise and impactful'}.\n\nGeneral tips:\n• Always start with the customer benefit\n• Use concrete numbers\n• End with a clear call to action\n• Avoid technical jargon`;
    document.getElementById('ab-result').style.display='block';
  }
  btn.disabled=false;btn.textContent='🔬 Analyze with AI';
}

// ── MOBILE PREVIEW — géré par updateMobilePreview() ci-dessus ──

// ── INIT NEW FEATURES on login ──
document.addEventListener('vb-user-logged-in', () => {
  updateCreditsDisplay();
  setTimeout(checkOnboarding, 800);
});

// Guide pub : ouverture via showAppTab() directement


const OFFER_LIMIT = 100;

async function checkAndShowOffer() {
  if (sessionStorage.getItem('vb_offer_closed')) return;
  if (localStorage.getItem('vb_offer_seen')) return;
  if (currentUser && (currentUser.plan === 'pro' || currentUser.plan === 'elite')) return;

  // Update le accountur en temps réel
  try {
    const r = await fetchWithTimeout('/api/admin/all-users?key=viralboost-admin', {}, 3000);
    const users = r.ok ? await r.json() : [];
    const remaining = Math.max(0, OFFER_LIMIT - users.length);
    const el = document.getElementById('offer-remaining');
    if (el) el.textContent = remaining;

    if (remaining <= 0) {
      // Offer donee — changer le contenu
      const wrap = document.getElementById('offer-box-wrap');
      wrap.innerHTML = `<div class="offer-full">
        <div style="font-size:40px;margin-bottom:10px">😔</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;color:#fbbf24;letter-spacing:2px">OFFER ENDED</div>
        <div style="font-size:13px;color:#4a7a58;margin-top:8px">All 100 free spots have been taken.<br>Discover our plans starting at €3/month.</div>
        <button class="offer-cta" style="margin-top:18px;width:auto;padding:12px 28px" onclick="closeOffer()">See plans →</button>
      </div>`;
    }
  } catch(e) {
    // API unavailable or timeout — leave "—" or use approx value
    const el = document.getElementById('offer-remaining');
    if (el && el.textContent === '—') el.textContent = '< 100';
  }
}

// showOfferFallback removed — the popup is always visible by default

function claimOffer() {
  localStorage.setItem('vb_offer_seen', '1');
  localStorage.setItem('vb_offer_claimed', '1');
  localStorage.setItem('vb_offer_pending', '1');
  document.getElementById('offer-popup').classList.add('hidden');
  if (currentUser) {
    // Already connected → direct upgrade
    currentUser.plan = 'pro';
    currentUser.offerClaimed = true;
    currentUser.offerExpiry = new Date(Date.now() + 365*24*60*60*1000).toISOString();
    localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
    fetch('/api/register-user', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(currentUser)}).catch(()=>{});
    toast('🎉 Plan PRO activated for free for 1 year!');
    updateAppBar();
  } else {
    // Open the sign up form directly
    openModal('signup-modal');
  }
}

function closeOffer() {
  // Mark as permanently declined — never show again
  localStorage.setItem('vb_offer_seen', '1');
  document.getElementById('offer-popup').classList.add('hidden');
}



// Activate the PRO plan offered at account creation — integrated in createUser above

// ── OFFER COUNTDOWN — expires 01/03/2026 at 10:00 ──
const OFFER_EXPIRY = new Date('2026-03-01T10:00:00');

function updateCountdown() {
  const el = document.getElementById('offer-countdown');
  if (!el) return;
  const diff = OFFER_EXPIRY - Date.now();
  if (diff <= 0) {
    el.textContent = 'EXPIRED';
    el.style.color = '#f87171';
    return;
  }
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  el.textContent = (d > 0 ? d + 'j ' : '') + String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}
setInterval(updateCountdown, 1000);


// ── BOTTOM NAV ──
// ── EXIT INTENT ──
let exitShown = false;
document.addEventListener('mouseleave', (e) => {
  if(e.clientY <= 0 && !exitShown && !currentUser && !localStorage.getItem('vb_exit_seen')){
    exitShown = true;
    document.getElementById('exit-overlay')?.classList.remove('hidden');
  }
});




// On mobile: exit after 40 seconds without interaction
let mobileExitTimer = setTimeout(() => {
  if(!exitShown && !currentUser && !localStorage.getItem('vb_exit_seen') && window.innerWidth < 768){
    exitShown = true;
    document.getElementById('exit-overlay')?.classList.remove('hidden');
  }
}, 40000);

function closeExitPopup(){
  document.getElementById('exit-overlay')?.classList.add('hidden');
  localStorage.setItem('vb_exit_seen', '1');
}

// ── DYNAMIC MEMBER COUNTER ──
async function loadMemberCount(){
  try{
    const r = await fetchWithTimeout('/api/admin/all-users?key=viralboost-admin', {}, 3000);
    const users = await r.json();
    if(Array.isArray(users) && users.length > 0){
      const count = users.length;
      const wrap = document.getElementById('hero-member-wrap');
      const countEl = document.getElementById('hero-member-count');
      if(countEl) countEl.textContent = count;
      if(wrap) wrap.style.display = 'inline';
    }
  }catch(e){}
}

function toggleMoreMenu(){
  const overlay=document.getElementById('bn-more-overlay');
  if(overlay) overlay.classList.toggle('hidden');
  const btn=document.getElementById('bn-more');
  if(btn) btn.classList.toggle('active');
}
function closeMoreMenu(){
  document.getElementById('bn-more-overlay')?.classList.add('hidden');
  document.getElementById('bn-more')?.classList.remove('active');
}
function moreNavGo(tab){
  closeMoreMenu();
  showAppTab(tab, null);
  // Disable all bn-items
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  document.getElementById('bn-more')?.classList.add('active');
}

function bottomNavGo(tab, btn){
  // Sync with existing app tab
  const appTabBtn = document.querySelector(`.app-tab[onclick="showAppTab('${tab}',this)"]`);
  if(appTabBtn) appTabBtn.click();
  // Update the active bottom nav
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active','bn-just-activated'));
  if(btn){
    btn.classList.add('active');
    // Pop animation
    btn.classList.add('bn-just-activated');
    setTimeout(()=>btn.classList.remove('bn-just-activated'), 350);
  }
}
function syncBottomNav(tab){
  const map={'feed':'bn-feed','showcase':'bn-showcase','publish':'bn-publish','chat-global':'bn-chat','profile':'bn-profile','boost-credits':'bn-credits'};
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  const id=map[tab];
  if(id) document.getElementById(id)?.classList.add('active');
  const chatDot=document.getElementById('chat-notif');
  const bnDot=document.getElementById('bn-chat-dot');
  if(bnDot && chatDot) bnDot.className='bn-dot'+(chatDot.style.display!=='none'?' show':'');
}

// ── MOBILE MENU ──

function toggleMobileMenu(){
  const menu=document.getElementById('mobile-menu');
  const btn=document.getElementById('hamburger-btn');
  const open=menu.classList.toggle('open');
  btn.classList.toggle('open',open);
  document.body.style.overflow=open?'hidden':'';
}
function closeMobileMenu(){
  document.getElementById('mobile-menu').classList.remove('open');
  document.getElementById('hamburger-btn').classList.remove('open');
  document.body.style.overflow='';
}
// Close the menu if clicking elsewhere
document.addEventListener('click',function(e){
  const menu=document.getElementById('mobile-menu');
  const btn=document.getElementById('hamburger-btn');
  if(menu&&menu.classList.contains('open')&&!menu.contains(e.target)&&!btn.contains(e.target)){
    closeMobileMenu();
  }
});

// Show popup after 60% scroll (more natural) or 15 seconds
window.addEventListener('load', () => {
  const popup = document.getElementById('offer-popup');
  const expiresd = Date.now() > OFFER_EXPIRY;
  if (!localStorage.getItem('vb_offer_seen') && !expiresd) {
    updateCountdown();
    let shown = false;
    // Déclencher au scroll 60%
    const onScroll = () => {
      const scrollPct = window.scrollY / (document.body.scrollHeight - window.innerHeight);
      if (scrollPct > 0.6 && !shown) {
        shown = true;
        popup.classList.remove('hidden');
        checkAndShowOffer();
        window.removeEventListener('scroll', onScroll);
      }
    };
    window.addEventListener('scroll', onScroll);
    // Fallback after 15 seconds if no scroll
    setTimeout(() => {
      if (!shown) {
        shown = true;
        popup.classList.remove('hidden');
        checkAndShowOffer();
        window.removeEventListener('scroll', onScroll);
      }
    }, 15000);
  }
});
</script>

<!-- ═══════════════════════════════════════════
     MODAL GUIDE — First ad creation
═══════════════════════════════════════════ -->
<div class="guide-overlay hidden" id="pub-guide-overlay" onclick="if(event.target===this)closePubGuide()">
  <div class="guide-box">
    <button class="guide-box-close" onclick="closePubGuide()">✕</button>
    <div class="guide-title" style="font-size:22px;margin-bottom:4px">CREATE YOUR AD IN 5 STEPS</div>
    <div class="guide-subtitle" style="font-size:12px;margin-bottom:14px">Follow the wizard — each step is guided.</div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px">
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">1</span>🚀 Identity — name & category</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">2</span>✍️ Description — what you offer</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">3</span>🎯 Audience & tags</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">4</span>🖼️ Visuel <strong style="color:var(--g3)">→ 3× more votes</strong></div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">5</span>👁️ Preview & publish</div>
    </div>
    <button class="btn-guide-start" style="padding:12px;font-size:13px" onclick="closePubGuide()">✨ Let's go!</button>
  </div>
</div>

<!-- EXIT INTENT POPUP -->
<div class="exit-overlay hidden" id="exit-overlay">
  <div class="exit-box">
    <button class="exit-close" onclick="closeExitPopup()">✕</button>
    <div class="exit-emoji">⚡</div>
    <div class="exit-title">Wait! Leaving already?</div>
    <div class="exit-sub">Join the community of creators and entrepreneurs showcasing their projects on ViralBoost.</div>
    <div class="exit-perks">
      <span>🚀 Pub visible en 30 sec</span>
      <span>🤝 Matching IA free</span>
      <span>💬 Active community</span>
    </div>
    <button class="btn-exit-cta" onclick="closeExitPopup();openModal('signup-modal')">✅ Create my free account →</button>
    <div class="exit-skip" onclick="closeExitPopup()">No thanks, I'll go</div>
  </div>
</div>

<!-- MODAL PROJET -->
<div class="project-modal-overlay hidden" id="project-modal-overlay" onclick="if(event.target===this)closeProjectModal()">
  <div class="project-modal" id="project-modal-content">
    <!-- dynamically populated -->
  </div>
</div>

<!-- BOTTOM NAV BAR (mobile) -->
<nav class="bottom-nav" id="bottom-nav" role="navigation" aria-label="Navigation principale">
  <button class="bn-item" id="bn-feed" onclick="bottomNavGo('feed',this)">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gf1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ff7043"/><stop offset="1" stop-color="#c62828"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gf1)"/>
        <path d="M8 20L20 10l12 10v10a1 1 0 01-1 1H9a1 1 0 01-1-1V20z" fill="rgba(255,255,255,0.9)"/>
        <rect x="16" y="23" width="8" height="8" rx="1.5" fill="#c62828"/>
      </svg>
    </span>
    <span data-i18n="bn_feed">Feed</span>
  </button>

  <button class="bn-item" id="bn-showcase" onclick="bottomNavGo('showcase',this)">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gv1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#b39ddb"/><stop offset="1" stop-color="#6a1b9a"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gv1)"/>
        <path d="M20 6l3.5 7 7.5 1.1-5.5 5.3 1.3 7.6L20 23.5l-6.8 3.5 1.3-7.6L9 12.1l7.5-1.1L20 6z" fill="rgba(255,255,255,0.95)"/>
        <circle cx="20" cy="16" r="3" fill="url(#gv1)"/>
      </svg>
    </span>
    <span data-i18n="bn_showcase">Showcase</span>
  </button>

  <button class="bn-item bn-publish" id="bn-publish" onclick="bottomNavGo('publish',this)" title="Publish">
    <span class="bn-icon">
      <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
        <line x1="16" y1="7" x2="16" y2="25" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
        <line x1="7" y1="16" x2="25" y2="16" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
      </svg>
    </span>
  </button>

  <button class="bn-item" id="bn-profile" onclick="bottomNavGo('profile',this)">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gp1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#4fc3f7"/><stop offset="1" stop-color="#0277bd"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gp1)"/>
        <circle cx="20" cy="15" r="7" fill="rgba(255,255,255,0.95)"/>
        <path d="M6 38c0-7.7 6.3-13 14-13s14 5.3 14 13" fill="rgba(255,255,255,0.9)"/>
      </svg>
    </span>
    <span data-i18n="bn_profile">Profile</span>
  </button>

  <button class="bn-item" id="bn-more" onclick="toggleMoreMenu()">
    <span class="bn-icon">
      <svg width="36" height="36" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="gm1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#78909c"/><stop offset="1" stop-color="#37474f"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#gm1)"/>
        <rect x="9" y="12" width="22" height="3" rx="1.5" fill="rgba(255,255,255,0.9)"/>
        <rect x="9" y="18.5" width="22" height="3" rx="1.5" fill="rgba(255,255,255,0.9)"/>
        <rect x="9" y="25" width="22" height="3" rx="1.5" fill="rgba(255,255,255,0.9)"/>
      </svg>
    </span>
    <span>More</span>
  </button>
</nav>

<!-- MENU "PLUS" MOBILE -->
<div class="bn-more-overlay hidden" id="bn-more-overlay" onclick="if(event.target===this)closeMoreMenu()">
  <div class="bn-more-sheet" id="bn-more-sheet">
    <div class="bn-more-handle"></div>
    <div class="bn-more-title">More options</div>
    <div class="bn-more-grid">
      <button class="bn-more-item" onclick="moreNavGo('chat-global')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#4dd0e1"/><stop offset="1" stop-color="#00838f"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic1)"/><path d="M8 12h24v14a2 2 0 01-2 2H10a2 2 0 01-2-2V12z" fill="rgba(255,255,255,0.2)"/><rect x="8" y="10" width="24" height="16" rx="3" fill="rgba(255,255,255,0.9)"/><circle cx="14" cy="18" r="2" fill="#00838f"/><circle cx="20" cy="18" r="2" fill="#00838f"/><circle cx="26" cy="18" r="2" fill="#00838f"/><path d="M14 26l2 4h8l2-4" fill="rgba(255,255,255,0.9)"/></svg></span>
        <span>Chat</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('boost-credits')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic2" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffb74d"/><stop offset="1" stop-color="#e65100"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic2)"/><rect x="7" y="13" width="26" height="18" rx="3" fill="rgba(255,255,255,0.2)"/><rect x="7" y="11" width="26" height="16" rx="3" fill="rgba(255,255,255,0.9)"/><path d="M13 17h4v2h-4zm0 4h8v2h-8zm10-4h4v6h-4z" fill="#e65100"/><circle cx="28" cy="10" r="5" fill="#ffd54f"/><text x="25.5" y="13.5" font-size="7" fill="#e65100" font-weight="bold">$</text></svg></span>
        <span>Shop</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('groups')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic3" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ce93d8"/><stop offset="1" stop-color="#7b1fa2"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic3)"/><circle cx="14" cy="15" r="5" fill="rgba(255,255,255,0.9)"/><circle cx="26" cy="15" r="5" fill="rgba(255,255,255,0.7)"/><path d="M4 32c0-5.5 4.5-9 10-9s10 3.5 10 9" fill="rgba(255,255,255,0.9)"/><path d="M22 32c0-5.5 4.5-9 10-9" fill="rgba(255,255,255,0.6)"/></svg></span>
        <span>Groups</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('stats')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic4" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#81c784"/><stop offset="1" stop-color="#1b5e20"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic4)"/><rect x="8" y="24" width="5" height="9" rx="1.5" fill="rgba(255,255,255,0.9)"/><rect x="15" y="18" width="5" height="15" rx="1.5" fill="rgba(255,255,255,0.9)"/><rect x="22" y="12" width="5" height="21" rx="1.5" fill="rgba(255,255,255,0.9)"/><rect x="29" y="20" width="5" height="13" rx="1.5" fill="rgba(255,255,255,0.7)"/></svg></span>
        <span>Stats</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('leaderboard')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic5" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffd54f"/><stop offset="1" stop-color="#f57f17"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic5)"/><path d="M20 6l3.5 7 7.5 1-5.5 5.3 1.3 7.7L20 23.5l-6.8 3.5 1.3-7.7L9 14l7.5-1L20 6z" fill="rgba(255,255,255,0.95)"/><circle cx="20" cy="17" r="3" fill="url(#ic5)"/></svg></span>
        <span>Top</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('collab')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic6" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffcc80"/><stop offset="1" stop-color="#e65100"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic6)"/><path d="M12 22c2.5-2 5-3 8-3s5.5 1 8 3" stroke="white" stroke-width="2.5" stroke-linecap="round" fill="none"/><circle cx="15" cy="15" r="4" fill="rgba(255,255,255,0.9)"/><circle cx="25" cy="15" r="4" fill="rgba(255,255,255,0.9)"/><path d="M17 28l3 4 3-4" fill="rgba(255,255,255,0.6)"/></svg></span>
        <span>Collabs</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('ia-boost')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic7" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#80deea"/><stop offset="1" stop-color="#006064"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic7)"/><rect x="10" y="10" width="20" height="20" rx="5" fill="rgba(255,255,255,0.15)"/><rect x="12" y="12" width="16" height="16" rx="4" fill="rgba(255,255,255,0.9)"/><circle cx="16" cy="18" r="2" fill="#006064"/><circle cx="24" cy="18" r="2" fill="#006064"/><path d="M14 23c1.5 2 10.5 2 12 0" stroke="#006064" stroke-width="1.5" stroke-linecap="round" fill="none"/><circle cx="20" cy="8" r="3" fill="#ffd54f"/><line x1="20" y1="11" x2="20" y2="13" stroke="#ffd54f" stroke-width="1.5"/></svg></span>
        <span>IA Boost</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('calendrier')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic8" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#90caf9"/><stop offset="1" stop-color="#1565c0"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic8)"/><rect x="7" y="12" width="26" height="22" rx="3" fill="rgba(255,255,255,0.9)"/><rect x="7" y="12" width="26" height="8" rx="3" fill="url(#ic8)"/><line x1="14" y1="9" x2="14" y2="15" stroke="white" stroke-width="2.5" stroke-linecap="round"/><line x1="26" y1="9" x2="26" y2="15" stroke="white" stroke-width="2.5" stroke-linecap="round"/><rect x="12" y="24" width="4" height="4" rx="1" fill="#1565c0"/><rect x="18" y="24" width="4" height="4" rx="1" fill="#1565c0"/><rect x="24" y="24" width="4" height="4" rx="1" fill="#90caf9"/></svg></span>
        <span>Calendar</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('ab-test')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic9" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#a5d6a7"/><stop offset="1" stop-color="#2e7d32"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic9)"/><rect x="7" y="10" width="11" height="20" rx="3" fill="rgba(255,255,255,0.9)"/><rect x="22" y="10" width="11" height="20" rx="3" fill="rgba(255,255,255,0.5)"/><text x="10" y="24" font-size="10" fill="#2e7d32" font-weight="bold">A</text><text x="25" y="24" font-size="10" fill="rgba(255,255,255,0.8)" font-weight="bold">B</text><path d="M18 20h4" stroke="rgba(255,255,255,0.8)" stroke-width="2" stroke-linecap="round"/></svg></span>
        <span>A/B Test</span>
      </button>
      <button class="bn-more-item" onclick="moreNavGo('followers')">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic10" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ffe082"/><stop offset="1" stop-color="#ff6f00"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic10)"/><path d="M20 8c-4.4 0-7 2-7 5 0 1.5.8 3 2 4l-1 4h12l-1-4c1.2-1 2-2.5 2-4 0-3-2.6-5-7-5z" fill="rgba(255,255,255,0.95)"/><rect x="14" y="30" width="12" height="3" rx="1.5" fill="rgba(255,255,255,0.8)"/><circle cx="29" cy="10" r="5" fill="#ef5350"/><text x="26.5" y="13.5" font-size="8" fill="white" font-weight="bold">3</text></svg></span>
        <span>Followers</span>
      </button>
      <button class="bn-more-item bn-more-logout" onclick="closeMoreMenu();logout()">
        <span class="bn-more-icon"><svg width="36" height="36" viewBox="0 0 40 40" fill="none"><defs><linearGradient id="ic11" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#ef9a9a"/><stop offset="1" stop-color="#b71c1c"/></linearGradient></defs><rect width="40" height="40" rx="10" fill="url(#ic11)"/><rect x="10" y="12" width="14" height="16" rx="2" fill="rgba(255,255,255,0.9)"/><path d="M22 20h10m-4-4l4 4-4 4" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span>
        <span>Leave</span>
      </button>
    </div>
  </div>
</div>


<script>
// ── PWA SERVICE WORKER ──
if('serviceWorker' in navigator){
  window.addEventListener('load', () => {
    const swCode = `
      const CACHE = 'viralboost-v1';
      self.addEventListener('install', e => {
        e.waitUntil(caches.open(CACHE).then(c => c.addAll(['/'])));
      });
      self.addEventListener('fetch', e => {
        e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
      });
    `;
    const blob = new Blob([swCode], {type: 'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).catch(()=>{});
  });
}

// ── INSTALL PROMPT ──
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  showInstallBanner();
});

function showInstallBanner(){
  // Show navbar button too
  const navBtn = document.getElementById('pwa-install-btn');
  if(navBtn) navBtn.style.display = 'flex';
  if(document.getElementById('pwa-banner')) return;
  const banner = document.createElement('div');
  banner.id = 'pwa-banner';
  banner.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:9990;background:linear-gradient(135deg,#0b1a0d,#142e17);border:1.5px solid rgba(34,197,94,0.4);border-radius:16px;padding:14px 20px;display:flex;align-items:center;gap:14px;box-shadow:0 8px 40px rgba(0,0,0,0.5);min-width:320px;max-width:90vw;animation:slideUp 0.4s ease;';
  banner.innerHTML = `
    <div style="width:40px;height:40px;background:linear-gradient(135deg,#22c55e,#16a34a);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">⚡</div>
    <div style="flex:1">
      <div style="font-size:13px;font-weight:800;color:#f0fdf4;margin-bottom:2px">Installer ViralBoost</div>
      <div style="font-size:11px;color:#4a7a58">Quick access from your desktop</div>
    </div>
    <button onclick="installPWA()" style="padding:8px 16px;background:#22c55e;border:none;border-radius:8px;font-family:Plus Jakarta Sans,sans-serif;font-size:12px;font-weight:800;color:#040a05;cursor:pointer;flex-shrink:0">Installer</button>
    <button onclick="dismissPWA()" style="background:none;border:none;color:#4a7a58;cursor:pointer;font-size:18px;padding:0 4px;flex-shrink:0">✕</button>
  `;
  document.body.appendChild(banner);
  // Auto-dismiss after 10s
  setTimeout(dismissPWA, 10000);
}

function handleInstallClick(){
  if(deferredPrompt){
    installPWA();
  } else {
    // Show manual instructions
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    if(isIOS){
      toast('📲 On iPhone: Share then Add to Home Screen');
    } else {
      toast('💻 In Chrome: click the + symbol in the address bar to install!');
    }
  }
}

function installPWA(){
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  deferredPrompt.userChoice.then(result => {
    if(result.outcome === 'accepted'){
      toast('🎉 ViralBoost installed on your desktop!');
    }
    dismissPWA();
    deferredPrompt = null;
  });
}

function dismissPWA(){
  const b = document.getElementById('pwa-banner');
  if(b) b.remove();
  // Keep navbar button visible
}

// iOS specific — show instructions
window.addEventListener('load', () => {
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
  if(isIOS && !isStandalone && !localStorage.getItem('vb_ios_prompt')){
    setTimeout(() => {
      const banner = document.createElement('div');
      banner.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:9990;background:linear-gradient(135deg,#0b1a0d,#142e17);border:1.5px solid rgba(34,197,94,0.4);border-radius:16px;padding:14px 20px;text-align:center;box-shadow:0 8px 40px rgba(0,0,0,0.5);max-width:90vw;';
      banner.innerHTML = `
        <div style="font-size:13px;font-weight:800;color:#f0fdf4;margin-bottom:6px">📲 Install ViralBoost on iPhone</div>
        <div style="font-size:12px;color:#4a7a58;line-height:1.6">Tap <strong style="color:#22c55e">Share</strong> then <strong style="color:#22c55e">Add to home screen</strong></div>
        <button onclick="this.parentElement.remove();localStorage.setItem('vb_ios_prompt','1')" style="margin-top:10px;padding:6px 16px;background:none;border:1px solid rgba(34,197,94,0.3);border-radius:8px;font-size:12px;color:#22c55e;cursor:pointer">OK compris</button>
      `;
      document.body.appendChild(banner);
    }, 3000);
    localStorage.setItem('vb_ios_prompt', '1');
  }
});
</script>

<div id="exit-popup" style="display:none;position:fixed;inset:0;z-index:10000;background:rgba(4,10,5,0.85);backdrop-filter:blur(8px);align-items:center;justify-content:center;">
  <div style="background:linear-gradient(135deg,#0b1a0d,#0f2312);border:1.5px solid rgba(34,197,94,0.35);border-radius:20px;padding:40px 36px;max-width:480px;width:92%;text-align:center;position:relative;box-shadow:0 0 80px rgba(34,197,94,0.15);">
    <button onclick="closeExitPopup()" style="position:absolute;top:14px;right:16px;background:none;border:none;color:#4a7a58;font-size:20px;cursor:pointer">✕</button>
    <div style="font-size:48px;margin-bottom:12px">🚀</div>
    <div style="font-family:'DM Mono',monospace;font-size:11px;color:#22c55e;letter-spacing:2px;margin-bottom:10px">WAIT!</div>
    <h2 style="font-family:'Plus Jakarta Sans',sans-serif;font-size:26px;font-weight:900;color:#f0fdf4;margin-bottom:10px;line-height:1.2">Leaving already?<br><span style="color:#22c55e">Les 100 premiers ont le PRO free.</span></h2>
    <p style="font-size:13px;color:#4a7a58;margin-bottom:24px;line-height:1.6">Join now and access all premium features — AI matching, boosted showcase, monetization — free for 1 year.</p>
    <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:20px">
      <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:8px;padding:10px 16px;text-align:center">
        <div style="font-size:18px;font-weight:900;color:#22c55e">100%</div>
        <div style="font-size:10px;color:#4a7a58">Free</div>
      </div>
      <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:8px;padding:10px 16px;text-align:center">
        <div style="font-size:18px;font-weight:900;color:#22c55e">30s</div>
        <div style="font-size:10px;color:#4a7a58">Pour publish</div>
      </div>
      <div style="background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.2);border-radius:8px;padding:10px 16px;text-align:center">
        <div style="font-size:18px;font-weight:900;color:#ffd700">PRO</div>
        <div style="font-size:10px;color:#4a7a58">1 year free</div>
      </div>
    </div>
    <button onclick="closeExitPopup();openModal('signup-modal')" style="width:100%;padding:15px;background:#22c55e;border:none;border-radius:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;font-weight:800;color:#040a05;cursor:pointer;box-shadow:0 0 40px rgba(34,197,94,0.35);margin-bottom:10px">⚡ Create my free account →</button>
    <div onclick="closeExitPopup()" style="font-size:12px;color:#4a7a58;cursor:pointer">No thanks, I'll leave</div>
  </div>
</div>

<script>
// ── EXIT INTENT ──
exitShown = false;
document.addEventListener('mouseleave', (e) => {
  if(e.clientY <= 0 && !exitShown && !currentUser && document.getElementById('landing').style.display !== 'none'){
    exitShown = true;
    const popup = document.getElementById('exit-popup');
    if(popup){ popup.style.display = 'flex'; }
  }
});
// Mobile : scroll up rapide = exit intent
let lastScrollY = 0;
let scrollTimer = null;
window.addEventListener('scroll', () => {
  const currentY = window.scrollY;
  if(scrollTimer) clearTimeout(scrollTimer);
  scrollTimer = setTimeout(() => {
    if(lastScrollY - currentY > 80 && currentY < 200 && !exitShown && !currentUser){
      exitShown = true;
      const popup = document.getElementById('exit-popup');
      if(popup){ popup.style.display = 'flex'; }
    }
    lastScrollY = currentY;
  }, 100);
});

function closeExitPopup(){
  const popup = document.getElementById('exit-popup');
  if(popup) popup.style.display = 'none';
}
</script>

<!-- CHOIX TYPE DE PUB -->
<div class="modal-bg" id="pub-type-modal">
  <div class="modal wide" style="max-width:560px;padding:32px">
    <button class="modal-close" onclick="closeModal('pub-type-modal')">✕</button>
    <div style="text-align:center;margin-bottom:28px">
      <div style="font-size:11px;color:var(--g3);letter-spacing:2px;font-family:'DM Mono',monospace;margin-bottom:8px">NOUVELLE PUBLICATION</div>
      <h2 style="font-size:22px;font-weight:800;color:var(--white)">What type of post?</h2>
    </div>
    <div style="display:flex;flex-direction:column;gap:12px">

      <!-- TYPE 1 : PUB -->
      <div onclick="selectPubType('pub')" style="background:var(--s1);border:1.5px solid rgba(34,197,94,0.2);border-radius:14px;padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:16px;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(34,197,94,0.5)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.2)'">
        <div style="width:48px;height:48px;background:rgba(34,197,94,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">📢</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span style="font-size:15px;font-weight:800;color:var(--white)">Pub</span>
            <span style="font-size:10px;background:rgba(34,197,94,0.1);color:var(--g3);border-radius:4px;padding:2px 7px;font-weight:700">GRATUIT</span>
            <span style="font-size:10px;color:var(--muted)">~2 min</span>
          </div>
          <div style="font-size:12px;color:var(--muted);line-height:1.5">Introduce your project quickly. Name, description, category, link. Ideal to get started.</div>
          <div style="display:flex;gap:6px;margin-top:8px">
            <span style="font-size:10px;color:var(--muted2)">✓ Project name</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Description</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Link</span>
          </div>
        </div>
        <div style="font-size:20px;color:var(--muted2)">→</div>
      </div>

      <!-- TYPE 2 : AD -->
      <div onclick="selectPubType('ad')" style="background:var(--s1);border:1.5px solid rgba(74,222,128,0.2);border-radius:14px;padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:16px;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(74,222,128,0.5)'" onmouseout="this.style.borderColor='rgba(74,222,128,0.2)'">
        <div style="width:48px;height:48px;background:rgba(74,222,128,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">📣</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span style="font-size:15px;font-weight:800;color:var(--white)">Ad</span>
            <span style="font-size:10px;background:rgba(74,222,128,0.1);color:#4ade80;border-radius:4px;padding:2px 7px;font-weight:700">STARTER+</span>
            <span style="font-size:10px;color:var(--muted)">~5 min</span>
          </div>
          <div style="font-size:12px;color:var(--muted);line-height:1.5">For launches, collab searches or offers. More details, more visibility.</div>
          <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
            <span style="font-size:10px;color:var(--muted2)">✓ Type d'ad</span>
            <span style="font-size:10px;color:var(--muted2)">✓ What you're looking for</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Banner image</span>
          </div>
        </div>
        <div style="font-size:20px;color:var(--muted2)">→</div>
      </div>

      <!-- TYPE 3 : CAMPAGNE -->
      <div onclick="selectPubType('campagne')" style="background:linear-gradient(135deg,rgba(255,215,0,0.05),rgba(255,140,0,0.03));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:16px;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(255,215,0,0.5)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
        <div style="width:48px;height:48px;background:rgba(255,215,0,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">🏆</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span style="font-size:15px;font-weight:800;color:#ffd700">Campagne</span>
            <span style="font-size:10px;background:rgba(255,215,0,0.1);color:#ffd700;border-radius:4px;padding:2px 7px;font-weight:700">PRO / ELITE</span>
            <span style="font-size:10px;color:var(--muted)">~10 min</span>
          </div>
          <div style="font-size:12px;color:var(--muted);line-height:1.5">For serious projects. Maximum visibility, measurable goals, video, FAQ and credit boost.</div>
          <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
            <span style="font-size:10px;color:var(--muted2)">✓ Video</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Measurable goal</span>
            <span style="font-size:10px;color:var(--muted2)">✓ FAQ</span>
            <span style="font-size:10px;color:var(--muted2)">✓ Boost top</span>
          </div>
        </div>
        <div style="font-size:20px;color:var(--muted2)">→</div>
      </div>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════
// PUB TYPE SELECTOR
// ══════════════════════════════════
function openPubTypeSelector(){
  if(!currentUser){ openModal('signup-modal'); return; }
  openModal('pub-type-modal');
}

let currentPubType = 'pub';

function selectPubType(type){
  closeModal('pub-type-modal');
  const plan = currentUser ? (currentUser.plan || 'free') : 'free';

  if(type === 'ad' && plan === 'free'){
    toast('📣 Announcements are available from the Starter plan!');
    setTimeout(() => showAppTab('boost-credits', null), 1000);
    return;
  }
  if(type === 'campagne' && (plan === 'free' || plan === 'starter')){
    toast('🏆 Campaigns are available from the Pro plan!');
    setTimeout(() => showAppTab('boost-credits', null), 1000);
    return;
  }

  currentPubType = type;
  showAppTab('feed', document.querySelector('.app-tab'));

  setTimeout(() => {
    adaptPubForm(type);
    const el = document.getElementById('feed-text');
    if(el) el.focus();
  }, 300);
}

function adaptPubForm(type){
  const labels = {
    pub: { badge: '📢 AD', color: 'var(--g3)', hint: 'Present your project in a few words' },
    ad: { badge: '📣 ANNOUNCEMENT', color: '#4ade80', hint: 'Detail your launch, collab or offer' },
    campagne: { badge: '🏆 CAMPAIGN', color: '#ffd700', hint: 'Create your complete campaign with goals and FAQ' }
  };
  const cfg = labels[type] || labels.pub;

  // Update or create type badge in feed form
  let badge = document.getElementById('pub-type-badge');
  if(!badge){
    badge = document.createElement('div');
    badge.id = 'pub-type-badge';
    badge.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding:8px 12px;border-radius:8px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.15)';
    const form = document.getElementById('feed-form') || document.querySelector('.feed-form');
    if(form) form.prepend(badge);
  }
  badge.innerHTML = `<span style="font-size:13px;font-weight:800;color:${cfg.color}">${cfg.badge}</span><button onclick="openPubTypeSelector()" style="background:none;border:none;font-size:11px;color:var(--muted);cursor:pointer">Changer →</button>`;

  // Show/hide extra fields based on type
  const extraAd = document.getElementById('pub-extra-ad');
  const extraCampagne = document.getElementById('pub-extra-campagne');

  // Create extra fields if needed
  if(type !== 'pub'){
    const feedForm = document.getElementById('feed-form') || document.querySelector('.feed-post-form');
    if(feedForm && !document.getElementById('pub-extra-ad')){
      const adFields = document.createElement('div');
      adFields.id = 'pub-extra-ad';
      adFields.style.cssText = 'margin-top:10px;display:flex;flex-direction:column;gap:8px';
      adFields.innerHTML = `
        <select id="ad-type-select" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px">
          <option value="">Ad type...</option>
          <option>🚀 Launch</option><option>🤝 Find collab</option><option>💼 Service offer</option><option>👥 Recruiting</option>
        </select>
        <input id="ad-seeking" type="text" placeholder="What you're looking for exactly..." style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
        <input id="ad-budget" type="text" placeholder="Budget ou conditions (optional)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
      `;
      feedForm.appendChild(adFields);
    }
    if(type === 'campagne' && !document.getElementById('pub-extra-campagne')){
      const campagneFields = document.createElement('div');
      campagneFields.id = 'pub-extra-campagne';
      campagneFields.style.cssText = 'margin-top:8px;display:flex;flex-direction:column;gap:8px';
      campagneFields.innerHTML = `
        <input id="campagne-goal" type="text" placeholder="Measurable goal (ex: 500 signups, €10k revenue)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
        <input id="campagne-video" type="url" placeholder="Presentation video URL (YouTube, Loom...)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px"/>
        <textarea id="campagne-faq" placeholder="FAQ — Q: ... A: ... (3 questions/answers)" style="padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:Plus Jakarta Sans,sans-serif;font-size:13px;resize:none;min-height:70px"></textarea>
      `;
      const adDiv = document.getElementById('pub-extra-ad');
      if(adDiv) adDiv.after(campagneFields);
    }
    if(document.getElementById('pub-extra-ad')) document.getElementById('pub-extra-ad').style.display = 'flex';
    if(type === 'campagne' && document.getElementById('pub-extra-campagne')) document.getElementById('pub-extra-campagne').style.display = 'flex';
  } else {
    if(document.getElementById('pub-extra-ad')) document.getElementById('pub-extra-ad').style.display = 'none';
    if(document.getElementById('pub-extra-campagne')) document.getElementById('pub-extra-campagne').style.display = 'none';
  }
}
</script>

<script>
// ══════════════════════════════════════════════
//  WIZARD CONFIG — CONTENU PAR TYPE DE PUB
// ══════════════════════════════════════════════
const WIZ_CONFIGS = {

  pub: {
    mainTitle: 'CREATE MY AD',
    mainSub: 'Introduce your project to the entire ViralBoost community.',
    color: '#22c55e',
    steps: ['Identity', 'Description', 'Audience', 'Visual', 'Preview'],
    step1: {
      icon: '📢', head: 'YOUR AD IDENTITY',
      sub: 'The name is the first thing people see',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Project / product name *</label>
          <input type="text" id="pub-name" placeholder="Ex: ContentPro — The AI tool for creators" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 chars · <em style="color:var(--g4)">Be precise and catchy</em></div>
        </div>
        <div class="fg">
          <label>Category *</label>
          <select id="pub-cat" onchange="updatePubTypeEmoji()">
            <option>🚀 SaaS / App</option><option>🌐 Website</option><option>🛍️ E-commerce</option><option>💼 Service / Freelance</option><option>🎓 Coaching / Training</option><option>🎵 Social media</option><option>📧 Newsletter</option><option>🎙️ Podcast</option><option>👥 Community</option>
          </select>
        </div>
        <div class="fg">
          <label>Project URL</label>
          <input type="url" id="pub-url" placeholder="https://myproject.com" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji / Icon</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🚀" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🚀','💡','🎯','🔥','💎','⚡','🛍️','📣','🌟','💪'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '✍️', head: 'DESCRIBE YOUR AD', sub: 'A good description makes people want to click',
      fields: `
        <div class="fg">
          <label>Short hook <span style="color:var(--muted);font-weight:400">(60 chars max)</span></label>
          <input type="text" id="pub-hook" placeholder="Ex: The tool that replaces 5 paid subscriptions" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description principale *</label>
          <textarea id="pub-desc" rows="5" placeholder="Explain what your project does, what problem it solves, why people should care..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(22,163,74,0.04);border:1px solid rgba(22,163,74,0.12);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">💡 CLIQUE POUR AJOUTER</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❌ Problem resolved : ">❌ Problem resolved</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Solution : ">✅ Solution</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 For who: ">🎯 For who</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💰 Price : ">💰 Price / offer</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 Why now: ">🔥 Why now</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Result: ">📈 Expected result</div>
          </div>
        </div>`
    },
    step3: {
      icon: '🎯', head: 'AUDIENCE & TAGS', sub: 'Help the community find your project',
      fields: `
        <div class="fg">
          <label>Target audience *</label>
          <input type="text" id="pub-target" placeholder="Ex: TikTok creators 18-35, freelancers, SMBs..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Project stage</label>
          <select id="pub-stage"><option>💭 Idea</option><option>🧪 Beta</option><option>🚀 Launched</option><option>📈 Growing</option><option>💰 Monetized</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(comma · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: IA, TikTok, Free, SaaS" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Are you looking for collaborators?</label>
          <select id="pub-collab-need"><option value="">Not specified</option><option>👨‍💻 Developer</option><option>📣 Marketeur</option><option>🎨 Designer</option><option>🎬 Video creator</option><option>💸 Investisseur</option><option>🤝 Partner</option><option>🧑‍💼 Premiers clients</option></select>
        </div>`
    }
  },

  ad: {
    mainTitle: 'CREATE MY ANNOUNCEMENT',
    mainSub: 'Inform the community about something new, an update or event.',
    color: '#4ade80',
    steps: ['Title', 'Message', 'Distribution', 'Visual', 'Preview'],
    step1: {
      icon: '📣', head: 'AD TITLE', sub: 'A good title = 3× more reads',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Announcement title *</label>
          <input type="text" id="pub-name" placeholder="Ex: Major update v2.0 — New features!" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 chars.</div>
        </div>
        <div class="fg">
          <label>Ad type *</label>
          <select id="pub-cat">
            <option>🚀 Launch / Update</option><option>🤝 Partnership</option><option>📅 Event</option><option>📢 Important news</option><option>🎉 Celebration / Milestone</option><option>⚠️ Service change</option>
          </select>
        </div>
        <div class="fg">
          <label>Event / announcement date</label>
          <input type="date" id="pub-date" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Associated link</label>
          <input type="url" id="pub-url" placeholder="https://your-link.com"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Announcement emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="📣" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['📣','🚀','🎉','📅','⚠️','🔔','💡','🤝','📢','🌟'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '💬', head: 'ANNOUNCEMENT MESSAGE', sub: 'Be clear, precise, and make people want to react',
      fields: `
        <div class="fg">
          <label>One-line summary *</label>
          <input type="text" id="pub-hook" placeholder="Ex: We just hit 10,000 users 🎉" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Message complet *</label>
          <textarea id="pub-desc" rows="5" placeholder="Detail your announcement: what's changing? Why is it important? What does it change for the community?" oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(74,222,128,0.04);border:1px solid rgba(74,222,128,0.12);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#4ade80;letter-spacing:2px;margin-bottom:10px">💡 STRUCTURE YOUR AD</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📢 What changes: ">📢 What changes</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Why it matters: ">🎯 Why it matters</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="👥 Who is concerned : ">👥 Who is concerned</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📅 Starting from: ">📅 Effective date</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔗 Learn more: ">🔗 Learn more</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🙏 Thanks to: ">🙏 Acknowledgments</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📡', head: 'DISTRIBUTION', sub: 'Target the right people',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: Update, V2, News, Announcement" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Target audience</label>
          <input type="text" id="pub-target" placeholder="Ex: Existing users, newsletter followers, creators..." oninput="updatePubCompletion()"/>
        </div>`
    }
  },

  service: {
    mainTitle: 'PROPOSER UN SERVICE',
    mainSub: 'Showcase your skills and find your first clients.',
    color: '#60a5fa',
    steps: ['Service', 'Details', 'Terms', 'Visual', 'Preview'],
    step1: {
      icon: '🛍️', head: 'YOUR SERVICE', sub: 'Describe what you do in a few clear words',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Service title *</label>
          <input type="text" id="pub-name" placeholder="Ex: Logo creation + professional brand guidelines" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 chars.</div>
        </div>
        <div class="fg">
          <label>Category *</label>
          <select id="pub-cat">
            <option>🎨 Design & Creative</option><option>💻 Development</option><option>📣 Marketing & Growth</option><option>✍️ Writing & Content</option><option>🎬 Video & Photo</option><option>🎵 Audio & Musique</option><option>📊 Business & Conseil</option><option>🎓 Coaching & Formation</option><option>📱 Social media</option><option>🔧 Technique & Support</option>
          </select>
        </div>
        <div class="fg">
          <label>Tarif *</label>
          <input type="text" id="pub-price" placeholder="Ex: From €150 · or flat rate €500" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Delivery time</label>
          <select id="pub-delay"><option>⚡ Express (24h)</option><option>🚀 Fast (2-3d)</option><option>📅 Standard (1 week)</option><option>🗓️ Long-term (2+ weeks)</option><option>🔄 Sur devis</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Service emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🛍️" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🎨','💻','📣','✍️','🎬','📊','🔧','🎓','📱','💡'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📋', head: 'SERVICE DESCRIPTION', sub: 'Convince by explaining exactly what you deliver',
      fields: `
        <div class="fg">
          <label>Hook *</label>
          <input type="text" id="pub-hook" placeholder="Ex: I create visual identities that convert" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Full description *</label>
          <textarea id="pub-desc" rows="5" placeholder="Describe precisely what you deliver, your process, your added value and why choose you..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(59,130,246,0.04);border:1px solid rgba(59,130,246,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#60a5fa;letter-spacing:2px;margin-bottom:10px">💡 CE QUI VEND YOUR SERVICE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ What's included: ">✅ What's included</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⭐ My expertise: ">⭐ My expertise</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📦 What you receive: ">📦 Concrete deliverables</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏆 Client results : ">🏆 Client results</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔄 My process: ">🔄 My process</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Who it's for: ">🎯 Who it's for</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📞', head: 'TERMS & CONTACT', sub: 'How clients can contact you',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Contact link / portfolio *</label>
          <input type="url" id="pub-url" placeholder="https://myfreelance.com or Calendly link" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Work mode</label>
          <select id="pub-mode"><option>🌍 100% Remote</option><option>🏢 On-site possible</option><option>🔄 Hybrid</option></select>
        </div>
        <div class="fg">
          <label>Availability</label>
          <select id="pub-dispo"><option>✅ Available now</option><option>📅 Available within 1 week</option><option>⏳ Waitlist</option><option>❌ Fully booked for now</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: Design, Logo, Visual identity, Freelance" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  launch: {
    mainTitle: 'LAUNCH MY PRODUCT',
    mainSub: 'Officially announce your product and create maximum buzz.',
    color: '#f87171',
    steps: ['Product', 'Pitch', 'Target & Price', 'Visual', 'Preview'],
    step1: {
      icon: '🚀', head: 'YOUR PRODUCT', sub: 'Present your launch with impact',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Product name *</label>
          <input type="text" id="pub-name" placeholder="Ex: LaunchKit — The all-in-one kit for founders" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
          <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 chars.</div>
        </div>
        <div class="fg">
          <label>Product category *</label>
          <select id="pub-cat"><option>🚀 SaaS / App</option><option>🛍️ Physical product</option><option>📚 Training / E-learning</option><option>🎓 Coaching</option><option>📱 Mobile app</option><option>🔧 Tool / Extension</option><option>💼 Service</option><option>📖 Book / Ebook</option></select>
        </div>
        <div class="fg">
          <label>Launch stage</label>
          <select id="pub-stage"><option>🔥 Launching today!</option><option>🧪 Open beta</option><option>📅 Pre-launch (waitlist)</option><option>🎯 Official launch</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Product URL *</label>
          <input type="url" id="pub-url" placeholder="https://myproduct.com" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Product emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🚀" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🚀','🔥','💥','⚡','🎯','💡','🏆','💎','🌟','🛠️'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🎤', head: 'YOUR PITCH', sub: 'Explain the problem you solve and your solution',
      fields: `
        <div class="fg">
          <label>Tagline / One-liner pitch *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Stop wasting 3h/week on repetitive tasks" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Full description *</label>
          <textarea id="pub-desc" rows="6" placeholder="What problem do you solve? How? For whom? Why now?" oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:140px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(239,68,68,0.04);border:1px solid rgba(239,68,68,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#f87171;letter-spacing:2px;margin-bottom:10px">🔥 GOOD PITCH STRUCTURE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❌ The problem: ">❌ The problem</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ My solution: ">✅ My solution</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 For who: ">🎯 For who</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Concrete result: ">📈 Concrete result</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏆 What sets me apart: ">🏆 My difference</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⚡ Why now: ">⚡ Why now</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💰', head: 'TARGET & PRICE', sub: 'Who buys and at what price?',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Product price *</label>
          <input type="text" id="pub-price" placeholder="Ex: $29/mo · $197 one-time · Free with premium" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Launch offer?</label>
          <input type="text" id="pub-promo" placeholder="Ex: -50% first 72 hours · Code LAUNCH"/>
        </div>
        <div class="fg">
          <label>Main target audience</label>
          <input type="text" id="pub-target" placeholder="Ex: B2B founders, freelancers, SMBs..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags <span style="color:var(--muted);font-weight:400">(virgule · 5 max)</span></label>
          <input type="text" id="pub-tags" placeholder="Ex: SaaS, AI, Productivity, Launch, B2B" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  collab: {
    mainTitle: 'CHERCHER UN COLLAB',
    mainSub: 'Find the ideal partner to boost your project.',
    color: '#c084fc',
    steps: ['Project', 'Profile', 'Terms', 'Visual', 'Preview'],
    step1: {
      icon: '🤝', head: 'YOUR PROJECT', sub: 'Present the context to attract the right profiles',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Project name *</label>
          <input type="text" id="pub-name" placeholder="Ex: Looking for a partner for educational SaaS" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Collaboration type *</label>
          <select id="pub-cat"><option>🤝 Co-founder</option><option>💼 Partner</option><option>🎨 Creative partner</option><option>📣 Marketing partner</option><option>👨‍💻 Tech partner</option><option>🌍 Distribution partner</option><option>💰 Business Angel</option></select>
        </div>
        <div class="fg">
          <label>Project sector</label>
          <select id="pub-secteur"><option>💻 Tech / SaaS</option><option>🛍️ E-commerce</option><option>🎓 Education</option><option>💪 Health / Wellness</option><option>🎬 Content creators</option><option>🏢 B2B</option><option>👥 Community</option><option>🌱 Impact / Social</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Link to your project</label>
          <input type="url" id="pub-url" placeholder="https://myproject.com ou pitch deck"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🤝" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🤝','💼','🎯','🚀','💡','🌟','👥','🔥','💪','🌍'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🔍', head: 'DESIRED PROFILE', sub: 'Describe precisely the person you\'re looking for',
      fields: `
        <div class="fg">
          <label>Hook *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Looking for dev React for co-fonder une EdTech" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Project & need description *</label>
          <textarea id="pub-desc" rows="5" placeholder="Present your project, its stage, what you've already accomplished, and what you expect from your future partner..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(168,85,247,0.04);border:1px solid rgba(168,85,247,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#c084fc;letter-spacing:2px;margin-bottom:10px">💡 KEY ELEMENTS</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏗️ Current stage: ">🏗️ Project stage</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ What I already have: ">✅ Already done</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Skills needed: ">🎯 Key skills</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Long-term vision: ">📈 Vision</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💰 Planned share: ">💰 Share / equity</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📩 To contact me: ">📩 Contact</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📋', head: 'TERMS', sub: 'Be transparent about the terms',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Collaboration terms *</label>
          <input type="text" id="pub-conditions" placeholder="Ex: 50/50 equity · Remote OK · Full-time ideally" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Required investment</label>
          <select id="pub-invest"><option>💸 Capital only</option><option>⏱️ Time only</option><option>🔄 Time + capital</option><option>🤝 To be discussed</option></select>
        </div>
        <div class="fg">
          <label>Work mode</label>
          <select id="pub-mode"><option>🌍 100% Remote</option><option>🏢 On-site (Paris)</option><option>🏢 On-site (Other city)</option><option>🔄 Hybrid</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Tech, Equity, Remote, EdTech, Collab" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  promo: {
    mainTitle: 'CREATE MY PROMO',
    mainSub: 'Create urgency with an irresistible offer.',
    color: '#fbbf24',
    steps: ['Offer', 'Message', 'Limits', 'Visual', 'Preview'],
    step1: {
      icon: '🏷️', head: 'YOUR PROMO OFFER', sub: 'Crossed price + discount = the magic formula',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Promo title *</label>
          <input type="text" id="pub-name" placeholder="Ex: -60% off all courses for 48h!" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Original price (crossed)</label>
          <input type="text" id="pub-oldprice" placeholder="Ex: $199" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Promo price *</label>
          <input type="text" id="pub-price" placeholder="Ex: $79 = -60%" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Promo code</label>
          <input type="text" id="pub-code" placeholder="Ex: VIRAL60" style="text-transform:uppercase;letter-spacing:2px;font-family:'DM Mono',monospace;font-weight:700"/>
        </div>
        <div class="fg">
          <label>Expiry date *</label>
          <input type="datetime-local" id="pub-expiry" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Link to offer *</label>
          <input type="url" id="pub-url" placeholder="https://monoffer.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🏷️" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🏷️','💸','🔥','⚡','🎉','💥','🎁','⏳','✂️','💰'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '💬', head: 'SALES MESSAGE', sub: 'Create urgency and justify the value',
      fields: `
        <div class="fg">
          <label>Hook *</label>
          <input type="text" id="pub-hook" placeholder="Ex: 🔥 Offer flash — seulement 48h !" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Offer description *</label>
          <textarea id="pub-desc" rows="5" placeholder="What's included, why it's a great deal, who it's for..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(245,158,11,0.04);border:1px solid rgba(245,158,11,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#fbbf24;letter-spacing:2px;margin-bottom:10px">⚡ CREATE URGENCY</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ What is included: ">✅ Included</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⏳ Expiress on: ">⏳ Deadline</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Who it's for: ">🎯 Who it's for</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 Why now: ">🔥 Urgency</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💎 Total value: ">💎 Value</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⭐ Testimonial: ">⭐ Social proof</div>
          </div>
        </div>`
    },
    step3: {
      icon: '⏱️', head: 'LIMITS & TARGETING', sub: 'Define who can benefit',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Target audience</label>
          <input type="text" id="pub-target" placeholder="Ex: Creators, entrepreneurs, students..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Number of spots</label>
          <input type="text" id="pub-slots" placeholder="Ex: 50 spots · Unlimitd · 1 winner only"/>
        </div>
        <div class="fg">
          <label>Access conditions</label>
          <select id="pub-access"><option>🌍 Open to all</option><option>📧 Newsletter subscribers</option><option>💎 VIP members</option><option>🔗 Secret link only</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Promo, Training, -60%, Flash, Limitd" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  sondage: {
    mainTitle: 'CREATE A POLL',
    mainSub: 'Collect votes and community insights in real time.',
    color: '#2dd4bf',
    steps: ['Question', 'Options', 'Settings', 'Visual', 'Preview'],
    step1: {
      icon: '📊', head: 'YOUR QUESTION', sub: 'A good question = actionable answers',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Your question *</label>
          <input type="text" id="pub-name" placeholder="Ex: Which AI tool do you use most in 2025?" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Poll theme</label>
          <select id="pub-cat"><option>💻 Tech & AI</option><option>📣 Marketing</option><option>💼 Business</option><option>🎨 Creativity</option><option>💰 Finance</option><option>🌍 Society</option><option>🎓 Education</option><option>🤔 General opinion</option></select>
        </div>
        <div class="fg">
          <label>Vote duration</label>
          <select id="pub-duration"><option>⚡ 24 hours</option><option>📅 3 days</option><option>📅 1 week</option><option>📅 2 weeks</option><option>♾️ Unlimitd</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Context / explanation (optional)</label>
          <input type="text" id="pub-hook" placeholder="Ex: I'm writing an article and would love your opinion!" maxlength="60" oninput="updateMobilePreview()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="📊" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['📊','🤔','💡','🗳️','❓','🔍','📈','🎯','💬','🌐'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🔘', head: 'THE OPTIONS', sub: 'Offer 2 to 4 clear and distinct choices',
      fields: `
        <div class="fg">
          <label>Option A *</label>
          <input type="text" id="pub-opt-a" placeholder="Ex: ChatGPT" oninput="updatePubCompletion()" style="border-left:3px solid #2dd4bf"/>
        </div>
        <div class="fg">
          <label>Option B *</label>
          <input type="text" id="pub-opt-b" placeholder="Ex: Claude" oninput="updatePubCompletion()" style="border-left:3px solid #34d399"/>
        </div>
        <div class="fg">
          <label>Option C</label>
          <input type="text" id="pub-opt-c" placeholder="Ex: Gemini" style="border-left:3px solid #a78bfa"/>
        </div>
        <div class="fg">
          <label>Option D</label>
          <input type="text" id="pub-opt-d" placeholder="Ex: Other (specify in comments)" style="border-left:3px solid #fb923c"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Description / Details</label>
          <textarea id="pub-desc" rows="3" placeholder="Add context or details about your poll..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:80px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300</div>
        </div>`
    },
    step3: {
      icon: '⚙️', head: 'SETTINGS', sub: 'Who can vote and how',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Target audience</label>
          <input type="text" id="pub-target" placeholder="Ex: Creators, developers, marketers..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Visible results</label>
          <select id="pub-results"><option>👁️ After vote only</option><option>🌍 Visible in real time</option><option>🔒 At the end only</option></select>
        </div>
        <div class="fg">
          <label>Multiple votes allowed?</label>
          <select id="pub-multi"><option>❌ Non (1 vote par personne)</option><option>✅ Oui (plusieurs choix)</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: IA, Sondage, Tools, Tech" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  tutoriel: {
    mainTitle: 'CREATE A TUTORIAL',
    mainSub: 'Share your expertise and position yourself as a reference.',
    color: '#86efac',
    steps: ['Topic', 'Content', 'Audience', 'Visual', 'Preview'],
    step1: {
      icon: '🎓', head: 'YOUR TUTORIAL', sub: 'A good tutorial title is precise and promises results',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Tutorial title *</label>
          <input type="text" id="pub-name" placeholder="Ex: How to create a landing page that converts in 2h" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Category</label>
          <select id="pub-cat"><option>💻 Development</option><option>🎨 Design</option><option>📣 Marketing</option><option>💼 Business</option><option>🤖 AI & Automation</option><option>📱 Social media</option><option>💰 Finance / Investment</option><option>🎬 Content creation</option><option>🛠️ Productivity</option></select>
        </div>
        <div class="fg">
          <label>Required level</label>
          <select id="pub-level"><option>🟢 Beginner</option><option>🟡 Intermediate</option><option>🔴 Advanced</option><option>🌍 All levels</option></select>
        </div>
        <div class="fg">
          <label>Estimated duration</label>
          <select id="pub-duration"><option>⚡ 5-10 min</option><option>📖 15-30 min</option><option>⏱️ 30-60 min</option><option>🗓️ Plusieurs heures</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Link vers le tuto complet</label>
          <input type="url" id="pub-url" placeholder="https://your-blog.com/tutorial or YouTube..."/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🎓" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🎓','📚','💡','🔧','⚙️','🎯','📝','🖥️','🔑','🚀'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📝', head: 'TUTORIAL CONTENT', sub: 'Describe what readers will learn',
      fields: `
        <div class="fg">
          <label>1-line summary *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Learn to double your conversion rate in 5 steps" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Full description *</label>
          <textarea id="pub-desc" rows="5" placeholder="Describe the main steps, prerequisites, and what readers will learn exactly..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(34,197,94,0.04);border:1px solid rgba(34,197,94,0.12);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#86efac;letter-spacing:2px;margin-bottom:10px">📚 STRUCTURE YOUR TUTORIAL</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 What you'll learn: ">🎯 Goal</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📋 📋 Prerequisites : ">📋 📋 Prerequisites</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="1️⃣ Step 1 : ">1️⃣ Step 1</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="2️⃣ Step 2 : ">2️⃣ Step 2</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🛠️ Tools used: ">🛠️ Tools</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Final result : ">✅ Final result</div>
          </div>
        </div>`
    },
    step3: {
      icon: '👥', head: 'AUDIENCE', sub: 'Who is this tutorial for?',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Target audience</label>
          <input type="text" id="pub-target" placeholder="Ex: Beginner developers, freelancers, entrepreneurs..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Tutorial, Marketing, Beginner, Free" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  search: {
    mainTitle: 'POST A SEARCH',
    mainSub: 'Describe your need and receive proposals from the community.',
    color: '#a5b4fc',
    steps: ['Need', 'Details', 'Budget & timeline', 'Visual', 'Preview'],
    step1: {
      icon: '🔍', head: 'YOUR NEED', sub: 'The more precise you are, the better served you\'ll be',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Need title *</label>
          <input type="text" id="pub-name" placeholder="Ex: Looking for React developer for urgent mobile app" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Search type *</label>
          <select id="pub-cat"><option>👨‍💻 Freelance / Contractor</option><option>🤝 Business partner</option><option>🛠️ Tool / Software</option><option>📚 Resource / Content</option><option>💡 Conseil / Avis</option><option>🌍 Fournisseur</option><option>📢 Influencer / Ambassadeur</option></select>
        </div>
        <div class="fg">
          <label>Urgency</label>
          <select id="pub-urgence"><option>🔥 Very urgent (this week)</option><option>⚡ Urgent (2 weeks)</option><option>📅 Normal (1 month)</option><option>🗓️ Not urgent (whenever available)</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🔍" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🔍','🤝','👨‍💻','🛠️','📢','💡','🎯','📚','💼','🌍'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📋', head: 'NEED DESCRIPTION', sub: 'Describe exactly what you need',
      fields: `
        <div class="fg">
          <label>Summary *</label>
          <input type="text" id="pub-hook" placeholder="Ex: I'm looking for someone to redesign my site in 2 weeks" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Full description *</label>
          <textarea id="pub-desc" rows="5" placeholder="Describe your project, the context, required skills, and what you expect exactly..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(99,102,241,0.04);border:1px solid rgba(99,102,241,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#a5b4fc;letter-spacing:2px;margin-bottom:10px">💡 BE PRECISE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 What I need: ">🎯 Specific need</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📋 Required skills: ">📋 ✅ Skills</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏗️ Project context: ">🏗️ Context</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📦 Expected deliverables: ">📦 Deliverables</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📩 How to apply: ">📩 How to apply</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⚠️ Important: ">⚠️ Key points</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💰', head: 'BUDGET & TIMELINE', sub: 'Be transparent to attract the right people',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Budget *</label>
          <input type="text" id="pub-price" placeholder="Ex: 300-500€ · Daily rate 350€ · Quote-based · Equity possible" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Work mode</label>
          <select id="pub-mode"><option>🌍 Remote only</option><option>🏢 Paris / Greater Paris</option><option>🏢 Other city</option><option>🔄 Remote or on-site</option></select>
        </div>
        <div class="fg">
          <label>Contrat</label>
          <select id="pub-contrat"><option>📄 Freelance mission</option><option>🤝 Partnership</option><option>💼 Full-time / Fixed-term</option><option>🔄 To be defined</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: React, Freelance, Urgent, Remote, Dev" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  resultat: {
    mainTitle: 'SHARE MY RESULTS',
    mainSub: 'Insworst the community with your stats and wins.',
    color: '#fde68a',
    steps: ['Numbers', 'Story', 'Learnings', 'Visual', 'Preview'],
    step1: {
      icon: '🏆', head: 'YOUR NUMBERS', sub: 'Concrete numbers inspire and engage',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Result title *</label>
          <input type="text" id="pub-name" placeholder="Ex: €10,000 revenue in 3 months — here's how I did it" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Key metric *</label>
          <input type="text" id="pub-metric" placeholder="Ex: 10 000€ · 5 000 followers · +300% de trafic" oninput="updatePubCompletion()" style="font-size:18px;font-weight:800;text-align:center"/>
        </div>
        <div class="fg">
          <label>Period</label>
          <input type="text" id="pub-period" placeholder="Ex: January to March 2025 · In 90 days" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Domaine</label>
          <select id="pub-cat"><option>💰 Revenue / MRR</option><option>👥 Audience / Followers</option><option>🔗 Traffic / Visitors</option><option>🛍️ Sales / Clients</option><option>📈 Croissance</option><option>🎓 Formation / Apprentissage</option><option>🏋️ Personal / Challenge</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🏆" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🏆','📈','💰','🎉','🚀','⭐','💪','🔥','🌟','🎯'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📖', head: 'YOUR STORY', sub: 'Context + journey = inspiring content',
      fields: `
        <div class="fg">
          <label>Hook *</label>
          <input type="text" id="pub-hook" placeholder="Ex: 3 months ago, I started from zero. Here's what changed." maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Your full story *</label>
          <textarea id="pub-desc" rows="6" placeholder="Talk about your starting point, the challenges faced, the actions that changed everything..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:140px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#fde68a;letter-spacing:2px;margin-bottom:10px">🏆 STRUCTURE QUI ENGAGE</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📍 Starting point : ">📍 Starting point</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="⚡ What changed everything: ">⚡ The spark</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔑 Key actions : ">🔑 Key actions</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 The results: ">📈 The numbers</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="😰 The challenges: ">😰 Challenges</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💡 What I would have done differently: ">💡 Retro</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💡', head: 'LEARNINGS', sub: 'Share what you\'ve learned to help others',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Apprentissage principal</label>
          <textarea id="pub-lesson" rows="3" placeholder="What is the #1 lesson you take away from this experience?" style="font-size:13px;resize:none;min-height:70px;padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:'Plus Jakarta Sans',sans-serif;outline:none"></textarea>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Results, Revenue, Growth, Testimonial" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Audience inspired by this result</label>
          <input type="text" id="pub-target" placeholder="Ex: Entrepreneurs, creators, beginner freelancers..." oninput="updatePubCompletion()"/>
        </div>`
    }
  },

  campagne: {
    mainTitle: 'LAUNCH MY CAMPAIGN',
    mainSub: 'The ultimate format for maximum visibility with measurable goals.',
    color: '#ffd700',
    steps: ['Campaign', 'Pitch', 'Goals', 'Visual', 'Preview'],
    step1: {
      icon: '🎯', head: 'YOUR CAMPAIGN', sub: 'The name + goal set the tone for your campaign',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Campaign name *</label>
          <input type="text" id="pub-name" placeholder="Ex: 🎯 LaunchBoost — 1000 beta testers in 30 days" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Campaign type *</label>
          <select id="pub-cat"><option>🚀 Product launch</option><option>🧪 Beta tester recruitment</option><option>💰 Fundraising</option><option>👥 Audience growth</option><option>🤝 Search partners</option><option>🌍 Impact / Cause</option></select>
        </div>
        <div class="fg">
          <label>Campaign duration</label>
          <select id="pub-duration"><option>⚡ 7 jours</option><option>📅 14 jours</option><option>📅 30 jours</option><option>📅 60 jours</option><option>♾️ Sans limit</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Campaign URL *</label>
          <input type="url" id="pub-url" placeholder="https://macampagne.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Presentation video URL</label>
          <input type="url" id="pub-video" placeholder="https://youtube.com/... ou Loom..." oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🎯" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🎯','🚀','💥','🔥','⭐','🏆','💎','🌟','⚡','🎪'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '🎤', head: 'CAMPAIGN PITCH', sub: 'Convince people to join your cause',
      fields: `
        <div class="fg">
          <label>Campaign slogan *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Join 500 founders changing their industry" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Full description *</label>
          <textarea id="pub-desc" rows="5" placeholder="Present your campaign, why it matters, what people gain by joining..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#ffd700;letter-spacing:2px;margin-bottom:10px">🌟 PITCH GAGNANT</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 The mission: ">🎯 The mission</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❓ The problem addressed: ">❓ Problem</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎁 What you offer: ">🎁 The offer</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💪 Why you: ">💪 Why you</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 The urgency: ">🔥 Urgency</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🚀 How to join: ">🚀 How to join</div>
          </div>
        </div>`
    },
    step3: {
      icon: '📊', head: 'GOALS & FAQ', sub: 'Precise numbers + FAQ = maximum credibility',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Main measurable goal *</label>
          <input type="text" id="pub-goal" placeholder="Ex: 1,000 signups · €50,000 raised · 10k followers" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>FAQ (3 key Q&As)</label>
          <textarea id="pub-faq" rows="4" placeholder="Q: How does it work?&#10;A: ...&#10;Q: Is it free?&#10;A: ..." style="font-size:13px;resize:none;min-height:100px;padding:10px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;color:var(--white);font-family:'DM Mono',monospace;outline:none"></textarea>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Campaign, SaaS, Launch, Beta, Growth" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  'service-pro': {
    mainTitle: 'MY PRO SERVICE',
    mainSub: 'Create your complete professional showcase to attract premium clients.',
    color: '#a855f7',
    steps: ['Profile', 'Offers', 'Proof', 'Visual', 'Preview'],
    step1: {
      icon: '🔧', head: 'YOUR PRO PROFILE', sub: 'Your premium digital business card',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Your professional title *</label>
          <input type="text" id="pub-name" placeholder="Ex: Antoine D. — Expert Growth & Acquisition B2B" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Main specialty *</label>
          <select id="pub-cat"><option>🎨 Design & Branding</option><option>💻 Development Web/App</option><option>📣 Marketing & Growth</option><option>✍️ Copywriting & Content</option><option>🎬 Video & Production</option><option>📊 Data & Analytics</option><option>🤖 AI & Automation</option><option>💼 Consulting & Strategy</option><option>🎓 Formation & Coaching</option></select>
        </div>
        <div class="fg">
          <label>Years of experience</label>
          <select id="pub-exp"><option>🌱 1-2 ans</option><option>📈 3-5 ans</option><option>⭐ 5-10 ans</option><option>🏆 +10 ans</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Portfolio / Website *</label>
          <input type="url" id="pub-url" placeholder="https://monportfolio.fr" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="🔧" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['🔧','💼','⭐','🎨','💻','📣','✍️','🎬','📊','🏆'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '💰', head: 'YOUR OFFERS', sub: 'Your services with clear pricing',
      fields: `
        <div class="fg">
          <label>Hook *</label>
          <input type="text" id="pub-hook" placeholder="Ex: I turn ideas into products that convert" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Description & offers *</label>
          <textarea id="pub-desc" rows="5" placeholder="Describe your main offers, your approach, what sets you apart..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div class="fg">
          <label>Starting rate</label>
          <input type="text" id="pub-price" placeholder="Ex: From €800 · Daily rate €500"/>
        </div>
        <div class="fg">
          <label>Availability</label>
          <select id="pub-dispo"><option>✅ Available immediately</option><option>📅 Available in 1 week</option><option>⏳ Waitlist 2 weeks</option><option>❌ Complet actuellement</option></select>
        </div>`
    },
    step3: {
      icon: '⭐', head: 'SOCIAL PROOF', sub: 'Testimonials + references = instant trust',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Customer testimonial 1</label>
          <input type="text" id="pub-testi1" placeholder="\"Excellent work, delivered ahead of schedule. Highly recommended!\" — Marie D., CEO Startup XY"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Customer testimonial 2</label>
          <input type="text" id="pub-testi2" placeholder="\"ROI x3 in 2 months. Performance beyond expectations.\" — Pierre L., Founder"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Notable clients / Brands</label>
          <input type="text" id="pub-refs" placeholder="Ex: Orange, BNP, 12 startups Series A, +50 freelances..."/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: Design, UX, Branding, Premium, Paris" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  },

  emploi: {
    mainTitle: 'POST A JOB OFFER',
    mainSub: 'Find the best talent for your team or project.',
    color: '#60a5fa',
    steps: ['Position', 'Mission', 'Terms', 'Visual', 'Preview'],
    step1: {
      icon: '💼', head: 'THE POSITION', sub: 'A precise title attracts the right candidates',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Job title *</label>
          <input type="text" id="pub-name" placeholder="Ex: Full-Stack Developer React/Node.js — FinTech Startup" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
        </div>
        <div class="fg">
          <label>Contract type *</label>
          <select id="pub-contrat"><option>💼 Permanent</option><option>📋 Fixed-term</option><option>🚀 Freelance / Mission</option><option>🎓 Internship</option><option>🌱 Apprenticeship</option><option>🤝 Partner / Co-fondateur</option></select>
        </div>
        <div class="fg">
          <label>Department / Field *</label>
          <select id="pub-cat"><option>💻 Tech & Dev</option><option>🎨 Design & Creative</option><option>📣 Marketing & Growth</option><option>💼 Commercial / Sales</option><option>📊 Data & BI</option><option>🤖 IA & ML</option><option>💰 Finance & Gestion</option><option>🎓 Produit / PM</option><option>👥 RH / Recruiting</option><option>🔧 Ops / Support</option></select>
        </div>
        <div class="fg">
          <label>Required experience</label>
          <select id="pub-exp"><option>🌱 Junior (0-2 yrs)</option><option>📈 Confirmed (2-5 yrs)</option><option>⭐ Senior (5-10 yrs)</option><option>🏆 Expert (10+ yrs)</option><option>🤔 Tous niveaux</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Company / project name *</label>
          <input type="text" id="pub-company" placeholder="Ex: FinTech XYZ · My Startup · Side project" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Link candidature / site *</label>
          <input type="url" id="pub-url" placeholder="https://rejoins.mastartup.fr ou email direct" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg" style="grid-column:1/-1"><label>Emoji</label><div style="display:flex;gap:8px;align-items:center"><input type="text" id="pub-emoji" placeholder="💼" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/><div style="display:flex;gap:6px;flex-wrap:wrap">
          ${['💼','👨‍💻','🎨','📣','💻','📊','🤖','💰','🎯','🚀'].map(e=>`<span onclick="document.getElementById('pub-emoji').value='${e}';updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">${e}</span>`).join('')}
        </div></div></div>`
    },
    step2: {
      icon: '📋', head: 'MISSION & SKILLS', sub: 'What the candidate does daily',
      fields: `
        <div class="fg">
          <label>Hook *</label>
          <input type="text" id="pub-hook" placeholder="Ex: Join a team of 5 scaling to +10k users/month" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
        </div>
        <div class="fg">
          <label>Job description & mission *</label>
          <textarea id="pub-desc" rows="5" placeholder="Describe the main missions, team context, job challenges, and what makes this positione unique..." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:130px;"></textarea>
          <div style="font-size:10px;color:var(--muted2);margin-top:5px;font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></div>
        </div>
        <div style="background:rgba(59,130,246,0.04);border:1px solid rgba(59,130,246,0.15);border-radius:10px;padding:14px 16px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:#60a5fa;letter-spacing:2px;margin-bottom:10px">💡 KEY ELEMENTS OF AN OFFER</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Main missions: ">🎯 Missions</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Required skills: ">✅ ✅ Skills</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🌟 Bonus skills: ">🌟 Bonus skills</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🏢 The team : ">🏢 The team</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🚀 The project: ">🚀 The project</div>
            <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Career growth prospects: ">📈 Evolution</div>
          </div>
        </div>`
    },
    step3: {
      icon: '💰', head: 'TERMS', sub: 'Compensation, workplace and benefits',
      fields: `
        <div class="fg" style="grid-column:1/-1">
          <label>Compensation *</label>
          <input type="text" id="pub-salary" placeholder="Ex: €45-55k/year · Daily rate €400 · Equity 0.5% · Negotiable" oninput="updatePubCompletion()"/>
        </div>
        <div class="fg">
          <label>Work mode *</label>
          <select id="pub-mode"><option>🌍 Full Remote</option><option>🏢 Paris</option><option>🏢 Lyon</option><option>🏢 Other city</option><option>🔄 Hybrid (2d office/week)</option><option>🔄 Hybrid (3j bureau/sem)</option></select>
        </div>
        <div class="fg">
          <label>Start date</label>
          <select id="pub-start"><option>⚡ Immediately</option><option>📅 In 1 month</option><option>📅 In 2-3 months</option><option>🤝 To be defined</option></select>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Benefits</label>
          <input type="text" id="pub-perks" placeholder="Ex: Stock options, health insurance, MacBook, training budget, team offsite..."/>
        </div>
        <div class="fg" style="grid-column:1/-1">
          <label>Tags</label>
          <input type="text" id="pub-tags" placeholder="Ex: CDI, Remote, React, Senior, Paris" oninput="updatePubCompletion();renderTagsPreview()"/>
          <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
        </div>`
    }
  }
};

// Fallback for types without custom config (tutoriel, search already done above)
['pub','ad','service','launch','collab','promo','sondage','tutoriel','search','resultat','campagne','service-pro','emploi'].forEach(t => {
  if(!WIZ_CONFIGS[t]) WIZ_CONFIGS[t] = WIZ_CONFIGS['pub'];
});

function applyWizardConfig(type) {
  const cfg = WIZ_CONFIGS[type] || WIZ_CONFIGS['pub'];

  // Main header
  const mt = document.getElementById('wiz-main-title');
  const ms = document.getElementById('wiz-main-sub');
  if(mt) mt.textContent = cfg.mainTitle;
  if(ms) ms.textContent = cfg.mainSub;

  // Stepper labels
  cfg.steps.forEach((lbl, i) => {
    const el = document.getElementById('wlbl-' + (i+1));
    if(el) el.textContent = lbl;
  });

  // Step 1
  const s1 = cfg.step1;
  document.getElementById('wiz-step1-icon').textContent = s1.icon;
  document.getElementById('wiz-step1-head').textContent = s1.head;
  document.getElementById('wiz-step1-sub').textContent = s1.sub;
  document.getElementById('wiz-step1-fields').innerHTML = s1.fields;
  document.getElementById('wiz-step1-next').innerHTML = `Next — ${cfg.steps[1]} <span>→</span>`;

  // Step 2
  const s2 = cfg.step2;
  document.getElementById('wiz-step2-icon').textContent = s2.icon;
  document.getElementById('wiz-step2-head').textContent = s2.head;
  document.getElementById('wiz-step2-sub').textContent = s2.sub;
  document.getElementById('wiz-step2-fields').innerHTML = s2.fields;
  document.getElementById('wiz-step2-next').innerHTML = `Next — ${cfg.steps[2]} <span>→</span>`;

  // Step 3
  const s3 = cfg.step3;
  document.getElementById('wiz-step3-icon').textContent = s3.icon;
  document.getElementById('wiz-step3-head').textContent = s3.head;
  document.getElementById('wiz-step3-sub').textContent = s3.sub;
  document.getElementById('wiz-step3-fields').innerHTML = s3.fields;
  document.getElementById('wiz-step3-next').innerHTML = `Next — ${cfg.steps[3]} <span>→</span>`;

  // Accent color on wizard header title
  if(mt) mt.style.color = cfg.color;

  // Re-init char counters if present
  const nameEl = document.getElementById('pub-name');
  const descEl = document.getElementById('pub-desc');
  if(nameEl) {
    nameEl.addEventListener('input', () => {
      const c = document.getElementById('pub-name-count');
      if(c) c.textContent = nameEl.value.length;
    });
  }
  if(descEl) {
    descEl.addEventListener('input', () => {
      const c = document.getElementById('pub-desc-count');
      if(c) c.textContent = descEl.value.length;
    });
  }
}
</script>

<script>
const PUB_TYPE_INFO = {
  pub: {
    emoji:'📢', name:'Ad', color:'#22c55e', btnBg:'linear-gradient(135deg,#15803d,#22c55e)',
    intro:'The simplest and most direct post. Ideal for presenting your project, app or brand to the entire ViralBoost community in seconds.',
    tags:['✍️ Project name','📝 Description','🔗 Link','🏷️ Tags'],
    tip:'💡 Perfect for getting started or testing your message.'
  },
  ad: {
    emoji:'📣', name:'Announcement', color:'#4ade80', btnBg:'linear-gradient(135deg,#166534,#4ade80)',
    intro:'Have important news to share? An update, a partnership, a change? Use Announcement to inform the community with a date and a link.',
    tags:['📋 Title','💬 Message','📅 Date','🔗 Link'],
    tip:'💡 Great for engaging and keeping your audience informed.'
  },
  service: {
    emoji:'🛍️', name:'Service', color:'#60a5fa', btnBg:'linear-gradient(135deg,#1e40af,#60a5fa)',
    intro:'Selling a service? Design, development, coaching, writing… Offer your skills with a clear rate and a way to contact you directly.',
    tags:['🔧 Service','💰 Rate','⏱️ Deadline','📩 Contact'],
    tip:'💡 Perfect for finding your first clients.'
  },
  launch: {
    emoji:'🚀', name:'Launch', color:'#f87171', btnBg:'linear-gradient(135deg,#991b1b,#f87171)',
    intro:'Today\'s the big day! Officially announce your product or service with full context: the problem you solve, your solution, and the price. Maximum impact.',
    tags:['📦 Product','❓ Problem solved','✅ Solution','💵 Price'],
    tip:'🔥 The best way to make noise at launch.'
  },
  collab: {
    emoji:'🤝', name:'Collab', color:'#c084fc', btnBg:'linear-gradient(135deg,#6b21a8,#c084fc)',
    intro:'Looking for a partner, co-founder, content creator or business partner? Describe the ideal profile and collaboration terms.',
    tags:['👤 Target profile','🎯 Niche','📋 Terms','📩 Contact'],
    tip:'💡 Hundreds of collabs are born here every month.'
  },
  promo: {
    emoji:'🏷️', name:'Promo', color:'#fbbf24', btnBg:'linear-gradient(135deg,#92400e,#fbbf24)',
    intro:'Exclusive deal, promo code, flash sale… Create urgency with a time-limitd offer. The crossed-out price and expiry date boost conversions.',
    tags:['🎁 Offer','💸 Crossed price','🔑 Promo code','⏳ Expiry'],
    tip:'⚡ Promos generate 3x more clicks on average.'
  },
  sondage: {
    emoji:'📊', name:'Poll', color:'#2dd4bf', btnBg:'linear-gradient(135deg,#134e4a,#2dd4bf)',
    intro:'Ask the community a question and collect votes in real time. Perfect for validating an idea, testing a product name or gauging your audience\'s preferences.',
    tags:['❓ Question','🔘 4 choices','⏱️ Duration','📈 Live results'],
    tip:'💡 Excellent for free market research.'
  },
  tutoriel: {
    emoji:'🎓', name:'Tutorial', color:'#86efac', btnBg:'linear-gradient(135deg,#14532d,#86efac)',
    intro:'Share your expertise! Publish a step-by-step guide on a topic you master. Tutorials generate lots of engagement and position you as an expert.',
    tags:['📚 Topic','🔢 Steps','📶 Level','⏱️ Estimated time'],
    tip:'💡 Tutorials get 5x more saves than other posts.'
  },
  search: {
    emoji:'🔍', name:'Search', color:'#a5b4fc', btnBg:'linear-gradient(135deg,#312e81,#a5b4fc)',
    intro:'Looking for a freelaunch, tool, resource or recommendation? Precisely describe your need, budget and deadline to receive proposals from the community.',
    tags:['📋 Need','💰 Budget','📅 Deadline','📩 Contact'],
    tip:'💡 The community responds in under 2h on average.'
  },
  resultat: {
    emoji:'🏆', name:'Result', color:'#fde68a', btnBg:'linear-gradient(135deg,#78350f,#fde68a)',
    intro:'Share your wins and inspiring the community! Sales figures, followers gained, revenue achieved… Show your progress and what you\'ve learned along the way.',
    tags:['📈 Key figures','📅 Period','💡 Learnings','🙏 Thank you'],
    tip:'🏆 Result posts are the most shared.'
  },
  campagne: {
    emoji:'🎯', name:'Campaign', color:'#ffd700', btnBg:'linear-gradient(135deg,#78350f,#ffd700)',
    intro:'The ultimate format for maximum visibility. Campaign combines a measurable goal, presentation video and FAQ to fully convince. Perfect for fundraising, launching a big product or finding investors.',
    tags:['🎯 Measurable goal','🎬 Video','❓ Full FAQ','🚀 Top feed boost'],
    tip:'🌟 The most impactful format on the platform.'
  },
  'service-pro': {
    emoji:'🔧', name:'Pro Service', color:'#a855f7', btnBg:'linear-gradient(135deg,#4c1d95,#a855f7)',
    intro:'The complete professional showcase for serious freelancers. Includes a portfolio, client testimonials, detailed pricing grids and a booking system.',
    tags:['🖼️ Portfolio','⭐ Testimonials','💰 Pricing grid','📅 Booking'],
    tip:'💎 To stand out and justify premium rates.'
  },
  emploi: {
    emoji:'💼', name:'Job Offer', color:'#60a5fa', btnBg:'linear-gradient(135deg,#1e3a8a,#60a5fa)',
    intro:'Recruit the best talent for your team or project. Describe the role, required skills, work conditions (remote, on-site) and compensation to attract the right profiles.',
    tags:['👤 Position','🛠️ Skills','🏠 Remote/On-site','💵 Compensation'],
    tip:'💼 Find your next collaborator in the community.'
  }
};

let _pendingPubType = null;

function previewPubType(type) {
  const info = PUB_TYPE_INFO[type];
  if (!info) { choosePubType(type); return; }

  _pendingPubType = type;

  // Highlight selected card
  document.querySelectorAll('.pub-type-card').forEach(c => c.classList.remove('ptc-selected'));
  const card = document.getElementById('ptc-' + type) || document.getElementById('ptc-' + type.replace('-','-'));
  if(card) card.classList.add('ptc-selected');

  const box = document.getElementById('pub-type-intro');
  document.getElementById('pub-intro-emoji').textContent = info.emoji;
  document.getElementById('pub-intro-title').textContent = info.name.toUpperCase();
  document.getElementById('pub-intro-title').style.color = info.color;
  document.getElementById('pub-intro-text').textContent = info.intro;

  // Tags
  const tagsEl = document.getElementById('pub-intro-tags');
  tagsEl.innerHTML = info.tags.map(t =>
    `<span style="font-size:10px;padding:3px 9px;border-radius:20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--g5);font-family:'DM Mono',monospace">${t}</span>`
  ).join('');

  // Confirm button
  const btn = document.getElementById('pub-intro-confirm');
  btn.style.background = info.btnBg;

  // Style the box border to match type color
  box.style.border = `1.5px solid ${info.color}30`;
  box.style.background = `linear-gradient(135deg,${info.color}08,transparent)`;

  // Add tip if needed
  if(info.tip) {
    document.getElementById('pub-intro-text').textContent = info.intro + '\n\n' + info.tip;
  }

  box.style.display = 'block';

  // Scroll intro into view smoothly
  setTimeout(()=>{ box.scrollIntoView({behavior:'smooth',block:'nearest'}); }, 100);
}

function confirmPubTypeChoice() {
  if(_pendingPubType) {
    choosePubType(_pendingPubType);
    _pendingPubType = null;
  }
}
</script>

<script>
// ── AD TYPE CHOOSER (inline in tab-publish) ──
function choosePubType(type){
  const plan = currentUser ? (currentUser.plan || 'free') : 'free';
  // All types are free now!
  // Hide chooser, show wizard
  const chooser = document.getElementById('pub-type-chooser');
  const wizard = document.getElementById('pub-wizard-content');
  const badge = document.getElementById('pub-type-badge');
  if(chooser) chooser.style.display = 'none';
  if(wizard) wizard.style.display = 'block';

  // Apply wizard config for this type
  applyWizardConfig(type);
  if(badge){
    const labels = {pub:'📢 AD', ad:'📣 ANNOUNCEMENT', service:'🛍️ SERVICE', launch:'🚀 LAUNCH', collab:'🤝 COLLAB', promo:'🏷️ PROMO', sondage:'📊 POLL', tutoriel:'🎓 TUTORIAL', search:'🔍 SEARCH', resultat:'🏆 RESULT', campagne:'🎯 CAMPAIGN', 'service-pro':'🔧 PRO SERVICE', emploi:'💼 JOB OFFER'};
    badge.textContent = labels[type] || '';
  }
  window._currentPubType = type;
  if(type === 'campagne'){
    toast('🏆 Campaign mode activated — maximum visibility!');
  } else if(type === 'ad'){
    toast('📣 Announcement mode activated!');
  }
}

function backToPubTypeChooser(){
  const chooser = document.getElementById('pub-type-chooser');
  const wizard = document.getElementById('pub-wizard-content');
  if(chooser) chooser.style.display = 'block';
  if(wizard) wizard.style.display = 'none';
  window._currentPubType = null;
  // Reset intro
  const intro = document.getElementById('pub-type-intro');
  if(intro) intro.style.display = 'none';
  document.querySelectorAll('.pub-type-card').forEach(c => c.classList.remove('ptc-selected'));
  _pendingPubType = null;
}

// Reset chooser when switching away and back to publish tab
const _origShowAppTab = showAppTab;
showAppTab = function(tab, el){
  if(tab === 'publish'){
    setTimeout(() => {
      const chooser = document.getElementById('pub-type-chooser');
      const wizard = document.getElementById('pub-wizard-content');
      if(chooser && wizard && !window._currentPubType){
        chooser.style.display = 'block';
        wizard.style.display = 'none';
        const intro = document.getElementById('pub-type-intro');
        if(intro) intro.style.display = 'none';
        document.querySelectorAll('.pub-type-card').forEach(c => c.classList.remove('ptc-selected'));
      }
    }, 50);
  }
  _origShowAppTab(tab, el);
};

// ══════════════════════════════════════════════════════
// ── ALL NEW VIRALBOOST FEATURES ──
// ══════════════════════════════════════════════════════

// ── 1. PROFILE COMPLETION ──
function getProfileCompletion(u){
  if(!u) return {pct:0, items:[]};
  const checks = [
    {key:'name',    label:'Name',    done: !!(u.name && u.name !== u.email?.split('@')[0])},
    {key:'username',label:'Username',    done: !!(u.username && u.username !== u.email?.split('@')[0])},
    {key:'bio',     label:'Bio',       done: !!(u.bio && u.bio.length > 10)},
    {key:'avatar',  label:'Avatar',    done: !!(u.avatarUrl || (u.avatar && u.avatar !== '🙂'))},
    {key:'niche',   label:'Niche',     done: !!u.niche},
    {key:'goal',    label:'Goal',  done: !!u.goal},
    {key:'social',  label:'Social',    done: !!(u.tiktok || u.instagram || u.twitter || u.website)},
    {key:'title',   label:'Title',     done: !!u.title},
  ];
  const done = checks.filter(c=>c.done).length;
  return { pct: Math.round(done/checks.length*100), items: checks };
}

function renderProfileCompletion(u){
  const {pct, items} = getProfileCompletion(u);
  if(pct === 100) return '';
  const color = pct >= 75 ? 'linear-gradient(90deg,var(--g2),var(--g3))' : pct >= 50 ? 'linear-gradient(90deg,#d97706,#fbbf24)' : 'linear-gradient(90deg,#dc2626,#f87171)';
  return `<div class="profile-completion-bar">
    <div class="pcb-header">
      <div>
        <div class="pcb-title">🎯 Profile completion</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">A complete profile = 3× more visibility</div>
      </div>
      <div class="pcb-pct">${pct}%</div>
    </div>
    <div class="pcb-bar"><div class="pcb-fill" style="width:${pct}%;background:${color}"></div></div>
    <div class="pcb-items">
      ${items.map(i=>`<div class="pcb-item ${i.done?'done':'todo'}">${i.done?'✓':'+'} ${i.label}</div>`).join('')}
    </div>
    ${pct < 100 ? `<button onclick="openEditProfile()" style="margin-top:12px;width:100%;padding:10px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;color:var(--bg);cursor:pointer;">✏️ Complete my profile →</button>` : ''}
  </div>`;
}

// ── 2. PARRAINAGE ──
function getReferralLink(u){
  if(!u) return '';
  const base = window.location.origin + window.location.pathname;
  return base + '?ref=' + (u.username || u.email.split('@')[0]);
}

function renderReferralBox(u){
  const link = getReferralLink(u);
  const refs = u.referrals || 0;
  const refCredits = (u.referralCredits || 0);
  return `<div class="referral-box">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:var(--g3)">🎁 PARRAINAGE</div>
      <span style="font-size:11px;color:var(--g4);font-weight:600">+100 credits per referral</span>
    </div>
    <div style="font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:4px;">Share your link — you and your referral each receive <strong style="color:var(--g3)">100 ViralCredits</strong> upon their signup.</div>
    <div class="referral-link">
      <span id="referral-link-text">${link}</span>
      <button class="referral-copy-btn" onclick="copyReferralLink()">📋 Copy</button>
    </div>
    <div class="referral-stats">
      <div class="referral-stat"><div class="referral-stat-num">${refs}</div><div class="referral-stat-lbl">Feedleuls</div></div>
      <div class="referral-stat"><div class="referral-stat-num">${refCredits}</div><div class="referral-stat-lbl">Credits earned</div></div>
      <div class="referral-stat"><div class="referral-stat-num">${refs * 100}</div><div class="referral-stat-lbl">Value (€)</div></div>
    </div>
  </div>`;
}

function copyReferralLink(){
  const link = getReferralLink(currentUser);
  navigator.clipboard?.writeText(link).then(()=>toast('✅ Link copied!')).catch(()=>{
    const el = document.getElementById('referral-link-text');
    if(el){ const range=document.createRange();range.selectNode(el);window.getSelection().removeAllRanges();window.getSelection().addRange(range);document.execCommand('copy');toast('✅ Link copied!'); }
  });
}

function checkReferral(){
  const params = new URLSearchParams(window.location.search);
  const ref = params.get('ref');
  if(ref && currentUser){
    const refKey = 'vb_ref_credited_' + currentUser.email;
    if(!localStorage.getItem(refKey)){
      // Credit both
      addCredits(100);
      localStorage.setItem(refKey, ref);
      toast('🎁 +100 credits gifted by referral!');
      // Update referrer stats in accounts
      const accounts = _getAccounts();
      const refUser = Object.values(accounts).find(u => u.username === ref || u.email.split('@')[0] === ref);
      if(refUser){
        refUser.referrals = (refUser.referrals||0) + 1;
        refUser.referralCredits = (refUser.referralCredits||0) + 100;
        _saveAccount(refUser);
      }
    }
  }
}

// ── 3. BADGE VERIFIED ──
function isVerified(u){
  if(!u) return false;
  return u.plan === 'pro' || u.plan === 'elite' || u.verified === true;
}

function getVerifiedBadge(u){
  if(!isVerified(u)) return '';
  return ' <span class="badge-verified">VERIFIED</span>';
}

// ── 4. TRENDING TOPICS ──
// ── TRENDING IA — trending curées ──
const AI_TRENDS = [
  {tag:'AI Agents', emoji:'🤖', desc:'Automate with autonomous agents', heat:'🔥🔥🔥'},
  {tag:'Short-form video', emoji:'🎬', desc:'TikTok & Reels still dominate', heat:'🔥🔥🔥'},
  {tag:'Micro SaaS', emoji:'🚀', desc:'Launch solo, monetize fast', heat:'🔥🔥🔥'},
  {tag:'Personal Branding', emoji:'💎', desc:'Sell yourself before your product', heat:'🔥🔥🔥'},
  {tag:'Newsletter payante', emoji:'📧', desc:'The creator email renaissance', heat:'🔥🔥'},
  {tag:'No-code / Vibe coding', emoji:'⚡', desc:'Build without code in 2025', heat:'🔥🔥🔥'},
  {tag:'UGC & Collab', emoji:'🤝', desc:'Paid user-generated content', heat:'🔥🔥'},
  {tag:'Digital Product', emoji:'💰', desc:'Passive revenue: ebooks, templates', heat:'🔥🔥'},
];

function renderTrendingWidget(){
  const container = document.getElementById('trending-widget-container');
  if(!container) return '';
  container.innerHTML = `
    <div class="trending-widget">
      <div class="trending-title" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <span>🔥 Current trends</span>
        <span style="font-size:9px;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);padding:2px 8px;border-radius:4px;font-family:'DM Mono',monospace;letter-spacing:1px;font-weight:700;">⚡ IA</span>
      </div>
      ${AI_TRENDS.map((t,i) => `
        <div class="trending-item" onclick="searchGlobal('${t.tag.replace(/'/g,"\\'")}')">
          <span class="trending-rank">${i+1}</span>
          <span class="trending-tag">${t.emoji} ${t.tag}</span>
          <span class="trending-count" title="${t.desc}">${t.heat}</span>
        </div>`).join('')}
      <div style="font-size:10px;color:var(--muted2);text-align:right;margin-top:10px;font-family:'DM Mono',monospace;letter-spacing:0.5px;">AI Selection · Creators 2025</div>
    </div>`;
  return '';
}

// ── 5. STORIES ──
let storiesData = JSON.parse(localStorage.getItem('vb_stories')||'[]');

function renderStoriesBar(){
  const now = Date.now();
  const active = storiesData.filter(s => now - s.ts < 86400000); // 24h
  const seenKey = 'vb_seen_stories_' + (currentUser?.email||'guest');
  const seen = JSON.parse(localStorage.getItem(seenKey)||'[]');
  
  return `<div class="stories-bar">
    ${currentUser && !currentUser.isDemo ? `
    <div class="story-item" onclick="openAddStory()">
      <div class="story-ring add-story">
        <div class="story-ava">📸</div>
        <div class="story-add-icon">+</div>
      </div>
      <div class="story-label">My story</div>
    </div>` : ''}
    ${active.map((s,i) => `
    <div class="story-item" onclick="viewStory(${i})">
      <div class="story-ring ${seen.includes(s.id)?'seen':''}">
        <div class="story-ava" style="background:${getAvatarColor(s.userId)}">${s.emoji||'🙂'}</div>
      </div>
      <div class="story-label">${s.author}</div>
    </div>`).join('')}
  </div>`;
}

function openAddStory(){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const text = prompt('💬 Your story (text, max 200 chars) — visible 24h:');
  if(!text || !text.trim()) return;
  const story = {
    id: 's'+Date.now(), userId: currentUser.email, author: currentUser.name,
    emoji: currentUser.avatar||'🙂', text: text.trim().slice(0,200),
    ts: Date.now(), plan: currentUser.plan||'free'
  };
  storiesData.unshift(story);
  storiesData = storiesData.filter(s => Date.now()-s.ts < 86400000).slice(0,50);
  localStorage.setItem('vb_stories', JSON.stringify(storiesData));
  // Re-render stories in feed
  const sb = document.getElementById('stories-bar-container');
  if(sb) sb.innerHTML = renderStoriesBar();
  toast('✅ Story published! Visible for 24h 👀');
}

function viewStory(idx){
  const now = Date.now();
  const active = storiesData.filter(s => now - s.ts < 86400000);
  const s = active[idx];
  if(!s) return;
  // Mark as seen
  const seenKey = 'vb_seen_stories_' + (currentUser?.email||'guest');
  const seen = JSON.parse(localStorage.getItem(seenKey)||'[]');
  if(!seen.includes(s.id)){ seen.push(s.id); localStorage.setItem(seenKey, JSON.stringify(seen)); }
  
  let overlay = document.getElementById('story-viewer-overlay');
  if(!overlay){
    overlay = document.createElement('div');
    overlay.id = 'story-viewer-overlay';
    overlay.className = 'story-viewer-overlay';
    document.body.appendChild(overlay);
  }
  overlay.innerHTML = `
    <div class="story-viewer-box">
      <div class="story-viewer-progress">
        ${active.map((_,i)=>`<div class="story-progress-bar"><div class="story-progress-fill" style="${i===idx?'':'width:100%'};${i>idx?'width:0':''};animation:${i===idx?'storyProgress 5s linear forwards':'none'}"></div></div>`).join('')}
      </div>
      <div class="story-viewer-header">
        <div style="display:flex;align-items:center;gap:8px;">
          <div style="width:32px;height:32px;border-radius:50%;background:${getAvatarColor(s.userId)};display:flex;align-items:center;justify-content:center;font-size:16px;">${s.emoji}</div>
          <div style="color:#fff;font-size:13px;font-weight:700;">${s.author}</div>
          <div style="color:rgba(255,255,255,0.5);font-size:11px;">${Math.round((Date.now()-s.ts)/60000)}min</div>
        </div>
        <button class="story-viewer-close" onclick="document.getElementById('story-viewer-overlay').className='story-viewer-overlay hidden'">✕</button>
      </div>
      <div class="story-content" onclick="${idx < active.length-1 ? `viewStory(${idx+1})` : `document.getElementById('story-viewer-overlay').className='story-viewer-overlay hidden'`}">
        <div style="padding:40px 28px;text-align:center;">
          <div style="font-size:48px;margin-bottom:20px;">${s.emoji}</div>
          <div style="font-size:20px;font-weight:700;color:#fff;line-height:1.5;">${s.text}</div>
          <div style="margin-top:20px;font-size:12px;color:rgba(255,255,255,0.5);">${s.author} · plan ${(s.plan||'free').toUpperCase()}</div>
        </div>
      </div>
    </div>`;
  overlay.className = 'story-viewer-overlay';
  // Auto-advance
  setTimeout(()=>{
    if(idx < active.length-1) viewStory(idx+1);
    else overlay.className = 'story-viewer-overlay hidden';
  }, 5000);
}

// ── 6. BOOST PAYANT ──
function openBoostMyPost(postId){
  if(!currentUser||currentUser.isDemo){openDemoSignupModal();return;}
  const credits = currentUser._credits||0;
  const options = [
    {label:'🔥 TOP 3 of Feed — 6h',    cost:50,  hours:6},
    {label:'⚡ TOP 1 of Feed — 12h',   cost:100, hours:12},
    {label:'💎 TOP 1 of Feed — 24h',   cost:180, hours:24},
  ];
  const modal = document.createElement('div');
  modal.id = 'boost-post-modal';
  modal.style.cssText = 'position:fixed;inset:0;background:rgba(4,10,5,0.94);backdrop-filter:blur(16px);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;';
  modal.innerHTML = `
    <div style="background:var(--s1);border:2px solid rgba(255,215,0,0.4);border-radius:20px;padding:28px;max-width:380px;width:100%;position:relative;">
      <button onclick="document.getElementById('boost-post-modal').remove()" style="position:absolute;top:12px;right:12px;background:var(--s2);border:1px solid var(--border);border-radius:50%;width:28px;height:28px;cursor:pointer;color:var(--muted);">✕</button>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;color:var(--gold);margin-bottom:4px;">🚀 BOOSTER MA PUB</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:20px;">Boost your ad to the top of the feed. Use your ViralCredits.</div>
      <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);margin-bottom:12px;">⚡ YOUR BALANCE: <strong>${credits} credits</strong></div>
      ${options.map((o,i)=>`
        <div class="boost-promo-card" onclick="applyBoostToPost('${postId}',${o.cost},${o.hours})" style="${credits<o.cost?'opacity:0.4;cursor:not-allowed':''}">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div class="boost-promo-title">${o.label}</div>
            <div class="boost-promo-price">${o.cost}⚡</div>
          </div>
          <div class="boost-promo-desc">${credits<o.cost?'❌ Insufficient credits':'✅ Available — Click to activate'}</div>
        </div>`).join('')}
      <div style="font-size:11px;color:var(--muted2);text-align:center;margin-top:8px;">💡 Earn credits by posting, voting and referring</div>
    </div>`;
  document.body.appendChild(modal);
}

function applyBoostToPost(postId, cost, hours){
  if(!currentUser) return;
  const credits = currentUser._credits||0;
  if(credits < cost){ toast('❌ Insufficient credits!'); return; }
  addCredits(-cost);
  const post = feedPosts.find(p=>p.id===postId);
  if(post){
    post.boosted = true;
    post.boostEnd = Date.now() + hours*3600000;
    // Move to top
    feedPosts = feedPosts.filter(p=>p.id!==postId);
    feedPosts.unshift(post);
    buildFeed();
  }
  document.getElementById('boost-post-modal')?.remove();
  toast(`🚀 Ad boosted for ${hours}h to top of feed! -${cost}⚡`);
}

// ── 7. AFFILIATION ──
function renderAffiliationBox(u){
  const commissions = u.affiliateEarnings || 0;
  const clicks = u.affiliateClicks || 0;
  const conversions = u.affiliateConversions || 0;
  return `<div style="background:linear-gradient(135deg,rgba(168,85,247,0.08),rgba(139,92,246,0.04));border:1.5px solid rgba(168,85,247,0.25);border-radius:14px;padding:18px 20px;margin-bottom:16px;">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:#a855f7;margin-bottom:4px;">💜 PROGRAMME AFFILIATION</div>
    <div style="font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:12px;">Gagne <strong style="color:#a855f7">20% commission</strong> on each upgrade via your link.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px;">
      <div style="text-align:center;background:rgba(255,255,255,0.02);border:1px solid rgba(168,85,247,0.2);border-radius:8px;padding:10px 6px;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:#a855f7;">${clicks}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;">Clicks</div>
      </div>
      <div style="text-align:center;background:rgba(255,255,255,0.02);border:1px solid rgba(168,85,247,0.2);border-radius:8px;padding:10px 6px;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:#a855f7;">${conversions}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;">Conversions</div>
      </div>
      <div style="text-align:center;background:rgba(255,255,255,0.02);border:1px solid rgba(168,85,247,0.2);border-radius:8px;padding:10px 6px;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:#a855f7;">${commissions}€</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;">Gains</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;background:rgba(4,10,5,0.8);border:1.5px solid rgba(168,85,247,0.25);border-radius:8px;padding:10px 14px;">
      <span style="flex:1;font-family:'DM Mono',monospace;font-size:12px;color:#c4b5fd;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${getReferralLink(u)}?aff=1</span>
      <button onclick="copyAffiliateLink()" style="background:#a855f7;border:none;border-radius:6px;padding:6px 12px;font-size:11px;font-weight:700;color:#fff;cursor:pointer;white-space:nowrap;">📋 Copy</button>
    </div>
  </div>`;
}

function copyAffiliateLink(){
  const link = getReferralLink(currentUser) + '?aff=1';
  navigator.clipboard?.writeText(link).then(()=>toast('✅ Affiliate link copied!')).catch(()=>toast('✅ Copied!'));
}

// ── 8. GLOBAL SEARCH ──
let _searchOverlay = null;

function openSearch(){
  if(!document.getElementById('search-overlay')){
    document.body.insertAdjacentHTML('beforeend', `
      <div id="search-overlay" class="search-overlay hidden">
        <div class="search-input-row">
          <input id="search-big-input" class="search-big-input" placeholder="🔍 Search posts, profiles, groups..." oninput="runSearch(this.value)" />
          <button class="search-close-btn" onclick="closeSearch()">✕</button>
        </div>
        <div class="search-results" id="search-results-container">
          <div style="text-align:center;padding:40px;color:var(--muted);font-size:14px;">Start typing to search...</div>
        </div>
      </div>`);
  }
  const overlay = document.getElementById('search-overlay');
  overlay.classList.remove('hidden');
  setTimeout(()=>document.getElementById('search-big-input')?.focus(), 100);
}

function closeSearch(){
  document.getElementById('search-overlay')?.classList.add('hidden');
}

function searchGlobal(query){
  openSearch();
  setTimeout(()=>{
    const inp = document.getElementById('search-big-input');
    if(inp){ inp.value=query; runSearch(query); }
  }, 150);
}

function runSearch(query){
  const container = document.getElementById('search-results-container');
  if(!container) return;
  if(!query || query.length < 2){
    container.innerHTML = '<div style="text-align:center;padding:40px;color:var(--muted);font-size:14px;">Start typing...</div>';
    return;
  }
  const q = query.toLowerCase();
  
  // Search in posts
  const matchPosts = feedPosts.filter(p => 
    p.text?.toLowerCase().includes(q) || p.author?.toLowerCase().includes(q) || p.projName?.toLowerCase().includes(q)
  ).slice(0,5);
  
  // Search in accounts
  const accounts = _getAccounts ? _getAccounts() : {};
  const matchUsers = Object.values(accounts).filter(u =>
    u.name?.toLowerCase().includes(q) || u.username?.toLowerCase().includes(q) || u.niche?.toLowerCase().includes(q) || u.bio?.toLowerCase().includes(q)
  ).slice(0,5);

  let html = '';
  if(matchUsers.length){
    html += `<div class="search-section-title">👤 Profiles (${matchUsers.length})</div>`;
    html += matchUsers.map(u=>`
      <div class="search-result-item" onclick="closeSearch();viewUserProfile('${u.email}')">
        <div class="search-result-ava" style="background:${getAvatarColor(u.email)}">${u.avatar||u.name?.[0]||'?'}</div>
        <div>
          <div class="search-result-name">${u.name||u.email} ${getVerifiedBadge(u)}</div>
          <div class="search-result-sub">@${u.username||'—'} · ${u.niche||'Creator'}</div>
        </div>
      </div>`).join('');
  }
  if(matchPosts.length){
    html += `<div class="search-section-title">📢 Posts (${matchPosts.length})</div>`;
    html += matchPosts.map(p=>`
      <div class="search-result-item">
        <div class="search-result-ava" style="background:${getAvatarColor(p.userId)}">${p.emoji||p.author?.[0]||'?'}</div>
        <div>
          <div class="search-result-name">${p.author}</div>
          <div class="search-result-sub">${(p.text||'').slice(0,70)}...</div>
        </div>
      </div>`).join('');
  }
  if(!html) html = `<div style="text-align:center;padding:40px;color:var(--muted);">No results for "<strong>${query}</strong>"</div>`;
  container.innerHTML = html;
}

// ── 9. MODE CLAIR ──
function toggleTheme(){
  document.body.classList.toggle('light-mode');
  const isLight = document.body.classList.contains('light-mode');
  localStorage.setItem('vb_theme', isLight?'light':'dark');
  if(currentUser){ currentUser.theme = isLight?'light':'dark'; _saveAccount&&_saveAccount(currentUser); }
}

function applyTheme(){
  const saved = localStorage.getItem('vb_theme') || currentUser?.theme;
  if(saved === 'light') document.body.classList.add('light-mode');
  else document.body.classList.remove('light-mode');
}

// ── 10. SHAREABLE PUBLIC PROFILE ──
function getPublicProfileUrl(u){
  const base = window.location.origin + window.location.pathname;
  return base + '?u=' + encodeURIComponent(u.username || u.email.split('@')[0]);
}

function shareMyProfile(){
  if(!currentUser) return;
  const url = getPublicProfileUrl(currentUser);
  if(navigator.share){
    navigator.share({title:'My ViralBoost profile', text:'Check out my profile on ViralBoost!', url}).catch(()=>{});
  } else {
    navigator.clipboard?.writeText(url).then(()=>toast('✅ Profile link copied!')).catch(()=>toast('✅ Copied!'));
  }
}

function checkPublicProfileParam(){
  const params = new URLSearchParams(window.location.search);
  const username = params.get('u');
  if(username && !currentUser){
    // Show public profile preview
    const accounts = _getAccounts ? _getAccounts() : {};
    const u = Object.values(accounts).find(a => 
      a.username?.toLowerCase() === username.toLowerCase() || 
      a.email.split('@')[0].toLowerCase() === username.toLowerCase()
    );
    if(u) setTimeout(()=>viewUserProfile(u.email), 500);
  }
}

// ── 11. SEARCH IN APP BAR ──
function injectSearchBtn(){
  const appRight = document.querySelector('.app-right');
  if(appRight && !document.getElementById('global-search-btn')){
    const btn = document.createElement('button');
    btn.id = 'global-search-btn';
    btn.style.cssText = 'background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:6px 12px;cursor:pointer;color:var(--muted);font-size:13px;display:flex;align-items:center;gap:5px;transition:all 0.2s;';
    btn.innerHTML = '🔍 <span style="font-size:11px;font-family:DM Mono,monospace;">Search</span>';
    btn.onmouseover = ()=>{ btn.style.borderColor='var(--g3)'; btn.style.color='var(--g3)'; };
    btn.onmouseout = ()=>{ btn.style.borderColor='var(--border2)'; btn.style.color='var(--muted)'; };
    btn.onclick = openSearch;
    appRight.insertBefore(btn, appRight.firstChild);
  }
}

// ── 12. THEME TOGGLE IN PROFILE ──
function renderThemeToggle(){
  const isLight = document.body.classList.contains('light-mode');
  return `<div style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;margin-bottom:10px;">
    <div style="display:flex;align-items:center;gap:8px;">
      <span style="font-size:16px">${isLight?'☀️':'🌙'}</span>
      <div>
        <div style="font-size:13px;font-weight:600;">${isLight?'Light mode':'Dark mode'}</div>
        <div style="font-size:11px;color:var(--muted);">Click to change</div>
      </div>
    </div>
    <div class="theme-toggle" onclick="toggleTheme();renderMyProfile();">
      <div class="theme-toggle-track"><div class="theme-toggle-thumb"></div></div>
    </div>
  </div>`;
}

// ── INIT NEW FEATURES ──
document.addEventListener('DOMContentLoaded', function(){
  applyTheme();
  checkPublicProfileParam();
});

</script>
</body>
</html>
