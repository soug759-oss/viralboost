<!DOCTYPE html>
<html lang="fr">
<script defer src="https://cloud.umami.is/script.js" data-website-id="2fb2c139-5a87-4082-b9f3-0aad697c9317"></script>
  <head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ViralBoost — Publie ta publicité, touche ta cible</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#040a05;--bg2:#060e07;--s1:#0b1a0d;--s2:#0f2312;--s3:#142e17;
  --g1:#15803d;--g2:#16a34a;--g3:#22c55e;--g4:#4ade80;--g5:#86efac;--g6:#bbf7d0;
  --white:#f0fdf4;--muted:#4a7a58;--muted2:#2d5a3a;
  --border:rgba(34,197,94,0.15);--border2:rgba(34,197,94,0.08);--glow:rgba(34,197,94,0.08);
}
*{margin:0;padding:0;box-sizing:border-box;}
button,a,[onclick]{cursor:pointer !important;touch-action:manipulation;}
button{-webkit-appearance:none;}
html{scroll-behavior:smooth;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--white);overflow-x:hidden;}
#cursor{display:none;}
#cursor-ring{display:none;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(34,197,94,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(34,197,94,0.025) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}
.orb{position:fixed;border-radius:50%;filter:blur(120px);pointer-events:none;z-index:0;}
.o1{width:600px;height:600px;background:rgba(21,128,61,0.07);top:-200px;right:-100px;animation:drift 14s ease-in-out infinite alternate;}
.o2{width:400px;height:400px;background:rgba(74,222,128,0.04);bottom:-100px;left:-100px;animation:drift 18s ease-in-out infinite alternate-reverse;}
@keyframes drift{from{transform:translate(0,0)}to{transform:translate(40px,40px)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes bounce{0%,60%,100%{transform:translateY(0);opacity:.3}30%{transform:translateY(-6px);opacity:1}}
@keyframes toastIn{from{opacity:0;transform:translateX(50px)}to{opacity:1;transform:translateX(0)}}

/* GOLD ELITE STYLES */
:root{--gold:#ffd700;--gold2:#ffb300;--gold3:#fff3b0;}
.elite-gold{color:var(--gold) !important;text-shadow:0 0 8px rgba(255,215,0,0.5);}
.btn-action.elite-action{border-color:var(--gold2)!important;color:var(--gold)!important;background:rgba(255,215,0,0.06)!important;box-shadow:0 0 8px rgba(255,215,0,0.15);}
.btn-action.elite-action:hover{box-shadow:0 0 16px rgba(255,215,0,0.3);}
.post-card.elite-post{border-color:rgba(255,215,0,0.25)!important;}
.plan-elite-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:2px;letter-spacing:1px;}

/* HERO AD BOX */
.hero-ad-box{background:rgba(22,163,74,0.06);border:2px solid rgba(22,163,74,0.25);border-radius:16px;padding:28px 32px;max-width:720px;width:100%;margin:0 auto 40px;animation:fadeUp 0.5s 0.1s ease both;}
.hero-ad-box h3{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:var(--g3);margin-bottom:12px;}
.hero-ad-form{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hero-ad-form input,.hero-ad-form select,.hero-ad-form textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.hero-ad-form input:focus,.hero-ad-form select:focus,.hero-ad-form textarea:focus{border-color:var(--g3);}
.hero-ad-form textarea{grid-column:1/-1;min-height:56px;resize:none;}
.hero-ad-form select option{background:var(--s1);}
.btn-hero-ad{grid-column:1/-1;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-hero-ad:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);}

/* ═══════════════════════════════════════════
   WIZARD PAS-À-PAS — ONGLET PUBLIER
═══════════════════════════════════════════ */
/* Stepper header */
.wiz-stepper{display:flex;align-items:center;gap:0;margin-bottom:28px;padding:20px 24px;background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;}
.wiz-step-dot{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;cursor:pointer;}
.wiz-step-circle{width:34px;height:34px;border-radius:50%;border:2px solid var(--border);background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;font-family:'DM Mono',monospace;color:var(--muted);transition:all 0.3s;position:relative;}
.wiz-step-circle.active{border-color:var(--g3);background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);box-shadow:0 0 16px rgba(34,197,94,0.4);}
.wiz-step-circle.done{border-color:var(--g2);background:rgba(22,163,74,0.15);color:var(--g3);}
.wiz-step-circle.done::after{content:'✓';position:absolute;font-size:12px;}
.wiz-step-circle.done span{display:none;}
.wiz-step-lbl{font-size:9px;font-weight:700;font-family:'DM Mono',monospace;letter-spacing:0.5px;color:var(--muted);text-align:center;text-transform:uppercase;transition:color 0.3s;}
.wiz-step-dot.active .wiz-step-lbl{color:var(--g3);}
.wiz-step-dot.done .wiz-step-lbl{color:var(--g4);}
.wiz-connector{flex:1;height:2px;background:var(--border2);margin:0 4px;margin-bottom:18px;transition:background 0.4s;}
.wiz-connector.done{background:linear-gradient(90deg,var(--g2),var(--g3));}

/* Step panels */
.wiz-panel{display:none;animation:fadeUp 0.3s ease;}
.wiz-panel.active{display:block;}

/* Step card groupe */
.wiz-group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 22px;margin-bottom:0;transition:border-color 0.3s;}
.wiz-group-card:focus-within{border-color:rgba(34,197,94,0.3);}
.wiz-group-title{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
.wiz-group-icon{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--g1),var(--g2));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.wiz-group-head{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1.5px;color:var(--white);}
.wiz-group-sub{font-size:12px;color:var(--muted);margin-top:1px;}

/* Nav boutons */
.wiz-nav{display:flex;gap:12px;margin-top:22px;}
.btn-wiz-back{flex:1;padding:13px;background:transparent;border:1.5px solid var(--border);border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-wiz-back:hover{border-color:var(--g3);color:var(--g3);}
.btn-wiz-next{flex:3;padding:13px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 20px rgba(22,163,74,0.25);display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-wiz-next:hover{background:linear-gradient(135deg,var(--g2),var(--g3));box-shadow:0 0 32px rgba(34,197,94,0.45);transform:translateY(-1px);}
.btn-wiz-publish{flex:3;padding:14px;background:linear-gradient(135deg,#15803d,#22c55e);border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;box-shadow:0 0 24px rgba(34,197,94,0.35);display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-wiz-publish:hover{box-shadow:0 0 40px rgba(34,197,94,0.55);transform:translateY(-1px);}

/* Progress bar sous le stepper */
.wiz-progress-bar{height:3px;background:var(--s3);border-radius:2px;overflow:hidden;margin-bottom:22px;}
.wiz-progress-fill{height:100%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:2px;transition:width 0.5s cubic-bezier(0.4,0,0.2,1);}

/* Aperçu pub dans step 5 */
.wiz-preview-card{background:linear-gradient(135deg,var(--s1),var(--s2));border:2px solid rgba(34,197,94,0.3);border-radius:14px;overflow:hidden;margin-bottom:14px;box-shadow:0 8px 32px rgba(0,0,0,0.4);}
.wiz-preview-banner{height:110px;background:linear-gradient(135deg,var(--s2),var(--s3));display:flex;align-items:center;justify-content:center;font-size:52px;position:relative;}
.wiz-preview-banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.wiz-preview-body{padding:16px 18px;}
.wiz-preview-name{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:1.5px;color:var(--white);margin-bottom:3px;}
.wiz-preview-hook{font-size:12px;color:var(--g3);font-weight:700;margin-bottom:8px;}
.wiz-preview-desc{font-size:13px;color:#c4d9cb;line-height:1.7;margin-bottom:10px;}
.wiz-preview-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px;}
.wiz-preview-footer{display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--muted);}
.wiz-preview-label{display:inline-block;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;padding:2px 8px;border-radius:3px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);color:var(--g4);}

/* ═══════════════════════════════════════════
   GUIDE MODAL — 1ère ouverture
═══════════════════════════════════════════ */
.guide-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.3s ease;}
.guide-overlay.hidden{display:none !important;}
.guide-box{background:var(--s1);border:2px solid rgba(34,197,94,0.4);border-radius:16px;max-width:340px;width:100%;padding:24px 22px;position:relative;animation:popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);}
.guide-box-close{position:absolute;top:16px;right:16px;background:var(--s2);border:1px solid var(--border);border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--muted);transition:all 0.2s;}
.guide-box-close:hover{border-color:var(--g3);color:var(--g3);}
.guide-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--g4);font-family:'DM Mono',monospace;letter-spacing:1px;margin-bottom:16px;}
.guide-title{font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:2px;color:var(--white);line-height:1;margin-bottom:6px;}
.guide-subtitle{font-size:13px;color:var(--muted);margin-bottom:22px;line-height:1.7;}
.guide-steps-list{display:flex;flex-direction:column;gap:10px;margin-bottom:24px;}
.guide-step-row{display:flex;align-items:flex-start;gap:14px;background:rgba(22,163,74,0.04);border:1.5px solid var(--border2);border-radius:12px;padding:14px 16px;transition:border-color 0.2s;}
.guide-step-row:hover{border-color:rgba(34,197,94,0.2);}
.guide-step-num{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);font-size:11px;font-weight:800;font-family:'DM Mono',monospace;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.guide-step-content{}
.guide-step-title{font-size:13px;font-weight:800;color:var(--white);margin-bottom:2px;}
.guide-step-desc{font-size:11px;color:var(--muted);line-height:1.6;}
.guide-tip-box{background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:10px;padding:12px 14px;margin-bottom:22px;font-size:12px;color:var(--g5);line-height:1.7;}
.guide-tip-box strong{color:var(--gold);}
.btn-guide-start{width:100%;padding:15px;background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;color:var(--bg);box-shadow:0 0 28px rgba(34,197,94,0.35);transition:all 0.2s;}
.btn-guide-start:hover{background:linear-gradient(135deg,var(--g2),var(--g3));box-shadow:0 0 44px rgba(34,197,94,0.55);transform:translateY(-2px);}

/* PUBLIC FEED PREVIEW */
.public-feed-section{padding:60px 5% 80px;position:relative;z-index:1;}
.public-post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;margin-bottom:10px;transition:border-color 0.2s;}
.public-post-card:hover{border-color:rgba(34,197,94,0.2);}
.public-post-card.elite-pub{border-color:rgba(255,215,0,0.2);}
.public-feed-blur{position:relative;}
.public-feed-blur .feed-lock{position:absolute;bottom:0;left:0;right:0;height:180px;background:linear-gradient(transparent,var(--bg));display:flex;align-items:flex-end;justify-content:center;padding-bottom:20px;}
.btn-unlock-feed{padding:11px 28px;background:var(--g2);border:none;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);box-shadow:0 0 24px rgba(22,163,74,0.35);transition:all 0.2s;}
.btn-unlock-feed:hover{background:var(--g3);}

/* MEDIA UPLOAD */
.media-upload-area{border:2px dashed var(--border);border-radius:10px;padding:14px;margin:10px 0;cursor:pointer;transition:all 0.2s;text-align:center;}
.media-upload-area:hover{border-color:var(--g3);background:var(--glow);}
.media-upload-area input{display:none;}
.media-preview-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
.media-preview-item{position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;border:1.5px solid var(--border);}
.media-preview-item img,.media-preview-item video{width:100%;height:100%;object-fit:cover;}
.media-preview-item .rm-media{position:absolute;top:2px;right:2px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;color:#fff;font-size:9px;display:flex;align-items:center;justify-content:center;}
.file-chip{display:flex;align-items:center;gap:6px;background:var(--s2);border:1px solid var(--border);border-radius:5px;padding:4px 10px;font-size:11px;color:var(--g4);}

/* GROUP CHAT */
.group-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;cursor:pointer;}
.group-card:hover{border-color:rgba(34,197,94,0.25);}
.group-card.elite-group{border-color:rgba(255,215,0,0.2);}
.group-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.group-icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.group-title{font-size:14px;font-weight:700;}
.group-desc{font-size:12px;color:var(--muted);margin-bottom:6px;}
.group-meta{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);display:flex;align-items:center;gap:10px;}

/* GROUP SETTINGS (ELITE) */
.group-settings-section{background:var(--s2);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:18px;margin-bottom:14px;}
.group-settings-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.toggle-row label{font-size:12px;color:var(--g5);}
.toggle{position:relative;width:38px;height:20px;cursor:pointer;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:var(--muted2);border-radius:20px;transition:0.3s;}
.toggle-slider::before{content:'';position:absolute;width:14px;height:14px;left:3px;top:3px;background:#fff;border-radius:50%;transition:0.3s;}
.toggle input:checked+.toggle-slider{background:var(--g2);}
.toggle input:checked+.toggle-slider::before{transform:translateX(18px);}

/* WALLPAPER */
#app.has-wallpaper{background-size:cover;background-position:center;background-attachment:fixed;}
#app.has-wallpaper .app-bar{background:rgba(4,10,5,0.85);}
#app.has-wallpaper .tpanel{background:rgba(4,10,5,0.5);border-radius:12px;}

/* REPORT MODAL */
.report-reason{display:flex;flex-direction:column;gap:8px;margin:12px 0;}
.report-reason label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--g5);cursor:pointer;}
.report-reason input[type=radio]{accent-color:var(--g3);}

/* ADMIN MSG BADGE */
.admin-msg-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:9px;font-weight:700;padding:2px 6px;border-radius:3px;letter-spacing:0.5px;}

/* ── BADGES SYSTÈME ── */
.badges-section{margin-top:24px;}
.badges-section h3{font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:14px;text-transform:uppercase;}
.badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px;}
.badge-item{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;transition:all 0.2s;position:relative;}
.badge-item.unlocked{border-color:rgba(34,197,94,0.35);background:rgba(22,163,74,0.06);}
.badge-item.unlocked:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.badge-item.locked{opacity:0.4;filter:grayscale(1);}
.badge-item.special{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.05);}
.badge-item.special.unlocked{box-shadow:0 0 12px rgba(255,215,0,0.15);}
.badge-emoji{font-size:26px;line-height:1;margin-bottom:6px;}
.badge-name{font-size:9px;font-weight:700;color:var(--g5);font-family:'DM Mono',monospace;letter-spacing:0.5px;line-height:1.3;}
.badge-item.locked .badge-name{color:var(--muted2);}
.badge-lock-icon{position:absolute;top:5px;right:6px;font-size:8px;color:var(--muted2);}
.badge-plan-tag{display:inline-block;font-family:'DM Mono',monospace;font-size:7px;padding:1px 5px;border-radius:2px;margin-top:3px;letter-spacing:0.5px;}
.badge-plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.badge-plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.badge-plan-elite{background:linear-gradient(135deg,rgba(255,215,0,0.25),rgba(255,140,0,0.2));color:#ffd700;}
.badge-tooltip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--s3);border:1px solid var(--border);border-radius:6px;padding:6px 10px;font-size:10px;color:var(--g5);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:10;font-family:'Plus Jakarta Sans',sans-serif;}
.badge-item:hover .badge-tooltip{opacity:1;}
.badge-progress-bar{height:3px;background:var(--s3);border-radius:2px;margin-top:5px;overflow:hidden;}
.badge-progress-fill{height:100%;background:var(--g3);border-radius:2px;transition:width 0.4s;}

/* ── MISSIONS & BOUTIQUE CRÉDITS ── */
.credits-tabs{display:flex;gap:0;margin-bottom:20px;border-bottom:1px solid var(--border2);}
.credits-tab{padding:9px 16px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.credits-tab.active{color:var(--gold);border-bottom-color:var(--gold);}
.credits-tab:hover{color:var(--white);}
.cpanel{display:none;}
.cpanel.active{display:block;animation:fadeUp 0.2s ease;}

/* Barre crédits améliorée */
.credits-bar-v2{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.04));border:1.5px solid rgba(255,215,0,0.25);border-radius:14px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;}
.credits-big{font-family:'Bebas Neue',sans-serif;font-size:42px;color:var(--gold);line-height:1;letter-spacing:1px;}
.credits-sub{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.credits-actions{display:flex;gap:8px;flex-wrap:wrap;}

/* Missions */
.mission-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:14px;transition:all 0.2s;}
.mission-card.done{border-color:rgba(34,197,94,0.3);background:rgba(22,163,74,0.04);opacity:0.7;}
.mission-icon{font-size:26px;flex-shrink:0;width:44px;height:44px;background:var(--s2);border-radius:10px;display:flex;align-items:center;justify-content:center;}
.mission-info{flex:1;}
.mission-title{font-size:13px;font-weight:700;color:var(--white);margin-bottom:2px;}
.mission-desc{font-size:11px;color:var(--muted);margin-bottom:6px;}
.mission-prog-bar{height:4px;background:var(--s3);border-radius:2px;overflow:hidden;margin-bottom:4px;}
.mission-prog-fill{height:100%;background:var(--g3);border-radius:2px;transition:width 0.5s;}
.mission-prog-txt{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);}
.mission-reward{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;}
.mission-reward-val{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);line-height:1;}
.mission-reward-label{font-size:8px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px;}
.btn-claim{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.15));border:1.5px solid rgba(255,215,0,0.4);border-radius:5px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer;color:var(--gold);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-claim:hover{box-shadow:0 0 10px rgba(255,215,0,0.3);}
.btn-claim:disabled{opacity:0.4;cursor:not-allowed;}
.mission-done-tag{font-size:10px;color:var(--g3);font-weight:700;}
.missions-reset{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);text-align:right;margin-bottom:12px;}

/* Boutique */
.shop-section-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin:20px 0 10px;}
.shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-bottom:20px;}
.shop-item{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 12px;text-align:center;transition:all 0.2s;cursor:pointer;position:relative;}
.shop-item:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-2px);}
.shop-item.premium{border-color:rgba(255,215,0,0.25);background:rgba(255,215,0,0.03);}
.shop-item.premium:hover{border-color:rgba(255,215,0,0.5);box-shadow:0 0 16px rgba(255,215,0,0.1);}
.shop-item-emoji{font-size:30px;margin-bottom:8px;}
.shop-item-name{font-size:12px;font-weight:700;color:var(--white);margin-bottom:3px;}
.shop-item-desc{font-size:10px;color:var(--muted);margin-bottom:8px;line-height:1.4;}
.shop-item-price{display:inline-flex;align-items:center;gap:4px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:4px;padding:3px 9px;font-family:'DM Mono',monospace;font-size:11px;font-weight:700;color:var(--gold);}
.shop-item-badge{position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:3px;font-family:'DM Mono',monospace;}

/* Badge rewards in BADGES */
.badge-reward{font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);margin-top:3px;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:200;padding:0 5%;height:66px;display:flex;align-items:center;justify-content:space-between;background:rgba(4,10,5,0.92);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:3px;color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.35);position:relative;z-index:1;}
.logo span{color:var(--white);}
.nav-links{display:flex;gap:28px;}
.nav-links a{font-size:13px;font-weight:500;color:var(--muted);text-decoration:none;letter-spacing:0.5px;transition:color 0.2s;position:relative;z-index:1;}
.nav-links a:hover{color:var(--g3);}
.lang-btn{background:rgba(34,197,94,0.08);border:1.5px solid var(--border);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:700;color:var(--g4);cursor:pointer;transition:all 0.2s;font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.lang-btn:hover{border-color:var(--g3);background:rgba(34,197,94,0.15);}
.nav-right{display:flex;gap:10px;align-items:center;}
.btn-g{padding:9px 22px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;letter-spacing:0.3px;}
.btn-ghost-g{background:transparent;border:1.5px solid var(--border);color:var(--g3);}
.btn-ghost-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.3);}
.btn-solid-g:hover{background:var(--g3);box-shadow:0 0 40px rgba(22,163,74,0.5);transform:translateY(-1px);}

/* HAMBURGER MOBILE */
.hamburger{display:none;flex-direction:column;justify-content:center;gap:5px;width:36px;height:36px;background:transparent;border:1.5px solid var(--border);border-radius:6px;cursor:pointer;padding:7px;flex-shrink:0;transition:border-color 0.2s;}
.hamburger span{display:block;height:2px;background:var(--g3);border-radius:2px;transition:all 0.3s;}
.hamburger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
.hamburger.open span:nth-child(2){opacity:0;transform:scaleX(0);}
.hamburger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}
.hamburger:hover{border-color:var(--g3);}

/* MOBILE DROPDOWN MENU */
.mobile-menu{display:none;position:fixed;top:66px;left:0;right:0;z-index:199;background:rgba(4,10,5,0.97);backdrop-filter:blur(24px);border-bottom:1px solid var(--border2);padding:0;max-height:0;overflow:hidden;transition:max-height 0.35s cubic-bezier(0.4,0,0.2,1),padding 0.35s ease;}
.mobile-menu.open{max-height:400px;padding:16px 5% 20px;}
.mobile-menu a{display:block;padding:13px 0;font-size:15px;font-weight:600;color:var(--muted);text-decoration:none;border-bottom:1px solid var(--border2);transition:color 0.2s;}
.mobile-menu a:last-of-type{border-bottom:none;}
.mobile-menu a:hover,.mobile-menu a:active{color:var(--g3);}
.mobile-menu .mobile-btns{display:flex;gap:10px;margin-top:16px;}
.mobile-menu .mobile-btns button{flex:1;}

/* BOTTOM NAV BAR */
.bottom-nav{
  display:none;
  position:fixed;bottom:0;left:0;right:0;z-index:300;
  background:rgba(4,10,5,0.97);backdrop-filter:blur(24px);
  border-top:1px solid var(--border);
  padding:8px 0 max(8px,env(safe-area-inset-bottom));
  gap:0;
}
.bn-item{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:3px;padding:4px 0;background:none;border:none;cursor:pointer;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:9px;font-weight:600;
  color:var(--muted);transition:color 0.2s;position:relative;
  touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.bn-item:active{opacity:0.7;}
.bn-item.active{color:var(--g3);}
.bn-item .bn-icon{font-size:20px;line-height:1;}
.bn-item .bn-dot{
  position:absolute;top:4px;right:calc(50% - 14px);
  width:6px;height:6px;background:var(--g3);border-radius:50%;
  box-shadow:0 0 5px var(--g3);display:none;
}
.bn-item .bn-dot.show{display:block;}
.bn-item.bn-publish{
  background:var(--g2);border-radius:14px;
  width:44px;max-width:44px;padding:6px 0;margin:0 auto;
  box-shadow:0 0 20px rgba(22,163,74,0.4);
  color:var(--bg) !important;
  flex:0 0 44px;
}
.bn-item.bn-publish .bn-icon{font-size:22px;}
.bn-item.bn-publish:active{transform:scale(0.93);}
.bn-item#bn-credits{position:relative;}
.bn-item#bn-credits .bn-icon{font-size:18px;}
.bn-credits-val{font-family:'Bebas Neue',sans-serif;font-size:12px;color:var(--gold);line-height:1;margin-top:-1px;}

@media(max-width:768px){
  .nav-links{display:none;}
  .nav-right{display:none;}
  .hamburger{display:flex;}
  .mobile-menu{display:block;}
  body.app-active .bottom-nav{display:flex;}
  body.app-active #app{padding-bottom:72px;}
  .app-bar{padding:0 3%;gap:0;}
  .app-logo{font-size:15px;letter-spacing:2px;margin-right:8px;}
}

/* HERO */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:100px 5% 80px;position:relative;z-index:1;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.25);border-radius:4px;padding:7px 16px;font-size:12px;font-weight:600;color:var(--g4);margin-bottom:32px;letter-spacing:1px;text-transform:uppercase;animation:fadeUp 0.6s ease both;}
.pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--g3);box-shadow:0 0 8px var(--g3);animation:blink 1.8s infinite;flex-shrink:0;}
.hero-concept{background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:12px;padding:18px 28px;margin-bottom:36px;max-width:660px;animation:fadeUp 0.6s 0.08s ease both;}
.hero-concept p{font-size:15px;color:var(--g5);line-height:1.8;font-weight:400;}
.hero-concept p strong{color:var(--g3);}
.hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(72px,12vw,148px);letter-spacing:2px;line-height:0.88;margin-bottom:20px;animation:fadeUp 0.6s 0.12s ease both;}
.hero h1 .line1{display:block;color:var(--white);}
.hero h1 .line2{display:block;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.35);}
.hero-sub{font-size:16px;color:var(--muted);max-width:500px;line-height:1.8;margin-bottom:44px;animation:fadeUp 0.6s 0.18s ease both;}
.hero-actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:18px;animation:fadeUp 0.6s 0.24s ease both;}
.btn-hero-big{padding:15px 38px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:800;cursor:pointer;transition:all 0.3s;letter-spacing:0.3px;}
.btn-hero-solid{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 36px rgba(22,163,74,0.35);}
.btn-hero-solid:hover{background:var(--g3);box-shadow:0 0 70px rgba(22,163,74,0.55);transform:translateY(-2px);}
.btn-hero-out{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-hero-out:hover{border-color:var(--g3);background:var(--glow);}
.hero-note{font-size:13px;color:var(--muted2);animation:fadeUp 0.6s 0.3s ease both;}
.hero-note span{color:var(--g4);}
.how-simple{display:flex;gap:0;justify-content:center;max-width:860px;width:100%;animation:fadeUp 0.6s 0.36s ease both;}
.how-step-simple{flex:1;text-align:center;padding:24px 18px;border:1px solid var(--border2);position:relative;}
.how-step-simple+.how-step-simple{border-left:none;}
.how-step-simple::before{content:attr(data-n);position:absolute;top:10px;left:12px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);letter-spacing:1px;}
.step-icon{font-size:26px;margin-bottom:10px;}
.how-step-simple h4{font-size:13px;font-weight:700;color:var(--g3);margin-bottom:5px;}
.how-step-simple p{font-size:12px;color:var(--muted);line-height:1.6;}

/* SECTION HELPERS */
.sec-label{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;display:block;}
h2.section-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(36px,5vw,60px);letter-spacing:2px;color:var(--white);margin-bottom:8px;}
h2.section-title em{color:var(--g3);font-style:normal;}
.section-sub{color:var(--muted);font-size:15px;margin-bottom:48px;max-width:480px;}

/* VITRINE */
.vitrine-section{padding:100px 5%;position:relative;z-index:1;}
.filters-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px;}
.f-btn{padding:7px 18px;border-radius:4px;border:1.5px solid var(--border2);background:transparent;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;}
.f-btn:hover,.f-btn.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.vitrine-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
.v-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer;}
.v-card:hover{border-color:rgba(34,197,94,0.3);transform:translateY(-3px);box-shadow:0 16px 48px rgba(0,0,0,0.4);}
.v-banner{height:110px;display:flex;align-items:center;justify-content:center;font-size:42px;position:relative;}
.v-banner::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,transparent 40%,var(--s1));}
.v-body{padding:16px 18px;}
.v-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.v-name{font-size:15px;font-weight:700;margin-bottom:5px;}
.v-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:8px;}
/* ── MODAL PROJET ── */
.project-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(8px);z-index:9000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.2s ease;}
.project-modal-overlay.hidden{display:none!important;}
.project-modal{background:var(--s1);border:1.5px solid rgba(34,197,94,0.25);border-radius:18px;max-width:480px;width:100%;max-height:85vh;overflow-y:auto;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.pmo-banner{height:130px;display:flex;align-items:center;justify-content:center;font-size:60px;position:relative;flex-shrink:0;}
.pmo-banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
.pmo-close{position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.5);border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:#fff;z-index:2;}
.pmo-body{padding:20px 22px 24px;}
.pmo-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pmo-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1.5px;color:var(--white);margin-bottom:8px;line-height:1.1;}
.pmo-hook{font-size:13px;color:var(--g4);font-weight:700;margin-bottom:10px;}
.pmo-desc{font-size:13px;color:#c4d9cb;line-height:1.75;margin-bottom:14px;}
.pmo-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.pmo-tag{font-family:'DM Mono',monospace;font-size:10px;padding:3px 9px;border-radius:3px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);color:var(--g4);}
.pmo-url{display:flex;align-items:center;gap:8px;padding:11px 14px;background:rgba(22,163,74,0.07);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;text-decoration:none;margin-bottom:14px;transition:all 0.2s;}
.pmo-url:hover{border-color:var(--g3);background:rgba(22,163,74,0.14);}
.pmo-url span{font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.pmo-footer{display:flex;align-items:center;justify-content:space-between;padding-top:14px;border-top:1px solid var(--border2);}
.pmo-author{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted);}
.pmo-ava{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg);}
.pmo-actions{display:flex;gap:8px;}
.pmo-btn{display:flex;align-items:center;gap:5px;background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:6px 14px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.pmo-btn:hover,.pmo-btn.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.pmo-btn-dm{border-color:rgba(34,197,94,0.2);color:var(--g4);}
.pmo-btn-dm:hover{border-color:var(--g3);background:var(--glow);}

.v-url-link{display:flex;align-items:center;gap:6px;padding:7px 10px;margin-bottom:10px;background:rgba(22,163,74,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:8px;text-decoration:none;transition:all 0.2s;font-size:11px;color:var(--g4);}
.v-url-link:hover{border-color:rgba(34,197,94,0.4);background:rgba(22,163,74,0.12);color:var(--g3);}
.v-url-text{font-family:'DM Mono',monospace;font-size:11px;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.v-footer{display:flex;align-items:center;justify-content:space-between;}
.v-author{display:flex;align-items:center;gap:7px;font-size:12px;color:var(--muted);}
.v-ava{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--bg);background:var(--g2);}
.v-actions{display:flex;align-items:center;gap:5px;}
.btn-vote-g{display:flex;align-items:center;gap:4px;background:transparent;border:1.5px solid var(--border2);border-radius:4px;padding:4px 10px;font-size:12px;font-weight:700;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'DM Mono',monospace;}
.btn-vote-g:hover,.btn-vote-g.voted{border-color:var(--g3);color:var(--g3);background:var(--glow);}
.btn-dm-small{background:transparent;border:1.5px solid var(--border2);border-radius:4px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;}
.btn-dm-small:hover{border-color:var(--g3);background:var(--glow);}
.v-badge{position:absolute;top:8px;left:8px;background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;letter-spacing:1px;z-index:2;border-radius:2px;}

/* PLANS */
.plans-section{padding:100px 5%;position:relative;z-index:1;background:linear-gradient(180deg,transparent,var(--bg2),transparent);}
.plans-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:16px;}
.plan-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:28px 20px;position:relative;transition:all 0.3s;}
.plan-card:hover{background:var(--s2);border-color:rgba(34,197,94,0.35);transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,0,0,0.4);}
.plan-card.recommended{background:var(--s2);border:1.5px solid var(--g3);border-top:3px solid var(--g3);}
.plan-badge{position:absolute;top:-1px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:9px;font-weight:700;padding:3px 10px;letter-spacing:1px;white-space:nowrap;}
.plan-name{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:3px;text-transform:uppercase;margin-bottom:14px;}
.plan-card.recommended .plan-name{color:var(--g3);}
.plan-price{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--white);letter-spacing:-1px;line-height:1;}
.plan-card.recommended .plan-price{color:var(--g3);text-shadow:0 0 20px rgba(74,222,128,0.3);}
.plan-period{font-size:12px;color:var(--muted);margin:3px 0 14px;}
.plan-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:16px;min-height:40px;}
.plan-features{list-style:none;margin-bottom:24px;}
.plan-features li{font-size:12px;color:#5a8a68;padding:6px 0;border-bottom:1px solid var(--border2);display:flex;align-items:flex-start;gap:7px;line-height:1.5;}
.plan-features li:last-child{border:none;}
.plan-features li::before{content:'✓';color:var(--g3);font-size:10px;font-weight:700;flex-shrink:0;margin-top:2px;}
.plan-features li.no::before{content:'✗';color:var(--muted2);}
.plan-features li.no{color:var(--muted2);}
.btn-plan-g{width:100%;padding:11px;border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;}
.btn-plan-outline-g{background:transparent;border:1.5px solid var(--border);color:var(--g4);}
.btn-plan-outline-g:hover{border-color:var(--g3);background:var(--glow);}
.btn-plan-solid-g{background:var(--g2);border:none;color:var(--bg);box-shadow:0 0 16px rgba(22,163,74,0.3);}
.btn-plan-solid-g:hover{background:var(--g3);}

/* REVIEWS */
.reviews-section{padding:100px 5%;position:relative;z-index:1;}
.reviews-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.rev-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:22px;transition:all 0.2s;}
.rev-card:hover{border-color:rgba(34,197,94,0.25);}
.rev-stars{color:var(--g3);font-size:12px;margin-bottom:10px;letter-spacing:2px;}
.rev-text{font-size:13px;color:#6a9478;line-height:1.8;margin-bottom:16px;}
.rev-text strong{color:var(--g4);}
.rev-author{display:flex;align-items:center;gap:10px;}
.rev-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.rev-name{font-size:13px;font-weight:700;}
.rev-handle{font-size:11px;color:var(--muted);}
.rev-result{font-size:11px;color:var(--g3);font-weight:600;margin-top:1px;}

/* CTA / FOOTER */
.cta-section{padding:100px 5%;text-align:center;position:relative;z-index:1;border-top:1px solid var(--border2);}
.cta-section h2{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,8vw,96px);letter-spacing:2px;color:var(--g3);text-shadow:0 0 60px rgba(74,222,128,0.3);margin-bottom:14px;}
.cta-section p{color:var(--muted);font-size:15px;margin-bottom:36px;}
footer{background:var(--bg2);border-top:1px solid var(--border2);padding:28px 5%;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:14px;position:relative;z-index:1;}
.footer-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;}
footer p{color:var(--muted);font-size:11px;font-family:'DM Mono',monospace;}

/* MODALS */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(4,10,5,0.92);backdrop-filter:blur(16px);z-index:500;align-items:center;justify-content:center;padding:16px;overflow-y:auto;}
.modal-bg.open{display:flex;animation:fadeIn 0.2s ease;}
.modal{background:var(--s1);border:1.5px solid var(--border);border-radius:16px;padding:36px;width:100%;max-width:480px;position:relative;animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);max-height:90vh;overflow-y:auto;}
.modal.wide{max-width:900px;}
.modal::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:60%;height:2px;background:linear-gradient(90deg,transparent,var(--g3),transparent);border-radius:100px;}
.modal-close{position:absolute;top:12px;right:12px;background:rgba(22,163,74,0.08);border:1.5px solid var(--border);border-radius:50%;width:28px;height:28px;cursor:pointer;color:var(--muted);font-size:12px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.modal-close:hover{border-color:var(--g3);color:var(--g3);}
.modal h2{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:2px;color:var(--g3);margin-bottom:3px;}
.modal-sub{color:var(--muted);font-size:11px;margin-bottom:22px;font-family:'DM Mono',monospace;letter-spacing:1px;}
.fg{margin-bottom:12px;}
label{display:block;font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);margin-bottom:4px;letter-spacing:1.5px;text-transform:uppercase;}
input,select,textarea{width:100%;padding:10px 13px;background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
input:focus,select:focus,textarea:focus{border-color:var(--g3);box-shadow:0 0 10px rgba(34,197,94,0.08);}
select option{background:var(--s1);}
textarea{resize:vertical;min-height:68px;}
.btn-modal-g{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;margin-top:6px;box-shadow:0 0 18px rgba(22,163,74,0.28);}
.btn-modal-g:hover{background:var(--g3);}
.btn-modal-g:disabled{opacity:0.4;cursor:not-allowed;}
.modal-switch{text-align:center;margin-top:12px;font-size:13px;color:var(--muted);}
.modal-switch a{color:var(--g3);cursor:pointer;font-weight:600;}

/* SIGNUP PLANS */
.signup-plans{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:18px;}
.sp-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:10px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative;}
.sp-card:hover,.sp-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.sp-card.selected::after{content:'✓';position:absolute;top:5px;right:7px;color:var(--g3);font-size:10px;font-weight:700;}
.sp-plan{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:3px;}
.sp-price{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--g3);line-height:1;}
.sp-per{font-size:9px;color:var(--muted);}
.sp-feat{font-size:10px;color:#4a7a58;margin-top:5px;line-height:1.5;}

/* PAYMENT */
.pay-sum{background:rgba(22,163,74,0.07);border:1.5px solid rgba(22,163,74,0.18);border-radius:10px;padding:16px;text-align:center;margin-bottom:16px;}
.pay-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.pay-price{font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--g3);}
.pay-period{font-size:11px;color:var(--muted);}
#card-element{background:rgba(4,10,5,0.8);border:1.5px solid var(--border);border-radius:8px;padding:12px;margin-bottom:5px;}
#card-errors{color:#f87171;font-size:11px;min-height:14px;margin-bottom:7px;font-family:'DM Mono',monospace;}

/* APP BAR */
#app{display:none;min-height:100vh;}
.app-bar{background:rgba(4,10,5,0.96);border-bottom:1px solid var(--border2);padding:0 2%;height:60px;display:flex;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(24px);}
.app-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:3px;text-shadow:0 0 12px rgba(74,222,128,0.35);margin-right:24px;white-space:nowrap;flex-shrink:0;}
.app-tabs{display:flex;flex:1;overflow-x:auto;gap:0;scrollbar-width:none;}
.app-tabs::-webkit-scrollbar{display:none;}
.app-tab{padding:0 14px;height:60px;display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;}
.app-tab:hover{color:var(--white);}
.app-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.notif-dot{width:5px;height:5px;background:var(--g3);border-radius:50%;margin-top:-10px;margin-left:-3px;box-shadow:0 0 5px var(--g3);flex-shrink:0;}
.app-right{margin-left:auto;display:flex;align-items:center;gap:7px;flex-shrink:0;padding-left:12px;}
.plan-chip{background:var(--g2);color:var(--bg);font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:1px;}
.user-chip{display:flex;align-items:center;gap:7px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:4px 10px;cursor:pointer;transition:all 0.2s;}
.user-chip:hover{border-color:var(--g3);}
.user-chip-ava{width:24px;height:24px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);}
.user-chip-name{font-size:12px;font-weight:600;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-out-g{background:transparent;border:1.5px solid var(--border2);border-radius:5px;padding:5px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;}
.btn-out-g:hover{border-color:#f87171;color:#f87171;}

/* APP PANELS */
.tpanel{display:none;}
.tpanel.active{display:block;animation:fadeUp 0.22s ease;}

/* PUBLISH BOX */
/* ── COMPOSER TWEET-STYLE ── */
.composer-intro{margin-bottom:20px;padding:0 2px;}
.composer-intro-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--g3);text-transform:uppercase;margin-bottom:6px;opacity:0.7;}
.composer-intro-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--white);line-height:1;margin-bottom:5px;}
.composer-intro-sub{font-size:12px;color:var(--muted);line-height:1.6;}

.publish-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:16px;padding:0;margin-bottom:22px;overflow:hidden;transition:border-color 0.25s,box-shadow 0.25s;}
.publish-box:focus-within{border-color:rgba(34,197,94,0.35);box-shadow:0 4px 40px rgba(34,197,94,0.06);}
.publish-top{display:flex;gap:12px;align-items:flex-start;padding:16px 16px 0;}
.pub-ava{width:36px;height:36px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;margin-top:2px;}
.pub-input-wrap{flex:1;display:flex;flex-direction:column;gap:10px;}
.pub-text{width:100%;background:transparent;border:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;color:var(--white);resize:none;outline:none;min-height:52px;max-height:200px;line-height:1.65;overflow:hidden;}
.pub-text::placeholder{color:var(--muted);}

.pub-type-row{display:flex;gap:5px;flex-wrap:wrap;max-height:0;overflow:hidden;opacity:0;transition:max-height 0.3s ease,opacity 0.25s ease;}
.pub-type-row.visible{max-height:80px;opacity:1;}
.pub-type-pill{display:flex;align-items:center;gap:4px;padding:4px 11px;border-radius:20px;border:1.5px solid var(--border2);background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.18s;white-space:nowrap;}
.pub-type-pill:hover{border-color:var(--g3);color:var(--g3);}
.pub-type-pill.active{border-color:var(--g2);color:var(--bg);background:var(--g2);}

.pub-proj-wrap{padding-bottom:2px;}
.pub-proj-wrap input{width:100%;padding:7px 11px;background:rgba(4,10,5,0.9);border:1.5px solid var(--border2);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;color:var(--white);outline:none;transition:border-color 0.2s;}
.pub-proj-wrap input:focus{border-color:rgba(34,197,94,0.4);}
.pub-proj-wrap input::placeholder{color:var(--muted2);}
.pub-url-trigger{display:inline-flex;align-items:center;gap:5px;background:transparent;border:1.5px solid var(--border2);border-radius:20px;padding:4px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.18s;}
.pub-url-trigger:hover{border-color:var(--g3);color:var(--g3);}
.pub-url-wrap{padding-top:0;}
.pub-url-inner{display:flex;align-items:center;gap:8px;background:rgba(4,10,5,0.85);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;transition:border-color 0.2s;}
.pub-url-inner:focus-within{border-color:rgba(34,197,94,0.4);}
.pub-url-icon{font-size:13px;flex-shrink:0;}
.pub-url-wrap input{flex:1;background:transparent;border:none;outline:none;font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);letter-spacing:0.3px;}
.pub-url-wrap input::placeholder{color:var(--muted2);}
.pub-url-close{background:transparent;border:none;color:var(--muted);font-size:11px;cursor:pointer;padding:0 2px;line-height:1;transition:color 0.15s;}
.pub-url-close:hover{color:#f87171;}

.pub-divider{height:1px;background:var(--border2);margin:14px 0 0;}
.pub-actions{display:flex;justify-content:flex-end;align-items:center;padding:10px 16px;gap:12px;}
.pub-meta{display:none;}
.pub-right{display:flex;align-items:center;gap:12px;}
.pub-char-count{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);transition:color 0.2s,opacity 0.2s;}
.pub-limit{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);letter-spacing:0.4px;}
.btn-publish{background:var(--g2);border:none;border-radius:20px;padding:8px 22px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;letter-spacing:0.2px;}
.btn-publish:hover{background:var(--g3);box-shadow:0 0 20px rgba(34,197,94,0.35);transform:translateY(-1px);}
.btn-publish:disabled{opacity:0.3;cursor:not-allowed;transform:none;box-shadow:none;}

/* FEED */
.feed-tabs{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border2);}
.feed-tab{padding:9px 18px;font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Plus Jakarta Sans',sans-serif;}
.feed-tab.active{color:var(--g3);border-bottom-color:var(--g3);}
.post-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;margin-bottom:12px;transition:border-color 0.2s;}
.post-card:hover{border-color:rgba(34,197,94,0.2);}
.post-url-card{display:flex;align-items:center;gap:8px;margin:10px 0 4px;padding:10px 14px;background:rgba(22,163,74,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:10px;text-decoration:none;transition:all 0.2s;cursor:pointer;}
.post-url-card:hover{border-color:rgba(34,197,94,0.4);background:rgba(22,163,74,0.1);}
.post-url-icon{font-size:14px;flex-shrink:0;}
.post-url-text{font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.post-url-arrow{font-size:14px;color:var(--g3);flex-shrink:0;}
.post-header{display:flex;align-items:center;gap:9px;margin-bottom:12px;}
.post-ava{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;cursor:pointer;}
.post-meta{flex:1;}
.post-author{font-size:14px;font-weight:700;cursor:pointer;transition:color 0.2s;}
.post-author:hover{color:var(--g3);}
.post-info{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-plan-badge{font-family:'DM Mono',monospace;font-size:8px;padding:1px 5px;border-radius:2px;letter-spacing:0.5px;}
.plan-free{background:rgba(107,114,128,0.2);color:#9ca3af;}
.plan-starter{background:rgba(22,163,74,0.15);color:var(--g4);}
.plan-pro{background:rgba(22,163,74,0.25);color:var(--g3);}
.plan-elite{background:rgba(74,222,128,0.2);color:var(--g3);box-shadow:0 0 5px rgba(74,222,128,0.2);}
.post-content{font-size:14px;line-height:1.7;color:#c4d9cb;margin-bottom:12px;}
.post-project{background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:12px;margin-bottom:12px;display:flex;gap:10px;align-items:center;transition:all 0.2s;}
.post-project:hover{border-color:rgba(34,197,94,0.22);}
.post-proj-icon{font-size:26px;width:42px;height:42px;background:var(--s3);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.post-proj-name{font-size:13px;font-weight:700;margin-bottom:2px;}
.post-proj-cat{font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px;text-transform:uppercase;}
.post-proj-desc{font-size:11px;color:var(--muted);margin-top:3px;}
.post-timer{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);background:rgba(22,163,74,0.1);border:1px solid rgba(22,163,74,0.15);border-radius:3px;padding:2px 7px;display:inline-flex;align-items:center;gap:3px;}
.post-actions{display:flex;gap:5px;align-items:center;flex-wrap:wrap;}
.btn-action{background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);transition:all 0.2s;display:flex;align-items:center;gap:4px;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-action:hover{border-color:var(--g3);color:var(--g3);}
.btn-action.active{border-color:var(--g3);color:var(--g3);background:var(--glow);}

/* WORLD CHAT PANEL */
.chat-panel-container{max-width:740px;margin:0 auto;padding:24px 0;}
.chat-box{background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;display:flex;flex-direction:column;height:500px;}
.chat-msgs-area{flex:1;overflow-y:auto;padding:18px;display:flex;flex-direction:column;gap:9px;}
.chat-msgs-area::-webkit-scrollbar{width:3px;}
.chat-msgs-area::-webkit-scrollbar-thumb{background:var(--muted2);border-radius:2px;}
.chat-msg-item{background:var(--s2);border-radius:8px;padding:8px 11px;}
.chat-msg-name{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:2px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.chat-msg-text{font-size:13px;color:#7a9a82;line-height:1.5;}
.chat-input-row{padding:12px 14px;border-top:1px solid var(--border2);display:flex;gap:7px;}
.chat-input-field{flex:1;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--white);outline:none;transition:all 0.2s;}
.chat-input-field:focus{border-color:var(--g3);}
.btn-send{background:var(--g2);border:none;border-radius:7px;width:38px;height:38px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-send:hover{background:var(--g3);}

/* PROFILE */
.profile-banner{height:160px;background:linear-gradient(135deg,var(--s2),var(--s3));border-radius:12px;position:relative;margin-bottom:52px;}
.profile-avatar{position:absolute;bottom:-40px;left:22px;width:80px;height:80px;border-radius:50%;border:3px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:var(--bg);box-shadow:0 0 20px rgba(22,163,74,0.25);line-height:1;overflow:hidden;}
.profile-edit-btn{position:absolute;top:14px;right:14px;background:rgba(4,10,5,0.7);border:1.5px solid var(--border);border-radius:6px;padding:6px 12px;font-size:12px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.profile-edit-btn:hover{border-color:var(--g3);color:var(--g3);}
.profile-info{padding:0 22px;}
.profile-name{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:1px;margin-bottom:2px;}
.profile-handle{font-family:'DM Mono',monospace;font-size:11px;color:var(--g4);margin-bottom:9px;display:flex;align-items:center;gap:8px;}
.profile-bio{font-size:13px;color:var(--muted);line-height:1.7;max-width:600px;margin-bottom:14px;}
.profile-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:14px;}
.profile-tag{background:rgba(22,163,74,0.08);border:1px solid rgba(22,163,74,0.18);border-radius:3px;padding:2px 9px;font-size:10px;color:var(--g4);font-family:'DM Mono',monospace;}
.profile-stats{display:flex;gap:20px;margin-bottom:16px;}
.pstat{text-align:center;}
.pstat-num{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3);}
.pstat-label{font-size:10px;color:var(--muted);}
.profile-links{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
.profile-link{display:flex;align-items:center;gap:5px;background:var(--s1);border:1.5px solid var(--border2);border-radius:5px;padding:5px 10px;font-size:11px;color:var(--muted);text-decoration:none;transition:all 0.2s;cursor:pointer;}
.profile-link:hover{border-color:var(--g3);color:var(--g3);}
.profile-fields{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0;padding:16px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;}
.pfield{display:flex;flex-direction:column;gap:2px;}
.pfield-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);letter-spacing:1.5px;text-transform:uppercase;}
.pfield-value{font-size:12px;color:var(--white);}
.profile-actions{display:flex;gap:7px;margin-bottom:20px;}
.btn-follow{background:var(--g2);border:none;border-radius:6px;padding:8px 20px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-follow:hover{background:var(--g3);}
.btn-follow.following{background:transparent;border:1.5px solid var(--border);color:var(--muted);}
.btn-dm-profile{background:transparent;border:1.5px solid var(--border);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:var(--g4);transition:all 0.2s;}
.btn-dm-profile:hover{border-color:var(--g3);color:var(--g3);}

/* EDIT PROFILE */
.edit-section{background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:20px;margin-bottom:12px;}
.edit-section h3{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.edit-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.edit-avatar-row{display:flex;align-items:flex-start;gap:14px;margin-bottom:14px;}
.edit-avatar-big{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;color:var(--bg);flex-shrink:0;position:relative;cursor:pointer;overflow:hidden;border:2.5px solid rgba(34,197,94,0.3);transition:border-color 0.2s;}
.edit-avatar-big:hover{border-color:var(--g3);}
.edit-avatar-big img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:50%;}
.edit-avatar-big .ava-upload-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;border-radius:50%;font-size:20px;pointer-events:none;}
.edit-avatar-big:hover .ava-upload-overlay{opacity:0;}
.edit-avatar-big.has-photo .ava-upload-overlay{display:none!important;}
#edit-ava-emoji{position:relative;z-index:1;line-height:1;pointer-events:none;}
.emoji-picker{display:flex;gap:5px;flex-wrap:wrap;}
.emoji-opt{width:32px;height:32px;border-radius:8px;border:2px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all 0.2s;background:var(--s2);}
.emoji-opt:hover,.emoji-opt.selected{border-color:var(--g3);background:rgba(22,163,74,0.12);}
.emoji-opt.premium-emoji{position:relative;}
.emoji-opt.premium-emoji::after{content:'⭐';position:absolute;top:-4px;right:-4px;font-size:8px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;width:12px;height:12px;display:flex;align-items:center;justify-content:center;padding:0;}
/* Media upload improved */
.media-upload-bar{display:flex;gap:8px;align-items:center;padding:8px 0;}
.media-btn{display:flex;align-items:center;gap:5px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:7px 12px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.media-btn:hover{border-color:var(--g3);color:var(--g3);}
.media-btn input{display:none;}
.media-btn .media-btn-icon{font-size:16px;}

/* DM */
.dm-thread{display:flex;flex-direction:column;height:380px;}
.dm-msgs{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:7px;padding-bottom:6px;}
.dm-msg{display:flex;flex-direction:column;max-width:75%;}
.dm-msg.mine{align-self:flex-end;align-items:flex-end;}
.dm-msg.theirs{align-self:flex-start;}
.dm-bubble-g{padding:9px 13px;border-radius:12px;font-size:13px;line-height:1.5;}
.dm-msg.mine .dm-bubble-g{background:var(--g2);color:var(--bg);border-bottom-right-radius:3px;}
.dm-msg.theirs .dm-bubble-g{background:var(--s2);border:1px solid var(--border2);border-bottom-left-radius:3px;}
.dm-time{font-size:9px;color:var(--muted);margin-top:2px;font-family:'DM Mono',monospace;}
.dm-input-row{display:flex;gap:7px;margin-top:10px;border-top:1px solid var(--border2);padding-top:10px;}

/* ELITE GOLD ACTIONS */
.elite-action { border-color: #d4af37 !important; color: #f5c842 !important; background: rgba(212,175,55,0.08) !important; }
.elite-action:hover { border-color: #f5c842 !important; box-shadow: 0 0 12px rgba(212,175,55,0.3) !important; }
.elite-action.active { background: rgba(212,175,55,0.15) !important; }
.plan-elite-action { border-color: #d4af37 !important; color: #f5c842 !important; }
.badge-elite-gold { color: #f5c842; text-shadow: 0 0 8px rgba(212,175,55,0.5); }

/* GROUP CARDS */
.group-card { background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;overflow:hidden;transition:all 0.3s;cursor:pointer; }
.group-card:hover { border-color:rgba(34,197,94,0.35);transform:translateY(-2px);box-shadow:0 12px 36px rgba(0,0,0,0.4); }
.group-banner { height:90px;display:flex;align-items:center;justify-content:center;font-size:36px;position:relative;background:linear-gradient(135deg,var(--s2),var(--s3)); }
.group-body { padding:14px 16px; }
.group-name { font-size:15px;font-weight:700;margin-bottom:4px; }
.group-desc { font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:10px; }
.group-footer { display:flex;align-items:center;justify-content:space-between; }
.group-meta { font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2); }

/* MEDIA PREVIEW */
.media-preview-item { display:flex;align-items:center;gap:8px;background:var(--s2);border:1.5px solid var(--border2);border-radius:8px;padding:8px 12px;margin-top:6px;font-size:12px;color:var(--muted); }
.media-preview-item img, .media-preview-item video { max-width:100px;max-height:70px;border-radius:4px;object-fit:cover; }
.media-preview-item .remove-media { cursor:pointer;color:#f87171;margin-left:auto; }

/* POST MEDIA */
.post-media { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px;object-fit:cover; }
.post-media-video { width:100%;border-radius:8px;margin-bottom:10px;max-height:350px; }

/* REPORT BTN */
.btn-report { background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:5px 10px;font-size:11px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif; }
.btn-report:hover { border-color:#f87171;color:#f87171; }

/* CONTACT ADMIN BTN (ELITE in profile) */
.btn-contact-admin { background:linear-gradient(135deg,rgba(212,175,55,0.15),rgba(245,200,66,0.1));border:1.5px solid rgba(212,175,55,0.4);border-radius:6px;padding:8px 16px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;color:#f5c842;transition:all 0.2s; }
.btn-contact-admin:hover { border-color:#f5c842;box-shadow:0 0 12px rgba(212,175,55,0.25); }
.follow-list{display:flex;flex-direction:column;gap:7px;}
.follow-item{display:flex;align-items:center;gap:9px;padding:10px 12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:8px;transition:all 0.2s;}
.follow-item:hover{border-color:rgba(34,197,94,0.2);}
.follow-item-ava{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--bg);flex-shrink:0;}
.follow-item-name{font-size:13px;font-weight:700;flex:1;}
.follow-item-sub{font-size:11px;color:var(--muted);}
.btn-dm-list{background:transparent;border:1.5px solid var(--border2);border-radius:5px;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all 0.2s;flex-shrink:0;}
.btn-dm-list:hover{border-color:var(--g3);}
.btn-follow-list{background:var(--g2);border:none;border-radius:5px;padding:5px 10px;font-size:11px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;flex-shrink:0;}
.btn-follow-list:hover{background:var(--g3);}
.btn-follow-list.following{background:transparent;border:1px solid var(--border);color:var(--muted);}

/* IA BOOST */
.boost-type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:0;}
.boost-type-card{background:var(--bg);border:1.5px solid var(--border2);border-radius:8px;padding:12px 8px;text-align:center;cursor:pointer;transition:all 0.2s;font-size:22px;}
.boost-type-card:hover,.boost-type-card.selected{border-color:var(--g3);background:rgba(22,163,74,0.07);}
.boost-type-card span{display:block;font-size:11px;color:var(--muted);margin-top:4px;font-weight:600;}
.boost-type-card.selected span{color:var(--g3);}

/* UPGRADE */
.upgrade-strip{background:rgba(22,163,74,0.05);border:1.5px solid rgba(22,163,74,0.14);border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:14px;}
.upgrade-strip h4{font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px;}
.upgrade-strip p{font-size:11px;color:var(--muted);}

/* DOTS */
.dots{display:inline-flex;gap:3px;align-items:center;}
.dots span{width:5px;height:5px;border-radius:50%;background:var(--g3);animation:bounce 1.2s ease infinite;}
.dots span:nth-child(2){animation-delay:.2s;}
.dots span:nth-child(3){animation-delay:.4s;}

/* TOAST */
#toast-container{position:fixed;bottom:22px;right:22px;z-index:9999;display:flex;flex-direction:column;gap:7px;pointer-events:none;}
.toast-g{background:var(--s2);border:1.5px solid var(--border);border-radius:10px;padding:11px 16px;font-size:13px;font-weight:600;color:var(--white);display:flex;align-items:center;gap:7px;box-shadow:0 8px 30px rgba(0,0,0,0.5);pointer-events:auto;animation:toastIn 0.4s ease both;min-width:200px;}
.toast-g.success{border-color:rgba(22,163,74,0.4);}

/* ── NOUVELLES FONCTIONNALITÉS ── */

/* ANALYTICS DASHBOARD */
.analytics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px 18px;transition:all 0.2s;}
.stat-card:hover{border-color:rgba(34,197,94,0.25);}
.stat-card-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.stat-card-value{font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3);line-height:1;}
.stat-card-sub{font-size:11px;color:var(--muted);margin-top:3px;}
.stat-card-trend{font-size:11px;font-weight:700;margin-top:5px;}
.stat-card-trend.up{color:#4ade80;}
.stat-card-trend.down{color:#f87171;}
.chart-wrap{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:18px;margin-bottom:16px;}
.chart-title{font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;}
.mini-chart{display:flex;align-items:flex-end;gap:4px;height:60px;}
.mini-bar{flex:1;background:var(--g2);border-radius:3px 3px 0 0;opacity:0.7;transition:opacity 0.2s;cursor:pointer;}
.mini-bar:hover{opacity:1;}
.mini-chart-labels{display:flex;gap:4px;margin-top:5px;}
.mini-chart-labels span{flex:1;font-family:'DM Mono',monospace;font-size:8px;color:var(--muted2);text-align:center;}

/* BOOST TOKENS / CREDITS */
.credits-bar{background:var(--s1);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
.credits-info{display:flex;align-items:center;gap:8px;}
.credits-icon{font-size:20px;}
.credits-count{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--gold);line-height:1;}
.credits-label{font-size:11px;color:var(--muted);}
.btn-buy-credits{background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,179,0,0.1));border:1.5px solid rgba(255,215,0,0.4);border-radius:6px;padding:7px 16px;font-size:12px;font-weight:700;cursor:pointer;color:var(--gold);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;}
.btn-buy-credits:hover{box-shadow:0 0 12px rgba(255,215,0,0.3);}
.boost-options{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;}
.boost-opt{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s;}
.boost-opt:hover,.boost-opt.selected{border-color:var(--gold);background:rgba(255,215,0,0.04);}
.boost-opt-icon{font-size:24px;margin-bottom:5px;}
.boost-opt-name{font-size:12px;font-weight:700;color:var(--g5);margin-bottom:3px;}
.boost-opt-cost{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);}
.boost-opt-desc{font-size:10px;color:var(--muted);margin-top:4px;}

/* A/B TEST IA */
.ab-compare{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.ab-side{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;}
.ab-side-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;margin-bottom:7px;}
.ab-side-label.a{color:#4ade80;}
.ab-side-label.b{color:#60a5fa;}
.ab-result{background:var(--s2);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;padding:14px;margin-top:12px;}
.ab-winner{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);margin-bottom:6px;}
.ab-analysis{font-size:12px;color:#7a9a82;line-height:1.8;white-space:pre-wrap;}

/* LEADERBOARD */
.leaderboard-list{display:flex;flex-direction:column;gap:8px;}
.lb-item{display:flex;align-items:center;gap:12px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:12px 16px;transition:all 0.2s;}
.lb-item:hover{border-color:rgba(34,197,94,0.2);}
.lb-item.top1{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.03);}
.lb-item.top2{border-color:rgba(192,192,192,0.35);}
.lb-item.top3{border-color:rgba(205,127,50,0.35);}
.lb-rank{font-family:'Bebas Neue',sans-serif;font-size:22px;width:30px;text-align:center;flex-shrink:0;}
.lb-item.top1 .lb-rank{color:var(--gold);}
.lb-item.top2 .lb-rank{color:#c0c0c0;}
.lb-item.top3 .lb-rank{color:#cd7f32;}
.lb-info{flex:1;}
.lb-name{font-size:14px;font-weight:700;margin-bottom:2px;}
.lb-sub{font-size:11px;color:var(--muted);}
.lb-score{font-family:'DM Mono',monospace;font-size:13px;color:var(--g3);font-weight:700;text-align:right;}
.lb-medal{font-size:18px;}

/* RÉACTIONS ENRICHIES */
.reactions-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px;padding-top:8px;border-top:1px solid var(--border2);}
.react-btn{display:flex;align-items:center;gap:3px;background:transparent;border:1.5px solid var(--border2);border-radius:20px;padding:4px 10px;font-size:13px;cursor:pointer;color:var(--muted);transition:all 0.2s;font-family:'Plus Jakarta Sans',sans-serif;position:relative;}
.react-btn:hover{transform:scale(1.08);}
.react-btn.active-fire{border-color:#f97316;color:#f97316;background:rgba(249,115,22,0.1);}
.react-btn.active-money{border-color:#4ade80;color:#4ade80;background:rgba(74,222,128,0.1);}
.react-btn.active-bulb{border-color:#facc15;color:#facc15;background:rgba(250,204,21,0.1);}
.react-btn.active-rocket{border-color:#818cf8;color:#818cf8;background:rgba(129,140,248,0.1);}
.react-btn.active-crown{border-color:#ffd700;color:#ffd700;background:rgba(255,215,0,0.1);}
.react-btn.active-gem{border-color:#22d3ee;color:#22d3ee;background:rgba(34,211,238,0.1);}
.react-btn.active-clap{border-color:#fb923c;color:#fb923c;background:rgba(251,146,60,0.1);}
.react-btn.active-eyes{border-color:#a78bfa;color:#a78bfa;background:rgba(167,139,250,0.1);}
.react-btn.active-star{border-color:#ffd700;color:#ffd700;background:rgba(255,215,0,0.1);}
.react-btn.active-zap{border-color:#86efac;color:#86efac;background:rgba(134,239,172,0.1);}
/* Réactions premium lockées */
.react-btn.premium-lock{opacity:0.5;}
.react-btn.premium-lock::after{content:'🔒';position:absolute;top:-5px;right:-5px;font-size:9px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;width:14px;height:14px;display:flex;align-items:center;justify-content:center;padding:0;}
.react-premium-tip{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a0f00,#2a1800);border:1px solid rgba(255,215,0,0.4);border-radius:7px;padding:6px 10px;font-size:10px;color:var(--gold);white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:10;font-family:'DM Mono',monospace;}
.react-btn.premium-lock:hover .react-premium-tip{opacity:1;}
.react-count{font-family:'DM Mono',monospace;font-size:10px;}

/* CALENDRIER ÉDITORIAL */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:14px;}
.cal-day{min-height:64px;background:var(--s1);border:1.5px solid var(--border2);border-radius:7px;padding:6px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);cursor:pointer;transition:all 0.2s;}
.cal-day:hover{border-color:rgba(34,197,94,0.25);}
.cal-day.has-post{border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.04);}
.cal-day.today{border-color:var(--g3);background:rgba(34,197,94,0.08);}
.cal-day .cal-num{font-size:11px;font-weight:700;color:var(--g4);margin-bottom:4px;}
.cal-day .cal-post-dot{width:6px;height:6px;border-radius:50%;background:var(--g3);display:inline-block;margin:1px;}
.cal-header-days{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:6px;}
.cal-header-days span{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);text-align:center;letter-spacing:1px;}
.slot-chip{display:inline-flex;align-items:center;gap:5px;background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:3px 8px;font-size:11px;color:var(--g4);margin:2px;cursor:pointer;font-family:'DM Mono',monospace;transition:all 0.2s;}
.slot-chip:hover,.slot-chip.selected{background:rgba(34,197,94,0.15);border-color:var(--g3);color:var(--g3);}

/* COLLABORATIONS MATCHING */
.collab-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:16px;margin-bottom:10px;transition:all 0.2s;}
.collab-card:hover{border-color:rgba(34,197,94,0.25);}
.collab-match-score{display:inline-flex;align-items:center;gap:5px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2);border-radius:4px;padding:3px 9px;font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);}
.collab-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.collab-ava{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--bg);flex-shrink:0;}
.collab-why{font-size:12px;color:#7a9a82;line-height:1.6;margin-bottom:10px;font-style:italic;}
.btn-collab{background:var(--g2);border:none;border-radius:6px;padding:7px 16px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-collab:hover{background:var(--g3);}

/* MOBILE PREVIEW */
.mobile-preview{background:#111;border-radius:24px;width:200px;min-height:340px;padding:12px;border:3px solid var(--border);flex-shrink:0;position:relative;overflow:hidden;}
.mobile-preview::before{content:'';position:absolute;top:8px;left:50%;transform:translateX(-50%);width:60px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;}
.mobile-screen{background:var(--s1);border-radius:16px;width:100%;height:100%;min-height:310px;padding:10px;overflow:hidden;margin-top:10px;}
.mobile-post-preview{background:var(--bg);border-radius:8px;padding:10px;font-size:10px;}
.mobile-post-preview .mob-title{font-weight:700;font-size:11px;margin-bottom:4px;color:var(--white);}
.mobile-post-preview .mob-text{color:var(--muted);font-size:10px;line-height:1.5;}
.mobile-post-preview .mob-cta{margin-top:8px;background:var(--g2);border-radius:4px;padding:5px 8px;font-size:10px;font-weight:700;color:var(--bg);display:inline-block;}
.preview-tabs{display:flex;gap:5px;margin-bottom:10px;}
.prev-tab{flex:1;background:transparent;border:1px solid var(--border2);border-radius:4px;padding:4px;font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);cursor:pointer;text-align:center;transition:all 0.2s;}
.prev-tab.active,.prev-tab:hover{border-color:var(--g3);color:var(--g3);}

/* ── PUBLICATION STEPS ── */
.pub-step-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:20px;margin-bottom:14px;transition:border-color 0.3s;}
.pub-step-card:focus-within{border-color:rgba(34,197,94,0.3);}
.pub-step-header{display:flex;align-items:flex-start;gap:14px;}
.pub-step-num{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g2));color:var(--bg);font-size:12px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:'DM Mono',monospace;}
.pub-step-title{font-size:14px;font-weight:700;color:var(--white);margin-bottom:2px;}
.pub-step-sub{font-size:11px;color:var(--muted);}
.pub-hint{font-size:10px;font-family:'DM Mono',monospace;padding:3px 9px;border-radius:20px;border:1px solid;transition:all 0.3s;}
.pub-hint.pending{color:var(--muted2);border-color:var(--border2);}
.pub-hint.done{color:var(--g3);border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.06);}
.pub-hint.done::before{content:'✓ ';}
.pub-tip-item{background:var(--s2);border:1px solid var(--border2);border-radius:6px;padding:7px 10px;font-size:11px;color:var(--muted);cursor:pointer;transition:all 0.2s;user-select:none;}
.pub-tip-item:hover{border-color:rgba(34,197,94,0.3);color:var(--g4);background:rgba(34,197,94,0.05);}
.pub-tag-chip{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:20px;padding:3px 10px;font-size:11px;color:var(--g4);font-family:'DM Mono',monospace;}

/* ── ONBOARDING TOOLTIP (mini aide) ── */
.ob-tooltip{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9990;width:min(520px,94vw);background:linear-gradient(135deg,#061a08,#0c2610);border:1.5px solid rgba(34,197,94,0.35);border-radius:16px;box-shadow:0 12px 48px rgba(0,0,0,0.7),0 0 40px rgba(34,197,94,0.08);animation:slideUpTooltip 0.5s cubic-bezier(.34,1.56,.64,1) both;}
.ob-tooltip.hiding{animation:slideDownTooltip 0.35s ease forwards;}
@keyframes slideUpTooltip{from{opacity:0;transform:translateX(-50%) translateY(30px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes slideDownTooltip{from{opacity:1;transform:translateX(-50%) translateY(0)}to{opacity:0;transform:translateX(-50%) translateY(20px)}}
.ob-tooltip-inner{padding:18px 20px 14px;}
.ob-tooltip-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.ob-tooltip-close{background:none;border:none;color:var(--muted2);font-size:18px;cursor:pointer;line-height:1;padding:2px 6px;border-radius:4px;transition:color 0.2s;}
.ob-tooltip-close:hover{color:var(--g3);}
.ob-steps-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;}
.ob-steps-row::-webkit-scrollbar{display:none;}
.ob-step-card{flex-shrink:0;width:130px;background:rgba(22,163,74,0.04);border:1.5px solid var(--border2);border-radius:10px;padding:12px 10px;text-align:center;cursor:pointer;transition:all 0.25s;}
.ob-step-card:hover,.ob-step-card.active{border-color:rgba(34,197,94,0.4);background:rgba(34,197,94,0.08);}
.ob-step-card.active{border-color:var(--g3);}
.ob-step-icon{font-size:24px;margin-bottom:6px;}
.ob-step-label{font-size:10px;font-weight:700;color:var(--g5);margin-bottom:4px;font-family:'DM Mono',monospace;letter-spacing:0.5px;}
.ob-step-desc{font-size:10px;color:var(--muted);line-height:1.5;}
.ob-tooltip-footer{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:10px;border-top:1px solid var(--border2);}
.ob-progress{display:flex;gap:5px;align-items:center;}
.ob-dot{width:6px;height:6px;border-radius:50%;background:var(--muted2);transition:all 0.3s;}
.ob-dot.active{background:var(--g3);box-shadow:0 0 5px var(--g3);width:18px;border-radius:3px;}
.ob-btn-next{padding:7px 18px;background:var(--g2);border:none;border-radius:7px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;color:var(--bg);cursor:pointer;transition:all 0.2s;}
.ob-btn-next:hover{background:var(--g3);}

/* ── ONBOARDING MODAL (ancienne) ── */
.onboarding-overlay{position:fixed;inset:0;background:rgba(4,10,5,0.96);z-index:9998;display:flex;align-items:center;justify-content:center;}
.onboarding-overlay.hidden{display:none;}
.onboarding-box{background:var(--s1);border:1.5px solid var(--border);border-radius:20px;padding:36px;max-width:460px;width:92%;text-align:center;animation:popIn 0.4s ease;}
.onboarding-step{display:none;}
.onboarding-step.active{display:block;animation:fadeUp 0.3s ease;}
.onboarding-progress{display:flex;justify-content:center;gap:6px;margin-bottom:24px;}
.onboarding-progress-dot{width:8px;height:8px;border-radius:50%;background:var(--muted2);transition:all 0.3s;}
.onboarding-progress-dot.active{background:var(--g3);box-shadow:0 0 6px var(--g3);}
.onboarding-icon{font-size:48px;margin-bottom:10px;}
.onboarding-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:var(--g3);margin-bottom:8px;}
.onboarding-sub{font-size:13px;color:var(--muted);margin-bottom:24px;line-height:1.7;}
.btn-onboard-next{width:100%;padding:12px;background:var(--g2);border:none;border-radius:8px;font-size:14px;font-weight:800;cursor:pointer;color:var(--bg);transition:all 0.2s;}
.btn-onboard-next:hover{background:var(--g3);}
.btn-onboard-skip{font-size:11px;color:var(--muted2);cursor:pointer;margin-top:10px;display:block;text-decoration:underline;}

/* AGENCE */
.agency-client-card{background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;transition:all 0.2s;}
.agency-client-card:hover{border-color:rgba(34,197,94,0.2);}
.agency-client-ava{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--g1),var(--g3));display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.agency-client-info{flex:1;}
.agency-client-name{font-size:13px;font-weight:700;margin-bottom:1px;}
.agency-client-plan{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.agency-client-stats{font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);}

@media(max-width:860px){#tab-publier .tpanel>div>div[style*="grid-template-columns:1fr 340px"]{display:block !important;}
#tab-publier [style*="position:sticky"]{position:static !important;margin-top:20px;}}
@media(max-width:600px){.analytics-grid{grid-template-columns:1fr;}.cal-day{min-height:44px;}}

/* RESPONSIVE */
@media(max-width:900px){.vitrine-grid,.reviews-grid,.plans-grid,.signup-plans{grid-template-columns:1fr 1fr;}.profile-fields{grid-template-columns:1fr 1fr;}.edit-grid{grid-template-columns:1fr;}.how-simple{flex-direction:column;}.nav-links{display:none;}}
@media(max-width:600px){.vitrine-grid,.reviews-grid,.plans-grid,.signup-plans,.boost-type-grid{grid-template-columns:1fr;}.profile-fields{grid-template-columns:1fr;}}

#offer-popup{position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);}
#offer-popup.hidden{display:none;}
.offer-box{background:linear-gradient(135deg,#061a08,#0a2a0d);border:2px solid rgba(34,197,94,0.45);border-radius:20px;padding:24px 26px;max-width:360px;width:92%;text-align:center;box-shadow:0 0 60px rgba(34,197,94,0.18);position:relative;}
.offer-crown{font-size:36px;margin-bottom:4px;}
.offer-title{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;background:linear-gradient(135deg,#4ade80,#86efac);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:3px;}
.offer-sub{font-size:11px;color:#4a7a58;margin-bottom:12px;font-family:'DM Mono',monospace;}
.offer-badge{display:inline-block;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;margin-bottom:12px;letter-spacing:1px;}
.offer-desc{font-size:12px;color:#e8fef0;line-height:1.6;margin-bottom:14px;}
.offer-desc strong{color:#4ade80;}
.offer-counter{background:rgba(34,197,94,0.07);border:1px solid rgba(34,197,94,0.2);border-radius:12px;padding:14px;margin-bottom:22px;}
.offer-counter-num{font-family:'Bebas Neue',sans-serif;font-size:34px;color:#4ade80;line-height:1;}
.offer-counter-lbl{font-size:11px;color:#4a7a58;font-family:'DM Mono',monospace;margin-top:3px;}
.offer-cta{width:100%;padding:11px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:800;cursor:pointer;letter-spacing:1px;margin-bottom:8px;transition:.2s;}
.offer-cta:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(34,197,94,0.3);}
.offer-skip{font-size:11px;color:#2d5a38;cursor:pointer;text-decoration:underline;}
.offer-close-btn{position:absolute;top:12px;right:14px;background:none;border:none;color:#2d5a38;font-size:20px;cursor:pointer;line-height:1;padding:4px;transition:.2s;}
.offer-close-btn:hover{color:#4ade80;}
.offer-timer{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:8px 12px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:12px;color:#f87171;}
.offer-timer span{font-weight:800;font-size:14px;}
.offer-full{background:rgba(234,179,8,0.08);border:1px solid rgba(234,179,8,0.25);border-radius:12px;padding:20px;text-align:center;max-width:460px;width:92%;}
</style>
</head>
<body>

<div id="cursor"></div>
<div id="cursor-ring"></div>
<div class="orb o1"></div>
<div class="orb o2"></div>
<div id="toast-container"></div>

<!-- ══════════ LANDING ══════════ -->
<div id="landing">

<nav>
  <div class="logo">VIRAL<span>BOOST</span></div>
  <div class="nav-links">
    <a href="#vitrine" data-i18n="nav_vitrine">Vitrine</a>
    <a href="#plans" data-i18n="nav_plans">Abonnements</a>
    <a href="#reviews" data-i18n="nav_reviews">Avis</a>
  </div>
  <div class="nav-right">
    <button class="lang-btn" id="lang-btn" onclick="toggleLang()" title="Switch language">🇫🇷 FR</button>
    <button class="btn-g btn-ghost-g" onclick="openModal('login-modal')" data-i18n="nav_login">Connexion</button>
    <button class="btn-g btn-solid-g" onclick="openModal('signup-modal')" data-i18n="nav_join">Rejoindre →</button>
  </div>
  <button class="hamburger" id="hamburger-btn" onclick="toggleMobileMenu()" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
</nav>
<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobile-menu">
  <a href="#vitrine" onclick="closeMobileMenu()" data-i18n="mob_vitrine">📊 Vitrine</a>
  <a href="#plans" onclick="closeMobileMenu()" data-i18n="mob_plans">💎 Abonnements</a>
  <a href="#reviews" onclick="closeMobileMenu()" data-i18n="mob_reviews">⭐ Avis</a>
  <div class="mobile-btns">
    <button class="btn-g btn-ghost-g" onclick="closeMobileMenu();openModal('login-modal')">Connexion</button>
    <button class="btn-g btn-solid-g" onclick="closeMobileMenu();openModal('signup-modal')">Rejoindre →</button>
  </div>
</div>

<section class="hero">
  <div class="hero-badge"><span class="pulse-dot"></span>🚀 LA VITRINE DES CRÉATEURS & ENTREPRENEURS</div>
  <div class="hero-concept">
    <p>Sur <strong>ViralBoost</strong>, tu <strong>exposes ton projet</strong> à une communauté qualifiée de créateurs et entrepreneurs. Publie ta pub, trouve des partenaires via le <strong>matching IA</strong>, et propulse ta croissance avec des outils tout-en-un.</p>
  </div>
  <h1><span class="line1" data-i18n="hero_line1">PUBLIE TA</span><span class="line2" data-i18n="hero_line2">PUBLICITÉ.</span></h1>
  <p class="hero-sub">La vitrine qui combine audience qualifiée, matching de collaborateurs et IA. Publie d'abord, crée ton compte après.</p>

  <!-- FORMULAIRE PUB HERO -->
  <div class="hero-ad-box">
    <h3>📢 PUBLIE TA PUBLICITÉ EN 30 SECONDES</h3>
    <div class="hero-ad-form">
      <input type="text" id="hero-ad-name" placeholder="Nom de ton produit / service *" maxlength="60"/>
      <select id="hero-ad-type">
        <option value="">Catégorie...</option>
        <option value="saas">🚀 SaaS / Logiciel</option>
        <option value="ecommerce">🛍️ E-commerce / Boutique</option>
        <option value="app">📱 Application mobile</option>
        <option value="tiktok">🎵 TikTok / Créateur</option>
        <option value="instagram">📸 Instagram / Influenceur</option>
        <option value="service">💼 Service / Freelance</option>
        <option value="site">🌐 Site web</option>
        <option value="autre">📦 Autre</option>
      </select>
      <textarea id="hero-ad-desc" placeholder="Décris ta pub en 2 phrases : ce que tu proposes, à qui, pourquoi c'est top..."></textarea>
      <button class="btn-hero-ad" onclick="heroPublishAd()">📢 Publier ma publicité gratuitement →</button>
    </div>
    <div style="text-align:center;margin-top:8px;font-size:11px;color:var(--muted2)">✓ Gratuit · Visible immédiatement · Pas de carte requise</div>
  </div>

  <div class="hero-actions">
    <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" data-i18n="hero_cta1">Créer mon compte →</button>
    <button class="btn-hero-big btn-hero-out" onclick="openModal('login-modal')" data-i18n="hero_cta2">Se connecter</button>
  </div>
  <p class="hero-note"><span>✓</span> Gratuit pour commencer &nbsp;·&nbsp; <span>✓</span> Sans carte bancaire &nbsp;·&nbsp; <span>✓</span> Accès instantané</p>
  <div class="how-simple" style="margin-top:56px">
    <div class="how-step-simple" data-n="01"><div class="step-icon">📢</div><h4 data-i18n="how1_title">Publie ta pub</h4><p>Décris ton projet ou service. En ligne en 30 secondes, visible par toute la communauté.</p></div>
    <div class="how-step-simple" data-n="02"><div class="step-icon">🤝</div><h4 data-i18n="how2_title">Trouve un partenaire</h4><p>Le <strong>matching IA</strong> te connecte aux créateurs et entrepreneurs qui correspondent à ton projet.</p></div>
    <div class="how-step-simple" data-n="03"><div class="step-icon">🚀</div><h4 data-i18n="how3_title">Propulse avec l'IA</h4><p>L'IA génère ta stratégie complète. Votes, partages, collabs — tu décoles rapidement.</p></div>
  </div>
</section>

<!-- FLUX PUBLIC (visible sans compte) -->
<section class="public-feed-section" id="public-feed">
  <div style="max-width:660px;margin:0 auto">
    <div style="text-align:center;margin-bottom:24px">
      <span class="sec-label" data-i18n="sec_feed">Fil public</span>
      <h2 class="section-title">Pubs <em>en direct</em></h2>
      <p class="section-sub" style="margin:0 auto">Les dernières publicités de la communauté — visibles par tous.</p>
    </div>
    <div id="public-feed-list" class="public-feed-blur">
      <!-- Les posts publics seront injectés ici -->
    </div>
    <div style="text-align:center;margin-top:28px">
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Rejoindre & publier ta pub →</button>
    </div>
  </div>
</section>

<section class="vitrine-section" id="vitrine">
  <div style="max-width:1100px;margin:0 auto 36px">
    <span class="sec-label" data-i18n="sec_vitrine">Vitrine communautaire</span>
    <h2 class="section-title">Projets <em>du moment</em></h2>
    <p class="section-sub">Votez pour vos favoris. Les plus votés gagnent en visibilité.</p>
    <div class="filters-row">
      <button class="f-btn active" onclick="filterLandingVitrine(this,'all')">Tous</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'site')">🌐 Sites</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'app')">📱 Apps</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'tiktok')">🎵 TikTok</button>
      <button class="f-btn" onclick="filterLandingVitrine(this,'saas')">🚀 SaaS</button>
    </div>
  </div>
  <div class="vitrine-grid" id="landing-vitrine-grid" style="max-width:1100px;margin:0 auto"></div>
</section>

<section class="plans-section" id="plans">
  <div style="text-align:center;margin-bottom:48px">
    <span class="sec-label" data-i18n="sec_plans">Abonnements</span>
    <h2 class="section-title">Choisis ton <em>niveau</em></h2>
    <p class="section-sub" style="margin:0 auto">Commence gratuitement. Evolue quand tu veux.</p>
  </div>
  <div class="plans-grid" id="landing-plans">

    <div class="plan-card">
      <div class="plan-name">FREE</div>
      <div class="plan-price">0<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">Gratuit pour toujours</div>
      <div class="plan-desc">Pour découvrir ViralBoost</div>
      <ul class="plan-features">
        <li>5 publications / jour</li>
        <li>3 messages chat / jour</li>
        <li>Vitrine 24h</li>
        <li>Profil public complet</li>
        <li>Accès communauté & collabs</li>
        <li>50 ViralCrédits à l'inscription</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="openModal('signup-modal')">Commencer gratuitement</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">STARTER</div>
      <div class="plan-price">3<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour commencer à propulser</div>
      <ul class="plan-features">
        <li>10 publications / jour</li>
        <li>10 messages chat / jour</li>
        <li>Vitrine 7 jours</li>
        <li>Coach IA 20 req/mois</li>
        <li>DMs illimités</li>
        <li>Badge Starter</li>
        <li>+200 ViralCrédits/mois</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('starter')">Choisir Starter &rarr;</button>
    </div>

    <div class="plan-card recommended">
      <div class="plan-badge">&#11088; POPULAIRE</div>
      <div class="plan-name">PRO</div>
      <div class="plan-price">14,99<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour les créateurs sérieux</div>
      <ul class="plan-features">
        <li>Publications illimitées</li>
        <li>Chat mondial illimité</li>
        <li>Vitrine 30j prioritaire</li>
        <li>IA Boost illimité</li>
        <li>Stats avancées</li>
        <li>Badge Pro vérifié</li>
        <li>Affiliation 30%</li>
        <li>+500 ViralCrédits/mois</li>
      </ul>
      <button class="btn-plan-g btn-plan-solid-g" onclick="startPayment('pro')">Choisir Pro &rarr;</button>
    </div>

    <div class="plan-card">
      <div class="plan-name">ELITE</div>
      <div class="plan-price">39,99<span style="font-size:22px;font-family:inherit">€</span></div>
      <div class="plan-period">/mois sans engagement</div>
      <div class="plan-desc">Pour dominer ton marché</div>
      <ul class="plan-features">
        <li>Tout du plan Pro</li>
        <li>Vitrine permanente + épinglée</li>
        <li>🏆 Badge Elite doré</li>
        <li>Priorité #1 dans le matching IA</li>
        <li>Créateur de groupes de discussion</li>
        <li>Rapport mensuel de performance</li>
        <li>1 appel stratégique/mois</li>
        <li>Messages privés à l'admin</li>
        <li>Likes/partages dorés</li>
        <li>+1500 ViralCrédits/mois</li>
      </ul>
      <button class="btn-plan-g btn-plan-outline-g" onclick="startPayment('elite')">Choisir Elite &rarr;</button>
    </div>

  </div>
</section>

<section style="padding:80px 5%;position:relative;z-index:1;">
  <div style="max-width:660px;margin:0 auto;text-align:center">
    <span class="sec-label">Témoignages</span>
    <h2 class="section-title">Sois parmi les <em>premiers</em></h2>
    <p class="section-sub" style="margin:0 auto 40px">ViralBoost est en lancement. Pas de faux avis ici — rejoins la communauté, publie ton projet, et si tu es satisfait, on sera ravis de mettre ton témoignage en avant.</p>
    <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:16px;padding:32px;max-width:480px;margin:0 auto">
      <div style="font-size:40px;margin-bottom:12px">🚀</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:var(--g3);margin-bottom:10px">PLATEFORME EN LANCEMENT</div>
      <div style="font-size:13px;color:var(--muted);line-height:1.8;margin-bottom:20px">Fais partie des premiers créateurs à bord. Chaque retour compte et façonne directement la plateforme.</div>
      <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" style="width:100%;padding:14px">Rejoindre maintenant →</button>
    </div>
  </div>
</section>

<!-- SECTION COLLABORATION MISE EN AVANT -->
<section style="padding:80px 5%;position:relative;z-index:1;background:rgba(11,26,13,0.6);">
  <div style="max-width:900px;margin:0 auto;text-align:center">
    <span class="sec-label">Matching IA</span>
    <h2 class="section-title">Trouve ton <em>prochain partenaire</em></h2>
    <p class="section-sub" style="margin:0 auto 40px">L'algorithme analyse vos profils, projets et objectifs pour vous connecter automatiquement avec les créateurs les plus compatibles.</p>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:32px">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">🧠</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Score de compatibilité</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">L'IA analyse ton profil et te propose les partenaires les plus compatibles avec un score de matching.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">💬</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Contact direct</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">Envoie un DM directement depuis la fiche de matching. Pas d'intermédiaire, contact immédiat.</div>
      </div>
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:14px;padding:24px 20px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">🎯</div>
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">Ciblé par niche</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.6">Filtre par secteur, objectif et disponibilité pour des collaborations vraiment pertinentes.</div>
      </div>
    </div>
    <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')">🤝 Découvrir mes matches →</button>
  </div>
</section>

<section class="cta-section">
  <h2>REJOINS LA COMMUNAUTÉ</h2>
  <p style="font-size:15px;color:var(--muted);margin:8px 0 28px">Plateforme en lancement — sois parmi les premiers créateurs à bord.</p>
  <button class="btn-hero-big btn-hero-solid" onclick="openModal('signup-modal')" data-i18n="hero_cta1">Créer mon compte →</button>
</section>

<footer>
  <div class="footer-logo">VIRALBOOST</div>
  <p>© 2025 ViralBoost — Le réseau social des créateurs</p>
  <p>Stripe · Claude AI · WebSocket temps réel</p>
</footer>
</div><!-- /landing -->


<!-- ══════════ APP ══════════ -->
<div id="app">
  <div class="app-bar">
    <div class="app-logo">VB</div>
    <div class="app-tabs">
      <button class="app-tab active" onclick="showAppTab('feed',this)">🏠 Fil</button>
      <button class="app-tab" onclick="showAppTab('vitrine',this)">✨ Vitrine</button>
      <button class="app-tab" onclick="showAppTab('publier',this)">➕ Publier</button>
      <button class="app-tab" onclick="showAppTab('chat-global',this)" id="tab-btn-chat">💬 Chat <span class="notif-dot" id="chat-notif" style="display:none"></span></button>
      <button class="app-tab" onclick="showAppTab('groupes',this)" id="tab-btn-groups">👥 Groupes</button>
      <button class="app-tab" onclick="showAppTab('stats',this)">📊 Stats</button>
      <button class="app-tab" onclick="showAppTab('boost-credits',this)">⚡ Boost</button>
      <button class="app-tab" onclick="showAppTab('leaderboard',this)">🏆 Top</button>
      <button class="app-tab" onclick="showAppTab('collab',this)">🤝 Collabs</button>
      <button class="app-tab" onclick="showAppTab('calendrier',this)">📅 Agenda</button>
      <button class="app-tab" onclick="showAppTab('ab-test',this)">🔬 A/B Test</button>
      <button class="app-tab" onclick="showAppTab('profil',this)">👤 Profil</button>
      <button class="app-tab" onclick="showAppTab('abonnes',this)">🔔 Abonnés</button>
      <button class="app-tab" onclick="showAppTab('ia-boost',this)">🤖 IA Boost</button>
    </div>
    <div class="app-right">
      <span class="plan-chip" id="app-plan-chip">FREE</span>
      <button class="btn-out-g" onclick="showAppTab('boost-credits',null);switchCreditsTab('shop',document.getElementById('ctab-shop'))" style="border-color:rgba(255,215,0,0.3);color:var(--gold);display:flex;align-items:center;gap:5px">🛒 <span style="font-family:'DM Mono',monospace;font-size:11px;font-weight:700" id="header-credits">0</span><span style="font-size:9px;opacity:0.7">⚡</span></button>
      <button id="btn-wallpaper" class="btn-out-g" onclick="openWallpaperModal()" style="display:none">🖼️</button>
      <button id="btn-admin-dm" class="btn-out-g" onclick="openAdminDM()" style="display:none;border-color:rgba(255,215,0,0.3);color:var(--gold)">📩 Admin</button>
      <div class="user-chip" onclick="showAppTab('profil',null)">
        <div class="user-chip-ava" id="app-user-ava">?</div>
        <span class="user-chip-name" id="app-user-name">...</span>
      </div>
      <button class="btn-out-g" onclick="logout()">Quitter</button>
    </div>
  </div>

  <div style="max-width:1160px;margin:0 auto;padding:0 16px">

    <!-- FIL -->
    <div class="tpanel active" id="tab-feed">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <!-- INTRO COMPOSER -->
        <div class="composer-intro">
          <div class="composer-intro-label" data-i18n="comp_label">✦ FIL COMMUNAUTAIRE</div>
          <h2 class="composer-intro-title" data-i18n="comp_title">Partage à la communauté</h2>
          <p class="composer-intro-sub" data-i18n="comp_sub">Projets, idées, questions — ta voix compte ici.</p>
        </div>

        <!-- COMPOSER TWEET-STYLE -->
        <div class="publish-box" id="publish-box">
          <div class="publish-top">
            <div class="pub-ava" id="feed-pub-ava">?</div>
            <div class="pub-input-wrap">
              <textarea class="pub-text" id="feed-text" placeholder="Partage ton projet à la communauté…" rows="2" oninput="updateCharCount(this);autoGrowTA(this)"></textarea>
              <!-- Pills type (cachées par défaut, visibles au focus) -->
              <div class="pub-type-row" id="pub-type-row">
                <button class="pub-type-pill active" onclick="selectPubType(this,'')" data-type="">💬 Post</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'site')" data-type="site">🌐 Site</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'app')" data-type="app">📱 App</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'saas')" data-type="saas">🚀 SaaS</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'tiktok')" data-type="tiktok">🎵 TikTok</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'instagram')" data-type="instagram">📸 Insta</button>
                <button class="pub-type-pill" onclick="selectPubType(this,'ecommerce')" data-type="ecommerce">🛍️ Shop</button>
              </div>
              <!-- Champ projet (visible si type sélectionné) -->
              <div class="pub-proj-wrap" id="pub-proj-wrap" style="display:none">
                <input type="text" id="feed-proj-name" placeholder="Nom du projet (optionnel)"/>
              </div>
              <!-- Bouton trigger URL -->
              <button class="pub-url-trigger" id="pub-url-trigger" onclick="toggleUrlField()" type="button" data-i18n="btn_addlink">🔗 Ajouter un lien</button>
              <!-- Champ URL caché par défaut -->
              <div class="pub-url-wrap" id="pub-url-wrap" style="display:none">
                <div class="pub-url-inner">
                  <span class="pub-url-icon">🔗</span>
                  <input type="url" id="feed-url" placeholder="https://ton-site.com" autocomplete="off" spellcheck="false"/>
                  <button class="pub-url-close" onclick="closeUrlField()" type="button">✕</button>
                </div>
              </div>
            </div>
          </div>
          <select id="feed-proj-type" style="display:none"><option value="">Sans projet</option><option value="site">🌐 Site web</option><option value="app">📱 App</option><option value="saas">🚀 SaaS</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option><option value="ecommerce">🛍️ E-commerce</option></select>
          <div id="feed-media-preview" class="media-preview-row" style="display:none;padding:0 16px;margin-left:50px"></div>
          <div class="pub-divider"></div>
          <div class="pub-actions">
            <div class="pub-right">
              <span class="pub-char-count" id="pub-char-count" style="opacity:0">0/500</span>
              <span class="pub-limit" id="feed-limit-info">FREE · 1/h</span>
              <button class="btn-publish" onclick="publishPost()" data-i18n="btn_publish">Publier</button>
            </div>
          </div>
        </div>
        <div class="feed-tabs">
          <button class="feed-tab active" onclick="switchFeed('all',this)" data-i18n="tab_all">Tout</button>
          <button class="feed-tab" onclick="switchFeed('following',this)" data-i18n="tab_following">Abonnements</button>
          <button class="feed-tab" onclick="switchFeed('top',this)" data-i18n="tab_top">Top du jour</button>
        </div>
        <div id="feed-list"></div>
      </div>
    </div>

    <!-- VITRINE APP -->
    <div class="tpanel" id="tab-vitrine">
      <div style="padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div><h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">VITRINE COMMUNAUTAIRE</h2><p style="font-size:12px;color:var(--muted)">Projets partagés par la communauté</p></div>
          <div class="filters-row" style="margin:0">
            <button class="f-btn active" onclick="filterAppVitrine(this,'all')">Tous</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'site')">🌐</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'app')">📱</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'tiktok')">🎵</button>
            <button class="f-btn" onclick="filterAppVitrine(this,'saas')">🚀</button>
          </div>
        </div>
        <div class="vitrine-grid" id="app-vitrine-grid"></div>
      </div>
    </div>

    <!-- PUBLIER -->
    <div class="tpanel" id="tab-publier">
      <div style="max-width:800px;margin:0 auto;padding:28px 0">

        <!-- EN-TÊTE -->
        <div style="margin-bottom:22px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:3px;color:var(--g3);margin-bottom:4px">CRÉER MA PUBLICITÉ</h2>
            <p style="font-size:13px;color:var(--muted)">Suis les 5 étapes pour créer une pub qui convertit et attire des votes.</p>
          </div>
          <button onclick="showPubGuide()" style="background:rgba(34,197,94,0.08);border:1.5px solid rgba(34,197,94,0.2);border-radius:8px;padding:8px 14px;font-size:12px;font-weight:700;color:var(--g4);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:all 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.2)'">💡 Guide création</button>
        </div>

        <!-- STEPPER -->
        <div class="wiz-stepper" id="wiz-stepper">
          <div class="wiz-step-dot active" id="wdot-1" onclick="wizGoTo(1)">
            <div class="wiz-step-circle active" id="wcirc-1"><span>1</span></div>
            <div class="wiz-step-lbl">Identité</div>
          </div>
          <div class="wiz-connector" id="wconn-1"></div>
          <div class="wiz-step-dot" id="wdot-2" onclick="wizGoTo(2)">
            <div class="wiz-step-circle" id="wcirc-2"><span>2</span></div>
            <div class="wiz-step-lbl">Description</div>
          </div>
          <div class="wiz-connector" id="wconn-2"></div>
          <div class="wiz-step-dot" id="wdot-3" onclick="wizGoTo(3)">
            <div class="wiz-step-circle" id="wcirc-3"><span>3</span></div>
            <div class="wiz-step-lbl">Audience</div>
          </div>
          <div class="wiz-connector" id="wconn-3"></div>
          <div class="wiz-step-dot" id="wdot-4" onclick="wizGoTo(4)">
            <div class="wiz-step-circle" id="wcirc-4"><span>4</span></div>
            <div class="wiz-step-lbl">Visuel</div>
          </div>
          <div class="wiz-connector" id="wconn-4"></div>
          <div class="wiz-step-dot" id="wdot-5" onclick="wizGoTo(5)">
            <div class="wiz-step-circle" id="wcirc-5"><span>5</span></div>
            <div class="wiz-step-lbl">Aperçu</div>
          </div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="wiz-progress-bar">
          <div class="wiz-progress-fill" id="wiz-prog-fill" style="width:20%"></div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 1 — IDENTITÉ DU PROJET
        ──────────────────────────────────── -->
        <div class="wiz-panel active" id="wpanel-1">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">🚀</div>
              <div>
                <div class="wiz-group-head">IDENTITÉ DE TA PUB</div>
                <div class="wiz-group-sub">Le nom et le type sont les premières choses que les gens voient</div>
              </div>
            </div>
            <div class="edit-grid" style="gap:14px">
              <div class="fg" style="grid-column:1/-1">
                <label>Nom du projet / produit *</label>
                <input type="text" id="pub-name" placeholder="Ex: ContentPro — L'outil IA pour créateurs" oninput="updatePubCompletion();updateMobilePreview()" maxlength="80" style="font-size:15px;padding:13px 15px;"/>
                <div style="font-size:10px;color:var(--muted2);margin-top:4px;font-family:'DM Mono',monospace"><span id="pub-name-count">0</span>/80 caractères · <em style="color:var(--g4)">Sois précis et accrocheur</em></div>
              </div>
              <div class="fg">
                <label>Catégorie *</label>
                <select id="pub-type" onchange="updatePubTypeEmoji()">
                  <option value="saas">🚀 SaaS / App</option>
                  <option value="site">🌐 Site web</option>
                  <option value="ecommerce">🛍️ E-commerce</option>
                  <option value="service">💼 Service / Freelance</option>
                  <option value="coaching">🎓 Coaching / Formation</option>
                  <option value="tiktok">🎵 TikTok / Réseaux sociaux</option>
                  <option value="instagram">📸 Instagram</option>
                  <option value="newsletter">📧 Newsletter</option>
                  <option value="podcast">🎙️ Podcast</option>
                  <option value="communaute">👥 Communauté / Groupe</option>
                </select>
              </div>
              <div class="fg">
                <label>URL du projet</label>
                <input type="url" id="pub-url" placeholder="https://monprojet.fr" oninput="updatePubCompletion()"/>
              </div>
              <div class="fg" style="grid-column:1/-1">
                <label>Emoji / Icône</label>
                <div style="display:flex;gap:8px;align-items:center">
                  <input type="text" id="pub-emoji" placeholder="🚀" maxlength="2" style="width:58px;text-align:center;font-size:24px;padding:8px;"/>
                  <div style="display:flex;gap:6px;flex-wrap:wrap">
                    <span onclick="document.getElementById('pub-emoji').value=this.textContent;updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">🚀</span>
                    <span onclick="document.getElementById('pub-emoji').value=this.textContent;updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">💡</span>
                    <span onclick="document.getElementById('pub-emoji').value=this.textContent;updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">🎯</span>
                    <span onclick="document.getElementById('pub-emoji').value=this.textContent;updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">🔥</span>
                    <span onclick="document.getElementById('pub-emoji').value=this.textContent;updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">💎</span>
                    <span onclick="document.getElementById('pub-emoji').value=this.textContent;updateMobilePreview()" style="cursor:pointer;font-size:20px;padding:5px;border-radius:6px;background:var(--s2);border:1.5px solid var(--border2);transition:border-color 0.2s" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='var(--border2)'">⚡</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-next" onclick="wizNext(1)">Suivant — Description <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 2 — DESCRIPTION
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-2">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">✍️</div>
              <div>
                <div class="wiz-group-head">DÉCRIS TA PUB</div>
                <div class="wiz-group-sub">Une bonne description donne envie de voter — sois concret et accrocheur</div>
              </div>
            </div>

            <div class="fg" style="margin-bottom:14px">
              <label>Accroche courte <span style="color:var(--muted);font-weight:400">(affiché en premier · 60 car. max)</span></label>
              <input type="text" id="pub-hook" placeholder="Ex: L'outil qui remplace 5 abonnements payants" maxlength="60" oninput="updateMobilePreview()" style="font-size:14px;font-weight:600;"/>
            </div>

            <div class="fg" style="margin-bottom:10px">
              <label>Description principale * <span style="color:var(--muted);font-weight:400">(min. 50 caractères)</span></label>
              <textarea id="pub-desc" rows="5" placeholder="Explique ce que fait ton projet, quel problème il résout, pourquoi les gens devraient s'y intéresser...&#10;&#10;Sois précis : qui es-tu, ce que tu offres, pourquoi maintenant." oninput="updatePubCompletion();updateMobilePreview();updateDescCount()" maxlength="300" style="font-size:13px;resize:vertical;min-height:120px;"></textarea>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-top:5px">
                <span style="font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace"><span id="pub-desc-count">0</span>/300 · <span id="pub-desc-quality"></span></span>
                <span style="font-size:10px;color:var(--muted2)">Minimum 50 caractères recommandés</span>
              </div>
            </div>

            <!-- TIPS CLIQUABLES -->
            <div style="background:rgba(22,163,74,0.04);border:1px solid rgba(22,163,74,0.12);border-radius:10px;padding:14px 16px">
              <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">💡 CLIQUE POUR AJOUTER UN ÉLÉMENT</div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="❌ Problème que ça résout : ">❌ Problème résolu</div>
                <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="✅ Solution proposée : ">✅ Solution proposée</div>
                <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🎯 Pour qui : ">🎯 Pour qui c'est</div>
                <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="📈 Résultat attendu : ">📈 Résultat attendu</div>
                <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="🔥 Pourquoi maintenant : ">🔥 Pourquoi maintenant</div>
                <div class="pub-tip-item" onclick="insertDescTip(this)" data-tip="💰 Prix / offre : ">💰 Prix / offre</div>
              </div>
            </div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(2)">← Retour</button>
            <button class="btn-wiz-next" onclick="wizNext(2)">Suivant — Audience <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 3 — AUDIENCE & TAGS
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-3">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">🎯</div>
              <div>
                <div class="wiz-group-head">AUDIENCE & TAGS</div>
                <div class="wiz-group-sub">Aide la communauté à comprendre à qui s'adresse ton projet</div>
              </div>
            </div>
            <div class="edit-grid" style="gap:14px">
              <div class="fg">
                <label>Audience cible *</label>
                <input type="text" id="pub-target" placeholder="Ex: Créateurs TikTok 18-35 ans, freelances, PME..." oninput="updatePubCompletion()"/>
                <div style="font-size:10px;color:var(--muted2);margin-top:3px">Plus précis = meilleur matching IA</div>
              </div>
              <div class="fg">
                <label>Stade du projet</label>
                <select id="pub-stage">
                  <option value="idee">💭 Idée / Concept</option>
                  <option value="beta">🧪 Beta / En test</option>
                  <option value="lance">🚀 Lancé</option>
                  <option value="croissance">📈 En croissance</option>
                  <option value="monetise">💰 Monétisé</option>
                </select>
              </div>
              <div class="fg" style="grid-column:1/-1">
                <label>Tags <span style="color:var(--muted);font-weight:400">(sépare par virgule · 5 max)</span></label>
                <input type="text" id="pub-tags" placeholder="Ex: IA, TikTok, Gratuit, SaaS, No-code" oninput="updatePubCompletion();renderTagsPreview()"/>
                <div id="pub-tags-preview" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px"></div>
              </div>
              <div class="fg" style="grid-column:1/-1">
                <label>Cherches-tu des collaborateurs ?</label>
                <select id="pub-collab-need">
                  <option value="">Non précisé</option>
                  <option value="dev">👨‍💻 Développeur</option>
                  <option value="marketing">📣 Marketeur</option>
                  <option value="design">🎨 Designer</option>
                  <option value="video">🎬 Créateur vidéo</option>
                  <option value="investisseur">💸 Investisseur</option>
                  <option value="associe">🤝 Associé</option>
                  <option value="client">🧑‍💼 Premiers clients</option>
                </select>
              </div>
            </div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(3)">← Retour</button>
            <button class="btn-wiz-next" onclick="wizNext(3)">Suivant — Visuel <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 4 — VISUEL
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-4">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">🖼️</div>
              <div>
                <div class="wiz-group-head">VISUEL DE TA PUB</div>
                <div class="wiz-group-sub">Les fiches avec image reçoivent <strong style="color:var(--g3)">3× plus de votes</strong> — fortement recommandé</div>
              </div>
            </div>
            <label style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;background:var(--s2);border:2px dashed var(--border);border-radius:14px;padding:40px 20px;font-size:13px;color:var(--muted);transition:all 0.2s;text-align:center" id="pub-media-drop" onmouseover="this.style.borderColor='var(--g3)';this.style.background='rgba(34,197,94,0.04)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='var(--s2)'">
              <span style="font-size:44px">🖼️</span>
              <div>
                <div style="font-weight:700;color:var(--g4);margin-bottom:4px">Clique pour ajouter ton image ou vidéo</div>
                <div style="font-size:11px;color:var(--muted2)">PNG, JPG, GIF, MP4 · Max 10MB</div>
              </div>
              <input type="file" id="pub-media-input" accept="image/*,video/*" style="display:none" onchange="handlePubMediaUpload(this);updatePubCompletion()"/>
            </label>
            <div id="pub-media-preview" style="margin-top:12px"></div>
            <div style="background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.15);border-radius:10px;padding:12px 14px;margin-top:14px;font-size:11px;color:var(--muted);line-height:1.9">
              ✅ Image de couverture → <strong style="color:var(--g4)">3× plus de votes</strong><br>
              ✅ Description 100+ car. → <strong style="color:var(--g4)">+60% de clics</strong><br>
              ✅ Tags précis → <strong style="color:var(--g4)">matching IA activé</strong>
            </div>
          </div>
          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(4)">← Retour</button>
            <button class="btn-wiz-next" onclick="wizNext(4)">Suivant — Aperçu final <span>→</span></button>
          </div>
        </div>

        <!-- ────────────────────────────────────
             ÉTAPE 5 — APERÇU & PUBLICATION
        ──────────────────────────────────── -->
        <div class="wiz-panel" id="wpanel-5">
          <div class="wiz-group-card">
            <div class="wiz-group-title">
              <div class="wiz-group-icon">👁️</div>
              <div>
                <div class="wiz-group-head">APERÇU & PUBLICATION</div>
                <div class="wiz-group-sub">Voici exactement comment ta pub sera vue par la communauté</div>
              </div>
            </div>

            <!-- APERÇU VITRINE -->
            <div id="wiz-vitrine-preview" class="wiz-preview-card">
              <div class="wiz-preview-banner" id="wiz-prev-banner">
                <span id="wiz-prev-emoji">🚀</span>
                <img id="wiz-prev-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover"/>
              </div>
              <div class="wiz-preview-body">
                <div class="wiz-preview-name" id="wiz-prev-name">Nom du projet</div>
                <div class="wiz-preview-hook" id="wiz-prev-hook" style="display:none"></div>
                <div class="wiz-preview-desc" id="wiz-prev-desc">Ta description apparaîtra ici...</div>
                <div class="wiz-preview-tags" id="wiz-prev-tags"></div>
                <div class="wiz-preview-footer">
                  <div style="display:flex;gap:10px">
                    <span>❤️ 0</span>
                    <span>💬 0</span>
                    <span id="wiz-prev-collab" style="display:none;font-size:10px;background:rgba(22,163,74,0.15);border:1px solid rgba(22,163,74,0.3);border-radius:4px;padding:1px 6px;color:var(--g4)"></span>
                  </div>
                  <div id="wiz-prev-author" style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2)"></div>
                </div>
              </div>
            </div>

            <!-- CHECKLIST RÉCAP -->
            <div id="wiz-checklist" style="background:var(--s2);border:1.5px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:4px">
              <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">FORCE DE TA FICHE</div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2)">Complétion</span>
                <span style="font-family:'DM Mono',monospace;font-size:14px;color:var(--gold);font-weight:700" id="wiz-completion-pct">0%</span>
              </div>
              <div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden;margin-bottom:12px">
                <div id="wiz-completion-bar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--g2),var(--g3));border-radius:3px;transition:width 0.4s"></div>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap" id="wiz-hints"></div>
            </div>

            <!-- DURÉE VITRINE -->
            <div style="background:rgba(22,163,74,0.04);border:1px solid rgba(22,163,74,0.1);border-radius:8px;padding:10px 14px;font-size:11px;color:var(--muted);margin-top:10px">
              ⏱ Durée vitrine : <strong style="color:var(--g3)">FREE = 24h</strong> · Starter = 7j · Pro = 30j · Elite = Permanent
              <span id="pub-plan-label" style="float:right;color:var(--g4);font-weight:600"></span>
            </div>
          </div>

          <div class="wiz-nav">
            <button class="btn-wiz-back" onclick="wizPrev(5)">← Modifier</button>
            <button class="btn-wiz-publish" onclick="publishProject()">🚀 Publier sur la vitrine !</button>
          </div>

          <div style="display:none" id="pub-strategy" style="margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:10px;padding:16px;font-size:13px;line-height:1.8;color:#7a9a82;white-space:pre-wrap"></div>
        </div>

      </div>
    </div>

    <!-- CHAT MONDIAL -->
    <div class="tpanel" id="tab-chat-global">
      <div class="chat-panel-container">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">CHAT MONDIAL</h2>
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);display:flex;align-items:center;gap:6px"><span style="width:6px;height:6px;border-radius:50%;background:var(--g3);box-shadow:0 0 5px var(--g3);display:inline-block"></span><span id="world-online-count">0 en ligne</span></div>
          </div>
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);background:var(--s1);border:1px solid var(--border2);border-radius:6px;padding:7px 12px">Messages restants : <span id="chat-msgs-left" style="color:var(--g3);font-weight:700">3</span></div>
        </div>
        <div class="chat-box">
          <div class="chat-msgs-area" id="world-chat-msgs"></div>
          <div class="chat-input-row">
            <input type="text" id="world-chat-in" class="chat-input-field" placeholder="Écris ton message à la communauté..." onkeydown="if(event.key==='Enter')sendWorldChat()"/>
            <button class="btn-send" onclick="sendWorldChat()">→</button>
          </div>
        </div>
        <div id="world-chat-upgrade" style="display:none" class="upgrade-strip">
          <div><h4>Messages du jour épuisés</h4><p>Starter (3€/mois) = 10 messages/jour</p></div>
          <button class="btn-g btn-solid-g" onclick="startPayment('starter')">Upgrade →</button>
        </div>
      </div>
    </div>

    <!-- PROFIL -->
    <div class="tpanel" id="tab-profil">
      <div style="max-width:760px;margin:0 auto;padding:22px 0" id="my-profile-view"></div>
    </div>

    <!-- ABONNÉS -->
    <div class="tpanel" id="tab-abonnes">
      <div style="max-width:640px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">ABONNÉS & ABONNEMENTS</h2>
        <div class="feed-tabs" style="margin-bottom:20px">
          <button class="feed-tab active" onclick="switchFollowTab('followers',this)">Abonnés (<span id="followers-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('following',this)">Abonnements (<span id="following-count">0</span>)</button>
          <button class="feed-tab" onclick="switchFollowTab('discover',this)">Découvrir</button>
        </div>
        <div id="follow-list-container" class="follow-list"></div>
      </div>
    </div>

    <!-- GROUPES -->
    <div class="tpanel" id="tab-groupes">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Rejoins ou crée des groupes thématiques</p>
          </div>
          <button class="btn-publish" onclick="openCreateGroup()" id="btn-create-group" style="display:none">+ Créer un groupe</button>
        </div>
        <div id="groups-list"></div>
      </div>
    </div>

    <!-- IA BOOST -->
    <div class="tpanel" id="tab-ia-boost">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">IA BOOST</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Stratégie de promotion complète générée en 10 secondes</p>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Type de stratégie</h3>
          <div class="boost-type-grid">
            <div class="boost-type-card selected" onclick="selectBoostType(this,'social')">📱<span>TikTok/Instagram</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'seo')">🔍<span>SEO Google</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'ads')">🎨<span>Publicités</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'email')">📧<span>Email marketing</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'strategy')">📊<span>Stratégie 90j</span></div>
            <div class="boost-type-card" onclick="selectBoostType(this,'coach')">🤖<span>Coach IA</span></div>
          </div>
        </div>
        <div class="edit-section" style="margin-bottom:12px">
          <h3>Ton projet</h3>
          <div class="edit-grid">
            <div class="fg"><label>Nom</label><input type="text" id="boost-name" placeholder="Mon super projet"/></div>
            <div class="fg"><label>Type</label><select id="boost-proj-type"><option>Site web</option><option>Application</option><option>SaaS</option><option>TikTok</option><option>Instagram</option></select></div>
            <div class="fg"><label>Cible</label><input type="text" id="boost-target" placeholder="Créateurs 18-30 ans"/></div>
            <div class="fg"><label>Objectif</label><input type="text" id="boost-goal" placeholder="1000 abonnés en 30j"/></div>
          </div>
          <div class="fg"><label>Description</label><textarea id="boost-desc" rows="2" placeholder="Décris ton projet..."></textarea></div>
        </div>
        <button class="btn-publish" style="width:100%;padding:13px;font-size:14px" id="btn-ia-boost" onclick="runIABoost()">⚡ Générer ma stratégie</button>
        <div id="boost-output-box" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border);border-radius:12px;padding:18px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:1px">STRATÉGIE GÉNÉRÉE</span>
            <button onclick="navigator.clipboard.writeText(document.getElementById('boost-output-text').textContent).then(()=>toast('📋 Copié !'))" style="background:transparent;border:1px solid var(--border);border-radius:4px;padding:3px 10px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Copier</button>
          </div>
          <div id="boost-output-text" style="font-size:13px;line-height:1.9;color:#7a9a82;white-space:pre-wrap"></div>
        </div>
      </div>
    </div>

    <!-- GROUPES DISCUSSION -->
    <div class="tpanel" id="tab-groupes">
      <div style="max-width:900px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:2px">GROUPES DE DISCUSSION</h2>
            <p style="font-size:12px;color:var(--muted)">Rejoins ou crée des groupes thématiques (créer = plan ELITE)</p>
          </div>
          <button class="btn-publish" id="btn-create-group" onclick="openCreateGroup()" style="display:none">🏛️ Créer un groupe</button>
        </div>
        <div id="groups-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px"></div>
      </div>
    </div>

    <!-- ══ STATS & ANALYTICS ══ -->
    <div class="tpanel" id="tab-stats">
      <div style="max-width:960px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">TABLEAU DE BORD</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:22px">Performance de tes publications sur 30 jours</p>
        <div class="analytics-grid" id="stats-kpi-grid">
          <div class="stat-card"><div class="stat-card-label">Vues totales</div><div class="stat-card-value" id="stat-views">0</div><div class="stat-card-trend up" id="stat-views-trend">↑ +0%</div></div>
          <div class="stat-card"><div class="stat-card-label">Clics</div><div class="stat-card-value" id="stat-clicks">0</div><div class="stat-card-trend up" id="stat-clicks-trend">↑ +0%</div></div>
          <div class="stat-card"><div class="stat-card-label">Publications</div><div class="stat-card-value" id="stat-posts">0</div><div class="stat-card-sub">ce mois</div></div>
          <div class="stat-card"><div class="stat-card-label">Abonnés</div><div class="stat-card-value" id="stat-followers">0</div><div class="stat-card-trend up" id="stat-followers-trend">↑ +0</div></div>
        </div>
        <div class="chart-wrap">
          <div class="chart-title">VUES PAR JOUR — 7 DERNIERS JOURS</div>
          <div class="mini-chart" id="views-chart"></div>
          <div class="mini-chart-labels" id="views-chart-labels"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
          <div class="chart-wrap">
            <div class="chart-title">MEILLEURES PUBS</div>
            <div id="top-posts-list" style="font-size:12px;color:var(--muted)">Aucune donnée</div>
          </div>
          <div class="chart-wrap">
            <div class="chart-title">RÉPARTITION PAR CATÉGORIE</div>
            <div id="cat-chart" style="font-size:12px;color:var(--muted)">Aucune donnée</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ BOOST CRÉDITS ══ -->
    <div class="tpanel" id="tab-boost-credits">
      <div style="max-width:700px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--gold);margin-bottom:3px">⚡ VIRAL CREDITS</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:16px">Gagne des crédits via les missions et badges — dépense-les pour propulser ton contenu</p>

        <!-- BARRE CRÉDITS -->
        <div class="credits-bar-v2">
          <div>
            <div class="credits-big" id="user-credits">0</div>
            <div class="credits-sub">⚡ VIRALCREDITS DISPONIBLES</div>
          </div>
          <div class="credits-actions">
            <button class="btn-buy-credits" onclick="switchCreditsTab('missions',this)">🎯 Missions</button>
            <button class="btn-buy-credits" onclick="switchCreditsTab('shop',this)" style="background:rgba(22,163,74,0.1);border-color:rgba(22,163,74,0.4);color:var(--g3)">🛒 Boutique</button>
            <button class="btn-buy-credits" onclick="switchCreditsTab('packs',this)">💳 Acheter</button>
          </div>
        </div>

        <!-- TABS -->
        <div class="credits-tabs">
          <button class="credits-tab active" id="ctab-missions" onclick="switchCreditsTab('missions',this)">🎯 Missions</button>
          <button class="credits-tab" id="ctab-shop" onclick="switchCreditsTab('shop',this)">🛒 Boutique</button>
          <button class="credits-tab" id="ctab-plans" onclick="switchCreditsTab('plans',this)">🎁 Plans</button>
          <button class="credits-tab" id="ctab-boost" onclick="switchCreditsTab('boost',this)">🚀 Booster</button>
          <button class="credits-tab" id="ctab-packs" onclick="switchCreditsTab('packs',this)">💳 Acheter</button>
        </div>

        <!-- MISSIONS -->
        <div class="cpanel active" id="cpanel-missions">
          <div class="missions-reset" id="missions-reset-timer">Réinitialisation dans <span id="missions-countdown">--:--:--</span></div>
          <div id="missions-list"></div>
          <div style="margin-top:20px;background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 16px;">
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);letter-spacing:2px;margin-bottom:10px">🏅 BADGES → CRÉDITS</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.8">
              Chaque badge débloqué offre des crédits automatiquement.<br>
              <span style="color:var(--g4)">📝 Premiers badges</span> → <b style="color:var(--gold)">+5 à +15⚡</b> &nbsp;|&nbsp;
              <span style="color:var(--g4)">🟢 Starter/Pro</span> → <b style="color:var(--gold)">+20 à +50⚡</b> &nbsp;|&nbsp;
              <span style="color:var(--gold)">👑 Badges spéciaux</span> → <b style="color:var(--gold)">+100 à +200⚡</b>
            </div>
          </div>
        </div>

        <!-- BOUTIQUE -->
        <div class="cpanel" id="cpanel-shop">
          <!-- ── ACHETER UN PLAN AVEC DES CRÉDITS ── -->
          <div style="background:linear-gradient(135deg,rgba(22,163,74,0.08),rgba(74,222,128,0.04));border:2px solid rgba(22,163,74,0.3);border-radius:14px;padding:18px 20px;margin-bottom:20px">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
              <span style="font-size:28px">🎁</span>
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:2px;color:var(--g3)">PAYER SON ABONNEMENT EN CRÉDITS</div>
                <div style="font-size:11px;color:var(--muted)">Accumule des crédits et upgrade sans sortir ta carte bancaire</div>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
              <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s" onclick="buyPlanWithCredits('starter')" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.08)'">
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:1px">STARTER</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">800<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 3€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:var(--g2);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Acheter</button>
              </div>
              <div style="background:var(--s1);border:2px solid rgba(22,163,74,0.3);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onclick="buyPlanWithCredits('pro')" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(22,163,74,0.3)'">
                <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-size:8px;font-weight:800;padding:2px 8px;border-radius:3px;letter-spacing:1px;white-space:nowrap">⭐ POPULAIRE</div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g3);letter-spacing:1px">PRO</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">3500<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 14,99€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:var(--g2);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Acheter</button>
              </div>
              <div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.25);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s" onclick="buyPlanWithCredits('elite')" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
                <div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--gold);letter-spacing:1px">ELITE</div>
                <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--gold);font-weight:700;margin:6px 0">9000<span style="font-size:12px">⚡</span></div>
                <div style="font-size:10px;color:var(--muted)">= 39,99€ · 1 mois</div>
                <button style="margin-top:10px;width:100%;padding:7px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;color:#1a0a00">Acheter</button>
              </div>
            </div>
            <div style="text-align:center;margin-top:10px;font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace">✓ Pas de carte bancaire · ✓ Activation immédiate · ✓ 1 mois offert</div>
          </div>
          <div class="shop-section-title">🚀 BOOST DE PUBLICATION</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('top-feed',10)">
              <div class="shop-item-emoji">🔝</div>
              <div class="shop-item-name">Top du Fil</div>
              <div class="shop-item-desc">Ta pub en tête du feed pendant 2h</div>
              <div class="shop-item-price">⚡ 10</div>
            </div>
            <div class="shop-item" onclick="shopBuy('vitrine-24h',25)">
              <div class="shop-item-emoji">✨</div>
              <div class="shop-item-name">Vitrine 24h</div>
              <div class="shop-item-desc">Épinglée en vitrine une journée</div>
              <div class="shop-item-price">⚡ 25</div>
            </div>
            <div class="shop-item" onclick="shopBuy('notif-push',50)">
              <div class="shop-item-emoji">🔔</div>
              <div class="shop-item-name">Notif Push</div>
              <div class="shop-item-desc">Notification à toute la communauté</div>
              <div class="shop-item-price">⚡ 50</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('boost-7j',80)">
              <div class="shop-item-badge">PREMIUM</div>
              <div class="shop-item-emoji">🏆</div>
              <div class="shop-item-name">Boost 7 Jours</div>
              <div class="shop-item-desc">Mis en avant pendant une semaine</div>
              <div class="shop-item-price">⚡ 80</div>
            </div>
          </div>
          <div class="shop-section-title">🎨 PERSONNALISATION PROFIL</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('cadre-or',30)">
              <div class="shop-item-emoji">🖼️</div>
              <div class="shop-item-name">Cadre Doré</div>
              <div class="shop-item-desc">Avatar avec bordure dorée animée</div>
              <div class="shop-item-price">⚡ 30</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('badge-feu',45)">
              <div class="shop-item-badge">RARE</div>
              <div class="shop-item-emoji">🔥</div>
              <div class="shop-item-name">Badge Feu</div>
              <div class="shop-item-desc">Flamme animée sur ton profil</div>
              <div class="shop-item-price">⚡ 45</div>
            </div>
            <div class="shop-item" onclick="shopBuy('emoji-pack',20)">
              <div class="shop-item-emoji">🎭</div>
              <div class="shop-item-name">Pack Emojis+</div>
              <div class="shop-item-desc">15 emojis exclusifs pour tes pubs</div>
              <div class="shop-item-price">⚡ 20</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('titre-vip',60)">
              <div class="shop-item-badge">VIP</div>
              <div class="shop-item-emoji">💎</div>
              <div class="shop-item-name">Titre VIP</div>
              <div class="shop-item-desc">Badge "VIP" doré sous ton nom</div>
              <div class="shop-item-price">⚡ 60</div>
            </div>
          </div>
          <div class="shop-section-title">🤖 IA & OUTILS</div>
          <div class="shop-grid">
            <div class="shop-item" onclick="shopBuy('ia-analyse',15)">
              <div class="shop-item-emoji">🔬</div>
              <div class="shop-item-name">Analyse IA</div>
              <div class="shop-item-desc">Analyse détaillée de ta pub</div>
              <div class="shop-item-price">⚡ 15</div>
            </div>
            <div class="shop-item" onclick="shopBuy('ia-hashtags',10)">
              <div class="shop-item-emoji">📌</div>
              <div class="shop-item-name">Hashtags IA</div>
              <div class="shop-item-desc">30 hashtags viraux générés par IA</div>
              <div class="shop-item-price">⚡ 10</div>
            </div>
            <div class="shop-item premium" onclick="shopBuy('ia-strategie',35)">
              <div class="shop-item-emoji">🗺️</div>
              <div class="shop-item-name">Stratégie IA</div>
              <div class="shop-item-desc">Plan marketing complet 30 jours</div>
              <div class="shop-item-price">⚡ 35</div>
            </div>
          </div>
          <div id="shop-boost-select-wrap" style="display:none;margin-top:14px;background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:14px;">
            <div style="font-size:12px;font-weight:700;margin-bottom:8px">Choisir la publication à booster :</div>
            <select id="boost-post-select" style="margin-bottom:10px"><option value="">Choisir...</option></select>
            <button class="btn-modal-g" onclick="confirmShopBoost()" style="margin-top:0;padding:9px">⚡ Confirmer le boost</button>
          </div>
        </div>

        <!-- PLANS AVEC CRÉDITS -->
        <div class="cpanel" id="cpanel-plans">
          <div style="text-align:center;margin-bottom:20px">
            <div style="font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px;color:var(--g3)">UPGRADE AVEC TES CRÉDITS</div>
            <div style="font-size:12px;color:var(--muted);margin-top:4px">Accumule des crédits via missions & badges → upgrade ton plan sans carte bancaire</div>
          </div>
          <div style="background:rgba(255,215,0,0.05);border:1.5px solid rgba(255,215,0,0.2);border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
            <div><div style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:1px">TES CRÉDITS ACTUELS</div><div style="font-family:'Bebas Neue',sans-serif;font-size:42px;color:var(--gold);line-height:1" id="plans-credits-display">0</div></div>
            <div style="text-align:right"><div style="font-size:11px;color:var(--muted)">Ton plan actuel</div><div style="font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--g3)" id="plans-current-plan">FREE</div></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr;gap:14px">
            <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);letter-spacing:1px;margin-bottom:4px">🟢 STARTER — 800⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">10 pubs/jour · Vitrine 7j · Coach IA · +200 crédits/mois</div>
                <div id="starter-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="starter-progress-bar" style="height:100%;background:var(--g3);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="starter-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('starter')" style="padding:10px 22px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);white-space:nowrap;flex-shrink:0">Acheter →</button>
            </div>
            <div style="background:var(--s1);border:2px solid rgba(22,163,74,0.25);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;position:relative">
              <div style="position:absolute;top:-10px;left:18px;background:var(--g2);color:var(--bg);font-size:9px;font-weight:800;padding:3px 10px;border-radius:3px;letter-spacing:1px">⭐ POPULAIRE</div>
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--g3);letter-spacing:1px;margin-bottom:4px">✅ PRO — 3 500⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Publications illimitées · IA Boost · Stats avancées · +500 crédits/mois</div>
                <div id="pro-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="pro-progress-bar" style="height:100%;background:var(--g3);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="pro-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('pro')" style="padding:10px 22px;background:var(--g2);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:var(--bg);white-space:nowrap;flex-shrink:0">Acheter →</button>
            </div>
            <div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.25);border-radius:12px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
              <div>
                <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--gold);letter-spacing:1px;margin-bottom:4px">🏆 ELITE — 9 000⚡</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Vitrine permanente · Appel mensuel · Priorité matching · +1500 crédits/mois</div>
                <div id="elite-progress-wrap" style="width:200px;max-width:100%"><div style="height:6px;background:var(--s3);border-radius:3px;overflow:hidden"><div id="elite-progress-bar" style="height:100%;background:linear-gradient(90deg,#ffd700,#ff8c00);border-radius:3px;transition:width 0.4s;width:0%"></div></div><div id="elite-progress-txt" style="font-size:10px;color:var(--muted);margin-top:3px;font-family:'DM Mono',monospace"></div></div>
              </div>
              <button onclick="buyPlanWithCredits('elite')" style="padding:10px 22px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:800;cursor:pointer;color:#1a0a00;white-space:nowrap;flex-shrink:0">Acheter →</button>
            </div>
          </div>
          <div style="margin-top:16px;text-align:center;font-size:11px;color:var(--muted2);font-family:'DM Mono',monospace">
            💡 Gagne des crédits via les missions quotidiennes et les badges pour upgrade gratuitement !
          </div>
        </div>

        <!-- BOOSTER MA PUB (raccourci) -->
        <div class="cpanel" id="cpanel-boost">
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px">Que veux-tu faire ?</div>
          <div class="boost-options">
            <div class="boost-opt selected" onclick="selectBoostOpt(this,'top-feed')">
              <div class="boost-opt-icon">🔝</div>
              <div class="boost-opt-name">Top du fil</div>
              <div class="boost-opt-cost">⚡ 10 crédits</div>
              <div class="boost-opt-desc">Ta pub en tête pendant 2h</div>
            </div>
            <div class="boost-opt" onclick="selectBoostOpt(this,'vitrine-24h')">
              <div class="boost-opt-icon">✨</div>
              <div class="boost-opt-name">Vitrine 24h</div>
              <div class="boost-opt-cost">⚡ 25 crédits</div>
              <div class="boost-opt-desc">Épinglée en vitrine une journée</div>
            </div>
            <div class="boost-opt" onclick="selectBoostOpt(this,'notif-push')">
              <div class="boost-opt-icon">🔔</div>
              <div class="boost-opt-name">Notification push</div>
              <div class="boost-opt-cost">⚡ 50 crédits</div>
              <div class="boost-opt-desc">Notif à toute la communauté</div>
            </div>
          </div>
          <div style="margin-bottom:12px">
            <label>Publication à booster</label>
            <select id="boost-post-select2" style="margin-top:4px"><option value="">Choisir une publication...</option></select>
          </div>
          <button class="btn-publish" onclick="applyBoost()" style="width:100%;padding:13px">⚡ Activer le boost</button>
        </div>

        <!-- ACHETER CRÉDITS -->
        <div class="cpanel" id="cpanel-packs">
          <div class="shop-section-title">💳 PACKS DE CRÉDITS</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
            <div onclick="buyCredits(50,4.99)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s" onmouseover="this.style.borderColor='rgba(34,197,94,0.3)'" onmouseout="this.style.borderColor='var(--border2)'">
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)">50</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">crédits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">4,99€</div>
              <div style="font-size:10px;color:var(--muted);margin-top:3px">0,10€/crédit</div>
            </div>
            <div onclick="buyCredits(150,12.99)" style="background:var(--s2);border:1.5px solid rgba(34,197,94,0.3);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onmouseover="this.style.borderColor='var(--g3)'" onmouseout="this.style.borderColor='rgba(34,197,94,0.3)'">
              <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:var(--g2);color:var(--bg);font-size:8px;font-weight:700;padding:2px 8px;border-radius:3px;white-space:nowrap">⭐ POPULAIRE</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)">150</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">crédits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">12,99€</div>
              <div style="font-size:10px;color:var(--g4);margin-top:3px">-13% moins cher</div>
            </div>
            <div onclick="buyCredits(400,29.99)" style="background:var(--s1);border:1.5px solid rgba(255,215,0,0.25);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:all 0.2s;position:relative" onmouseover="this.style.borderColor='rgba(255,215,0,0.5)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.25)'">
              <div style="position:absolute;top:-8px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00;font-size:8px;font-weight:700;padding:2px 8px;border-radius:3px;white-space:nowrap">👑 BEST VALUE</div>
              <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--gold)">400</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">crédits</div>
              <div style="font-size:15px;font-weight:700;margin-top:8px">29,99€</div>
              <div style="font-size:10px;color:var(--gold);margin-top:3px">-25% moins cher</div>
            </div>
          </div>
          <div style="margin-top:14px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.15);border-radius:8px;padding:12px 14px;font-size:11px;color:var(--muted);line-height:1.7">
            💡 <b style="color:var(--g4)">Astuce :</b> Tu peux aussi gagner des crédits gratuitement en complétant les <span style="color:var(--g3);cursor:pointer" onclick="switchCreditsTab('missions',document.getElementById('ctab-missions'))">missions quotidiennes</span> et en débloquant des badges !
          </div>
        </div>

      </div>
    </div>

    <!-- ══ LEADERBOARD ══ -->
    <div class="tpanel" id="tab-leaderboard">
      <div style="max-width:660px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">CLASSEMENT</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Top des publications virales cette semaine</p>
        <div class="feed-tabs" style="margin-bottom:18px">
          <button class="feed-tab active" onclick="switchLeaderboard('pubs',this)">📢 Pubs virales</button>
          <button class="feed-tab" onclick="switchLeaderboard('createurs',this)">👤 Créateurs</button>
          <button class="feed-tab" onclick="switchLeaderboard('vitrine',this)">✨ Vitrine</button>
        </div>
        <div class="leaderboard-list" id="leaderboard-list"></div>
      </div>
    </div>

    <!-- ══ COLLABS ══ -->
    <div class="tpanel" id="tab-collab">
      <div style="max-width:760px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">COLLABORATIONS</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">Créateurs compatibles avec ton profil — matchés par l'IA</p>
        <div style="background:rgba(34,197,94,0.05);border:1.5px solid rgba(34,197,94,0.15);border-radius:10px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px">
          <div style="font-size:24px">🤖</div>
          <div>
            <div style="font-size:13px;font-weight:700;color:var(--g4);margin-bottom:2px">Matching IA activé</div>
            <div style="font-size:11px;color:var(--muted)">Basé sur ta niche, tes objectifs et tes compétences</div>
          </div>
          <button onclick="loadCollabs()" style="margin-left:auto;background:var(--g2);border:none;border-radius:6px;padding:7px 14px;font-size:12px;font-weight:700;cursor:pointer;color:var(--bg)">Actualiser</button>
        </div>
        <div id="collab-list">
          <div style="text-align:center;padding:32px;color:var(--muted)">Chargement des suggestions...</div>
        </div>
      </div>
    </div>

    <!-- ══ CALENDRIER ÉDITORIAL ══ -->
    <div class="tpanel" id="tab-calendrier">
      <div style="max-width:860px;margin:0 auto;padding:22px 0">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px">
          <div>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">CALENDRIER ÉDITORIAL</h2>
            <p style="font-size:12px;color:var(--muted)">Planifie et visualise tes publications</p>
          </div>
          <div style="display:flex;gap:8px">
            <button onclick="calNav(-1)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted)">←</button>
            <span id="cal-month-label" style="font-family:'DM Mono',monospace;font-size:12px;color:var(--g4);padding:7px 14px;background:var(--s1);border:1.5px solid var(--border2);border-radius:6px"></span>
            <button onclick="calNav(1)" style="background:var(--s1);border:1.5px solid var(--border2);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted)">→</button>
          </div>
        </div>
        <div class="cal-header-days">
          <span>LUN</span><span>MAR</span><span>MER</span><span>JEU</span><span>VEN</span><span>SAM</span><span>DIM</span>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
        <div style="margin-top:20px">
          <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g4);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px">🤖 CRÉNEAUX OPTIMAUX SUGGÉRÉS PAR L'IA</div>
          <div id="optimal-slots" style="display:flex;flex-wrap:wrap;gap:6px"></div>
        </div>
      </div>
    </div>

    <!-- ══ A/B TEST IA ══ -->
    <div class="tpanel" id="tab-ab-test">
      <div style="max-width:760px;margin:0 auto;padding:22px 0">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:2px;color:var(--g3);margin-bottom:3px">A/B TEST IA</h2>
        <p style="font-size:12px;color:var(--muted);margin-bottom:20px">L'IA analyse tes 2 versions et prédit laquelle convertira le mieux</p>
        <div class="ab-compare">
          <div class="ab-side">
            <div class="ab-side-label a">VERSION A</div>
            <textarea id="ab-text-a" rows="4" placeholder="Première version de ta pub..." style="width:100%;resize:none"></textarea>
          </div>
          <div class="ab-side">
            <div class="ab-side-label b">VERSION B</div>
            <textarea id="ab-text-b" rows="4" placeholder="Deuxième version de ta pub..." style="width:100%;resize:none"></textarea>
          </div>
        </div>
        <div class="fg"><label>Objectif de la pub</label><select id="ab-goal"><option value="clics">Générer des clics</option><option value="abonnes">Gagner des abonnés</option><option value="ventes">Convertir en ventes</option><option value="notoriete">Notoriété / Vues</option></select></div>
        <button class="btn-publish" onclick="runABTest()" id="btn-ab" style="width:100%;padding:13px;font-size:14px;margin-top:4px">🔬 Analyser avec l'IA</button>
        <div id="ab-result" style="display:none;margin-top:16px" class="ab-result">
          <div class="ab-winner" id="ab-winner-text">Version A gagne</div>
          <div class="ab-analysis" id="ab-analysis-text"></div>
        </div>
      </div>
    </div>

  </div><!-- /max-width container -->
</div><!-- /app -->

<!-- SIGNUP -->
<div class="modal-bg" id="signup-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('signup-modal')">✕</button>
    <h2>REJOINDRE VIRALBOOST</h2>
    <div class="modal-sub">CRÉE TON COMPTE · CHOISIS TON PLAN</div>
    <div style="margin-bottom:18px">
      <label>Choisis ton abonnement</label>
      <div class="signup-plans" id="signup-plans-grid"></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="fg"><label>Prénom *</label><input type="text" id="s-name" placeholder="Marie"/></div>
      <div class="fg"><label>Pseudo *</label><input type="text" id="s-username" placeholder="@marie_creator"/></div>
      <div class="fg"><label>Email *</label><input type="email" id="s-email" placeholder="marie@exemple.fr"/></div>
      <div class="fg"><label>Mot de passe *</label><input type="password" id="s-pass" placeholder="8 caractères min."/></div>
    </div>
    <button class="btn-modal-g" onclick="signup()">Créer mon compte →</button>
    <div class="modal-switch">Déjà inscrit ? <a onclick="switchModal('signup-modal','login-modal')">Se connecter</a></div>
  </div>
</div>

<!-- LOGIN -->
<div class="modal-bg" id="login-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('login-modal')">✕</button>
    <h2>CONNEXION</h2>
    <div class="modal-sub">CONTENT DE TE REVOIR 👋</div>
    <div class="fg"><label>Email</label><input type="email" id="l-email" placeholder="marie@exemple.fr"/></div>
    <div class="fg"><label>Mot de passe</label><input type="password" id="l-pass" placeholder="Ton mot de passe"/></div>
    <button class="btn-modal-g" onclick="login()">Se connecter →</button>
    <div class="modal-switch">Pas de compte ? <a onclick="switchModal('login-modal','signup-modal')">S'inscrire</a></div>
  </div>
</div>

<!-- PAYMENT -->
<div class="modal-bg" id="payment-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('payment-modal')">✕</button>
    <h2>ABONNEMENT</h2>
    <div class="modal-sub">SANS ENGAGEMENT · ANNULABLE ANYTIME</div>
    <div class="pay-sum">
      <div class="pay-plan" id="pay-plan-name">STARTER</div>
      <div class="pay-price" id="pay-plan-price">3€</div>
      <div class="pay-period">/mois</div>
    </div>
    <div id="card-element"></div>
    <div id="card-errors"></div>
    <button class="btn-modal-g" id="btn-pay" onclick="processPayment()">🔒 S'abonner maintenant</button>
    <div style="text-align:center;margin-top:7px;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">CRYPTÉ · STRIPE · SANS ENGAGEMENT</div>
  </div>
</div>

<!-- REPORT MODAL -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">SIGNALEMENT TRANSMIS À L'ADMIN</div>
    <div class="report-reason">
      <label><input type="radio" name="report-reason" value="spam"/> Spam / Publicité abusive</label>
      <label><input type="radio" name="report-reason" value="harcelement"/> Harcèlement</label>
      <label><input type="radio" name="report-reason" value="contenu_inapproprie"/> Contenu inapproprié</label>
      <label><input type="radio" name="report-reason" value="arnaque"/> Arnaque / Fraude</label>
      <label><input type="radio" name="report-reason" value="autre"/> Autre</label>
    </div>
    <div class="fg"><label>Détails (optionnel)</label><textarea id="report-details" rows="3" placeholder="Donne plus d'infos..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Envoyer le signalement</button>
  </div>
</div>

<!-- CREATE GROUP MODAL (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CRÉER UN GROUPE</h2>
    <div class="modal-sub">RÉSERVÉ AUX MEMBRES ELITE 🏆</div>
    <div class="group-settings-section">
      <h3>Informations du groupe</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Nom du groupe *</label><input type="text" id="cg-name" placeholder="Marketing Digital Pro"/></div>
        <div class="fg"><label>Emoji icône</label><input type="text" id="cg-emoji" placeholder="💼" maxlength="2"/></div>
        <div class="fg"><label>Thème / Catégorie</label><select id="cg-cat"><option value="marketing">📢 Marketing / Pub</option><option value="saas">🚀 SaaS / Tech</option><option value="ecommerce">🛍️ E-commerce</option><option value="tiktok">🎵 TikTok / Créateurs</option><option value="business">💼 Business</option><option value="freelance">💻 Freelance</option><option value="autre">📦 Autre</option></select></div>
        <div class="fg"><label>Membres max</label><select id="cg-max"><option value="50">50 membres</option><option value="100">100 membres</option><option value="500">500 membres</option><option value="0">Illimité</option></select></div>
      </div>
      <div class="fg"><label>Description</label><textarea id="cg-desc" rows="2" placeholder="À quoi sert ce groupe ? Qui peut rejoindre ?"></textarea></div>
    </div>
    <div class="group-settings-section">
      <h3>🔧 Paramètres de modération</h3>
      <div class="toggle-row"><label>Autoriser les photos dans le groupe</label><label class="toggle"><input type="checkbox" id="cg-allow-photos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Autoriser les vidéos</label><label class="toggle"><input type="checkbox" id="cg-allow-videos" checked/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Autoriser les fichiers</label><label class="toggle"><input type="checkbox" id="cg-allow-files"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Groupe privé (sur invitation)</label><label class="toggle"><input type="checkbox" id="cg-private"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Modération des messages avant publication</label><label class="toggle"><input type="checkbox" id="cg-premod"/><span class="toggle-slider"></span></label></div>
      <div class="toggle-row"><label>Fond d'écran personnalisé pour le groupe</label><label class="toggle"><input type="checkbox" id="cg-wallpaper-enable"/><span class="toggle-slider"></span></label></div>
    </div>
    <button class="btn-modal-g" onclick="createGroup()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">🏆 Créer le groupe</button>
  </div>
</div>

<!-- WALLPAPER MODAL (ELITE) -->
<div class="modal-bg" id="wallpaper-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('wallpaper-modal')">✕</button>
    <h2>FOND D'ÉCRAN</h2>
    <div class="modal-sub">PERSONNALISE TON ESPACE — ELITE ONLY 🏆</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div onclick="setWallpaper('none')" style="height:70px;background:var(--bg);border:2px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--muted)">Aucun</div>
      <div onclick="setWallpaper('linear-gradient(135deg,#040a05,#0b2810)')" style="height:70px;background:linear-gradient(135deg,#040a05,#0b2810);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#0a0014,#1a0028)')" style="height:70px;background:linear-gradient(135deg,#0a0014,#1a0028);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#001a0a,#0a1f0a,#001210)')" style="height:70px;background:linear-gradient(135deg,#001a0a,#0a1f0a,#001210);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#1a0a00,#2a1000)')" style="height:70px;background:linear-gradient(135deg,#1a0a00,#2a1000);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
      <div onclick="setWallpaper('linear-gradient(135deg,#00101a,#001428)')" style="height:70px;background:linear-gradient(135deg,#00101a,#001428);border:2px solid var(--border);border-radius:8px;cursor:pointer"></div>
    </div>
    <div class="fg"><label>Ou importe une image</label><input type="file" id="wallpaper-file" accept="image/*" onchange="setWallpaperFromFile(this)"/></div>
  </div>
</div>

<!-- DM ADMIN MODAL (ELITE) -->
<div class="modal-bg" id="dm-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-admin-modal')">✕</button>
    <h2>MESSAGE À L'ADMIN</h2>
    <div class="modal-sub">MESSAGE PRIVÉ — ELITE ONLY 🏆</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-admin-msgs"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-admin-input" placeholder="Ton message à l'admin..." onkeydown="if(event.key==='Enter')sendAdminDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendAdminDM()" style="padding:9px 18px">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- GROUP CHAT MODAL -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div class="modal-sub" id="group-chat-sub">DISCUSSION DE GROUPE</div>
    <div style="display:flex;gap:12px">
      <div style="flex:1">
        <div class="chat-box" style="height:400px">
          <div class="chat-msgs-area" id="group-chat-msgs"></div>
          <div class="chat-input-row" style="align-items:center">
            <label id="group-media-upload-label" style="cursor:pointer;color:var(--g3);font-size:18px;flex-shrink:0;display:none" title="Ajouter media">
              <input type="file" id="group-media-input" accept="image/*,video/*" style="display:none" onchange="sendGroupMedia(this)"/>📎
            </label>
            <input type="text" id="group-chat-in" class="chat-input-field" placeholder="Écris ton message..."/>
            <button class="btn-send" onclick="sendGroupMsg()">→</button>
          </div>
        </div>
      </div>
      <div id="group-members-sidebar" style="width:180px;background:var(--s1);border:1px solid var(--border2);border-radius:10px;padding:12px;max-height:430px;overflow-y:auto">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:2px;margin-bottom:10px">MEMBRES</div>
        <div id="group-members-list" style="font-size:12px;color:var(--muted)"></div>
        <div id="group-admin-controls" style="display:none;margin-top:12px;border-top:1px solid var(--border2);padding-top:10px">
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:2px;margin-bottom:8px">MODÉRATION</div>
          <button onclick="openGroupSettings()" style="width:100%;padding:6px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:5px;font-size:11px;color:var(--gold);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;margin-bottom:5px">⚙️ Paramètres</button>
          <button onclick="openModal('wallpaper-modal')" style="width:100%;padding:6px;background:transparent;border:1px solid var(--border);border-radius:5px;font-size:11px;color:var(--muted);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">🖼️ Fond d'écran</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DM MODAL -->
<div class="modal-bg" id="dm-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('dm-modal')">✕</button>
    <h2>MESSAGE PRIVÉ</h2>
    <div class="modal-sub" id="dm-modal-sub">À : ...</div>
    <div class="dm-thread">
      <div class="dm-msgs" id="dm-msgs-list"></div>
      <div class="dm-input-row">
        <input type="text" id="dm-input" placeholder="Ton message..." onkeydown="if(event.key==='Enter')sendDM()" style="flex:1"/>
        <button class="btn-publish" onclick="sendDM()" style="padding:9px 18px">Envoyer</button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT PROFILE -->
<div class="modal-bg" id="edit-profile-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('edit-profile-modal')">✕</button>
    <h2>MON PROFIL</h2>
    <div class="modal-sub">BIEN PLUS COMPLET QUE LES AUTRES RÉSEAUX</div>

    <div class="edit-section">
      <h3>Identité & Avatar</h3>
      <div class="edit-avatar-row">
        <div class="edit-avatar-big" id="edit-ava-preview" style="background:var(--g2)" onclick="document.getElementById('ava-file-input')?.click()" title="Clique pour uploader une photo">
          <span id="edit-ava-emoji">🙂</span>
          <img id="edit-ava-img" style="display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%"/>
          <div class="ava-upload-overlay"></div>
          <input type="file" id="ava-file-input" accept="image/*" style="display:none;position:absolute" onchange="handleAvatarUpload(this)"/>
        </div>
        <div style="flex:1">
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Clique sur l'avatar pour uploader une photo · ou choisis un emoji</div>
          <div style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:9px;color:var(--g3);letter-spacing:1px">GRATUIT</div>
          <div class="emoji-picker" style="margin-bottom:10px">
            <div class="emoji-opt" onclick="selectEmoji(this,'🙂')">🙂</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😎')">😎</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🤩')">🤩</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'😏')">😏</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧐')">🧐</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🚀')">🚀</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'💡')">💡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🎯')">🎯</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🔥')">🔥</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'⚡')">⚡</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🌍')">🌍</div>
            <div class="emoji-opt" onclick="selectEmoji(this,'🧠')">🧠</div>
          </div>
          <div style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:1px">✨ PREMIUM (STARTER+)</div>
          <div class="emoji-picker">
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'💎','starter')">💎</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'👑','pro')">👑</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦁','starter')">🦁</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🐉','pro')">🐉</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🌟','starter')">🌟</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🏆','pro')">🏆</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦊','starter')">🦊</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🤖','starter')">🤖</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🦄','elite')">🦄</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'👾','pro')">👾</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🧬','elite')">🧬</div>
            <div class="emoji-opt premium-emoji" onclick="selectEmojiPremium(this,'🔮','elite')">🔮</div>
          </div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Prénom *</label><input type="text" id="ep-name" placeholder="Marie"/></div>
        <div class="fg"><label>Pseudo *</label><input type="text" id="ep-username" placeholder="marie_creator"/></div>
        <div class="fg"><label>Titre / Métier</label><input type="text" id="ep-title" placeholder="Créatrice de contenu · Dev indie"/></div>
        <div class="fg"><label>Localisation</label><input type="text" id="ep-location" placeholder="Paris, France 🇫🇷"/></div>
      </div>
      <div class="fg"><label>Bio</label><textarea id="ep-bio" rows="3" placeholder="Raconte qui tu es, ce que tu crées, ce qui te passionne..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>À propos (ultra-détaillé)</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>Secteur / Niche</label><input type="text" id="ep-niche" placeholder="Marketing digital, Tech, Fitness..."/></div>
        <div class="fg"><label>Expérience</label><select id="ep-exp"><option>Débutant (0-1 an)</option><option>Intermédiaire (1-3 ans)</option><option>Confirmé (3-5 ans)</option><option>Expert (5+ ans)</option></select></div>
        <div class="fg"><label>Disponibilité</label><select id="ep-dispo"><option>Ouvert aux collaborations</option><option>Disponible pour missions</option><option>En recherche d'investisseur</option><option>Cherche associé</option><option>Simplement en réseau</option></select></div>
        <div class="fg"><label>Revenus/mois (optionnel)</label><select id="ep-revenue"><option value="">Non précisé</option><option>0–500€</option><option>500–2 000€</option><option>2 000–5 000€</option><option>5 000–10 000€</option><option>10 000€+</option></select></div>
        <div class="fg"><label>Objectif principal</label><input type="text" id="ep-goal" placeholder="Atteindre 100K abonnés en 2025"/></div>
        <div class="fg"><label>Compétences clés</label><input type="text" id="ep-skills" placeholder="Vidéo, Copywriting, SEO, Dev..."/></div>
        <div class="fg"><label>Outils utilisés</label><input type="text" id="ep-tools" placeholder="CapCut, Canva, Notion, Figma..."/></div>
        <div class="fg"><label>Langues parlées</label><input type="text" id="ep-langs" placeholder="Français, Anglais, Espagnol..."/></div>
      </div>
      <div class="fg"><label>Ce que je recherche</label><textarea id="ep-looking" rows="2" placeholder="Je cherche des collaborateurs, un associé, des clients, des conseils..."></textarea></div>
    </div>

    <div class="edit-section">
      <h3>Réseaux & Liens</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="fg"><label>🌐 Site web</label><input type="url" id="ep-website" placeholder="https://monsite.fr"/></div>
        <div class="fg"><label>🎵 TikTok</label><input type="text" id="ep-tiktok" placeholder="@moncompte"/></div>
        <div class="fg"><label>📸 Instagram</label><input type="text" id="ep-instagram" placeholder="@moncompte"/></div>
        <div class="fg"><label>🐦 Twitter/X</label><input type="text" id="ep-twitter" placeholder="@moncompte"/></div>
        <div class="fg"><label>💼 LinkedIn</label><input type="url" id="ep-linkedin" placeholder="linkedin.com/in/..."/></div>
        <div class="fg"><label>▶️ YouTube</label><input type="text" id="ep-youtube" placeholder="@moncompte"/></div>
      </div>
    </div>

    <div class="edit-section">
      <h3>Mes chiffres (optionnel)</h3>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px">
        <div class="fg"><label>Abonnés TikTok</label><input type="text" id="ep-tiktok-count" placeholder="45 000"/></div>
        <div class="fg"><label>Abonnés Instagram</label><input type="text" id="ep-ig-count" placeholder="12 000"/></div>
        <div class="fg"><label>Projets lancés</label><input type="text" id="ep-projects-count" placeholder="3"/></div>
        <div class="fg"><label>Ventes / Clients</label><input type="text" id="ep-sales" placeholder="150"/></div>
      </div>
    </div>

    <button class="btn-modal-g" onclick="saveProfile()">💾 Sauvegarder le profil</button>
  </div>
</div>

<!-- PUBLISH LANDING (avant inscription) -->
<div class="modal-bg" id="publish-landing-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('publish-landing-modal')">✕</button>
    <h2>PUBLIER UNE PUBLICITÉ</h2>
    <div class="modal-sub">DIFFUSION IMMÉDIATE SUR VIRALBOOST · SANS COMPTE REQUIS</div>
    <div class="fg"><label>Titre de ta publicité *</label><input type="text" id="pl-title" placeholder="Ex: ContentPro — L'outil IA pour créateurs"/></div>
    <div class="fg"><label>Message publicitaire *</label><textarea id="pl-text" rows="4" placeholder="Décris ton produit, service, projet... Sois accrocheur !"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Catégorie</label><select id="pl-type"><option value="saas">🚀 SaaS / App</option><option value="site">🌐 Site web</option><option value="ecommerce">🛍️ E-commerce</option><option value="service">💼 Service</option><option value="coaching">🎓 Coaching</option><option value="tiktok">🎵 TikTok</option><option value="instagram">📸 Instagram</option></select></div>
      <div class="fg"><label>URL (optionnel)</label><input type="url" id="pl-url" placeholder="https://..."/></div>
    </div>
    <div class="fg">
      <label>Image / Vidéo (optionnel)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        📎 Ajouter un fichier
        <input type="file" id="pl-media" accept="image/*,video/*" style="display:none" onchange="handleLandingMediaUpload(this)"/>
      </label>
      <div id="pl-media-preview" style="margin-top:8px"></div>
    </div>
    <button class="btn-modal-g" onclick="publishLandingAd()">📢 Publier maintenant</button>
    <div class="modal-switch">Tu as un compte ? <a onclick="switchModal('publish-landing-modal','login-modal')">Se connecter</a> · <a onclick="switchModal('publish-landing-modal','signup-modal')">S'inscrire</a></div>
  </div>
</div>

<!-- CRÉER GROUPE (ELITE) -->
<div class="modal-bg" id="create-group-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('create-group-modal')">✕</button>
    <h2>CRÉER UN GROUPE</h2>
    <div class="modal-sub">FONCTIONNALITÉ ELITE — TU ES ADMIN DU GROUPE</div>
    <div class="edit-grid">
      <div class="fg"><label>Nom du groupe *</label><input type="text" id="grp-name" placeholder="Ex: SaaS Builders FR"/></div>
      <div class="fg"><label>Emoji / Icône</label><input type="text" id="grp-emoji" placeholder="🚀" maxlength="2"/></div>
    </div>
    <div class="fg"><label>Description *</label><textarea id="grp-desc" rows="2" placeholder="De quoi parle ce groupe ?"></textarea></div>
    <div class="edit-grid">
      <div class="fg"><label>Catégorie</label><select id="grp-cat"><option>SaaS / Tech</option><option>Marketing</option><option>TikTok / Instagram</option><option>E-commerce</option><option>Coaching</option><option>Crypto / Finance</option><option>Autre</option></select></div>
      <div class="fg"><label>Accès</label><select id="grp-access"><option value="public">🌍 Public</option><option value="private">🔒 Privé (sur invitation)</option></select></div>
    </div>
    <div class="fg"><label>Image de fond (URL ou upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Fond du groupe
        <input type="file" id="grp-bg-input" accept="image/*" style="display:none" onchange="handleGroupBgUpload(this)"/>
      </label>
      <div id="grp-bg-preview" style="margin-top:8px"></div>
    </div>
    <div class="fg"><label>Règles du groupe (optionnel)</label><textarea id="grp-rules" rows="2" placeholder="Ex: Pas de spam. Sujets liés au SaaS uniquement."></textarea></div>
    <div style="background:rgba(22,163,74,0.06);border:1px solid rgba(22,163,74,0.18);border-radius:8px;padding:12px;margin-bottom:14px;font-size:12px;color:var(--g5)">
      En tant qu'admin, tu pourras : modifier le fond, les règles, autoriser/interdire les photos, supprimer des membres, signaler des abus.
    </div>
    <button class="btn-modal-g" onclick="createGroup()">🏛️ Créer le groupe</button>
  </div>
</div>

<!-- SETTINGS GROUPE (ELITE admin) -->
<div class="modal-bg" id="group-settings-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-settings-modal')">✕</button>
    <h2>PARAMÈTRES DU GROUPE</h2>
    <div class="modal-sub">ADMINISTRATION — ELITE UNIQUEMENT</div>
    <div class="fg"><label>Autoriser les photos dans ce groupe</label>
      <select id="gs-allow-photos"><option value="1">✅ Oui, autorisées</option><option value="0">❌ Non, désactivées</option></select>
    </div>
    <div class="fg"><label>Nouveau fond (upload)</label>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;background:var(--s2);border:1.5px dashed var(--border);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--muted)">
        🖼️ Modifier le fond
        <input type="file" id="gs-bg-input" accept="image/*" style="display:none" onchange="handleGroupSettingsBg(this)"/>
      </label>
    </div>
    <div class="fg"><label>Règles</label><textarea id="gs-rules" rows="2"></textarea></div>
    <div class="fg"><label>Mode privé</label>
      <select id="gs-access"><option value="public">🌍 Public</option><option value="private">🔒 Privé</option></select>
    </div>
    <button class="btn-modal-g" onclick="saveGroupSettings()">💾 Sauvegarder</button>
  </div>
</div>

<!-- CHAT GROUPE -->
<div class="modal-bg" id="group-chat-modal">
  <div class="modal wide">
    <button class="modal-close" onclick="closeModal('group-chat-modal')">✕</button>
    <h2 id="group-chat-title">GROUPE</h2>
    <div style="display:flex;gap:8px;margin-bottom:8px" id="group-chat-actions"></div>
    <div class="chat-box" style="height:400px">
      <div class="chat-msgs-area" id="group-chat-msgs"></div>
      <div class="chat-input-row">
        <input type="text" id="group-chat-input" class="chat-input-field" placeholder="Message dans le groupe..." onkeydown="if(event.key==='Enter')sendGroupMessage()"/>
        <label id="group-media-btn" style="display:none;cursor:pointer;background:var(--s2);border:1.5px solid var(--border2);border-radius:7px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0" title="Joindre un fichier">
          📎<input type="file" id="group-chat-file" accept="image/*,video/*" style="display:none" onchange="handleGroupChatFile(this)"/>
        </label>
        <button class="btn-send" onclick="sendGroupMessage()">→</button>
      </div>
    </div>
  </div>
</div>

<!-- SIGNALER UN UTILISATEUR -->
<div class="modal-bg" id="report-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('report-modal')">✕</button>
    <h2>SIGNALER</h2>
    <div class="modal-sub" id="report-modal-sub">SIGNALEMENT TRANSMIS À L'ADMIN</div>
    <div class="fg"><label>Raison du signalement *</label>
      <select id="report-reason">
        <option value="spam">🚫 Spam / Publicité abusive</option>
        <option value="harcelement">⚠️ Harcèlement / Insultes</option>
        <option value="contenu">🔞 Contenu inapproprié</option>
        <option value="arnaque">💸 Arnaque / Fraude</option>
        <option value="autre">📝 Autre</option>
      </select>
    </div>
    <div class="fg"><label>Détails (optionnel)</label><textarea id="report-details" rows="3" placeholder="Explique ce qui s'est passé..."></textarea></div>
    <button class="btn-modal-g" onclick="submitReport()">🚨 Envoyer le signalement</button>
  </div>
</div>

<!-- CONTACTER L'ADMIN (ELITE) -->
<div class="modal-bg" id="contact-admin-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('contact-admin-modal')">✕</button>
    <h2>MESSAGE À L'ADMIN</h2>
    <div class="modal-sub">FONCTIONNALITÉ ELITE — RÉPONSE SOUS 24H</div>
    <div class="fg"><label>Objet</label><input type="text" id="ca-subject" placeholder="Ex: Demande de partenariat"/></div>
    <div class="fg"><label>Message *</label><textarea id="ca-message" rows="5" placeholder="Ton message à l'équipe ViralBoost..."></textarea></div>
    <button class="btn-modal-g" onclick="sendAdminMessage()">📩 Envoyer</button>
  </div>
</div>
<script>


// ════════════════════════════════════════
// ── SYSTÈME I18N FR / EN
// ════════════════════════════════════════
let currentLang = localStorage.getItem('vb_lang') || 'fr';

const i18n = {
  fr: {
    // Navbar
    nav_vitrine: 'Vitrine', nav_plans: 'Abonnements', nav_reviews: 'Avis',
    nav_login: 'Connexion', nav_join: 'Rejoindre →',
    mob_vitrine: '📊 Vitrine', mob_plans: '💎 Abonnements', mob_reviews: '⭐ Avis',
    // Hero
    hero_line1: 'PUBLIE TA', hero_line2: 'PUBLICITÉ.',
    hero_cta1: 'Créer mon compte →', hero_cta2: 'Se connecter',
    how1_title: 'Publie ta pub', how2_title: 'Trouve un partenaire', how3_title: "Propulse avec l'IA",
    // Sections
    sec_feed: 'Fil public', sec_vitrine: 'Vitrine communautaire', sec_plans: 'Abonnements',
    // Bottom nav
    bn_feed: 'Fil', bn_vitrine: 'Vitrine', bn_profil: 'Profil',
    // Composer
    comp_label: '✦ FIL COMMUNAUTAIRE', comp_title: 'Partage à la communauté',
    comp_sub: 'Projets, idées, questions — ta voix compte ici.',
    comp_placeholder: 'Partage ton projet à la communauté…',
    // Feed tabs
    tab_all: 'Tout', tab_following: 'Abonnements', tab_top: 'Top du jour',
    // Buttons
    btn_publish: 'Publier', btn_addlink: '🔗 Ajouter un lien',
    // Toast
    toast_published: '📢 Publication postée !',
    toast_write: 'Écris quelque chose !',
    toast_limit_free: 'Plan FREE : 1 publication/heure. Upgrade pour plus !',
    toast_limit_day: "Limite de publications atteinte pour aujourd'hui.",
    // App tabs
    apptab_feed: 'Fil', apptab_vitrine: 'Vitrine', apptab_publish: 'Publier',
    apptab_chat: 'Chat', apptab_profil: 'Profil',
    // Profile
    prof_edit: '✏️ Modifier', prof_followers: 'Abonnés', prof_following: 'Abonnements', prof_projects: 'Projets', prof_votes: 'Votes reçus',
    // Vitrine
    vit_title: 'VITRINE COMMUNAUTAIRE', vit_sub: 'Projets partagés par la communauté',
    vit_empty: '🚀 Aucun projet pour ce filtre',
    vit_all: 'Tous',
    // Publish wizard
    wiz_title: 'CRÉER MA PUBLICITÉ',
    wiz_sub: 'Suis les 5 étapes pour créer une pub qui convertit et attire des votes.',
    // No posts
    no_posts: "Aucune publication pour l'instant.",
    // Login/signup modal
    login_title: 'CONNEXION', signup_title: 'CRÉER MON COMPTE',
    // Settings
    logout: 'Quitter',
    // URL field
    url_placeholder: 'https://ton-site.com',
    proj_placeholder: 'Nom du projet (optionnel)',
  },
  en: {
    // Navbar
    nav_vitrine: 'Showcase', nav_plans: 'Pricing', nav_reviews: 'Reviews',
    nav_login: 'Log in', nav_join: 'Join →',
    mob_vitrine: '📊 Showcase', mob_plans: '💎 Pricing', mob_reviews: '⭐ Reviews',
    // Hero
    hero_line1: 'PUBLISH YOUR', hero_line2: 'AD.',
    hero_cta1: 'Create my account →', hero_cta2: 'Log in',
    how1_title: 'Post your ad', how2_title: 'Find a partner', how3_title: 'Boost with AI',
    // Sections
    sec_feed: 'Public feed', sec_vitrine: 'Community Showcase', sec_plans: 'Pricing',
    // Bottom nav
    bn_feed: 'Feed', bn_vitrine: 'Showcase', bn_profil: 'Profile',
    // Composer
    comp_label: '✦ COMMUNITY FEED', comp_title: 'Share with the community',
    comp_sub: 'Projects, ideas, questions — your voice matters here.',
    comp_placeholder: 'Share your project with the community…',
    // Feed tabs
    tab_all: 'All', tab_following: 'Following', tab_top: "Today's top",
    // Buttons
    btn_publish: 'Post', btn_addlink: '🔗 Add a link',
    // Toast
    toast_published: '📢 Post published!',
    toast_write: 'Write something!',
    toast_limit_free: 'FREE plan: 1 post/hour. Upgrade for more!',
    toast_limit_day: 'Daily post limit reached.',
    // App tabs
    apptab_feed: 'Feed', apptab_vitrine: 'Showcase', apptab_publish: 'Publish',
    apptab_chat: 'Chat', apptab_profil: 'Profile',
    // Profile
    prof_edit: '✏️ Edit', prof_followers: 'Followers', prof_following: 'Following', prof_projects: 'Projects', prof_votes: 'Votes received',
    // Vitrine
    vit_title: 'COMMUNITY SHOWCASE', vit_sub: 'Projects shared by the community',
    vit_empty: '🚀 No projects for this filter',
    vit_all: 'All',
    // Publish wizard
    wiz_title: 'CREATE MY AD',
    wiz_sub: 'Follow the 5 steps to create an ad that converts and attracts votes.',
    // No posts
    no_posts: 'No posts yet.',
    // Login/signup modal
    login_title: 'LOG IN', signup_title: 'CREATE MY ACCOUNT',
    // Settings
    logout: 'Log out',
    // URL field
    url_placeholder: 'https://your-website.com',
    proj_placeholder: 'Project name (optional)',
  }
};

function t(key) {
  return (i18n[currentLang] && i18n[currentLang][key]) || (i18n['fr'][key]) || key;
}

function applyLang() {
  // Mettre à jour tous les éléments data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    el.textContent = t(key);
  });
  // Placeholder textarea
  const ta = document.getElementById('feed-text');
  if(ta) ta.placeholder = t('comp_placeholder');
  const urlInp = document.getElementById('feed-url');
  if(urlInp) urlInp.placeholder = t('url_placeholder');
  const projInp = document.getElementById('feed-proj-name');
  if(projInp) projInp.placeholder = t('proj_placeholder');
  // Bouton langue
  const btn = document.getElementById('lang-btn');
  if(btn) btn.textContent = currentLang === 'fr' ? '🇬🇧 EN' : '🇫🇷 FR';
  // html lang
  document.documentElement.lang = currentLang;
  // Title
  document.title = currentLang === 'fr' ? 'ViralBoost — Publie ta publicité, touche ta cible' : 'ViralBoost — Publish your ad, reach your audience';
}

function toggleLang() {
  currentLang = currentLang === 'fr' ? 'en' : 'fr';
  localStorage.setItem('vb_lang', currentLang);
  applyLang();
}

// Appliquer au chargement
document.addEventListener('DOMContentLoaded', () => { applyLang(); });

const PLANS = [
  { id:'free', name:'FREE', price:0, period:'', desc:'Pour découvrir ViralBoost',
    features:['1 publication / heure','3 messages chat mondial / jour','Vitrine 1 heure','Profil public complet','Accès communauté'],
    limits:{pubsPerHour:1,chatMsgs:3,vitrineHours:1}
  },
  { id:'starter', name:'STARTER', price:3, period:'/mois', desc:'Pour commencer à propulser',
    features:['3 publications / jour','10 messages chat mondial / jour','Vitrine 7 jours','Coach IA (20 requêtes/mois)','DMs illimités','Badge Starter'],
    limits:{pubsPerDay:3,chatMsgs:10,vitrineHours:168}
  },
  { id:'pro', name:'PRO', price:14.99, period:'/mois', desc:'Pour les créateurs sérieux', recommended:true,
    features:['Publications illimitées','Chat mondial illimité','Vitrine 30j prioritaire','IA Boost illimité','Stats avancées','Badge Pro vérifié','Affiliation 30%'],
    limits:{pubsPerDay:999,chatMsgs:999,vitrineHours:720}
  },
  { id:'elite', name:'ELITE', price:39.99, period:'/mois', desc:'Pour dominer ton marché',
    features:['Tout du plan Pro','Vitrine permanente + épinglée','Badge Elite 🏆 doré sur actions','🏛️ Créer des groupes de discussion','Admin groupe complet','Signaler → transmis à admin','Message privé à l\'admin','Sessions coaching live','Commission 40%'],
    limits:{pubsPerDay:999,chatMsgs:999,vitrineHours:9999999}
  }
];


// ── SYSTÈME DE BADGES ──
const BADGES = [
  // ── PUBLICATIONS ──
  { id:'first_post',    emoji:'📝', name:'Première Pub',      desc:'Publie ton 1er post',             plan:null,    condition:u=>((u._postCount||0)>=1) },
  { id:'post5',         emoji:'🔥', name:'En Feu',            desc:'5 publications au total',          plan:null,    condition:u=>((u._postCount||0)>=5) },
  { id:'post20',        emoji:'💥', name:'Machine à Pub',     desc:'20 publications au total',         plan:null,    condition:u=>((u._postCount||0)>=20) },
  { id:'post50',        emoji:'🚀', name:'Rocket Publisher',  desc:'50 publications au total',         plan:null,    condition:u=>((u._postCount||0)>=50) },
  { id:'post100',       emoji:'💯', name:'Centenaire',        desc:'100 publications au total',        plan:'starter',condition:u=>((u._postCount||0)>=100) },
  { id:'post500',       emoji:'🌊', name:'Tsunami de Contenu',desc:'500 publications au total',        plan:'pro',   condition:u=>((u._postCount||0)>=500), special:true },
  // ── VOTES & POPULARITÉ ──
  { id:'first_vote',    emoji:'⚡', name:'Premier Vote',      desc:'Reçois ton 1er vote',             plan:null,    condition:u=>((u.totalVotes||0)>=1) },
  { id:'votes10',       emoji:'🎯', name:'Populaire',         desc:'10 votes reçus',                  plan:null,    condition:u=>((u.totalVotes||0)>=10) },
  { id:'votes50',       emoji:'🏅', name:'Influenceur',       desc:'50 votes reçus',                  plan:null,    condition:u=>((u.totalVotes||0)>=50) },
  { id:'votes100',      emoji:'🎖️', name:'Viral',             desc:'100 votes reçus',                 plan:'starter',condition:u=>((u.totalVotes||0)>=100) },
  { id:'votes500',      emoji:'🏆', name:'Phénomène',         desc:'500 votes reçus',                 plan:'pro',   condition:u=>((u.totalVotes||0)>=500), special:true },
  { id:'votes1000',     emoji:'💎', name:'Icon Viral',        desc:'1000 votes reçus',                plan:'elite', condition:u=>((u.totalVotes||0)>=1000), special:true },
  // ── PROFIL & RÉSEAU ──
  { id:'bio',           emoji:'✍️', name:'Profil Complet',   desc:'Ajoute ta bio',                   plan:null,    condition:u=>!!(u.bio&&u.bio.length>10) },
  { id:'profil_links',  emoji:'🔗', name:'Bien Connecté',    desc:'Ajoute 2 réseaux sociaux',         plan:null,    condition:u=>([u.tiktok,u.instagram,u.twitter,u.youtube,u.linkedin].filter(Boolean).length>=2) },
  { id:'profil_full',   emoji:'⭐', name:'Profil Gold',      desc:'Profil 100% complété',             plan:'starter',condition:u=>!!(u.bio&&u.name&&u.title&&u.location&&u.skills) },
  { id:'follow1',       emoji:'🤝', name:'Connecté',         desc:'Suis quelqu\'un',                  plan:null,    condition:u=>((u.following||[]).length>=1) },
  { id:'follow10',      emoji:'🌐', name:'Networker',        desc:'10 abonnements',                  plan:null,    condition:u=>((u.following||[]).length>=10) },
  { id:'follow50',      emoji:'🕸️', name:'Super Networker',  desc:'50 abonnements',                  plan:'starter',condition:u=>((u.following||[]).length>=50) },
  { id:'follow100',     emoji:'🌍', name:'Réseau Mondial',   desc:'100 abonnements',                 plan:'pro',   condition:u=>((u.following||[]).length>=100) },
  { id:'followers10',   emoji:'📣', name:'Leader d\'opinion',desc:'10 abonnés sur ton profil',        plan:null,    condition:u=>((u.followers||[]).length>=10) },
  { id:'followers50',   emoji:'📢', name:'Célébrité',        desc:'50 abonnés sur ton profil',        plan:'starter',condition:u=>((u.followers||[]).length>=50) },
  { id:'followers100',  emoji:'🌟', name:'Star VB',          desc:'100 abonnés sur ton profil',       plan:'pro',   condition:u=>((u.followers||[]).length>=100) },
  // ── MESSAGES & SOCIAL ──
  { id:'dm_king',       emoji:'💬', name:'DM King',          desc:'Envoie 5 messages privés',         plan:'starter',condition:u=>(['starter','pro','elite'].includes(u.plan)&&(u._dmCount||0)>=5) },
  { id:'dm_master',     emoji:'📨', name:'DM Master',        desc:'Envoie 50 messages privés',        plan:'pro',   condition:u=>((u._dmCount||0)>=50) },
  { id:'chat_pioneer',  emoji:'🗨️', name:'Pionnier du Chat', desc:'Envoie 20 messages dans le chat',  plan:null,    condition:u=>((u._chatCount||0)>=20) },
  { id:'chat_legend',   emoji:'🎙️', name:'Voix de la Comm.', desc:'Envoie 200 messages dans le chat', plan:'starter',condition:u=>((u._chatCount||0)>=200) },
  { id:'group_member',  emoji:'👥', name:'Membre Actif',     desc:'Rejoint 1 groupe',                 plan:null,    condition:u=>((u._groupCount||0)>=1) },
  { id:'group_chatter', emoji:'💭', name:'Grand Parleur',    desc:'50 messages dans des groupes',     plan:'starter',condition:u=>((u._groupMsgs||0)>=50) },
  // ── IA & STRATÉGIE ──
  { id:'ia_first',      emoji:'🤖', name:'IA Explorer',      desc:'Utilise IA Boost 1 fois',          plan:null,    condition:u=>((u._iaCount||0)>=1) },
  { id:'ia_master',     emoji:'🧠', name:'IA Master',        desc:'Utilise IA Boost 10 fois',         plan:'pro',   condition:u=>(['pro','elite'].includes(u.plan)&&(u._iaCount||0)>=10) },
  { id:'ia_addict',     emoji:'🔮', name:'IA Addict',        desc:'Utilise IA Boost 50 fois',         plan:'pro',   condition:u=>((u._iaCount||0)>=50), special:true },
  { id:'ab_test',       emoji:'🔬', name:'Expérimentateur',  desc:'Lance un A/B test IA',             plan:'pro',   condition:u=>((u._abTests||0)>=1) },
  // ── VITRINE & PROJETS ──
  { id:'first_vitrine', emoji:'✨', name:'En Vitrine',       desc:'Publie ton 1er projet en vitrine', plan:null,    condition:u=>((u._projectCount||0)>=1) },
  { id:'vitrine5',      emoji:'🖼️', name:'Galerie',          desc:'5 projets en vitrine',             plan:'starter',condition:u=>((u._projectCount||0)>=5) },
  { id:'vitrine10',     emoji:'🎭', name:'Portfolio Pro',    desc:'10 projets en vitrine',            plan:'pro',   condition:u=>((u._projectCount||0)>=10) },
  // ── CRÉDITS & SHOP ──
  { id:'credits50',     emoji:'⚡', name:'Chargé',           desc:'Accumule 50 ViralCrédits',         plan:null,    condition:u=>(userCredits>=50) },
  { id:'credits200',    emoji:'💸', name:'Rich Creator',     desc:'Accumule 200 ViralCrédits',        plan:'starter',condition:u=>(userCredits>=200) },
  { id:'credits1000',   emoji:'💰', name:'Millionnaire VB',  desc:'Accumule 1000 ViralCrédits',       plan:'pro',   condition:u=>(userCredits>=1000), special:true },
  { id:'shop_first',    emoji:'🛒', name:'Premier Achat',    desc:'Achète quelque chose en boutique', plan:null,    condition:u=>((u._shopBuys||0)>=1) },
  { id:'shop_power',    emoji:'🏪', name:'Gros Dépensier',   desc:'10 achats en boutique',            plan:'starter',condition:u=>((u._shopBuys||0)>=10) },
  // ── COLLABS & MATCHING ──
  { id:'first_collab',  emoji:'🤝', name:'Premier Collab',   desc:'Propose une collaboration',        plan:null,    condition:u=>((u._collabCount||0)>=1) },
  { id:'collab5',       emoji:'🏗️', name:'Bâtisseur',        desc:'5 collaborations proposées',       plan:'starter',condition:u=>((u._collabCount||0)>=5) },
  { id:'collab_master', emoji:'🌐', name:'Collab Master',    desc:'10 collaborations',                plan:'pro',   condition:u=>((u._collabCount||0)>=10), special:true },
  // ── RÉACTIONS ──
  { id:'first_react',   emoji:'😍', name:'Réactif',          desc:'Envoie 1 réaction enrichie',       plan:null,    condition:u=>((u._reactCount||0)>=1) },
  { id:'react50',       emoji:'🎉', name:'Exprès-sif',       desc:'50 réactions envoyées',            plan:null,    condition:u=>((u._reactCount||0)>=50) },
  { id:'react200',      emoji:'🎊', name:'Roi des Réactions',desc:'200 réactions envoyées',           plan:'starter',condition:u=>((u._reactCount||0)>=200) },
  // ── LIKES ──
  { id:'like10',        emoji:'❤️', name:'Cœur Généreux',   desc:'Aime 10 publications',             plan:null,    condition:u=>((u._likeCount||0)>=10) },
  { id:'like100',       emoji:'💝', name:'Fan Club',         desc:'100 likes donnés',                 plan:null,    condition:u=>((u._likeCount||0)>=100) },
  { id:'like500',       emoji:'💗', name:'Love Machine',     desc:'500 likes donnés',                 plan:'starter',condition:u=>((u._likeCount||0)>=500) },
  // ── COMMENTAIRES ──
  { id:'comment5',      emoji:'💡', name:'Commentateur',     desc:'Laisse 5 commentaires',            plan:null,    condition:u=>((u._commentCount||0)>=5) },
  { id:'comment20',     emoji:'📢', name:'Voix Active',      desc:'20 commentaires laissés',          plan:'starter',condition:u=>((u._commentCount||0)>=20) },
  // ── PARTAGES ──
  { id:'share5',        emoji:'📤', name:'Partageur',        desc:'Partage 5 publications',           plan:null,    condition:u=>((u._shareCount||0)>=5) },
  { id:'share20',       emoji:'📡', name:'Ambassadeur',      desc:'Partage 20 publications',          plan:'starter',condition:u=>((u._shareCount||0)>=20) },
  // ── ANCIENNETÉ ──
  { id:'early',         emoji:'🌱', name:'Pionnier',         desc:'Membre fondateur 2025-2026',       plan:null,    condition:u=>!!(u.createdAt&&new Date(u.createdAt)<new Date('2026-06-01')) },
  { id:'week1',         emoji:'📅', name:'1 Semaine',        desc:'Membre depuis 7 jours',            plan:null,    condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=7*86400000) },
  { id:'month1',        emoji:'🗓️', name:'1 Mois',           desc:'Membre depuis 30 jours',           plan:null,    condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=30*86400000) },
  { id:'month6',        emoji:'🎂', name:'6 Mois',           desc:'Membre depuis 6 mois',             plan:'starter',condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=180*86400000) },
  { id:'year1',         emoji:'🎆', name:'1 An',             desc:'Membre depuis 1 an',               plan:'pro',   condition:u=>!!(u.createdAt&&(Date.now()-new Date(u.createdAt).getTime())>=365*86400000), special:true },
  // ── MISSIONS ──
  { id:'mission5',      emoji:'🎯', name:'Chasseur de Missions',desc:'Complete 5 missions',           plan:null,    condition:u=>((u._missionsCompleted||0)>=5) },
  { id:'mission20',     emoji:'🏹', name:'Mission Impossible',  desc:'Complete 20 missions',          plan:'starter',condition:u=>((u._missionsCompleted||0)>=20) },
  { id:'streak3',       emoji:'🔑', name:'Régulier',         desc:'Connexion 3 jours d\'affilée',     plan:null,    condition:u=>((u._loginStreak||0)>=3) },
  { id:'streak7',       emoji:'🔑', name:'Discipline',       desc:'Connexion 7 jours d\'affilée',     plan:'starter',condition:u=>((u._loginStreak||0)>=7) },
  { id:'streak30',      emoji:'🏋️', name:'Athlète du Contenu',desc:'30 jours de connexion consécutifs',plan:'pro',  condition:u=>((u._loginStreak||0)>=30), special:true },
  // ── PLANS ──
  { id:'starter_badge', emoji:'🟢', name:'Starter',          desc:'Plan Starter activé',             plan:'starter',condition:u=>['starter','pro','elite'].includes(u.plan) },
  { id:'pro_badge',     emoji:'✅', name:'PRO Vérifié',      desc:'Plan Pro activé',                  plan:'pro',   condition:u=>['pro','elite'].includes(u.plan) },
  { id:'affiliate',     emoji:'💰', name:'Affilié',          desc:'Pro + programme affiliation',      plan:'pro',   condition:u=>(['pro','elite'].includes(u.plan)) },
  { id:'elite_badge',   emoji:'🏆', name:'ELITE',            desc:'Plan Elite activé',                plan:'elite', condition:u=>(u.plan==='elite') },
  { id:'group_founder', emoji:'🏛️', name:'Fondateur',        desc:'Crée un groupe (Elite)',           plan:'elite', condition:u=>(u.plan==='elite'&&(u._groupCount||0)>=1) },
  { id:'legend',        emoji:'👑', name:'LÉGENDE',          desc:'Elite + 100 votes + 20 pubs',      plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=100&&(u._postCount||0)>=20), special:true },
  { id:'king',          emoji:'💎', name:'DIAMOND KING',     desc:'Elite + 200 votes au top',         plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=200), special:true },
  { id:'god',           emoji:'🌌', name:'VIRAL GOD',        desc:'Elite + 1000 votes + 500 pubs',    plan:'elite', condition:u=>(u.plan==='elite'&&(u.totalVotes||0)>=1000&&(u._postCount||0)>=500), special:true },
  // ── CRÉDITS UTILISÉS POUR PLANS ──
  { id:'plan_credits',  emoji:'🪙', name:'Acheteur Malin',   desc:'Achète un plan avec des crédits',  plan:null,    condition:u=>((u._planBoughtWithCredits||0)>=1), special:false },
];

function getUserBadges(u){
  return BADGES.map(b=>({...b, unlocked: b.condition(u)}));
}

function renderBadges(u){
  const badges = getUserBadges(u);
  const unlocked = badges.filter(b=>b.unlocked).length;
  return `
  <div class="badges-section">
    <h3>🏅 MES BADGES <span style="font-size:10px;color:var(--muted);font-weight:400">${unlocked}/${badges.length} débloqués</span></h3>
    <div class="badges-grid">
      ${badges.map(b=>{
        const bonus = BADGE_CREDITS[b.id]||5;
        return `<div class="badge-item ${b.unlocked?'unlocked':'locked'} ${b.special?'special':''}">
          ${!b.unlocked?'<span class="badge-lock-icon">🔒</span>':''}
          <div class="badge-emoji">${b.emoji}</div>
          <div class="badge-name">${b.name}</div>
          ${b.plan?`<div class="badge-plan-tag badge-plan-${b.plan}">${b.plan.toUpperCase()}</div>`:''}
          <div class="badge-reward">+${bonus}⚡</div>
          <div class="badge-tooltip">${b.desc} · +${bonus} crédits</div>
        </div>`;
      }).join('')}
    </div>
  </div>`;
}


let worldChatMsgs=[],dmTarget=null,dmThreads={},ws=null,wsRetries=0;
let myVotes=new Set(JSON.parse(localStorage.getItem('vb_votes')||'[]'));
let posts=[],selectedSignupPlan='free';
let groupsData=[];
let currentGroupId=null;
let pendingMediaUrl=null, pendingLandingMediaUrl=null, pendingPubMediaUrl=null;
let reportTarget=null;
let currentGroupSettingsId=null;
let groupBgUrl=null, groupSettingsBgUrl=null;

// Crédits offerts par badge
const BADGE_CREDITS = {
  first_post:5, post5:10, post20:20, post50:35, post100:60, post500:150,
  first_vote:5, votes10:15, votes50:30, votes100:50, votes500:100, votes1000:200,
  bio:10, profil_links:12, profil_full:25,
  follow1:5, follow10:15, follow50:30, follow100:50,
  followers10:15, followers50:35, followers100:60,
  dm_king:15, dm_master:40,
  chat_pioneer:10, chat_legend:30,
  group_member:10, group_chatter:25,
  ia_first:10, ia_master:30, ia_addict:75, ab_test:20,
  first_vitrine:12, vitrine5:25, vitrine10:50,
  credits50:15, credits200:30, credits1000:100,
  shop_first:10, shop_power:30,
  first_collab:15, collab5:35, collab_master:80,
  first_react:5, react50:20, react200:50,
  like10:8, like100:25, like500:60,
  comment5:10, comment20:30,
  share5:10, share20:30,
  early:20, week1:10, month1:25, month6:60, year1:150,
  mission5:20, mission20:60,
  streak3:15, streak7:35, streak30:100,
  starter_badge:20, pro_badge:50, affiliate:25,
  elite_badge:100, group_founder:40, legend:150, king:200, god:500,
  plan_credits:30,
};

function checkNewBadges(){
  if(!currentUser) return;
  const saved = JSON.parse(localStorage.getItem('vb_earned_badges')||'[]');
  const savedSet = new Set(saved);
  const nowUnlocked = BADGES.filter(b => b.condition(currentUser)).map(b=>b.id);
  const newOnes = nowUnlocked.filter(id => !savedSet.has(id));
  if(newOnes.length){
    newOnes.forEach(id=>{
      const b = BADGES.find(x=>x.id===id);
      const bonus = BADGE_CREDITS[id]||5;
      if(b){
        setTimeout(()=>{
          addCredits(bonus);
          toast(`${b.emoji} Badge débloqué : ${b.name} ! +${bonus}⚡`);
        }, 300);
        savedSet.add(id);
      }
    });
    localStorage.setItem('vb_earned_badges', JSON.stringify([...savedSet]));
  }
}

// ── TOAST ──
function toast(msg,type='success'){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className='toast-g'+(type==='success'?' success':'');
  t.textContent=msg;
  c.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(50px)';t.style.transition='all 0.3s';setTimeout(()=>t.remove(),300);},3000);
}

// ── PLANS RENDER ──
function renderPlans(){
  // Landing plans grid
  const g=document.getElementById('landing-plans');
  if(g) g.innerHTML=PLANS.map(p=>`
    <div class="plan-card ${p.recommended?'recommended':''}">
      ${p.recommended?'<div class="plan-badge">⭐ POPULAIRE</div>':''}
      <div class="plan-name">${p.name}</div>
      <div class="plan-price">${p.price===0?'0':''+p.price+'€'}</div>
      <div class="plan-period">${p.price===0?'Gratuit':p.period}</div>
      <div class="plan-desc">${p.desc}</div>
      <ul class="plan-features">${p.features.map(f=>`<li>${f}</li>`).join('')}</ul>
      <button class="btn-plan-g ${p.recommended?'btn-plan-solid-g':'btn-plan-outline-g'}" onclick="${p.price===0?`openModal('signup-modal')`:`startPayment('${p.id}')`}">${p.price===0?'Commencer gratuitement':'Choisir '+p.name+' →'}</button>
    </div>`).join('');

  // Signup plans
  const sg=document.getElementById('signup-plans-grid');
  if(sg) sg.innerHTML=PLANS.map(p=>`
    <div class="sp-card ${p.id==='free'?'selected':''}" onclick="selectSignupPlan(this,'${p.id}')">
      <div class="sp-plan">${p.name}</div>
      <div class="sp-price">${p.price===0?'0€':p.price+'€'}</div>
      <div class="sp-per">${p.price===0?'Gratuit':p.period}</div>
      <div class="sp-feat">${p.features.slice(0,2).join('<br>')}</div>
    </div>`).join('');
}

function selectSignupPlan(el,planId){
  document.querySelectorAll('#signup-plans-grid .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedSignupPlan=planId;
}

// ── VITRINE DATA & RENDER ──
// Pas de projets fictifs — uniquement les vraies publications des vrais utilisateurs
let vitrineData=[];

function openProjectModal(id){
  const p=vitrineData.find(p=>p.id===id);
  if(!p)return;
  const overlay=document.getElementById('project-modal-overlay');
  const box=document.getElementById('project-modal-content');
  if(!overlay||!box)return;
  const avatarColor=getAvatarColor(p.authorId||p.author);
  box.innerHTML=`
    <div class="pmo-banner" style="background:${p.color||'var(--s2)'}">
      ${p.mediaUrl?`<img src="${p.mediaUrl}"/>`:''}
      <span style="position:relative;z-index:1">${p.emoji||'🚀'}</span>
      <button class="pmo-close" onclick="closeProjectModal()">✕</button>
    </div>
    <div class="pmo-body">
      <div class="pmo-cat">${p.type||p.cat||''}</div>
      <div class="pmo-name">${p.name}</div>
      ${p.hook?`<div class="pmo-hook">${p.hook}</div>`:''}
      <div class="pmo-desc">${p.desc||''}</div>
      ${p.tags&&p.tags.length?`<div class="pmo-tags">${p.tags.map(t=>`<span class="pmo-tag">#${t}</span>`).join('')}</div>`:''}
      ${p.url?`<a class="pmo-url" href="${p.url}" target="_blank" rel="noopener noreferrer">
        <span>🔗</span><span>${p.url.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span><span style="color:var(--g3)">↗</span>
      </a>`:''}
      <div class="pmo-footer">
        <div class="pmo-author">
          <div class="pmo-ava" style="background:${avatarColor}">${(p.author||'?')[0]}</div>
          <span>${p.author||'Anonyme'}</span>
          <span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span>
        </div>
        <div class="pmo-actions">
          <button class="pmo-btn ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this);this.querySelector('span').textContent=document.querySelector('[data-pid=\'${p.id}\'] .vote-count')?.textContent||'0'">
            ▲ <span>${p.votes||0}</span>
          </button>
          <button class="pmo-btn pmo-btn-dm" onclick="closeProjectModal();openDMToUser('${p.authorId}','${p.author}')">💬 DM</button>
        </div>
      </div>
    </div>`;
  overlay.classList.remove('hidden');
  document.body.style.overflow='hidden';
}
function closeProjectModal(){
  document.getElementById('project-modal-overlay')?.classList.add('hidden');
  document.body.style.overflow='';
}

function buildVitrineGrid(containerId,filter='all'){
  const el=document.getElementById(containerId);
  if(!el)return;
  const data=filter==='all'?vitrineData:vitrineData.filter(p=>p.cat===filter);
  if(!data.length){el.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:48px;color:var(--muted)">'+t('vit_empty')+'</div>';return;}
  el.innerHTML=data.map(p=>`
    <div class="v-card" data-pid="${p.id}" onclick="openProjectModal('${p.id}')">
      ${p.badge?`<div class="v-banner" style="background:${p.color}">${p.emoji}<div class="v-badge">${p.badge}</div></div>`:`<div class="v-banner" style="background:${p.color}">${p.emoji}</div>`}
      <div class="v-body">
        <div class="v-cat">${p.type}</div>
        <div class="v-name">${p.name}</div>
        <div class="v-desc">${p.desc}</div>
        ${p.url?`<a class="v-url-link" href="${p.url}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation()">
          <span>🔗</span><span class="v-url-text">${p.url.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span><span style="font-size:11px">↗</span>
        </a>`:''}
        <div class="v-footer">
          <div class="v-author"><div class="v-ava">${p.author[0]}</div>${p.author}</div>
          <div class="v-actions">
            <button class="btn-vote-g ${myVotes.has(p.id)?'voted':''}" onclick="voteProject(event,'${p.id}',this)">▲ <span class="vote-count">${p.votes}</span></button>
            <button class="btn-dm-small" onclick="openDMToUser('${p.authorId}','${p.author}')" title="Envoyer un DM">💬</button>
          </div>
        </div>
      </div>
    </div>`).join('');
}

function filterLandingVitrine(el,filter){
  document.querySelectorAll('#vitrine .filters-row .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildVitrineGrid('landing-vitrine-grid',filter);
}
function filterAppVitrine(el,filter){
  document.querySelectorAll('#tab-vitrine .f-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildVitrineGrid('app-vitrine-grid',filter);
}

async function voteProject(e,id,btn){
  e.stopPropagation();
  if(!currentUser){openModal('login-modal');return;}
  if(myVotes.has(id)){toast('Tu as déjà voté !');return;}
  btn.classList.add('voted');
  const cnt=btn.querySelector('.vote-count');
  const proj=vitrineData.find(p=>p.id===id);
  if(proj)proj.votes++;
  if(cnt)cnt.textContent=(parseInt(cnt.textContent)||0)+1;
  myVotes.add(id);
  localStorage.setItem('vb_votes',JSON.stringify([...myVotes]));
  toast('👍 Vote comptabilisé !');
  // sync API
  try{await fetch('/api/projects/'+id+'/vote',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser.email})});}catch(e){}
}

// Pas de posts fictifs — uniquement les vraies publications
const samplePosts=[];
let feedPosts=[];

// Charge le feed depuis l'API au démarrage
// Fetch avec timeout pour éviter les blocages si le serveur ne répond pas
function fetchWithTimeout(url,opts={},ms=4000){
  const ctrl=new AbortController();
  const tid=setTimeout(()=>ctrl.abort(),ms);
  return fetch(url,{...opts,signal:ctrl.signal}).finally(()=>clearTimeout(tid));
}

async function loadPostsFromAPI(){
  try{
    const r=await fetchWithTimeout('/api/posts');
    const apiPosts=await r.json();
    if(Array.isArray(apiPosts)) feedPosts=apiPosts;
  }catch(e){}
  buildFeed();
}

function buildFeed(filter='all'){
  const el=document.getElementById('feed-list');
  if(!el)return;
  let data=[...feedPosts];
  if(filter==='following')data=data.filter(p=>currentUser?.following?.includes(p.userId)||p.userId===currentUser?.id);
  if(filter==='top')data=data.sort((a,b)=>b.likes-a.likes);
  if(!data.length){el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted)">'+t('no_posts')+'</div>';return;}
  el.innerHTML=data.map(p=>{
    const plan=PLANS.find(pl=>pl.id===p.plan)||PLANS[0];
    const isMe=p.userId===currentUser?.email;
    const isElite=(p.plan||'free')==='elite';
    const timerHtml=p.timerEnd?`<span class="post-timer">⏱ <span class="post-timer-val" data-end="${p.timerEnd}">--:--</span></span>`:'';
    const actionClass=isElite?'btn-action elite-action':'btn-action';
    const likedByMe=p.myLike;
    const mediaHtml=p.mediaUrl?`${p.mediaType&&p.mediaType.startsWith('video')?`<video class="post-media-video" controls src="${p.mediaUrl}"></video>`:`<img class="post-media" src="${p.mediaUrl}" alt="media" onclick="window.open('${p.mediaUrl}','_blank')" style="cursor:zoom-in"/>`}`:'';
    return `
    <div class="post-card" id="post-${p.id}" data-pid="${p.id}">
      <div class="post-header">
        <div class="post-ava" style="background:${getAvatarColor(p.userId)}" onclick="viewUserProfile('${p.userId}')">${p.emoji||p.author[0]}</div>
        <div class="post-meta">
          <div class="post-author" onclick="viewUserProfile('${p.userId}')">${isElite?'<span class="badge-elite-gold">🏆</span> ':''} ${p.author}</div>
          <div class="post-info"><span class="chat-msg-plan-badge plan-${p.plan||'free'}">${(p.plan||'FREE').toUpperCase()}</span> · ${p.time} ${timerHtml}</div>
        </div>
        ${!isMe?`<button class="btn-dm-small" onclick="openDMToUser('${p.userId}','${p.author}')" title="DM">💬</button>`:''}
        <button class="btn-report" onclick="openReport('${p.userId}','${p.author}')" title="Signaler">⚑</button>
      </div>
      <div class="post-content">${escHtml(p.text)}</div>
      ${mediaHtml}
      ${p.postUrl?`<a class="post-url-card" href="${p.postUrl}" target="_blank" rel="noopener noreferrer">
        <span class="post-url-icon">🔗</span>
        <span class="post-url-text">${p.postUrl.replace(/^https?:\/\//,'').replace(/\/$/,'')}</span>
        <span class="post-url-arrow">↗</span>
      </a>`:''}
      ${p.projName?`<div class="post-project" onclick="void(0)">
        <div class="post-proj-icon">${p.projEmoji||'🚀'}</div>
        <div><div class="post-proj-name">${p.projName}</div><div class="post-proj-cat">${p.projType||'pub'}</div>${p.projDesc?`<div class="post-proj-desc">${p.projDesc}</div>`:''}</div>
      </div>`:''}
      <div class="post-actions">
        <button class="${actionClass} ${likedByMe?'active':''}" onclick="likePost('${p.id}',this)">❤️ <span class="like-count">${p.likes||0}</span></button>
        <button class="${actionClass}" onclick="openComments('${p.id}')">💬 <span class="comment-count">${p.comments||0}</span></button>
        <button class="${actionClass}" onclick="sharePost('${p.id}',this)">🔗 <span class="share-count">${p.shares||0}</span></button>
        ${isMe?`<button class="${actionClass}" onclick="deletePost('${p.id}')" style="margin-left:auto;color:#f87171">🗑</button>`:''}
      </div>
      <div class="reactions-row">
        ${buildReactionsHTML(p)}
      </div>
    </div>`;
  }).join('');
  updateTimers();
}

function switchFeed(filter,el){
  document.querySelectorAll('.feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFeed(filter);
}

async function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  btn.classList.toggle('active');
  const cnt=btn.querySelector('.like-count');
  if(cnt)cnt.textContent=p.likes;
  if(p.myLike && currentUser){
    currentUser._todayLikes=(currentUser._todayLikes||0)+1;
    localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  }
  try{fetch('/api/posts/'+id+'/like',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:currentUser?.email||'anon'})});}catch(e){}
}

async function sharePost(id,btn){
  navigator.clipboard.writeText(window.location.origin+'#post-'+id).then(()=>toast('🔗 Lien copié !'));
  const p=feedPosts.find(p=>p.id===id);
  if(p){p.shares=(p.shares||0)+1;const cnt=btn?.querySelector('.share-count');if(cnt)cnt.textContent=p.shares;}
  try{fetch('/api/posts/'+id+'/share',{method:'POST'});}catch(e){}
}

function openComments(id){
  toast('💬 Commentaires — bientôt disponible !');
}

function deletePost(id){
  feedPosts=feedPosts.filter(p=>p.id!==id);
  document.getElementById('post-'+id)?.remove();
}

// ── SYSTÈME DE RÉACTIONS ──
const REACTIONS_FREE = [
  {type:'fire',   emoji:'🔥', label:'Feu',     color:'#f97316'},
  {type:'bulb',   emoji:'💡', label:'Idée',    color:'#facc15'},
  {type:'money',  emoji:'💸', label:'Cash',    color:'#4ade80'},
  {type:'clap',   emoji:'👏', label:'Bravo',   color:'#fb923c'},
];
const REACTIONS_PREMIUM = [
  {type:'rocket', emoji:'🚀', label:'Décollage', color:'#818cf8', plan:'starter'},
  {type:'crown',  emoji:'👑', label:'Roi',      color:'#ffd700', plan:'pro'},
  {type:'gem',    emoji:'💎', label:'Gem',      color:'#22d3ee', plan:'pro'},
  {type:'eyes',   emoji:'👀', label:'Je regarde', color:'#a78bfa', plan:'elite'},
  {type:'zap',    emoji:'⚡', label:'Boost',   color:'#86efac', plan:'starter'},
  {type:'star',   emoji:'🌟', label:'Star',    color:'#ffd700', plan:'elite'},
];
const ALL_REACTIONS = [...REACTIONS_FREE, ...REACTIONS_PREMIUM];

function buildReactionsHTML(p){
  if(!p.reactions) p.reactions = {};
  const plan = currentUser?.plan||'free';
  const planOrder = {free:0, starter:1, pro:2, elite:3};
  const userLevel = planOrder[plan]||0;

  return ALL_REACTIONS.map(r => {
    const count = p.reactions[r.type]||0;
    const active = p['myReact_'+r.type] ? 'active-'+r.type : '';
    const isPremium = REACTIONS_PREMIUM.find(x=>x.type===r.type);
    const reqLevel = isPremium ? planOrder[isPremium.plan]||0 : 0;
    const locked = isPremium && userLevel < reqLevel;
    if(locked){
      return `<button class="react-btn premium-lock" onclick="reactLocked('${isPremium.plan}')">
        ${r.emoji} ${count>0?`<span class="react-count" style="color:var(--muted)">${count}</span>`:''}
        <span class="react-premium-tip">${r.label} · ${isPremium.plan.toUpperCase()} requis</span>
      </button>`;
    }
    return `<button class="react-btn ${active}" onclick="toggleReaction('${p.id}','${r.type}',this)" style="${active?'border-color:'+r.color+';color:'+r.color:''}">
      ${r.emoji} <span class="react-count">${count||0}</span>
    </button>`;
  }).join('');
}

function toggleReaction(postId, type, btn){
  const p = feedPosts.find(x=>x.id===postId);
  if(!p) return;
  if(!p.reactions) p.reactions = {};
  const key = 'myReact_'+type;
  const was = p[key];
  p[key] = !was;
  p.reactions[type] = Math.max(0,(p.reactions[type]||0)+(was?-1:1));
  const r = ALL_REACTIONS.find(x=>x.type===type);
  const activeClass = 'active-'+type;
  btn.classList.toggle(activeClass, !was);
  if(!was){ btn.style.borderColor=r?.color||''; btn.style.color=r?.color||''; }
  else { btn.style.borderColor=''; btn.style.color=''; }
  btn.querySelector('.react-count').textContent = p.reactions[type]||0;
  if(!was && currentUser){
    currentUser._todayReacts = (currentUser._todayReacts||0)+1;
    localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  }
}

function reactLocked(plan){
  toast(`🔒 Réaction ${plan.toUpperCase()} — Upgrade pour débloquer !`, 'error');
  setTimeout(()=>openModal('pricing-modal'),800);
}

// ── MEDIA UPLOAD ──
async function handleMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('feed-media-preview');
  preview.style.display='block';
  preview.innerHTML='<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd=new FormData();
  fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingMediaUrl=d.url;
    const isVideo=file.type.startsWith('video');
    preview.innerHTML=`<div class="media-preview-item">${isVideo?`<video src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px"></video>`:`<img src="${d.url}" style="max-width:100px;max-height:70px;border-radius:4px;object-fit:cover"/>`} <span style="flex:1">${file.name}</span> <span class="remove-media" onclick="pendingMediaUrl=null;document.getElementById('feed-media-preview').innerHTML='';document.getElementById('feed-media-preview').style.display='none'">✕</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';pendingMediaUrl=null;}
}

async function handleLandingMediaUpload(input){
  const file=input.files[0];
  if(!file)return;
  const preview=document.getElementById('pl-media-preview');
  preview.innerHTML='<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    pendingLandingMediaUrl=d.url;
    preview.innerHTML=`<div class="media-preview-item"><img src="${d.url}" style="max-width:100px;max-height:60px;border-radius:4px;object-fit:cover"/> <span style="flex:1">${file.name}</span></div>`;
  }catch(e){preview.innerHTML='<div class="media-preview-item" style="color:#f87171">Erreur upload</div>';}
}

async function handleGroupBgUpload(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupBgUrl=d.url;document.getElementById('grp-bg-preview').innerHTML=`<img src="${d.url}" style="width:100%;height:80px;object-fit:cover;border-radius:6px;margin-top:6px"/>`;}catch(e){}
}

async function handleGroupSettingsBg(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();groupSettingsBgUrl=d.url;}catch(e){}
}

async function handleGroupChatFile(input){
  const file=input.files[0];if(!file)return;
  const fd=new FormData();fd.append('file',file);
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});
    const d=await r.json();
    // Send as message with media
    const msg={text:'',mediaUrl:d.url,mediaType:file.type,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
    await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});
    loadGroupMessages(currentGroupId);
  }catch(e){}
}

// ── PUBLISH LANDING AD (avant compte) ──
async function publishLandingAd(){
  const title=document.getElementById('pl-title').value.trim();
  const text=document.getElementById('pl-text').value.trim();
  if(!title||!text){toast('Remplis le titre et le message.');return;}
  const type=document.getElementById('pl-type').value;
  const url=document.getElementById('pl-url').value.trim();
  const post={
    id:'p'+Date.now(),userId:'landing_'+Date.now(),author:'Visiteur',
    emoji:'📢',plan:'free',text:title+'\n\n'+text,projName:title,projType:type,
    projEmoji:getTypeEmoji(type),projDesc:text.slice(0,80),projUrl:url,
    mediaUrl:pendingLandingMediaUrl,mediaType:pendingLandingMediaUrl?.match(/\.(mp4|webm|mov)/i)?'video/mp4':'image/jpeg',
    time:'À l\'instant',likes:0,comments:0,shares:0,timerEnd:Date.now()+3600000
  };
  feedPosts.unshift(post);
  pendingLandingMediaUrl=null;
  closeModal('publish-landing-modal');
  try{await fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  toast('📢 Publicité publiée ! Crée un compte pour gérer tes pubs.');
  setTimeout(()=>openModal('signup-modal'),2000);
}

function openPublishLanding(){
  document.getElementById('pl-title').value='';
  document.getElementById('pl-text').value='';
  document.getElementById('pl-media-preview').innerHTML='';
  pendingLandingMediaUrl=null;
  openModal('publish-landing-modal');
}

// ── PUBLISH POST ──
let pubHourCount=0, pubHourReset=0;
function toggleUrlField(){
  const wrap=document.getElementById('pub-url-wrap');
  const trigger=document.getElementById('pub-url-trigger');
  if(wrap){wrap.style.display='block';if(trigger)trigger.style.display='none';document.getElementById('feed-url')?.focus();}
}
function closeUrlField(){
  const wrap=document.getElementById('pub-url-wrap');
  const trigger=document.getElementById('pub-url-trigger');
  if(wrap){wrap.style.display='none';const inp=document.getElementById('feed-url');if(inp)inp.value='';}
  if(trigger)trigger.style.display='inline-flex';
}

function selectPubType(el, type){
  document.querySelectorAll('.pub-type-pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  const sel=document.getElementById('feed-proj-type');
  if(sel) sel.value=type;
  const projWrap=document.getElementById('pub-proj-wrap');
  if(projWrap) projWrap.style.display=(type&&type!=='')?'block':'none';
}
function updateCharCount(el){
  const count=el.value.length;
  const display=document.getElementById('pub-char-count');
  if(display){
    display.style.opacity=count>0?'1':'0';
    display.textContent=count+'/500';
    display.style.color=count>450?'#f87171':count>350?'var(--gold)':'var(--muted2)';
  }
}
function autoGrowTA(el){
  el.style.height='auto';
  el.style.height=el.scrollHeight+'px';
}
// Afficher les pills au focus sur la textarea
document.addEventListener('DOMContentLoaded',function(){
  const ta=document.getElementById('feed-text');
  const row=document.getElementById('pub-type-row');
  if(ta&&row){
    ta.addEventListener('focus',function(){row.classList.add('visible');});
  }
});

function publishPost(){
  if(!currentUser){openModal('login-modal');return;}
  const text=document.getElementById('feed-text')?.value.trim()||'';
  if(!text){toast(t('toast_write'));return;}

  // Check limits
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const now=Date.now();
  if(currentUser.plan==='free'){
    if(now-pubHourReset>3600000){pubHourCount=0;pubHourReset=now;}
    if(pubHourCount>=1){toast(t('toast_limit_free'));return;}
  } else if(plan.limits.pubsPerDay){
    const today=new Date().toDateString();
    const key='vb_pubs_'+today;
    const count=parseInt(localStorage.getItem(key)||'0');
    if(count>=plan.limits.pubsPerDay){toast(t('toast_limit_day'));return;}
    localStorage.setItem(key,count+1);
  }

  const projName=document.getElementById('feed-proj-name')?.value.trim()||'';
  const projType=document.getElementById('feed-proj-type')?.value||'';
  let postUrl=document.getElementById('feed-url')?.value.trim()||'';
  // Ajouter https:// si manquant
  if(postUrl && !postUrl.startsWith('http')) postUrl='https://'+postUrl;
  const timerEnd=currentUser.plan==='free'?Date.now()+3600000:null;

  const post={
    id:'p'+Date.now(),userId:currentUser.email,author:currentUser.name,
    emoji:currentUser.avatar||'🙂',plan:currentUser.plan||'free',
    text,projName,projType,projEmoji:getTypeEmoji(projType),projDesc:'',
    postUrl,
    mediaUrl:pendingMediaUrl,mediaType:pendingMediaUrl?'image':'',
    time:'À l\'instant',likes:0,comments:0,shares:0,myLike:false,timerEnd
  };
  feedPosts.unshift(post);
  pubHourCount++;
  // Tracker pour badges
  currentUser._postCount = (currentUser._postCount||0) + 1;
  currentUser._todayPosts = (currentUser._todayPosts||0) + 1;
  // Tracker médias pour missions
  if(pendingMediaUrl){
    const isVideo = post.mediaType && post.mediaType.startsWith('video');
    const isFile = pendingMediaUrl && /\.(pdf|doc|docx|zip|txt|ppt|xls)/i.test(pendingMediaUrl);
    if(isVideo) currentUser._todayVideoPosts = (currentUser._todayVideoPosts||0)+1;
    else if(isFile) currentUser._todayFilePosts = (currentUser._todayFilePosts||0)+1;
    else currentUser._todayMediaPosts = (currentUser._todayMediaPosts||0)+1;
  }
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();
  pendingMediaUrl=null;
  if(document.getElementById('feed-text')) document.getElementById('feed-text').value='';
  if(document.getElementById('feed-proj-name')) document.getElementById('feed-proj-name').value='';
  closeUrlField();
  document.getElementById('feed-media-preview').innerHTML='';
  document.getElementById('feed-media-preview').style.display='none';
  buildFeed();
  toast(t('toast_published'));
  // Sync API
  try{fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(post)});}catch(e){}
  if(timerEnd)setTimeout(()=>{feedPosts=feedPosts.filter(p=>p.id!==post.id);buildFeed();},3600000);
}

async function handlePubMediaUpload(input){
  const file = input.files[0]; if(!file) return;
  const preview = document.getElementById('pub-media-preview');
  preview.innerHTML = '<div class="media-preview-item">⏳ Upload en cours...</div>';
  const fd = new FormData(); fd.append('file', file);
  try{
    const r = await fetch('/api/upload',{method:'POST',body:fd});
    const d = await r.json(); pendingPubMediaUrl = d.url;
    // Mettre à jour l'aperçu vitrine avec l'image
    const imgWrap = document.getElementById('pub-preview-img-wrap');
    const imgEl = document.getElementById('pub-preview-img');
    if(imgWrap && imgEl){ imgEl.src = d.url; imgWrap.style.display = 'block'; }
    preview.innerHTML = `<div class="media-preview-item" style="display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:8px 12px">
      <img src="${d.url}" style="width:48px;height:36px;border-radius:4px;object-fit:cover"/>
      <span style="font-size:12px;color:var(--g4)">✅ ${file.name.slice(0,30)}</span>
      <button onclick="removePubMedia()" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px">✕</button>
    </div>`;
    updatePubCompletion();
  }catch(e){
    // Fallback local preview si pas de backend
    const url = URL.createObjectURL(file); pendingPubMediaUrl = url;
    const imgWrap = document.getElementById('pub-preview-img-wrap');
    const imgEl = document.getElementById('pub-preview-img');
    if(imgWrap && imgEl){ imgEl.src = url; imgWrap.style.display = 'block'; }
    preview.innerHTML = `<div class="media-preview-item" style="display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:8px 12px">
      <img src="${url}" style="width:48px;height:36px;border-radius:4px;object-fit:cover"/>
      <span style="font-size:12px;color:var(--g4)">📎 ${file.name.slice(0,30)}</span>
      <button onclick="removePubMedia()" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px">✕</button>
    </div>`;
    updatePubCompletion();
  }
  // Rendre la zone de drop cliquable
  document.getElementById('pub-media-drop')?.addEventListener('click', ()=>document.getElementById('pub-media-input')?.click());
}
function removePubMedia(){
  pendingPubMediaUrl = null;
  document.getElementById('pub-media-preview').innerHTML = '';
  const imgWrap = document.getElementById('pub-preview-img-wrap');
  if(imgWrap) imgWrap.style.display = 'none';
  updatePubCompletion();
}

// ── PUBLISH PROJECT ──
function publishProject(){
  if(!currentUser){openModal('login-modal');return;}
  const name = document.getElementById('pub-name')?.value.trim()||'';
  const desc = document.getElementById('pub-desc')?.value.trim()||'';
  if(!name || !desc){ toast('Remplis au minimum le nom et la description.', 'error'); return; }
  if(name.length < 4){ toast('Le nom est trop court (4 caractères min).', 'error'); return; }
  if(desc.length < 20){ toast('La description est trop courte (20 caractères min).', 'error'); return; }

  const type = document.getElementById('pub-type')?.value||'';
  const emoji = document.getElementById('pub-emoji')?.value || getTypeEmoji(type);
  const url = document.getElementById('pub-url')?.value.trim() || '';
  const target = document.getElementById('pub-target')?.value.trim() || '';
  const hook = document.getElementById('pub-hook')?.value.trim() || '';
  const tags = (document.getElementById('pub-tags')?.value || '').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const stage = document.getElementById('pub-stage')?.value || '';
  const collabNeed = document.getElementById('pub-collab-need')?.value || '';
  const plan = PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const colors = ['linear-gradient(135deg,#15803d,#22c55e)','linear-gradient(135deg,#166534,#4ade80)','linear-gradient(135deg,#14532d,#86efac)'];

  const proj = {
    id:'pub'+Date.now(), name, cat:type, type:typeName(type),
    desc: desc.slice(0,300), hook, emoji, url, target, tags, stage, collabNeed,
    color: colors[Math.floor(Math.random()*colors.length)],
    author: currentUser.name, authorId: currentUser.email,
    plan: currentUser.plan || 'free',
    votes: 0, mediaUrl: pendingPubMediaUrl,
    timerEnd: plan.limits.vitrineHours < 999999 ? Date.now() + plan.limits.vitrineHours*3600000 : null,
    createdAt: Date.now()
  };

  pendingPubMediaUrl = null;
  document.getElementById('pub-media-preview').innerHTML = '';
  const imgWrap = document.getElementById('pub-preview-img-wrap');
  if(imgWrap) imgWrap.style.display = 'none';
  vitrineData.unshift(proj);
  buildVitrineGrid('app-vitrine-grid');
  buildVitrineGrid('landing-vitrine-grid');

  // Reset form
  ['pub-name','pub-desc','pub-hook','pub-url','pub-target','pub-tags'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  updatePubCompletion(); updateDescCount(); renderTagsPreview(); updateMobilePreview();
  // Reset wizard vers étape 1
  wizGoTo(1);

  // Badges & missions
  currentUser._postCount = (currentUser._postCount||0) + 1;
  currentUser._todayPosts = (currentUser._todayPosts||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();

  // Save & sync
  const saved = JSON.parse(localStorage.getItem('vb_my_projects')||'[]');
  saved.unshift(proj); localStorage.setItem('vb_my_projects', JSON.stringify(saved));
  try{ fetch('/api/projects',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(proj)}); }catch(e){}

  // Confirmation avec tip
  toast('🌐 Projet publié sur la vitrine ! Partage le lien dans le chat pour avoir tes premiers votes 🚀');
}

async function generateBoostForProject(){
  const name=document.getElementById('pub-name')?.value.trim()||'Mon projet';
  const desc=document.getElementById('pub-desc')?.value.trim()||'Projet digital';
  const type=document.getElementById('pub-type')?.value||'';
  const target=document.getElementById('pub-target')?.value.trim()||'Grand public';
  const btn=document.getElementById('btn-pub-project');
  btn.disabled=true;
  const outBox=document.getElementById('pub-strategy');
  outBox.style.display='block';
  outBox.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:`Tu es expert en marketing digital. Génère une stratégie de promotion pour:\n- Projet: ${name} (${type})\n- Cible: ${target}\n- Description: ${desc}\n\nFournis: hashtags TikTok, calendrier contenu 2 semaines, 3 idées de posts viraux, 5 mots-clés SEO.`})});
    const data=await res.json();
    outBox.textContent=data.content;
  }catch(e){outBox.textContent='Connecte le backend Render pour générer des stratégies IA.';}
  btn.disabled=false;
}

// ── WORLD CHAT ──
let chatMsgsToday=parseInt(localStorage.getItem('vb_chat_today_'+new Date().toDateString())||'0');

function buildWorldChat(){
  const el=document.getElementById('world-chat-msgs');
  if(!el)return;
  const msgs=[...worldChatMsgs];
  if(!msgs.length){
    el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Sois le premier à écrire dans le chat ! 👋</div>';
    return;
  }
  el.innerHTML=msgs.map(m=>`
    <div class="chat-msg-item">
      <div class="chat-msg-name">${m.name} <span class="chat-msg-plan-badge plan-${m.plan}">${m.plan.toUpperCase()}</span> <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.time||''}</span></div>
      <div class="chat-msg-text">${escHtml(m.text)}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
  // Update online count
  const onlineEl=document.getElementById('world-online-count');
  if(onlineEl)onlineEl.textContent=(12+Math.floor(Math.random()*8))+' en ligne';
}

function sendWorldChat(){
  if(!currentUser){openModal('login-modal');return;}
  const inp=document.getElementById('world-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  const today=new Date().toDateString();
  if(chatMsgsToday>=plan.limits.chatMsgs){
    document.getElementById('world-chat-upgrade').style.display='flex';
    toast('Limite de messages atteinte ! Upgrade ton plan.');
    return;
  }
  chatMsgsToday++;
  localStorage.setItem('vb_chat_today_'+today,chatMsgsToday);
  document.getElementById('chat-msgs-left').textContent=Math.max(0,plan.limits.chatMsgs-chatMsgsToday);
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  worldChatMsgs.push({name:currentUser.name,plan:currentUser.plan||'free',text,time});
  inp.value='';
  buildWorldChat();
  // WS send
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'message',name:currentUser.name,plan:currentUser.plan||'free',text}));
  }
}

// ── PROFILE ──
function renderMyProfile(){
  const el=document.getElementById('my-profile-view');
  if(!el||!currentUser)return;
  const u=currentUser;
  const ava=u.avatar||'🙂';
  const followers=(u.followers||[]).length;
  const following=(u.following||[]).length;
  el.innerHTML=`
    <div class="profile-banner" style="background:linear-gradient(135deg,${getAvatarColor(u.email)},var(--s3))">
      <div class="profile-avatar" style="background:${getAvatarColor(u.email)}">${u.avatarUrl?`<img src="${u.avatarUrl}" style="width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:50%;" />`:`<span style="line-height:1">${ava}</span>`}</div>
      <button class="profile-edit-btn" onclick="openEditProfile()">✏️ Modifier</button>
      ${u.plan==='elite'?`<button class="btn-contact-admin" style="position:absolute;bottom:14px;right:14px" onclick="openContactAdmin()">📩 Admin</button>`:''}
    </div>
    <div class="profile-info">
      <div class="profile-name">${u.name||'Utilisateur'}</div>
      <div class="profile-handle">@${u.username||u.email.split('@')[0]} · <span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></div>
      <div class="profile-bio">${u.bio||'<span style="color:var(--muted2)">Ajoute une bio dans "Modifier mon profil"</span>'}</div>
      ${u.tags&&u.tags.length?`<div class="profile-tags">${u.tags.map(t=>`<span class="profile-tag">${t}</span>`).join('')}</div>`:''}
      <div class="profile-stats">
        <div class="pstat"><div class="pstat-num">${followers}</div><div class="pstat-label">Abonnés</div></div>
        <div class="pstat"><div class="pstat-num">${following}</div><div class="pstat-label">Abonnements</div></div>
        <div class="pstat"><div class="pstat-num">${(u.projects||[]).length}</div><div class="pstat-label">Projets</div></div>
        <div class="pstat"><div class="pstat-num">${u.totalVotes||0}</div><div class="pstat-label">Votes reçus</div></div>
      </div>
      ${renderProfileLinks(u)}
      ${renderProfileFields(u)}
    </div>
    <div style="margin-top:24px">
      <h3 style="font-family:'DM Mono',monospace;font-size:11px;color:var(--g3);letter-spacing:2px;margin-bottom:12px">MES PUBLICATIONS</h3>
      <div id="my-posts-feed">${feedPosts.filter(p=>p.userId===u.email).length===0?'<div style="color:var(--muted);font-size:13px">Aucune publication encore.</div>':''}</div>
    </div>
    ${renderBadges(u)}`;
  // Render my posts
  const myPosts=feedPosts.filter(p=>p.userId===u.email);
  const mpEl=document.getElementById('my-posts-feed');
  if(mpEl&&myPosts.length){
    mpEl.innerHTML=myPosts.map(p=>`<div class="post-card" style="margin-bottom:10px"><div class="post-content">${escHtml(p.text)}</div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:8px">${p.time} · ❤️ ${p.likes}</div></div>`).join('');
  }
}

function renderProfileLinks(u){
  const links=[];
  if(u.website)links.push(`<a class="profile-link" href="${u.website}" target="_blank">🌐 Site web</a>`);
  if(u.tiktok)links.push(`<a class="profile-link" href="https://tiktok.com/@${u.tiktok.replace('@','')}" target="_blank">🎵 ${u.tiktok}</a>`);
  if(u.instagram)links.push(`<a class="profile-link" href="https://instagram.com/${u.instagram.replace('@','')}" target="_blank">📸 ${u.instagram}</a>`);
  if(u.twitter)links.push(`<a class="profile-link" href="https://twitter.com/${u.twitter.replace('@','')}" target="_blank">🐦 ${u.twitter}</a>`);
  if(u.linkedin)links.push(`<a class="profile-link" href="${u.linkedin}" target="_blank">💼 LinkedIn</a>`);
  if(u.youtube)links.push(`<a class="profile-link" href="https://youtube.com/@${u.youtube.replace('@','')}" target="_blank">▶️ ${u.youtube}</a>`);
  if(!links.length)return '';
  return `<div class="profile-links" style="margin-bottom:16px">${links.join('')}</div>`;
}

function renderProfileFields(u){
  const fields=[];
  if(u.title)fields.push({l:'Titre',v:u.title});
  if(u.location)fields.push({l:'Localisation',v:u.location});
  if(u.niche)fields.push({l:'Niche',v:u.niche});
  if(u.exp)fields.push({l:'Expérience',v:u.exp});
  if(u.dispo)fields.push({l:'Disponibilité',v:u.dispo});
  if(u.goal)fields.push({l:'Objectif',v:u.goal});
  if(u.skills)fields.push({l:'Compétences',v:u.skills});
  if(u.tools)fields.push({l:'Outils',v:u.tools});
  if(u.langs)fields.push({l:'Langues',v:u.langs});
  if(u.tiktokCount)fields.push({l:'Abonnés TikTok',v:u.tiktokCount});
  if(u.igCount)fields.push({l:'Abonnés Instagram',v:u.igCount});
  if(u.revenue)fields.push({l:'Revenus/mois',v:u.revenue});
  if(!fields.length)return '';
  return `<div class="profile-fields">${fields.map(f=>`<div class="pfield"><div class="pfield-label">${f.l}</div><div class="pfield-value">${f.v}</div></div>`).join('')}</div>`;
}

function openEditProfile(){
  if(!currentUser)return;
  const u=currentUser;
  const fields={name:'ep-name',username:'ep-username',title:'ep-title',location:'ep-location',bio:'ep-bio',niche:'ep-niche',goal:'ep-goal',skills:'ep-skills',tools:'ep-tools',langs:'ep-langs',website:'ep-website',tiktok:'ep-tiktok',instagram:'ep-instagram',twitter:'ep-twitter',linkedin:'ep-linkedin',youtube:'ep-youtube',tiktokCount:'ep-tiktok-count',igCount:'ep-ig-count',projectsCount:'ep-projects-count',sales:'ep-sales',looking:'ep-looking'};
  Object.entries(fields).forEach(([key,id])=>{const el=document.getElementById(id);if(el&&u[key])el.value=u[key];});
  if(u.exp){const sel=document.getElementById('ep-exp');if(sel)for(let o of sel.options)if(o.value===u.exp||o.text===u.exp)sel.value=o.value;}
  if(u.dispo){const sel=document.getElementById('ep-dispo');if(sel)for(let o of sel.options)if(o.text===u.dispo)sel.value=o.value;}
  if(u.revenue){const sel=document.getElementById('ep-revenue');if(sel)for(let o of sel.options)if(o.text===u.revenue)sel.value=o.value;}
  // Restaurer l'avatar dans le formulaire
  const avaEl = document.getElementById('edit-ava-emoji');
  const avaImg = document.getElementById('edit-ava-img');
  if(u.avatarUrl && avaImg){ avaImg.src=u.avatarUrl; avaImg.style.display='block'; if(avaEl) avaEl.style.display='none'; }
  else if(avaEl){ avaEl.textContent=u.avatar||'🙂'; if(avaImg) avaImg.style.display='none'; }
  openModal('edit-profile-modal');
}

function selectEmoji(el,emoji){
  document.querySelectorAll('.emoji-opt').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  const prev = document.getElementById('edit-ava-preview');
  const emojiSpan = document.getElementById('edit-ava-emoji');
  const imgEl = document.getElementById('edit-ava-img');
  if(emojiSpan) emojiSpan.textContent = emoji;
  if(imgEl){ imgEl.style.display='none'; if(emojiSpan) emojiSpan.style.display=''; }
  if(currentUser) currentUser._pendingEmoji = emoji;
}

function selectEmojiPremium(el, emoji, requiredPlan){
  const planOrder = {free:0, starter:1, pro:2, elite:3};
  const userLevel = planOrder[currentUser?.plan||'free']||0;
  const reqLevel = planOrder[requiredPlan]||0;
  if(userLevel < reqLevel){
    toast(`🔒 Avatar ${requiredPlan.toUpperCase()} — Upgrade requis !`, 'error');
    setTimeout(()=>openModal('pricing-modal'), 800);
    return;
  }
  selectEmoji(el, emoji);
}

async function handleAvatarUpload(input){
  const file = input.files[0];
  if(!file) return;
  const imgEl = document.getElementById('edit-ava-img');
  const emojiSpan = document.getElementById('edit-ava-emoji');
  // Aperçu local immédiat
  const url = URL.createObjectURL(file);
  if(imgEl){ imgEl.src=url; imgEl.style.display='block'; }
  if(emojiSpan) emojiSpan.style.display='none';
  const overlay=document.querySelector('.ava-upload-overlay'); if(overlay) overlay.style.display='none';
  document.getElementById('edit-ava-preview')?.classList.add('has-photo');
  // Tenter upload serveur
  try{
    const fd = new FormData(); fd.append('file', file);
    const r = await fetch('/api/upload', {method:'POST', body:fd});
    const d = await r.json();
    if(d.url && currentUser){ currentUser.avatarUrl = d.url; localStorage.setItem('viralboost_user', JSON.stringify(currentUser)); }
  }catch(e){ /* garde l'aperçu local */ }
  if(currentUser){ currentUser._pendingAvatarUrl = url; }
  toast('📷 Photo de profil mise à jour !');
}

function saveProfile(){
  if(!currentUser)return;
  const sel=document.getElementById('ep-exp');
  const selD=document.getElementById('ep-dispo');
  const selR=document.getElementById('ep-revenue');
  Object.assign(currentUser,{
    name:document.getElementById('ep-name').value.trim()||currentUser.name,
    username:document.getElementById('ep-username').value.trim().replace('@',''),
    title:document.getElementById('ep-title').value.trim(),
    location:document.getElementById('ep-location').value.trim(),
    bio:document.getElementById('ep-bio').value.trim(),
    niche:document.getElementById('ep-niche').value.trim(),
    exp:sel?sel.options[sel.selectedIndex].text:'',
    dispo:selD?selD.options[selD.selectedIndex].text:'',
    revenue:selR?selR.options[selR.selectedIndex].text:'',
    goal:document.getElementById('ep-goal').value.trim(),
    skills:document.getElementById('ep-skills').value.trim(),
    tools:document.getElementById('ep-tools').value.trim(),
    langs:document.getElementById('ep-langs').value.trim(),
    website:document.getElementById('ep-website').value.trim(),
    tiktok:document.getElementById('ep-tiktok').value.trim(),
    instagram:document.getElementById('ep-instagram').value.trim(),
    twitter:document.getElementById('ep-twitter').value.trim(),
    linkedin:document.getElementById('ep-linkedin').value.trim(),
    youtube:document.getElementById('ep-youtube').value.trim(),
    tiktokCount:document.getElementById('ep-tiktok-count').value.trim(),
    igCount:document.getElementById('ep-ig-count').value.trim(),
    looking:document.getElementById('ep-looking').value.trim(),
    avatar:document.getElementById('edit-ava-preview').textContent||'🙂',
    tags:[currentUser.niche,currentUser.dispo].filter(Boolean)
  });
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('edit-profile-modal');
  updateAppBar();
  renderMyProfile();
  toast('✅ Profil mis à jour !');
}

// ── FOLLOWERS ──
// Pas d'utilisateurs fictifs — uniquement les vrais membres
const sampleUsers=[];

async function buildFollowList(type='followers'){
  const el=document.getElementById('follow-list-container');
  if(!el)return;
  const myFollowers=currentUser?.followers||[];
  const myFollowing=currentUser?.following||[];
  let users=[];
  try{
    const r=await fetchWithTimeout('/api/admin/all-users');
    const allUsers=await r.json();
    if(type==='followers') users=(allUsers||[]).filter(u=>myFollowers.includes(u.email||u.id));
    if(type==='following') users=(allUsers||[]).filter(u=>myFollowing.includes(u.email||u.id));
    if(type==='discover') users=(allUsers||[]).filter(u=>(u.email||u.id)!==currentUser?.email).slice(0,20);
  }catch(e){}
  if(!users.length){
    const msgs={followers:'Tu n\'as pas encore d\'abonnés.',following:'Tu ne suis personne encore.',discover:'Aucun autre créateur inscrit pour le moment.'};
    el.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">${msgs[type]||''}</div>`;
    document.getElementById('followers-count').textContent=myFollowers.length;
    document.getElementById('following-count').textContent=myFollowing.length;
    return;
  }
  el.innerHTML=users.map(u=>`
    <div class="follow-item">
      <div class="follow-item-ava" style="background:${getAvatarColor(u.email||u.id)}">${u.avatar||u.name?.[0]||'🙂'}</div>
      <div style="flex:1">
        <div class="follow-item-name">${escHtml(u.name||'Créateur')}</div>
        <div class="follow-item-sub">${escHtml(u.bio||'')}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px"><span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'free').toUpperCase()}</span></div>
      </div>
      <button class="btn-dm-list" onclick="openDMToUser('${u.email||u.id}','${escHtml(u.name||'?')}')" title="DM">💬</button>
      <button class="btn-follow-list ${myFollowing.includes(u.email||u.id)?'following':''}" onclick="toggleFollow(this,'${u.email||u.id}')">${myFollowing.includes(u.email||u.id)?'Suivi ✓':'Suivre'}</button>
    </div>`).join('');
  document.getElementById('followers-count').textContent=myFollowers.length;
  document.getElementById('following-count').textContent=myFollowing.length;
}

function switchFollowTab(type,el){
  document.querySelectorAll('#tab-abonnes .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  buildFollowList(type);
}

function toggleFollow(btn,userId){
  if(!currentUser)return;
  currentUser.following=currentUser.following||[];
  if(currentUser.following.includes(userId)){
    currentUser.following=currentUser.following.filter(id=>id!==userId);
    btn.textContent='Suivre';btn.classList.remove('following');
    toast('Désabonné');
  } else {
    currentUser.following.push(userId);
    btn.textContent='Suivi ✓';btn.classList.add('following');
    toast('✅ Abonné !');
  }
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  document.getElementById('following-count').textContent=currentUser.following.length;
}

// ── DM ──
function openDMToUser(userId,name){
  if(!currentUser){openModal('login-modal');return;}
  if(userId===currentUser.email){toast('Tu ne peux pas te DM toi-même 😄');return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='À : '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function openDMToUser(userId,name){
  if(!currentUser){openModal('login-modal');return;}
  dmTarget={id:userId,name};
  document.getElementById('dm-modal-sub').textContent='À : '+name;
  renderDMThread(userId);
  openModal('dm-modal');
}

function renderDMThread(userId){
  const el=document.getElementById('dm-msgs-list');
  const thread=dmThreads[userId]||[];
  if(!thread.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Début de la conversation 👋</div>';return;}
  el.innerHTML=thread.map(m=>`
    <div class="dm-msg ${m.fromMe?'mine':'theirs'}">
      <div class="dm-bubble-g">${escHtml(m.text)}</div>
      <div class="dm-time">${m.time}</div>
    </div>`).join('');
  el.scrollTop=el.scrollHeight;
}

function sendDM(){
  if(!dmTarget||!currentUser)return;
  const inp=document.getElementById('dm-input');
  const text=inp.value.trim();
  if(!text)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  if(!dmThreads[dmTarget.id])dmThreads[dmTarget.id]=[];
  dmThreads[dmTarget.id].push({fromMe:true,text,time});
  inp.value='';
  // Tracker pour badges
  currentUser._dmCount = (currentUser._dmCount||0) + 1;
  currentUser._todayDMs = (currentUser._todayDMs||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  checkNewBadges();
  renderDMThread(dmTarget.id);
  // WS
  if(ws&&ws.readyState===WebSocket.OPEN){
    ws.send(JSON.stringify({type:'dm',toId:dmTarget.id,fromName:currentUser.name,fromPlan:currentUser.plan||'free',text}));
  }
}

// ── IA BOOST ──
function selectBoostType(el,type){
  document.querySelectorAll('#tab-ia-boost .sp-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostType=type;
}

const boostPrompts={
  social:(n,t,d,g)=>`Expert growth hacking TikTok/Instagram. Stratégie pour:\n- Projet: ${n}\n- Cible: ${t}\n- Description: ${d}\n- Objectif: ${g}\n\nFournis: 5 scripts vidéo viraux, 20 hashtags, calendrier 30 jours, meilleurs horaires.`,
  seo:(n,t,d,g)=>`Expert SEO. Plan pour:\n- Projet: ${n}\n- Cible: ${t}\n- Description: ${d}\n\nFournis: 20 mots-clés, 5 sujets d'articles, stratégie backlinks, checklist on-page.`,
  ads:(n,t,d,g)=>`Expert copywriting pub. Crée pour:\n- Projet: ${n}\n- Cible: ${t}\n\nFournis: 3 pubs Facebook Ads, 3 scripts TikTok Ads (30s), 3 annonces Google, 5 accroches Instagram.`,
  email:(n,t,d,g)=>`Expert email marketing. Séquence pour:\n- Projet: ${n}\n- Cible: ${t}\n\nFournis: 5 emails complets (bienvenue J0, valeur J3, preuve J7, promo J14, relance J30).`,
  strategy:(n,t,d,g)=>`Consultant stratégie digitale. Plan 90j pour:\n- Projet: ${n}\n- Cible: ${t}\n- Objectif: ${g}\n\nFournis: analyse SWOT, objectifs SMART, actions mois 1/2/3, budget estimé.`,
  coach:(n,t,d,g)=>`Tu es coach marketing expert. Donne des conseils personnalisés pour:\n- Projet: ${n}\n- Description: ${d}\n- Objectif: ${g}\n\nConseils concrets, actionnables, priorisés.`
};

async function runIABoost(){
  if(!currentUser){openModal('login-modal');return;}
  const name=document.getElementById('boost-name').value.trim()||'Mon projet';
  const target=document.getElementById('boost-target').value.trim()||'Grand public';
  const desc=document.getElementById('boost-desc').value.trim()||'Projet digital';
  const goal=document.getElementById('boost-goal').value.trim()||'Croître';
  const btn=document.getElementById('btn-ia-boost');
  btn.disabled=true;btn.textContent='⚡ Génération...';
  const out=document.getElementById('boost-output-box');
  const txt=document.getElementById('boost-output-text');
  out.style.display='block';
  txt.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  try{
    const res=await fetch('/api/generate-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:boostPrompts[selectedBoostType](name,target,desc,goal)})});
    const data=await res.json();
    txt.textContent=data.content;
    toast('✅ Stratégie générée !');
  }catch(e){txt.textContent='Connecte le backend Render pour générer des stratégies IA complètes.';}
  btn.disabled=false;btn.textContent='⚡ Générer ma stratégie';
}

// ── AUTH ──
function signup(){
  const name=document.getElementById('s-name').value.trim();
  const username=document.getElementById('s-username').value.trim().replace('@','');
  const email=document.getElementById('s-email').value.trim();
  const pass=document.getElementById('s-pass').value;
  if(!name||!email||!pass){toast('Remplis tous les champs obligatoires.');return;}
  if(pass.length<8){toast('Mot de passe trop court (8 car. min).');return;}
  if(selectedSignupPlan!=='free'){
    closeModal('signup-modal');
    pendingSignup={name,username,email,pass};
    startPayment(selectedSignupPlan);
    return;
  }
  createUser({name,username,email,plan:'free'});
  closeModal('signup-modal');
  showApp();
}

let pendingSignup=null;

function createUser({name,username,email,plan}){
  const offeredPlan=localStorage.getItem('vb_offer_pending')?'pro':(plan||'free');
  currentUser={id:email,name,username:username||email.split('@')[0],email,plan:offeredPlan,avatar:'🙂',bio:'',followers:[],following:[],projects:[],totalVotes:0,createdAt:new Date().toISOString()};
  if(offeredPlan==='pro'&&localStorage.getItem('vb_offer_pending')){
    currentUser.offerClaimed=true;
    currentUser.offerExpiry=new Date(Date.now()+365*24*60*60*1000).toISOString();
    localStorage.removeItem('vb_offer_pending');
    setTimeout(()=>toast('🎉 Plan PRO activé gratuitement pour 1 an !'),800);
  }
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  // Crédits de bienvenue
  const welcomeCredits = 50;
  addCredits(welcomeCredits);
  setTimeout(()=>toast(`🎁 Bienvenue ! +${welcomeCredits}⚡ ViralCrédits offerts !`), 1200);
  try{fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)});}catch(e){}
}

// ── SUPER ADMIN ──
const SUPER_ADMIN_EMAIL='soug759@gmail.com';
const SUPER_ADMIN_PASS='Carla123';

function isSuperAdmin(email,pass){
  return email===SUPER_ADMIN_EMAIL&&pass===SUPER_ADMIN_PASS;
}

function loginAsSuperAdmin(){
  currentUser={
    id:SUPER_ADMIN_EMAIL,
    name:'Admin',
    username:'admin_viralboost',
    email:SUPER_ADMIN_EMAIL,
    plan:'elite',
    avatar:'👑',
    bio:'Super Administrateur de ViralBoost',
    isSuperAdmin:true,
    followers:[],following:[],projects:[],totalVotes:0,
    createdAt:new Date().toISOString()
  };
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('login-modal');
  showApp();
  // Charger toutes les données admin
  loadAdminData();
}

async function loadAdminData(){
  // Charger tous les utilisateurs, signalements, DMs, projets
  try{
    const [usersRes,reportsRes,dmsRes,projectsRes]=await Promise.all([
      fetch('/api/admin/all-users?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/reports?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/admin/dms?key=viralboost-admin').catch(()=>({ok:false})),
      fetch('/api/projects').catch(()=>({ok:false}))
    ]);
    window._adminData={
      users: usersRes.ok ? await usersRes.json() : [],
      reports: reportsRes.ok ? await reportsRes.json() : [],
      dms: dmsRes.ok ? await dmsRes.json() : [],
      projects: projectsRes.ok ? await projectsRes.json() : []
    };
    toast('👑 Accès Admin total activé !');
    showAdminPanel();
  }catch(e){
    toast('👑 Mode Admin activé (données locales)');
    window._adminData={users:[],reports:[],dms:[],projects:[]};
    showAdminPanel();
  }
}

function showAdminPanel(){
  // Ajouter onglet Admin dans la barre si pas déjà là
  const tabs=document.querySelector('.app-tabs');
  if(tabs&&!document.getElementById('tab-btn-admin')){
    const btn=document.createElement('button');
    btn.className='app-tab';
    btn.id='tab-btn-admin';
    btn.style.color='#ffd700';
    btn.style.borderBottomColor='#ffd700';
    btn.innerHTML='👑 Admin';
    btn.onclick=()=>showAppTab('admin',btn);
    tabs.appendChild(btn);
    // Créer le panel admin
    const panel=document.createElement('div');
    panel.className='tpanel';
    panel.id='tab-admin';
    panel.innerHTML=buildAdminPanelHTML();
    document.querySelector('#app > div[style]').appendChild(panel);
  }
}

function buildAdminPanelHTML(){
  const d=window._adminData||{};
  const users=d.users||[];
  const reports=d.reports||[];
  const dms=d.dms||[];
  const projects=d.projects||[];

  return `
  <div style="max-width:1100px;margin:0 auto;padding:22px 0">
    <h2 style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:3px;color:#ffd700;margin-bottom:6px">👑 PANNEAU SUPER ADMIN</h2>
    <p style="font-size:12px;color:var(--muted);margin-bottom:24px;font-family:'DM Mono',monospace">Accès exclusif · soug759@gmail.com</p>

    <!-- STATS -->
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:28px">
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-users">${users.length||'?'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">UTILISATEURS</div>
      </div>
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-projects">${projects.length||'?'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">PROJETS/PUBS</div>
      </div>
      <div style="background:rgba(255,75,75,0.08);border:1.5px solid rgba(255,75,75,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#f87171" id="admin-stat-reports">${reports.length||'0'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">SIGNALEMENTS</div>
      </div>
      <div style="background:rgba(255,215,0,0.06);border:1.5px solid rgba(255,215,0,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:#ffd700" id="admin-stat-dms">${dms.length||'0'}</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">DMS ADMIN</div>
      </div>
      <div style="background:rgba(34,197,94,0.06);border:1.5px solid rgba(34,197,94,0.2);border-radius:10px;padding:16px;text-align:center">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g3)" id="admin-stat-online">—</div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">EN LIGNE</div>
      </div>
    </div>

    <!-- TABS -->
    <div class="feed-tabs" style="margin-bottom:18px">
      <button class="feed-tab active" onclick="switchAdminTab('users',this)">👥 Utilisateurs</button>
      <button class="feed-tab" onclick="switchAdminTab('reports',this)">🚨 Signalements</button>
      <button class="feed-tab" onclick="switchAdminTab('dms',this)">📩 DMs</button>
      <button class="feed-tab" onclick="switchAdminTab('projects',this)">📢 Publications</button>
      <button class="feed-tab" onclick="switchAdminTab('chat',this)">💬 Chat global</button>
    </div>

    <!-- USERS -->
    <div id="admin-tab-users">
      <div style="background:var(--s1);border:1.5px solid var(--border2);border-radius:10px;overflow:hidden">
        <table style="width:100%;border-collapse:collapse">
          <thead><tr style="background:var(--s2)">
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">NOM</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">EMAIL</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">PLAN</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">INSCRIT</th>
            <th style="padding:10px 14px;text-align:left;font-size:10px;color:var(--g3);font-family:'DM Mono',monospace;letter-spacing:1px">ACTIONS</th>
          </tr></thead>
          <tbody id="admin-users-tbody">
            ${users.length?users.map(u=>`<tr style="border-top:1px solid var(--border2)">
              <td style="padding:10px 14px;font-size:13px">${u.name||'—'}</td>
              <td style="padding:10px 14px;font-size:12px;color:var(--muted);font-family:'DM Mono',monospace">${u.email||'—'}</td>
              <td style="padding:10px 14px"><span class="chat-msg-plan-badge plan-${u.plan||'free'}">${(u.plan||'FREE').toUpperCase()}</span></td>
              <td style="padding:10px 14px;font-size:11px;color:var(--muted)">${u.createdAt?new Date(u.createdAt).toLocaleDateString('fr-FR'):'—'}</td>
              <td style="padding:10px 14px"><button onclick="adminBanUser('${u.email}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:3px 8px;font-size:10px;color:#f87171;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Bannir</button></td>
            </tr>`).join(''):'<tr><td colspan="5" style="padding:24px;text-align:center;color:var(--muted)">Connecte MongoDB pour voir les utilisateurs</td></tr>'}
          </tbody>
        </table>
      </div>
    </div>

    <!-- REPORTS (hidden by default) -->
    <div id="admin-tab-reports" style="display:none">
      ${reports.length?`<div style="display:flex;flex-direction:column;gap:8px">
        ${reports.map(r=>`<div style="background:rgba(248,113,113,0.06);border:1.5px solid rgba(248,113,113,0.2);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
            <span style="font-size:12px;font-weight:700;color:#f87171">🚨 ${r.reportedName||r.reportedId||'?'}</span>
            <span style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">signalé par ${r.reporterName||r.reporterEmail||'?'}</span>
            <span style="background:rgba(248,113,113,0.15);color:#f87171;font-size:9px;padding:2px 7px;border-radius:3px;font-family:'DM Mono',monospace;margin-left:auto">${r.reason||'?'}</span>
          </div>
          ${r.details?`<div style="font-size:12px;color:var(--muted)">${r.details}</div>`:''}
          <div style="font-size:10px;color:var(--muted2);margin-top:6px;font-family:'DM Mono',monospace">${r.createdAt?new Date(r.createdAt).toLocaleString('fr-FR'):''}</div>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">Aucun signalement pour le moment 🎉</div>'}
    </div>

    <!-- DMs (hidden) -->
    <div id="admin-tab-dms" style="display:none">
      ${dms.length?`<div style="display:flex;flex-direction:column;gap:8px">
        ${dms.map(d=>`<div style="background:rgba(255,215,0,0.04);border:1.5px solid rgba(255,215,0,0.15);border-radius:10px;padding:14px 18px">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
            <span style="font-size:20px">👑</span>
            <span style="font-size:12px;font-weight:700;color:#ffd700">${d.fromName||d.fromEmail||'?'}</span>
            <span class="chat-msg-plan-badge plan-${d.fromPlan||'elite'}" style="font-size:9px">${(d.fromPlan||'ELITE').toUpperCase()}</span>
            <span style="font-size:10px;color:var(--muted);margin-left:auto;font-family:'DM Mono',monospace">${d.createdAt?new Date(d.createdAt).toLocaleString('fr-FR'):''}</span>
          </div>
          <div style="font-size:13px;color:var(--g5)">${d.text||'—'}</div>
          <button onclick="replyToAdminDM('${d.fromEmail}')" style="margin-top:8px;background:transparent;border:1px solid rgba(255,215,0,0.2);border-radius:4px;padding:4px 10px;font-size:10px;color:#ffd700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Répondre</button>
        </div>`).join('')}
      </div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">Aucun DM admin pour le moment</div>'}
    </div>

    <!-- PROJECTS (hidden) -->
    <div id="admin-tab-projects" style="display:none">
      ${projects.length?`<div class="vitrine-grid">${projects.slice(0,12).map(p=>`
        <div class="v-card">
          <div class="v-banner" style="background:${p.color||'var(--s2)'};">${p.emoji||'🚀'}
            <div class="v-badge" style="background:#ffd700;color:#1a0a00">${p.cat||p.type||'pub'}</div>
          </div>
          <div class="v-body">
            <div class="v-name">${p.name}</div>
            <div class="v-desc">${(p.desc||'').slice(0,80)}</div>
            <div class="v-footer">
              <div class="v-author" style="font-size:11px">${p.author||'?'}</div>
              <button onclick="adminDeleteProject('${p.id}')" style="background:transparent;border:1px solid rgba(248,113,113,0.3);border-radius:4px;padding:2px 7px;font-size:10px;color:#f87171;cursor:pointer">🗑</button>
            </div>
          </div>
        </div>`).join('')}</div>`:'<div style="text-align:center;padding:40px;color:var(--muted)">Aucun projet publié</div>'}
    </div>

    <!-- CHAT (hidden) -->
    <div id="admin-tab-chat" style="display:none">
      <div class="chat-box" style="height:500px">
        <div class="chat-msgs-area" id="admin-chat-msgs">
          ${[...publicMessages].reverse().slice(0,50).map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${m.name||'?'} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div><div class="chat-msg-text">${m.text||''}</div></div>`).join('')||'<div style="text-align:center;padding:32px;color:var(--muted)">Chat en temps réel visible ici</div>'}
        </div>
        <div class="chat-input-row">
          <input type="text" id="admin-chat-in" class="chat-input-field" placeholder="Envoyer un message en tant qu\'Admin 👑..." onkeydown="if(event.key===\\'Enter\\')sendAdminChatMsg()"/>
          <button class="btn-send" onclick="sendAdminChatMsg()" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a0a00">→</button>
        </div>
      </div>
    </div>

    <div style="margin-top:24px;padding:14px;background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.1);border-radius:8px;font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;text-align:center">
      👑 Super Admin Panel · soug759@gmail.com · <a href="/admin?key=viralboost-admin" target="_blank" style="color:#ffd700;text-decoration:none">Dashboard serveur complet →</a>
    </div>
  </div>`;
}

function switchAdminTab(tab,el){
  document.querySelectorAll('#tab-admin .feed-tab').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  ['users','reports','dms','projects','chat'].forEach(t=>{
    const el2=document.getElementById('admin-tab-'+t);
    if(el2)el2.style.display=t===tab?'block':'none';
  });
}

function adminBanUser(email){
  if(confirm('Bannir '+email+' ?')){
    fetch('/api/admin/ban',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,key:'viralboost-admin'})}).catch(()=>{});
    toast('🚫 Utilisateur banni : '+email);
  }
}

function adminDeleteProject(id){
  if(confirm('Supprimer ce projet ?')){
    vitrineData=vitrineData.filter(p=>p.id!==id);
    fetch('/api/projects/'+id,{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({key:'viralboost-admin'})}).catch(()=>{});
    toast('🗑 Projet supprimé');
    document.getElementById('tab-admin').innerHTML=buildAdminPanelHTML();
  }
}

function replyToAdminDM(email){
  openDMToUser(email, email.split('@')[0]);
}

function sendAdminChatMsg(){
  const inp=document.getElementById('admin-chat-in');
  const text=inp.value.trim();
  if(!text)return;
  inp.value='';
  const el=document.getElementById('admin-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.style.background='rgba(255,215,0,0.06)';
  div.style.border='1px solid rgba(255,215,0,0.15)';
  div.innerHTML=`<div class="chat-msg-name"><span style="color:#ffd700">👑 Admin</span> <span class="admin-msg-badge">ADMIN</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({type:'message',name:'👑 Admin',plan:'elite',text,isAdmin:true}));
  }
}

function login(){
  const email=document.getElementById('l-email').value.trim();
  const pass=document.getElementById('l-pass').value;
  if(!email||!pass){toast('Remplis tous les champs.');return;}

  // ── SUPER ADMIN ──
  if(isSuperAdmin(email,pass)){
    loginAsSuperAdmin();
    return;
  }

  const saved=localStorage.getItem('viralboost_user');
  if(saved){
    const u=JSON.parse(saved);
    if(u.email===email){currentUser=u;closeModal('login-modal');showApp();return;}
  }
  createUser({name:email.split('@')[0],email,plan:'free'});
  closeModal('login-modal');
  showApp();
}

function logout(){
  currentUser=null;
  document.getElementById('app').style.display='none';
  document.getElementById('landing').style.display='block';
  window.scrollTo(0,0);
}

async function loadVitrineFromAPI(){
  try{
    const r=await fetchWithTimeout('/api/projects');
    const apiProjects=await r.json();
    if(Array.isArray(apiProjects)&&apiProjects.length>0){
      const apiIds=new Set(apiProjects.map(p=>p.id));
      vitrineData=[...apiProjects,...(vitrineData||[]).filter(p=>!apiIds.has(p.id))];
    }
  }catch(e){}
  buildVitrineGrid('app-vitrine-grid');
}

function showApp(){
  document.getElementById('landing').style.display='none';
  document.getElementById('app').style.display='block';
  document.body.classList.add('app-active');
  updateAppBar();
  loadPostsFromAPI();
  loadVitrineFromAPI();
  window.scrollTo(0,0);
  connectWS();
  const plan=PLANS.find(p=>p.id===currentUser.plan)||PLANS[0];
  document.getElementById('feed-limit-info').innerHTML=`Plan ${(currentUser.plan||'FREE').toUpperCase()} · <span id="pubs-left">${plan.limits.pubsPerHour||plan.limits.pubsPerDay||'∞'}</span> pub${currentUser.plan==='free'?'/h':'/jour'}`;
  const chatLeft=Math.max(0,(PLANS.find(p=>p.id===currentUser.plan)||PLANS[0]).limits.chatMsgs-chatMsgsToday);
  const chatEl=document.getElementById('chat-msgs-left');
  if(chatEl)chatEl.textContent=chatLeft;
  // Restore wallpaper
  if(currentUser.wallpaper&&currentUser.wallpaper!=='none'){
    const app=document.getElementById('app');
    app.style.background=currentUser.wallpaper;
    app.classList.add('has-wallpaper');
  }
  // Pub hero après inscription
  if(window._pendingHeroAd&&currentUser){
    const ad=window._pendingHeroAd;
    document.getElementById('feed-text').value=ad.desc;
    document.getElementById('feed-proj-name').value=ad.name;
    const sel=document.getElementById('feed-proj-type');
    if(sel&&ad.type)sel.value=ad.type;
    showAppTab('feed',document.querySelector('.app-tab'));
    toast('📢 Ta pub est prête ! Clique sur Publier.');
    window._pendingHeroAd=null;
  }
  // Nouvelles features
  updateCreditsDisplay();
  setTimeout(checkOnboarding,800);
  setTimeout(checkNewBadges, 500);
}

function updateAppBar(){
  if(!currentUser)return;
  document.getElementById('app-user-name').textContent=currentUser.name;
  document.getElementById('app-user-ava').textContent=currentUser.avatar||currentUser.name[0];
  const chip=document.getElementById('app-plan-chip');
  chip.textContent=(currentUser.plan||'FREE').toUpperCase();
  const isElite=currentUser.plan==='elite';
  if(isElite){chip.style.background='linear-gradient(135deg,#ffd700,#ff8c00)';chip.style.color='#1a0a00';}
  else{chip.style.background='';chip.style.color='';}
  const btnWp=document.getElementById('btn-wallpaper');
  const btnAdm=document.getElementById('btn-admin-dm');
  if(btnWp)btnWp.style.display=isElite?'flex':'none';
  if(btnAdm)btnAdm.style.display=isElite?'flex':'none';
}

// ── PAYMENT ──
function startPayment(planId){
  const plan=PLANS.find(p=>p.id===planId);
  if(!plan||plan.price===0)return;
  pendingPlan=planId;
  document.getElementById('pay-plan-name').textContent=plan.name;
  document.getElementById('pay-plan-price').textContent=plan.price+'€';
  openModal('payment-modal');
  if(stripe){
    const el=stripe.elements({appearance:{theme:'night',variables:{colorPrimary:'#22c55e',colorBackground:'#0b1a0d',colorText:'#f0fdf4',borderRadius:'8px'}}});
    cardElement=el.create('card');
    setTimeout(()=>cardElement.mount('#card-element'),100);
  }
}

async function processPayment(){
  const btn=document.getElementById('btn-pay');
  btn.disabled=true;btn.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  const amounts={starter:300,pro:1499,elite:3999};
  try{
    const r=await fetch('/api/create-payment-intent',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan:pendingPlan,amount:amounts[pendingPlan]||300})});
    const{clientSecret,error:ie}=await r.json();
    if(ie)throw new Error(ie);
    const{error,paymentIntent}=await stripe.confirmCardPayment(clientSecret,{payment_method:{card:cardElement}});
    if(error)throw new Error(error.message);
    if(paymentIntent.status==='succeeded'){
      if(pendingSignup){createUser({...pendingSignup,plan:pendingPlan});pendingSignup=null;}
      else if(currentUser){currentUser.plan=pendingPlan;localStorage.setItem('viralboost_user',JSON.stringify(currentUser));}
      closeModal('payment-modal');
      updateAppBar();
      showApp();
      toast('🎉 Plan '+pendingPlan.toUpperCase()+' activé !');
    }
  }catch(err){
    document.getElementById('card-errors').textContent=err.message;
    btn.disabled=false;btn.textContent='🔒 S\'abonner';
  }
}

// ── WEBSOCKET ──
function connectWS(){
  if(!currentUser)return;
  try{
    const proto=location.protocol==='https:'?'wss':'ws';
    ws=new WebSocket(`${proto}://${location.host}`);
    ws.onopen=()=>{
      wsRetries=0;
      ws.send(JSON.stringify({type:'join',userId:currentUser.email,name:currentUser.name,plan:currentUser.plan||'free'}));
    };
    ws.onmessage=(e)=>{
      try{
        const data=JSON.parse(e.data);
        // Historique du chat au chargement (messages précédents)
        if(data.type==='history'&&Array.isArray(data.messages)){
          worldChatMsgs=data.messages.map(m=>({name:m.name,plan:m.plan||'free',text:m.text,time:new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})}));
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
        }
        // Publications vitrine précédentes envoyées au login
        if(data.type==='projects_history'&&Array.isArray(data.projects)){
          const apiIds=new Set(data.projects.map(p=>p.id));
          vitrineData=[...data.projects,...(vitrineData||[]).filter(p=>!apiIds.has(p.id))];
          if(document.getElementById('tab-vitrine')?.classList.contains('active'))buildVitrineGrid('app-vitrine-grid');
        }
        if(data.type==='message'&&data.message){
          worldChatMsgs.push({name:data.message.name,plan:data.message.plan||'free',text:data.message.text,time:new Date(data.message.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(document.getElementById('tab-chat-global')?.classList.contains('active'))buildWorldChat();
          else{const nd=document.getElementById('chat-notif');if(nd)nd.style.display='inline-block';}
        }
        if(data.type==='online_users'){
          const cnt=document.getElementById('world-online-count');
          if(cnt)cnt.textContent=data.users.length+' en ligne';
        }
        if(data.type==='dm'&&data.message?.fromId){
          const fromId=data.message.fromId;
          if(!dmThreads[fromId])dmThreads[fromId]=[];
          dmThreads[fromId].push({fromMe:false,text:data.message.text,time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
          if(dmTarget&&dmTarget.id===fromId)renderDMThread(fromId);
          toast('💬 Nouveau DM de '+data.message.fromName);
        }
        if(data.type==='vote_update'){
          document.querySelectorAll('[data-pid="'+data.projectId+'"] .vote-count').forEach(el=>el.textContent=data.votes);
        }
        if(data.type==='new_project'&&data.project?.authorId!==currentUser?.email){
          vitrineData.unshift(data.project);
          toast('🚀 Nouveau projet : '+data.project.name);
        }
        if(data.type==='new_post'&&data.post?.userId!==currentUser?.email){
          // Ajouter le post en temps réel
          if(!feedPosts.find(p=>p.id===data.post.id)){
            const p=data.post;
            p.time='À l\'instant';
            feedPosts.unshift(p);
            if(document.getElementById('tab-feed')?.classList.contains('active'))buildFeed();
          }
        }
        if(data.type==='like_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p){p.likes=data.likes;}
          const cnt=document.querySelector(`#post-${data.postId} .like-count`);
          if(cnt)cnt.textContent=data.likes;
        }
        if(data.type==='comment_update'){
          const p=feedPosts.find(p=>p.id===data.postId);
          if(p)p.comments=data.comments;
          const cnt=document.querySelector(`#post-${data.postId} .comment-count`);
          if(cnt)cnt.textContent=data.comments;
        }
        if(data.type==='share_update'){
          const cnt=document.querySelector(`#post-${data.postId} .share-count`);
          if(cnt)cnt.textContent=data.shares;
        }
        if(data.type==='group_message'&&data.groupId===currentGroupId){
          if(document.getElementById('group-chat-modal')?.classList.contains('open')){
            loadGroupMessages(currentGroupId);
          }
        }
      }catch(e){}
    };
    ws.onclose=()=>{
      wsRetries=(wsRetries||0)+1;
      if(wsRetries<10)setTimeout(connectWS,Math.min(5000*wsRetries,30000));
    };
  }catch(e){}
}

// ── TIMERS (posts) ──
function updateTimers(){
  document.querySelectorAll('.post-timer-val').forEach(el=>{
    const end=parseInt(el.dataset.end);
    if(!end)return;
    const left=end-Date.now();
    if(left<=0){el.closest('.post-card')?.remove();return;}
    const m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);
    el.textContent=m+'m'+String(s).padStart(2,'0')+'s';
  });
}
setInterval(updateTimers,1000);

// ── TABS update to include groupes ──
function showAppTab(tab,el){
  syncBottomNav(tab);
  document.querySelectorAll('.app-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tpanel').forEach(p=>p.classList.remove('active'));
  if(el)el.classList.add('active');
  const panel=document.getElementById('tab-'+tab);
  if(panel)panel.classList.add('active');
  // Onglets originaux
  if(tab==='vitrine')buildVitrineGrid('app-vitrine-grid');
  if(tab==='profil')renderMyProfile();
  if(tab==='abonnes')buildFollowList('discover');
  if(tab==='chat-global'){buildWorldChat();const nd=document.getElementById('chat-notif');if(nd)nd.style.display='none';}
  if(tab==='feed')buildFeed();
  if(tab==='groupes')loadGroups();
  // Nouveaux onglets
  if(tab==='stats')loadStats();
  if(tab==='leaderboard')loadLeaderboard('pubs');
  if(tab==='collab')loadCollabs();
  if(tab==='calendrier')buildCalendar();
  if(tab==='publier'){
    updatePubCompletion(); updateDescCount();
    setTimeout(()=>{ const drop=document.getElementById('pub-media-drop'); if(drop) drop.onclick=()=>document.getElementById('pub-media-input')?.click(); },100);
    // Guide première ouverture
    if(!localStorage.getItem('vb_pub_guide_seen')){
      setTimeout(()=>{ document.getElementById('pub-guide-overlay')?.classList.remove('hidden'); }, 500);
    }
  }
  if(tab==='boost-credits'){updateCreditsDisplay();loadBoostPostOptions();renderMissions();updateMissionsCountdown();}
}

// ── GROUPES ──
async function loadGroups(){
  try{
    const r=await fetch('/api/groups');
    groupsData=await r.json();
  }catch(e){groupsData=[];}
  buildGroupsList();
  const btn=document.getElementById('btn-create-group');
  if(btn)btn.style.display=(currentUser?.plan==='elite')?'block':'none';
}

// Pas de groupes fictifs — uniquement les vrais groupes créés par les membres
const sampleGroups=[];

function buildGroupsList(){
  const el=document.getElementById('groups-list');
  if(!el)return;
  const data=groupsData;
  if(!data.length){
    el.innerHTML='<div style="text-align:center;padding:48px;color:var(--muted);grid-column:1/-1"><div style="font-size:40px;margin-bottom:12px">🏛️</div><div style="font-size:14px;font-weight:700;color:var(--g5);margin-bottom:8px">Aucun groupe pour l\'instant</div><div style="font-size:12px">Les membres Elite peuvent créer des groupes thématiques.</div></div>';
    return;
  }
  el.innerHTML=data.map(g=>`
    <div class="group-card" onclick="openGroupChat('${g.id}','${escHtml(g.name)}','${g.creatorId}','${g.access}','${g.allowPhotos||1}')">
      <div class="group-banner" style="${g.bgUrl?`background:url('${g.bgUrl}') center/cover`:'background:linear-gradient(135deg,var(--s2),var(--s3))'}">
        <span style="font-size:36px">${g.emoji||'💬'}</span>
        ${g.access==='private'?'<span style="position:absolute;top:8px;right:8px;font-size:10px;background:rgba(0,0,0,0.6);padding:2px 7px;border-radius:4px;color:#fff">🔒 Privé</span>':''}
      </div>
      <div class="group-body">
        <div class="group-name">${g.name}</div>
        <div class="group-desc">${g.desc||''}</div>
        <div class="group-footer">
          <div class="group-meta">👥 ${g.membersCount||0} membres · ${g.cat||''}</div>
          ${currentUser?.plan==='elite'&&currentUser?.email===g.creatorId?`<button class="btn-report" onclick="event.stopPropagation();openGroupSettings('${g.id}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Admin</button>`:''}
        </div>
      </div>
    </div>`).join('');
}

async function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser){openModal('login-modal');return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  // Show admin btn if elite creator
  const acts=document.getElementById('group-chat-actions');
  acts.innerHTML='';
  if(currentUser.plan==='elite'&&currentUser.email===creatorId){
    acts.innerHTML=`<button class="btn-report" onclick="openGroupSettings('${groupId}')" style="border-color:rgba(212,175,55,0.4);color:#f5c842">⚙️ Paramètres groupe</button>`;
  }
  // Show media upload if allowed
  const mediaBtnLabel=document.getElementById('group-media-btn');
  if(mediaBtnLabel)mediaBtnLabel.style.display=(allowPhotos==='1'||allowPhotos===1)?'flex':'none';
  await loadGroupMessages(groupId);
  openModal('group-chat-modal');
}

async function loadGroupMessages(groupId){
  const el=document.getElementById('group-chat-msgs');
  try{
    const r=await fetch('/api/groups/'+groupId+'/messages');
    const msgs=await r.json();
    if(!msgs.length){el.innerHTML='<div style="text-align:center;padding:32px;color:var(--muted);font-size:13px">Premier à écrire dans ce groupe 👋</div>';return;}
    el.innerHTML=msgs.map(m=>`
      <div class="chat-msg-item">
        <div class="chat-msg-name">${escHtml(m.author||'Anonyme')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>
        ${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}
        ${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px;object-fit:cover"/>`}</div>`:''}
      </div>`).join('');
    el.scrollTop=el.scrollHeight;
  }catch(e){el.innerHTML='<div style="color:var(--muted);text-align:center;padding:20px">Impossible de charger les messages</div>';}
}

async function sendGroupMessage(){
  if(!currentUser){openModal('login-modal');return;}
  const inp=document.getElementById('group-chat-input');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const msg={text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free',timestamp:new Date().toISOString()};
  inp.value='';
  try{await fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)});}catch(e){}
  await loadGroupMessages(currentGroupId);
}

function openCreateGroup(){
  if(currentUser?.plan!=='elite'){toast('⭐ Créer un groupe est réservé au plan ELITE.');startPayment('elite');return;}
  openModal('create-group-modal');
}

async function createGroup(){
  if(!currentUser){return;}
  const name=document.getElementById('grp-name').value.trim();
  const desc=document.getElementById('grp-desc').value.trim();
  if(!name||!desc){toast('Remplis le nom et la description.');return;}
  const group={
    name,desc,emoji:document.getElementById('grp-emoji').value||'💬',
    cat:document.getElementById('grp-cat').value,
    access:document.getElementById('grp-access').value,
    rules:document.getElementById('grp-rules').value.trim(),
    bgUrl:groupBgUrl||'',allowPhotos:1,
    creatorId:currentUser.email,membersCount:1
  };
  try{
    const r=await fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)});
    const d=await r.json();
    toast('🏛️ Groupe créé !');
    closeModal('create-group-modal');
    groupBgUrl=null;
    await loadGroups();
  }catch(e){
    // Fallback local si pas de backend
    group.id='grp'+Date.now();
    groupsData.unshift(group);
    toast('🏛️ Groupe créé !');
    closeModal('create-group-modal');
    buildGroupsList();
  }
}

function openGroupSettings(groupId){
  currentGroupSettingsId=groupId;
  const grp=groupsData.find(g=>g.id===groupId);
  if(grp){
    document.getElementById('gs-rules').value=grp.rules||'';
    document.getElementById('gs-allow-photos').value=grp.allowPhotos||1;
    document.getElementById('gs-access').value=grp.access||'public';
  }
  openModal('group-settings-modal');
}

async function saveGroupSettings(){
  if(!currentGroupSettingsId)return;
  const settings={
    allowPhotos:parseInt(document.getElementById('gs-allow-photos').value),
    rules:document.getElementById('gs-rules').value.trim(),
    access:document.getElementById('gs-access').value
  };
  if(groupSettingsBgUrl)settings.bgUrl=groupSettingsBgUrl;
  try{
    await fetch('/api/groups/'+currentGroupSettingsId+'/settings',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({settings,requesterId:currentUser.email})});
    toast('✅ Paramètres du groupe mis à jour !');
    closeModal('group-settings-modal');
    groupSettingsBgUrl=null;
    await loadGroups();
  }catch(e){toast('Erreur paramètres.');}
}

// ── SIGNALEMENT ──
function openReport(userId,userName){
  if(!currentUser){openModal('login-modal');return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Signaler : '+userName+' → transmis à l\'admin';
  openModal('report-modal');
}

async function submitReport(){
  if(!reportTarget||!currentUser)return;
  const reason=document.getElementById('report-reason').value;
  const details=document.getElementById('report-details').value.trim();
  try{
    await fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      reporterId:currentUser.email,reporterEmail:currentUser.email,reporterName:currentUser.name,
      reportedId:reportTarget.id,reportedName:reportTarget.name,reason,details
    })});
    toast('🚨 Signalement envoyé à l\'admin !');
    closeModal('report-modal');
  }catch(e){toast('Erreur envoi signalement.');}
}

// ── CONTACT ADMIN (ELITE) ──
function openContactAdmin(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacter l\'admin est réservé au plan ELITE.');return;}
  openModal('contact-admin-modal');
}

async function sendAdminMessage(){
  if(!currentUser)return;
  const subject=document.getElementById('ca-subject').value.trim();
  const message=document.getElementById('ca-message').value.trim();
  if(!message){toast('Écris ton message.');return;}
  try{
    await fetch('/api/contact-admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      fromName:currentUser.name,fromEmail:currentUser.email,fromPlan:currentUser.plan,
      subject,message
    })});
    toast('📩 Message envoyé à l\'admin !');
    closeModal('contact-admin-modal');
  }catch(e){toast('Erreur envoi.');}
}

// ── HERO PUBLISH AD ──
function heroPublishAd(){
  const name=document.getElementById('hero-ad-name').value.trim();
  const type=document.getElementById('hero-ad-type').value;
  const desc=document.getElementById('hero-ad-desc').value.trim();
  if(!name){document.getElementById('hero-ad-name').focus();toast('Indique le nom de ton produit !','error');return;}
  if(!desc){document.getElementById('hero-ad-desc').focus();toast('Décris brièvement ta pub !','error');return;}
  // Pré-remplir le signup modal et lancer la pub après inscription
  window._pendingHeroAd={name,type,desc};
  openModal('signup-modal');
  toast('✅ Crée ton compte pour publier ta pub !');
}

// ── PUBLIC FEED ──
function buildPublicFeed(){
  const el=document.getElementById('public-feed-list');
  if(!el)return;
  const publicPosts=[...feedPosts].slice(0,3);
  if(!publicPosts.length){
    el.innerHTML=`<div style="text-align:center;padding:48px 24px;color:var(--muted)">
      <div style="font-size:40px;margin-bottom:12px">📢</div>
      <div style="font-size:14px;color:var(--g5);font-weight:700;margin-bottom:8px">Sois le premier à publier !</div>
      <div style="font-size:12px;line-height:1.8">Le fil se remplit avec les vraies publications de la communauté.</div>
      <button class="btn-unlock-feed" onclick="openModal('signup-modal')" style="margin-top:20px">Créer un compte & publier →</button>
    </div>`;
    return;
  }
  el.innerHTML=`<div>${publicPosts.slice(0,3).map(p=>{
    const isElite=p.plan==='elite';
    return `<div class="public-post-card ${isElite?'elite-pub':''}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <div style="width:32px;height:32px;border-radius:50%;background:${getAvatarColor(p.userId)};display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--bg)">${p.emoji||p.author?.[0]||'?'}</div>
        <div>
          <div style="font-size:13px;font-weight:700;${isElite?'color:var(--gold)':''}">${p.author||'Anonyme'}</div>
          <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">${p.time||''}</div>
        </div>
        <span class="chat-msg-plan-badge plan-${p.plan||'free'}" style="margin-left:auto">${(p.plan||'FREE').toUpperCase()}</span>
      </div>
      <div style="font-size:13px;line-height:1.7;color:#c4d9cb">${p.text?p.text.slice(0,160)+(p.text.length>160?'...':''):''}</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">❤️ ${p.likes||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">💬 ${p.comments||0}</span>
        <span style="font-size:11px;color:${isElite?'var(--gold)':'var(--muted)'}">🔗 Partager</span>
      </div>
    </div>`;
  }).join('')}</div><div class="feed-lock"><button class="btn-unlock-feed" onclick="openModal('signup-modal')">📢 Voir tout le fil & publier ta pub →</button></div>`;
}

// ── MEDIA PREVIEW ──
function previewFeedMedia(input){
  const preview=document.getElementById('feed-media-preview');
  if(!preview)return;
  preview.innerHTML='';
  const files=Array.from(input.files).slice(0,4);
  files.forEach(f=>{
    const div=document.createElement('div');
    div.className='media-preview-item';
    if(f.type.startsWith('image/')){
      const img=document.createElement('img');
      img.src=URL.createObjectURL(f);
      div.appendChild(img);
    } else if(f.type.startsWith('video/')){
      const vid=document.createElement('video');
      vid.src=URL.createObjectURL(f);
      vid.muted=true;
      div.appendChild(vid);
    } else {
      div.innerHTML=`<div style="padding:8px;font-size:11px;color:var(--g4);text-align:center">📄<br>${f.name.slice(0,12)}</div>`;
    }
    const rm=document.createElement('button');
    rm.className='rm-media';rm.textContent='✕';
    rm.onclick=()=>{div.remove();};
    div.appendChild(rm);
    preview.appendChild(div);
  });
}

// ── SIGNALEMENT (avec radio) ──
function submitReport(){
  if(!currentUser)return;
  const radios=document.querySelectorAll('input[name="report-reason"]');
  let reason='';
  radios.forEach(r=>{if(r.checked)reason=r.value;});
  if(!reason){toast('Choisis une raison de signalement.');return;}
  const details=document.getElementById('report-details').value.trim();
  fetch('/api/report',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
    reporterId:currentUser?.email||'anonymous',reporterName:currentUser?.name||'?',
    reportedId:reportTarget?.id||'?',reportedName:reportTarget?.name||'?',reason,details,timestamp:new Date().toISOString()
  })}).catch(()=>{});
  toast('🚨 Signalement envoyé à l\'admin !');
  closeModal('report-modal');
  reportTarget=null;
}

// ── SEND GROUP MSG ──
function sendGroupMsg(){
  if(!currentUser){openModal('login-modal');return;}
  const inp=document.getElementById('group-chat-in');
  const text=inp.value.trim();
  if(!text||!currentGroupId)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${time}</span></div><div class="chat-msg-text">${escHtml(text)}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  inp.value='';
  fetch('/api/groups/'+currentGroupId+'/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,userId:currentUser.email,author:currentUser.name,plan:currentUser.plan||'free'})}).catch(()=>{});
}

function sendGroupMedia(input){
  const f=input.files[0];
  if(!f||!currentGroupId)return;
  const el=document.getElementById('group-chat-msgs');
  const div=document.createElement('div');
  div.className='chat-msg-item';
  const url=URL.createObjectURL(f);
  div.innerHTML=`<div class="chat-msg-name">${escHtml(currentUser.name)} <span class="chat-msg-plan-badge plan-${currentUser.plan||'free'}">${(currentUser.plan||'FREE').toUpperCase()}</span></div><div style="margin-top:4px">${f.type.startsWith('video')?`<video src="${url}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${url}" style="max-width:200px;border-radius:6px"/>`}</div>`;
  el.appendChild(div);el.scrollTop=el.scrollHeight;
  input.value='';
}

// ── CREATE GROUP (new modal IDs) ──
function createGroup(){
  if(!currentUser){return;}
  if(currentUser.plan!=='elite'){toast('⭐ Créer un groupe est réservé au plan ELITE.');return;}
  const name=document.getElementById('cg-name')?.value.trim();
  if(!name){toast('Donne un nom au groupe.');return;}
  const group={
    id:'grp'+Date.now(),name,emoji:document.getElementById('cg-emoji')?.value||'💬',
    desc:document.getElementById('cg-desc')?.value.trim()||'',
    cat:document.getElementById('cg-cat')?.value||'Autre',
    access:document.getElementById('cg-private')?.checked?'private':'public',
    allowPhotos:document.getElementById('cg-allow-photos')?.checked?1:0,
    allowVideos:document.getElementById('cg-allow-videos')?.checked?1:0,
    premod:document.getElementById('cg-premod')?.checked?1:0,
    creatorId:currentUser.email,membersCount:1
  };
  groupsData.unshift(group);
  toast('🏆 Groupe créé !');
  closeModal('create-group-modal');
  if(document.getElementById('tab-groupes')?.classList.contains('active'))buildGroupsList();
  fetch('/api/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(group)}).catch(()=>{});
}

// ── WALLPAPER (ELITE) ──
function setWallpaper(bg){
  if(currentUser?.plan!=='elite'){toast('⭐ Le fond d\'écran est réservé au plan ELITE.');return;}
  const app=document.getElementById('app');
  if(bg==='none'){app.style.background='';app.classList.remove('has-wallpaper');}
  else{app.style.background=bg;app.classList.add('has-wallpaper');}
  currentUser.wallpaper=bg;
  localStorage.setItem('viralboost_user',JSON.stringify(currentUser));
  closeModal('wallpaper-modal');
  toast('🖼️ Fond d\'écran appliqué !');
}

function setWallpaperFromFile(input){
  if(!input.files[0])return;
  if(currentUser?.plan!=='elite'){toast('⭐ Le fond d\'écran est réservé au plan ELITE.');return;}
  const url=URL.createObjectURL(input.files[0]);
  const app=document.getElementById('app');
  app.style.background=`url('${url}') center/cover fixed`;
  app.classList.add('has-wallpaper');
  toast('🖼️ Fond d\'écran appliqué !');
  closeModal('wallpaper-modal');
}

// ── DM ADMIN (ELITE) ──
let adminDMMessages=[];
function openAdminDM(){
  if(currentUser?.plan!=='elite'){toast('⭐ Contacter l\'admin directement est réservé au plan ELITE.');return;}
  renderAdminDMThread();
  openModal('dm-admin-modal');
}
function renderAdminDMThread(){
  const el=document.getElementById('dm-admin-msgs');
  if(!el)return;
  if(!adminDMMessages.length){el.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">📩 Premier message à l\'admin — répond sous 24h</div>';return;}
  el.innerHTML=adminDMMessages.map(m=>`<div class="dm-msg ${m.fromMe?'mine':'theirs'}"><div class="dm-bubble-g">${escHtml(m.text)}</div><div class="dm-time">${m.time}</div></div>`).join('');
  el.scrollTop=el.scrollHeight;
}
function sendAdminDM(){
  const inp=document.getElementById('dm-admin-input');
  const text=inp.value.trim();
  if(!text||!currentUser)return;
  const now=new Date();
  const time=now.getHours()+':'+String(now.getMinutes()).padStart(2,'0');
  adminDMMessages.push({fromMe:true,text,time});
  inp.value='';
  renderAdminDMThread();
  fetch('/api/admin-dm',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fromEmail:currentUser.email,fromName:currentUser.name,fromPlan:currentUser.plan,text,timestamp:new Date().toISOString()})}).catch(()=>{});
  toast('📩 Message envoyé à l\'admin !');
}

// ── OPEN REPORT ──
function openReport(userId,userName){
  if(!currentUser){openModal('login-modal');return;}
  reportTarget={id:userId,name:userName};
  document.getElementById('report-modal-sub').textContent='Signaler : '+userName+' → transmis à l\'admin';
  document.querySelectorAll('input[name="report-reason"]').forEach(r=>r.checked=false);
  document.getElementById('report-details').value='';
  openModal('report-modal');
}

// ── OPEN GROUP CHAT ──
function openGroupChat(groupId,groupName,creatorId,access,allowPhotos){
  if(!currentUser){openModal('login-modal');return;}
  currentGroupId=groupId;
  document.getElementById('group-chat-title').textContent=groupName;
  document.getElementById('group-chat-sub').textContent='Groupe de discussion · '+(access==='private'?'🔒 Privé':'🌍 Public');
  // Admin controls
  const adminCtrl=document.getElementById('group-admin-controls');
  if(adminCtrl)adminCtrl.style.display=(currentUser.plan==='elite'&&currentUser.email===creatorId)?'block':'none';
  // Media upload
  const mediLabel=document.getElementById('group-media-upload-label');
  if(mediLabel)mediLabel.style.display=(allowPhotos==='1'||allowPhotos===1||allowPhotos===true)?'inline-flex':'none';
  // Load members
  const ml=document.getElementById('group-members-list');
  if(ml)ml.innerHTML='<div style="color:var(--muted2);font-size:11px">👥 En ligne...</div>';
  // Load messages
  const msgEl=document.getElementById('group-chat-msgs');
  msgEl.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)">Premier à écrire dans ce groupe 👋</div>';
  fetch('/api/groups/'+groupId+'/messages').then(r=>r.json()).then(msgs=>{
    if(!msgs.length)return;
    msgEl.innerHTML=msgs.map(m=>`<div class="chat-msg-item"><div class="chat-msg-name">${escHtml(m.author||'?')} <span class="chat-msg-plan-badge plan-${m.plan||'free'}">${(m.plan||'FREE').toUpperCase()}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-left:auto">${m.timestamp?new Date(m.timestamp).toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'}):''}</span></div>${m.text?`<div class="chat-msg-text">${escHtml(m.text)}</div>`:''}${m.mediaUrl?`<div style="margin-top:4px">${m.mediaType?.startsWith('video')?`<video src="${m.mediaUrl}" controls style="max-width:200px;border-radius:6px"></video>`:`<img src="${m.mediaUrl}" style="max-width:200px;border-radius:6px"/>`}</div>`:''}</div>`).join('');
    msgEl.scrollTop=msgEl.scrollHeight;
  }).catch(()=>{});
  openModal('group-chat-modal');
}

function openGroupSettings(groupId){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('create-group-modal');
}

// ── LIKE/PARTAGE/COMMENTAIRE DORÉS ELITE ──
function likePost(id,btn){
  const p=feedPosts.find(p=>p.id===id);
  if(!p)return;
  p.myLike=!p.myLike;
  p.likes+=p.myLike?1:-1;
  const isElite=currentUser?.plan==='elite';
  if(isElite){btn.style.borderColor='var(--gold)';btn.style.color='var(--gold)';btn.style.boxShadow='0 0 8px rgba(255,215,0,0.3)';}
  else btn.classList.toggle('active');
  btn.textContent='❤️ '+p.likes;
  // WS broadcast
  if(ws&&ws.readyState===1){ws.send(JSON.stringify({type:'like',postId:id,likes:p.likes,userId:currentUser?.email,userPlan:currentUser?.plan}));}
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('wallpaper-modal');
}
function _patchWS(){
  if(ws){
    const origOnMessage=ws.onmessage;
    ws.onmessage=(e)=>{
      if(origOnMessage)origOnMessage(e);
      try{
        const data=JSON.parse(e.data);
        if(data.type==='like'){
          const btn=document.querySelector(`[data-post-id="${data.postId}"] .btn-like`);
          if(btn)btn.textContent='❤️ '+data.likes;
        }
      }catch(err){}
    };
  }
}

function openWallpaperModal(){
  if(currentUser?.plan!=='elite'){toast('⭐ Réservé au plan ELITE.');return;}
  openModal('wallpaper-modal');
}

// ── WEBSOCKET — update for group messages ──

function escHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function getAvatarColor(id){const colors=['linear-gradient(135deg,#15803d,#4ade80)','linear-gradient(135deg,#166534,#22c55e)','linear-gradient(135deg,#14532d,#86efac)','linear-gradient(135deg,#065f46,#34d399)'];return colors[(id||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0)%colors.length];}
function getTypeEmoji(t){return{site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️'}[t]||'🚀';}
function typeName(t){return{site:'Site web',app:'Application',saas:'SaaS',tiktok:'TikTok',instagram:'Instagram',ecommerce:'E-commerce'}[t]||t;}

// ── MODALS ──
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function switchModal(a,b){closeModal(a);setTimeout(()=>openModal(b),200);}
document.querySelectorAll('.modal-bg').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

// ── STRIPE ──
try{stripe=Stripe('pk_test_VOTRE_CLE_STRIPE_ICI');}catch(e){}

// ── INIT ──
window.addEventListener('load',()=>{
  renderPlans();
  buildVitrineGrid('landing-vitrine-grid');
  buildPublicFeed();
  const saved=localStorage.getItem('viralboost_user');
  if(saved){
    currentUser=JSON.parse(saved);
    showApp();
  }
});

</script>
<!-- ── POPUP OFFRE 100 PREMIERS — s'affiche après 10 secondes ── -->
<div id="offer-popup" class="hidden">
  <div id="offer-box-wrap">
    <!-- Contenu par défaut visible instantanément -->
    <div class="offer-box">
      <button class="offer-close-btn" onclick="closeOffer()">✕</button>
      <div class="offer-crown">🎁</div>
      <div class="offer-title">OFFRE LANCEMENT</div>
      <div class="offer-sub">Limité aux 100 premiers inscrits uniquement</div>
      <div class="offer-badge">💎 PLAN PRO — 1 AN 100% GRATUIT</div>
      <div class="offer-desc">
        Valeur réelle : <strong>179,88€</strong><br>
        ✅ 999 publications/jour<br>
        ✅ Coach IA illimité<br>
        ✅ Vitrine 30 jours<br>
        ✅ Chat illimité
      </div>
      <div class="offer-timer">⏰ Offre expire dans : <span id="offer-countdown">--:--:--</span></div>
      <div class="offer-counter">
        <div class="offer-counter-num" id="offer-remaining">—</div>
        <div class="offer-counter-lbl">places restantes sur 100</div>
      </div>
      <button class="offer-cta" onclick="claimOffer()">🚀 CRÉER MON COMPTE GRATUIT</button>
      <div class="offer-skip" onclick="closeOffer()">Non merci, je préfère payer</div>
    </div>
  </div>
</div>

<script>

// ══════════════════════════════════════════════
// ── NOUVELLES FONCTIONNALITÉS ViralBoost v2 ──
// ══════════════════════════════════════════════

// ── ONBOARDING TOOLTIP (mini aide à l'arrivée) ──
const OB_STEPS = [
  {icon:'📢', label:'PUBLIE TON PROJET', desc:'Clique sur "➕ Publier" et remplis ta fiche en 2 min. Plus c\'est complet, plus tu attires.'},
  {icon:'🗳️', label:'VOTE & EXPLORE', desc:'Visite la vitrine, vote pour les projets qui te plaisent. Tu gagnes des crédits à chaque vote.'},
  {icon:'🤖', label:'IA BOOST', desc:'Génère une stratégie TikTok, SEO ou Email en 10 secondes. Onglet "IA Boost" dans le menu.'},
  {icon:'🤝', label:'TROUVE DES COLLABS', desc:'Le matching IA connecte les créateurs par niche et objectifs. Onglet "Collabs" pour tes matches.'},
  {icon:'⚡', label:'GAGNE DES CRÉDITS', desc:'Publie, vote, commente, complète des missions. Tes crédits débloquent des boosts et des plans.'},
];
let _obStep = 0;
let _obTooltip = null;

function checkOnboarding(){
  if(!currentUser || localStorage.getItem('vb_onboarded_'+currentUser.email)) return;
  setTimeout(showOnboardingTooltip, 1200);
}

function showOnboardingTooltip(){
  if(document.getElementById('ob-tooltip')) return;
  _obStep = 0;
  const el = document.createElement('div');
  el.id = 'ob-tooltip';
  el.className = 'ob-tooltip';
  el.innerHTML = buildTooltipHTML();
  document.body.appendChild(el);
  _obTooltip = el;
}

function buildTooltipHTML(){
  const s = OB_STEPS[_obStep];
  const isLast = _obStep === OB_STEPS.length - 1;
  return `<div class="ob-tooltip-inner">
    <div class="ob-tooltip-header">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;color:var(--g3)">✦ COMMENT ÇA MARCHE ?</div>
      <button class="ob-tooltip-close" onclick="closeOnboardingTooltip()">✕</button>
    </div>
    <div class="ob-steps-row" id="ob-steps-row">
      ${OB_STEPS.map((step, i) => `
        <div class="ob-step-card ${i === _obStep ? 'active' : ''}" onclick="goObStep(${i})">
          <div class="ob-step-icon">${step.icon}</div>
          <div class="ob-step-label">${step.label}</div>
          <div class="ob-step-desc">${i === _obStep ? step.desc : ''}</div>
        </div>`).join('')}
    </div>
    <div class="ob-tooltip-footer">
      <div class="ob-progress">
        ${OB_STEPS.map((_, i) => `<div class="ob-dot ${i === _obStep ? 'active' : ''}"></div>`).join('')}
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <span onclick="closeOnboardingTooltip()" style="font-size:11px;color:var(--muted2);cursor:pointer;text-decoration:underline">Passer</span>
        <button class="ob-btn-next" onclick="${isLast ? 'closeOnboardingTooltip()' : 'obNext()'}">${isLast ? 'C\'est parti 🚀' : 'Suivant →'}</button>
      </div>
    </div>
  </div>`;
}

function goObStep(i){
  _obStep = i;
  if(_obTooltip) _obTooltip.innerHTML = buildTooltipHTML();
}
function obNext(){
  if(_obStep < OB_STEPS.length - 1){ _obStep++; if(_obTooltip) _obTooltip.innerHTML = buildTooltipHTML(); }
  else closeOnboardingTooltip();
}
function closeOnboardingTooltip(){
  const el = document.getElementById('ob-tooltip');
  if(!el) return;
  el.classList.add('hiding');
  setTimeout(() => el.remove(), 350);
  if(currentUser) localStorage.setItem('vb_onboarded_'+currentUser.email, '1');
}

// Garde l'ancienne fonction showOnboarding comme alias
function showOnboarding(){ showOnboardingTooltip(); }

// ── FORMULAIRE PUBLICATION — COMPLÉTION ──
function updatePubCompletion(){
  const name = document.getElementById('pub-name')?.value.trim() || '';
  const desc = document.getElementById('pub-desc')?.value.trim() || '';
  const url  = document.getElementById('pub-url')?.value.trim() || '';
  const target = document.getElementById('pub-target')?.value.trim() || '';
  const tags = document.getElementById('pub-tags')?.value.trim() || '';
  const hasMedia = !!document.querySelector('#pub-media-preview img, #pub-media-preview video');

  const checks = {
    name: name.length >= 4,
    desc: desc.length >= 40,
    url: url.length > 5,
    target: target.length >= 3,
    tags: tags.length >= 2,
    media: hasMedia,
  };
  const done = Object.values(checks).filter(Boolean).length;
  const pct = Math.round((done / 6) * 100);

  const bar = document.getElementById('pub-completion-bar');
  const txt = document.getElementById('pub-completion-txt');
  if(bar){ bar.style.width = pct + '%'; bar.style.background = pct >= 80 ? 'linear-gradient(90deg,#16a34a,#4ade80)' : pct >= 50 ? 'linear-gradient(90deg,var(--g2),var(--g3))' : 'linear-gradient(90deg,var(--g1),var(--g2))'; }
  if(txt){ txt.textContent = pct + '%'; txt.style.color = pct >= 80 ? 'var(--g3)' : pct >= 50 ? 'var(--gold)' : 'var(--muted)'; }

  document.querySelectorAll('.pub-hint').forEach(el => {
    const hint = el.dataset.hint;
    el.classList.toggle('done', !!checks[hint]);
    el.classList.toggle('pending', !checks[hint]);
  });

  // Compteur nom
  const nc = document.getElementById('pub-name-count');
  if(nc) nc.textContent = name.length;
  // Label plan
  const pl = document.getElementById('pub-plan-label');
  if(pl && currentUser){ const lbl = {free:'FREE · 24h',starter:'STARTER · 7j',pro:'PRO · 30j',elite:'ELITE · Permanent'}; pl.textContent = '📋 ' + (lbl[currentUser.plan] || ''); }
}

function updateDescCount(){
  const d = document.getElementById('pub-desc')?.value || '';
  const c = document.getElementById('pub-desc-count');
  const q = document.getElementById('pub-desc-quality');
  if(c) c.textContent = d.length;
  if(q){
    if(d.length === 0) q.textContent = '';
    else if(d.length < 40) q.style.color = 'var(--muted)', q.textContent = '⚠️ Trop court';
    else if(d.length < 100) q.style.color = 'var(--gold)', q.textContent = '👍 Correct';
    else if(d.length < 200) q.style.color = 'var(--g3)', q.textContent = '✅ Bon';
    else q.style.color = 'var(--g4)', q.textContent = '🔥 Excellent';
  }
}

function renderTagsPreview(){
  const raw = document.getElementById('pub-tags')?.value || '';
  const container = document.getElementById('pub-tags-preview');
  if(!container) return;
  const tags = raw.split(',').map(t => t.trim()).filter(Boolean).slice(0, 5);
  container.innerHTML = tags.map(t => `<span class="pub-tag-chip">#${t}</span>`).join('');
  updatePubCompletion();
}

function insertDescTip(el){
  const tip = el.dataset.tip;
  const ta = document.getElementById('pub-desc');
  if(!ta) return;
  const cur = ta.value;
  const sep = cur.length > 0 && !cur.endsWith('\n') ? '\n' : '';
  ta.value = cur + sep + tip;
  ta.focus();
  updateDescCount();
  updatePubCompletion();
  updateMobilePreview();
  el.style.borderColor = 'var(--g3)';
  el.style.color = 'var(--g3)';
  setTimeout(() => { el.style.borderColor = ''; el.style.color = ''; }, 1000);
}

function updatePubTypeEmoji(){
  const type = document.getElementById('pub-type')?.value;
  const map = {saas:'🚀',site:'🌐',ecommerce:'🛍️',service:'💼',coaching:'🎓',tiktok:'🎵',instagram:'📸',newsletter:'📧',podcast:'🎙️',communaute:'👥'};
  const emojiInput = document.getElementById('pub-emoji');
  if(emojiInput && !emojiInput.value) emojiInput.value = map[type] || '🚀';
  updateMobilePreview();
}

// ── WIZARD NAVIGATION ──
let currentWizStep = 1;
const WIZ_TOTAL = 5;

function wizGoTo(step){
  // Valider avant d'avancer
  if(step > currentWizStep){
    for(let s = currentWizStep; s < step; s++){
      if(!wizValidate(s)) return;
    }
  }
  // Cacher panel actuel
  document.getElementById('wpanel-' + currentWizStep)?.classList.remove('active');
  // Mettre à jour dots
  for(let i=1; i<=WIZ_TOTAL; i++){
    const dot = document.getElementById('wdot-'+i);
    const circ = document.getElementById('wcirc-'+i);
    const conn = document.getElementById('wconn-'+i);
    if(!dot||!circ) continue;
    dot.className = 'wiz-step-dot' + (i===step?' active':i<step?' done':'');
    circ.className = 'wiz-step-circle' + (i===step?' active':i<step?' done':'');
    if(conn) conn.className = 'wiz-connector' + (i<step?' done':'');
  }
  // Afficher nouveau panel
  currentWizStep = step;
  document.getElementById('wpanel-' + step)?.classList.add('active');
  // Progress bar
  const pct = Math.round((step/WIZ_TOTAL)*100);
  const fill = document.getElementById('wiz-prog-fill');
  if(fill) fill.style.width = pct+'%';
  // Si step 5 : refresh aperçu
  if(step===5) wizRefreshPreview();
  // Scroll vers le haut du wizard
  document.getElementById('wiz-stepper')?.scrollIntoView({behavior:'smooth',block:'start'});
}

function wizNext(from){ if(wizValidate(from)) wizGoTo(from+1); }
function wizPrev(from){ wizGoTo(from-1); }

function wizValidate(step){
  if(step===1){
    const n = document.getElementById('pub-name')?.value.trim()||'';
    if(n.length < 3){ toast('Donne un nom à ton projet (3 caractères min)','error'); document.getElementById('pub-name')?.focus(); return false; }
  }
  if(step===2){
    const d = document.getElementById('pub-desc')?.value.trim()||'';
    if(d.length < 20){ toast('La description est trop courte (20 caractères min)','error'); document.getElementById('pub-desc')?.focus(); return false; }
  }
  return true;
}

function wizRefreshPreview(){
  const name = document.getElementById('pub-name')?.value||'';
  const desc = document.getElementById('pub-desc')?.value||'';
  const hook = document.getElementById('pub-hook')?.value||'';
  const emoji = document.getElementById('pub-emoji')?.value||'🚀';
  const tags = (document.getElementById('pub-tags')?.value||'').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const collab = document.getElementById('pub-collab-need')?.value||'';

  const pname = document.getElementById('wiz-prev-name');
  const pdesc = document.getElementById('wiz-prev-desc');
  const phook = document.getElementById('wiz-prev-hook');
  const pemoji = document.getElementById('wiz-prev-emoji');
  const ptags = document.getElementById('wiz-prev-tags');
  const pcollab = document.getElementById('wiz-prev-collab');
  const pauthor = document.getElementById('wiz-prev-author');
  const pimg = document.getElementById('wiz-prev-img');

  if(pname) pname.textContent = name||'Nom du projet';
  if(pdesc) pdesc.textContent = desc ? desc.slice(0,200)+(desc.length>200?'...':'') : 'Ta description apparaîtra ici...';
  if(phook){ phook.textContent=hook; phook.style.display=hook?'block':'none'; }
  if(pemoji) pemoji.textContent=emoji;
  if(ptags) ptags.innerHTML=tags.map(t=>`<span class="pub-tag-chip" style="font-size:10px;padding:2px 8px">#${t}</span>`).join('');
  const collabMap={dev:'🔍 Cherche dev',marketing:'🔍 Cherche marketeur',design:'🔍 Cherche designer',video:'🔍 Cherche créateur vidéo',investisseur:'🔍 Cherche investisseur',associe:'🔍 Cherche associé',client:'🔍 Premiers clients'};
  if(pcollab){ pcollab.textContent=collabMap[collab]||''; pcollab.style.display=collab?'block':'none'; }
  if(pauthor&&currentUser) pauthor.textContent=currentUser.name||'';
  // Image si uploadée
  if(pimg && pendingPubMediaUrl){ pimg.src=pendingPubMediaUrl; pimg.style.display='block'; const pe=document.getElementById('wiz-prev-emoji'); if(pe) pe.style.display='none'; }
  else if(pimg){ pimg.style.display='none'; const pe=document.getElementById('wiz-prev-emoji'); if(pe){ pe.style.display='block'; } }

  // Checklist complétion
  wizRefreshChecklist();
}

function wizRefreshChecklist(){
  const name = document.getElementById('pub-name')?.value.trim()||'';
  const desc = document.getElementById('pub-desc')?.value.trim()||'';
  const url = document.getElementById('pub-url')?.value.trim()||'';
  const target = document.getElementById('pub-target')?.value.trim()||'';
  const tags = document.getElementById('pub-tags')?.value.trim()||'';
  const hasMedia = !!pendingPubMediaUrl;
  const checks=[
    {key:'name',label:'📝 Nom',ok:name.length>=3},
    {key:'desc',label:'💬 Description',ok:desc.length>=50},
    {key:'hook',label:'✨ Accroche',ok:!!(document.getElementById('pub-hook')?.value.trim())},
    {key:'url',label:'🔗 Lien',ok:url.length>5},
    {key:'target',label:'🎯 Audience',ok:target.length>3},
    {key:'tags',label:'🏷️ Tags',ok:tags.length>1},
    {key:'media',label:'🖼️ Visuel',ok:hasMedia},
  ];
  const done=checks.filter(c=>c.ok).length;
  const pct=Math.round((done/checks.length)*100);
  const bar=document.getElementById('wiz-completion-bar');
  const pctEl=document.getElementById('wiz-completion-pct');
  const hints=document.getElementById('wiz-hints');
  if(bar) bar.style.width=pct+'%';
  if(pctEl){ pctEl.textContent=pct+'%'; pctEl.style.color=pct>=80?'var(--g3)':pct>=50?'var(--gold)':'var(--muted)'; }
  if(hints) hints.innerHTML=checks.map(c=>`<span style="font-size:10px;font-family:'DM Mono',monospace;padding:2px 8px;border-radius:3px;background:${c.ok?'rgba(34,197,94,0.12)':'rgba(0,0,0,0.2)'};border:1px solid ${c.ok?'rgba(34,197,94,0.25)':'var(--border2)'};color:${c.ok?'var(--g4)':'var(--muted)'}">${c.ok?'✓':''} ${c.label}</span>`).join('');
}

// ── GUIDE MODAL ──
function showPubGuide(){
  document.getElementById('pub-guide-overlay')?.classList.remove('hidden');
}
function closePubGuide(){
  document.getElementById('pub-guide-overlay')?.classList.add('hidden');
  localStorage.setItem('vb_pub_guide_seen','1');
}

// Surcharge updateMobilePreview pour mettre à jour aussi l'aperçu vitrine
const _origUpdateMobilePreview = typeof updateMobilePreview !== 'undefined' ? updateMobilePreview : null;
function updateMobilePreview(){
  const name = document.getElementById('pub-name')?.value || '';
  const desc = document.getElementById('pub-desc')?.value || '';
  const hook = document.getElementById('pub-hook')?.value || '';
  const emoji = document.getElementById('pub-emoji')?.value || '🚀';
  const tags = (document.getElementById('pub-tags')?.value || '').split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
  const stage = document.getElementById('pub-stage')?.value || '';
  const collab = document.getElementById('pub-collab-need')?.value || '';

  // Mobile preview (anciens IDs maintenus pour compat)
  const mn = document.getElementById('mob-preview-name') || document.querySelector('#mobile-pub-preview .mob-title');
  const md = document.getElementById('mob-preview-desc') || document.querySelector('#mobile-pub-preview .mob-text');
  if(mn) mn.textContent = name || 'Nom du projet';
  if(md) md.textContent = desc ? desc.slice(0, 100) + (desc.length > 100 ? '...' : '') : 'Description de ta pub apparaîtra ici...';

  // Anciens IDs de prévisualisation (compat)
  const pn = document.getElementById('pub-preview-name');
  const pd = document.getElementById('pub-preview-desc');
  const pe = document.getElementById('pub-preview-emoji');
  const ph = document.getElementById('pub-preview-hook');
  const pt = document.getElementById('pub-preview-tags');
  const ps = document.getElementById('pub-preview-stage-badge');
  const pc = document.getElementById('pub-preview-collab-badge');
  const pa = document.getElementById('pub-preview-author');
  if(pn) pn.textContent = name || 'Nom du projet';
  if(pd) pd.textContent = desc ? desc.slice(0, 160) + (desc.length > 160 ? '...' : '') : 'Ta description apparaîtra ici...';
  if(pe) pe.textContent = emoji;
  if(ph){ ph.textContent = hook; ph.style.display = hook ? 'block' : 'none'; }
  if(pt){ pt.innerHTML = tags.map(t => `<span class="pub-tag-chip" style="font-size:10px;padding:2px 8px">#${t}</span>`).join(''); }
  const stageMap = {idee:'💭 Idée',beta:'🧪 Beta',lance:'🚀 Lancé',croissance:'📈 En croissance',monetise:'💰 Monétisé'};
  if(ps){ ps.textContent = stageMap[stage] || ''; ps.style.display = stage && stage !== 'lance' ? 'block' : 'none'; }
  if(pc){ const collabMap = {dev:'🔍 Cherche dev',marketing:'🔍 Cherche marketeur',design:'🔍 Cherche designer',video:'🔍 Cherche créateur vidéo',investisseur:'🔍 Cherche investisseur',associe:'🔍 Cherche associé',client:'🔍 Premiers clients'}; pc.textContent = collabMap[collab]||''; pc.style.display = collab ? 'block' : 'none'; }
  if(pa && currentUser) pa.textContent = currentUser.name || '';

  // Complétion
  updatePubCompletion();
}

// ── STATS / ANALYTICS — VRAIES DONNÉES ──
function loadStats(){
  if(!currentUser)return;

  // Mes vraies publications
  const myPosts=feedPosts.filter(p=>p.userId===currentUser.email||p.userId===currentUser.id);
  const myProjects=vitrineData.filter(p=>p.authorId===currentUser.email);

  // Vrais chiffres calculés depuis les données réelles
  const totalLikes=myPosts.reduce((s,p)=>s+(p.likes||0),0);
  const totalComments=myPosts.reduce((s,p)=>s+(p.comments||0),0);
  const totalVotes=myProjects.reduce((s,p)=>s+(p.votes||0),0);
  const totalFollowers=(currentUser.followers||[]).length;
  const totalFollowing=(currentUser.following||[]).length;

  // KPIs
  document.getElementById('stat-views').textContent=(totalLikes*12+totalComments*5+myPosts.length*30).toLocaleString('fr');
  document.getElementById('stat-clicks').textContent=(totalLikes*2+totalVotes).toLocaleString('fr');
  document.getElementById('stat-posts').textContent=myPosts.length+myProjects.length;
  document.getElementById('stat-followers').textContent=totalFollowers;

  // Tendances basées sur données réelles
  const hasActivity=myPosts.length>0||myProjects.length>0;
  document.getElementById('stat-views-trend').textContent=hasActivity?'↑ Actif':'— Publie pour voir tes stats';
  document.getElementById('stat-views-trend').className='stat-card-trend '+(hasActivity?'up':'');
  document.getElementById('stat-clicks-trend').textContent=totalLikes>0?'↑ '+totalLikes+' likes':'— 0 like';
  document.getElementById('stat-clicks-trend').className='stat-card-trend '+(totalLikes>0?'up':'');
  document.getElementById('stat-followers-trend').textContent=totalFollowers>0?'↑ '+totalFollowing+' abonnements':'— Suis des créateurs';
  document.getElementById('stat-followers-trend').className='stat-card-trend '+(totalFollowers>0?'up':'');

  // Graphique vues 7 jours — basé sur tes vraies pubs
  const chart=document.getElementById('views-chart');
  const labels=document.getElementById('views-chart-labels');
  const days=['L','M','M','J','V','S','D'];
  const today=new Date();
  // Calcule les vues par jour réelles en regardant les timestamps des posts
  const vals=days.map((_,i)=>{
    const d=new Date(today);d.setDate(today.getDate()-6+i);
    const dayStr=d.toDateString();
    const dayPosts=myPosts.filter(p=>{
      if(!p.createdAt&&!p.time)return false;
      const pd=p.createdAt?new Date(p.createdAt).toDateString():'';
      return pd===dayStr;
    });
    // Si pas de timestamps précis, distribue les likes existants
    return dayPosts.length>0?dayPosts.reduce((s,p)=>s+(p.likes||0)*12+15,0):0;
  });
  // Si aucune donnée avec timestamp, montre quand même les totaux de façon lisible
  const hasTimestamps=vals.some(v=>v>0);
  const displayVals=hasTimestamps?vals:[0,0,0,0,0,0,totalLikes*12+myPosts.length*30];
  const max=Math.max(...displayVals,1);
  if(chart){
    chart.innerHTML=displayVals.map((v,i)=>`<div class="mini-bar" style="height:${Math.max(4,Math.round(v/max*100))}%;${v===0?'opacity:0.2':''}" title="Jour ${days[i]} : ${v} vues estimées"></div>`).join('');
    labels.innerHTML=days.map(d=>`<span>${d}</span>`).join('');
  }

  // Top pubs RÉELLES de l'utilisateur
  const tp=document.getElementById('top-posts-list');
  if(tp){
    if(!myPosts.length&&!myProjects.length){
      tp.innerHTML='<div style="color:var(--muted);font-size:11px;padding:8px 0">Tu n\'as pas encore publié. <a onclick="showAppTab(\'publier\',null)" style="color:var(--g3);cursor:pointer">Publier maintenant →</a></div>';
    } else {
      const sorted=[...myPosts].sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,3);
      tp.innerHTML=sorted.map((p,i)=>`
        <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border2)">
          <div style="font-size:11px;color:var(--g5);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px">${i+1}. ${escHtml((p.text||'').substring(0,40))}</div>
          <div style="display:flex;gap:8px;font-family:'DM Mono',monospace;font-size:10px;flex-shrink:0">
            <span style="color:var(--g3)">❤️ ${p.likes||0}</span>
            <span style="color:var(--muted)">💬 ${p.comments||0}</span>
          </div>
        </div>`).join('');
    }
  }

  // Répartition par catégorie — MES projets réels
  const cc=document.getElementById('cat-chart');
  if(cc){
    const allMine=[...myPosts,...myProjects];
    if(!allMine.length){
      cc.innerHTML='<div style="color:var(--muted);font-size:11px;padding:8px 0">Aucune publication encore</div>';
    } else {
      const catCount={};
      allMine.forEach(p=>{
        const cat=p.projType||p.cat||p.type||'autre';
        catCount[cat]=(catCount[cat]||0)+1;
      });
      const total=allMine.length;
      const catEmojis={site:'🌐',app:'📱',saas:'🚀',tiktok:'🎵',instagram:'📸',ecommerce:'🛍️',service:'💼',coaching:'🎓',autre:'📦'};
      cc.innerHTML=Object.entries(catCount).sort((a,b)=>b[1]-a[1]).map(([cat,count])=>{
        const pct=Math.round(count/total*100);
        return `<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
          <span style="font-size:11px;width:80px;flex-shrink:0">${catEmojis[cat]||'📦'} ${cat}</span>
          <div style="flex:1;height:8px;background:var(--s2);border-radius:4px">
            <div style="width:${pct}%;height:100%;background:var(--g2);border-radius:4px;transition:width 0.5s"></div>
          </div>
          <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);width:28px;text-align:right">${pct}%</span>
        </div>`;
      }).join('');
    }
  }

  // Résumé global en bas
  const summary=`
    <div style="background:rgba(34,197,94,0.05);border:1.5px solid rgba(34,197,94,0.12);border-radius:10px;padding:14px 18px;margin-top:14px;font-size:12px;color:var(--g5);line-height:1.8">
      📊 <strong style="color:var(--g3)">${myPosts.length}</strong> publication${myPosts.length>1?'s':''} ·
      <strong style="color:var(--g3)">${myProjects.length}</strong> projet${myProjects.length>1?'s':''} en vitrine ·
      <strong style="color:var(--g3)">${totalLikes}</strong> like${totalLikes>1?'s':''} reçus ·
      <strong style="color:var(--g3)">${totalVotes}</strong> vote${totalVotes>1?'s':''} ·
      <strong style="color:var(--g3)">${totalFollowers}</strong> abonné${totalFollowers>1?'s':''}
    </div>`;
  const statsPanel=document.getElementById('tab-stats');
  if(statsPanel){
    const existing=statsPanel.querySelector('.stats-summary');
    if(existing)existing.remove();
    const wrap=statsPanel.querySelector('[style*="max-width:960px"]');
    if(wrap){const div=document.createElement('div');div.className='stats-summary';div.innerHTML=summary;wrap.appendChild(div);}
  }
}

// ── BOOST CRÉDITS ──
let userCredits=parseInt(localStorage.getItem('vb_credits')||'0');
let selectedBoostOpt='top-feed';
let pendingShopItem=null, pendingShopCost=0;

// ── MISSIONS QUOTIDIENNES ──
const MISSIONS_DEF = [
  // ── QUOTIDIENNES ──
  { id:'pub1',      icon:'📝', title:'Publie aujourd\'hui',         desc:'Poste 1 publication',              max:1,  reward:8,  counter:u=>Math.min(u._todayPosts||0,1) },
  { id:'pub3',      icon:'🔥', title:'3 publications en un jour',   desc:'Poste 3 publications aujourd\'hui',max:3,  reward:20, counter:u=>Math.min(u._todayPosts||0,3) },
  { id:'pub5',      icon:'💥', title:'5 publications en un jour',   desc:'Poste 5 publications aujourd\'hui',max:5,  reward:35, counter:u=>Math.min(u._todayPosts||0,5) },
  { id:'like3',     icon:'❤️', title:'Like 3 posts',                desc:'Aime 3 publications',              max:3,  reward:6,  counter:u=>Math.min(u._todayLikes||0,3) },
  { id:'like10',    icon:'💗', title:'Like 10 posts',               desc:'Aime 10 publications',             max:10, reward:15, counter:u=>Math.min(u._todayLikes||0,10) },
  { id:'dm1',       icon:'💬', title:'Envoie un DM',                desc:'Contacte un créateur',             max:1,  reward:5,  counter:u=>Math.min(u._todayDMs||0,1) },
  { id:'dm3',       icon:'📨', title:'3 DMs envoyés',               desc:'Contacte 3 créateurs',             max:3,  reward:12, counter:u=>Math.min(u._todayDMs||0,3) },
  { id:'profil',    icon:'✍️', title:'Complète ton profil',         desc:'Ajoute bio + lien',                max:1,  reward:15, counter:u=>(u.bio&&u.bio.length>10&&(u.website||u.tiktok||u.instagram)?1:0) },
  { id:'vitrine1',  icon:'✨', title:'Publie en vitrine',           desc:'Ajoute un projet à la vitrine',    max:1,  reward:12, counter:u=>Math.min(u._todayProjects||0,1) },
  { id:'chat5',     icon:'🌐', title:'5 messages chat mondial',     desc:'Participe au chat communautaire',  max:5,  reward:10, counter:u=>Math.min(u._todayChat||0,5) },
  { id:'chat10',    icon:'💭', title:'10 messages chat mondial',    desc:'Contribue activement au chat',     max:10, reward:20, counter:u=>Math.min(u._todayChat||0,10) },
  { id:'connexion', icon:'🌅', title:'Connexion quotidienne',       desc:'Connecte-toi chaque jour',         max:1,  reward:5,  counter:u=>1 },
  { id:'vote3',     icon:'🗳️', title:'Vote pour 3 projets',         desc:'Vote pour des projets en vitrine', max:3,  reward:8,  counter:u=>Math.min(u._todayVotes||0,3) },
  { id:'share1',    icon:'📤', title:'Partage une publication',     desc:'Partage 1 pub de la communauté',   max:1,  reward:7,  counter:u=>Math.min(u._todayShares||0,1) },
  { id:'react5',    icon:'😍', title:'5 réactions sur des posts',   desc:'Utilise 5 réactions (🔥💡💸👏)',   max:5,  reward:10, counter:u=>Math.min(u._todayReacts||0,5) },
  { id:'react_all', icon:'🎭', title:'Utilise 4 types de réactions',desc:'Essaie feu, idée, cash et bravo',  max:4,  reward:18, counter:u=>Math.min(u._todayReactTypes||0,4) },
  { id:'follow1',   icon:'👥', title:'Suis un créateur',            desc:'Abonne-toi à 1 créateur',          max:1,  reward:5,  counter:u=>Math.min((u._todayFollows||0),1) },
  { id:'follow5',   icon:'🤝', title:'Suis 5 créateurs',            desc:'Abonne-toi à 5 créateurs',         max:5,  reward:15, counter:u=>Math.min((u._todayFollows||0),5) },
  { id:'comment2',  icon:'💡', title:'Commente 2 posts',            desc:'Laisse 2 commentaires',            max:2,  reward:8,  counter:u=>Math.min(u._todayComments||0,2) },
  { id:'iaboost1',  icon:'🤖', title:'Utilise IA Boost',            desc:'Génère une stratégie IA',          max:1,  reward:18, counter:u=>Math.min(u._todayIA||0,1) },
  { id:'collab1',   icon:'🔗', title:'Propose une collaboration',   desc:'Contacte quelqu\'un via Collabs',  max:1,  reward:20, counter:u=>Math.min(u._todayCollabs||0,1) },
  { id:'group1',    icon:'👾', title:'Rejoins un groupe',           desc:'Participe à 1 groupe thématique',  max:1,  reward:10, counter:u=>Math.min(u._todayGroups||0,1) },
  { id:'profil_img',icon:'🖼️', title:'Ajoute tes réseaux sociaux', desc:'Renseigne TikTok ou Instagram',    max:1,  reward:12, counter:u=>(u.tiktok||u.instagram?1:0) },
  { id:'streak3',   icon:'🌟', title:'Connexion 3 jours de suite',  desc:'Reviens chaque jour',              max:3,  reward:30, counter:u=>Math.min(u._loginStreak||0,3) },
  { id:'credits50', icon:'⚡', title:'Accumule 50 crédits',         desc:'Atteins 50 ViralCrédits',          max:50, reward:25, counter:u=>Math.min(userCredits||0,50) },
  { id:'pub_desc',  icon:'📋', title:'Pub avec description longue', desc:'Écris une pub de 100+ caractères', max:1,  reward:10, counter:u=>Math.min(u._todayLongPosts||0,1) },
  // ── NOUVELLES — IMAGES & MÉDIAS ──
  { id:'pub_img',   icon:'📸', title:'Publie avec une image',       desc:'Ajoute une photo à ta publication',max:1,  reward:14, counter:u=>Math.min(u._todayMediaPosts||0,1) },
  { id:'pub_img3',  icon:'🖼️', title:'3 pubs avec image',           desc:'Publie 3 fois avec une image',     max:3,  reward:28, counter:u=>Math.min(u._todayMediaPosts||0,3) },
  { id:'pub_video', icon:'🎬', title:'Publie une vidéo',            desc:'Partage une vidéo avec la communauté',max:1, reward:20, counter:u=>Math.min(u._todayVideoPosts||0,1) },
  { id:'pub_file',  icon:'📄', title:'Partage un fichier',          desc:'Ajoute un fichier PDF ou document', max:1, reward:12, counter:u=>Math.min(u._todayFilePosts||0,1) },
  { id:'vitrine_img',icon:'🌠',title:'Vitrine avec image',          desc:'Publie un projet avec un visuel',  max:1,  reward:20, counter:u=>Math.min(u._todayVisualProjects||0,1) },
  // ── NOUVELLES — ICÔNES AVATAR ──
  { id:'ava_emoji', icon:'🎭', title:'Change d\'avatar',            desc:'Mets à jour ton emoji ou photo',   max:1,  reward:8,  counter:u=>(u._changedAvatar?1:0) },
  { id:'ava_photo', icon:'📷', title:'Photo de profil',             desc:'Ajoute une vraie photo de profil', max:1,  reward:25, counter:u=>(u.avatarUrl?1:0) },
  // ── NOUVELLES — RÉACTIONS PREMIUM ──
  { id:'react_rocket',icon:'🚀',title:'Réaction Décollage',        desc:'Utilise la réaction 🚀 (Starter+)', max:3,  reward:15, counter:u=>Math.min(u._todayRocketReacts||0,3), premium:'starter' },
  { id:'react_crown', icon:'👑',title:'Réaction Royale',           desc:'Utilise la réaction 👑 (Pro+)',     max:3,  reward:20, counter:u=>Math.min(u._todayCrownReacts||0,3), premium:'pro' },
  { id:'react_gem',   icon:'💎',title:'Réaction Gem',              desc:'Utilise la réaction 💎 (Pro+)',     max:5,  reward:18, counter:u=>Math.min(u._todayGemReacts||0,5),   premium:'pro' },
  { id:'react_star',  icon:'🌟',title:'Réaction Star',             desc:'Utilise la réaction 🌟 (Elite)',   max:5,  reward:25, counter:u=>Math.min(u._todayStarReacts||0,5),  premium:'elite' },
];

function getMissionsState(){
  const today = new Date().toDateString();
  const raw = JSON.parse(localStorage.getItem('vb_missions_'+today)||'{}');
  return raw;
}
function saveMissionsState(state){
  const today = new Date().toDateString();
  localStorage.setItem('vb_missions_'+today, JSON.stringify(state));
}

function renderMissions(){
  const list = document.getElementById('missions-list');
  if(!list) return;
  const state = getMissionsState();
  const plan = currentUser?.plan||'free';
  const planOrder = {free:0,starter:1,pro:2,elite:3};
  const userLevel = planOrder[plan]||0;

  // Grouper par catégorie
  const categories = [
    {label:'📅 Quotidiennes', ids:['pub1','pub3','pub5','like3','like10','connexion','dm1','dm3','chat5','chat10','vote3','share1','comment2','follow1','follow5','iaboost1','collab1','group1']},
    {label:'🖼️ Images & Médias', ids:['pub_img','pub_img3','pub_video','pub_file','vitrine_img','pub_desc','vitrine1']},
    {label:'😎 Avatar & Profil', ids:['ava_emoji','ava_photo','profil','profil_img']},
    {label:'🎭 Réactions', ids:['react5','react_all','react_rocket','react_crown','react_gem','react_star']},
    {label:'⚡ Progression', ids:['streak3','credits50']},
  ];

  let html = '';
  categories.forEach(cat => {
    const missions = MISSIONS_DEF.filter(m => cat.ids.includes(m.id));
    if(!missions.length) return;
    html += `<div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--g3);letter-spacing:2px;margin:16px 0 8px;text-transform:uppercase">${cat.label}</div>`;
    html += missions.map(m => {
      const prog = m.counter(currentUser||{});
      const done = state[m.id+'_claimed'];
      const canClaim = prog >= m.max && !done;
      const pct = Math.round((prog/m.max)*100);
      const reqLevel = m.premium ? planOrder[m.premium]||0 : 0;
      const locked = reqLevel > 0 && userLevel < reqLevel;
      const premiumBadge = m.premium ? `<span style="font-size:8px;font-family:'DM Mono',monospace;background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.15));border:1px solid rgba(255,215,0,0.4);border-radius:3px;padding:1px 6px;color:var(--gold);margin-left:6px">${m.premium.toUpperCase()}</span>` : '';
      return `<div class="mission-card ${done?'done':''} ${locked?'locked':''}">
        <div class="mission-icon" style="${locked?'filter:grayscale(1);opacity:0.5':''}">${m.icon}</div>
        <div class="mission-info">
          <div class="mission-title">${m.title}${premiumBadge}</div>
          <div class="mission-desc">${locked?`🔒 Requiert ${m.premium?.toUpperCase()} — Upgrade pour débloquer`:m.desc}</div>
          <div class="mission-prog-bar"><div class="mission-prog-fill" style="width:${locked?0:pct}%"></div></div>
          <div class="mission-prog-txt">${locked?'--':prog+'/'+m.max}</div>
        </div>
        <div class="mission-reward">
          <div class="mission-reward-val" style="${locked?'color:var(--muted)':''}">+${m.reward}</div>
          <div class="mission-reward-label">⚡ crédits</div>
          ${done
            ? '<div class="mission-done-tag">✅ Réclamé</div>'
            : locked
              ? `<button class="btn-claim" style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,140,0,0.08));border-color:rgba(255,215,0,0.3);color:var(--gold)" onclick="openModal('pricing-modal')">Upgrade →</button>`
              : `<button class="btn-claim" onclick="claimMission('${m.id}',${m.reward})" ${canClaim?'':'disabled'}>${canClaim?'Réclamer':'En cours'}</button>`
          }
        </div>
      </div>`;
    }).join('');
  });
  list.innerHTML = html;
}

function claimMission(id, reward){
  const m = MISSIONS_DEF.find(x=>x.id===id);
  if(!m) return;
  const prog = m.counter(currentUser||{});
  if(prog < m.max){ toast('Mission pas encore terminée !','error'); return; }
  const state = getMissionsState();
  if(state[id+'_claimed']){ toast('Déjà réclamé !','error'); return; }
  state[id+'_claimed'] = true;
  saveMissionsState(state);
  addCredits(reward);
  toast(`⚡ +${reward} crédits réclamés ! Mission accomplie 🎯`);
  renderMissions();
}

function updateMissionsCountdown(){
  const el = document.getElementById('missions-countdown');
  if(!el) return;
  const now = new Date();
  const midnight = new Date(now); midnight.setHours(24,0,0,0);
  const diff = midnight - now;
  const h = Math.floor(diff/3600000);
  const m = Math.floor((diff%3600000)/60000);
  const s = Math.floor((diff%60000)/1000);
  el.textContent = String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}
setInterval(updateMissionsCountdown, 1000);

// Incrémenter compteurs journaliers
function trackTodayAction(action){
  if(!currentUser) return;
  const key = '_today'+action;
  currentUser[key] = (currentUser[key]||0)+1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  renderMissions();
}

// ── BOUTIQUE ──
function switchCreditsTab(tab, btn){
  document.querySelectorAll('.credits-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.cpanel').forEach(p=>p.classList.remove('active'));
  const tabBtn = typeof btn === 'string' ? document.getElementById('ctab-'+tab) : btn;
  if(tabBtn) tabBtn.classList.add('active');
  const panel = document.getElementById('cpanel-'+tab);
  if(panel) panel.classList.add('active');
  if(tab==='missions') renderMissions();
  if(tab==='boost'||tab==='shop') loadBoostPostOptions();
  if(tab==='plans') updatePlansCreditsPanel();
}

function updatePlansCreditsPanel(){
  const el = document.getElementById('plans-credits-display');
  const planEl = document.getElementById('plans-current-plan');
  if(el) el.textContent = userCredits;
  if(planEl && currentUser) planEl.textContent = (currentUser.plan||'free').toUpperCase();
  // Update progress bars
  const costs = { starter:800, pro:3500, elite:9000 };
  ['starter','pro','elite'].forEach(planId=>{
    const cost = costs[planId];
    const pct = Math.min(100, Math.round((userCredits/cost)*100));
    const bar = document.getElementById(planId+'-progress-bar');
    const txt = document.getElementById(planId+'-progress-txt');
    if(bar) bar.style.width = pct+'%';
    if(txt){
      if(userCredits >= cost) txt.textContent = '✅ Tu peux acheter ce plan !';
      else txt.textContent = `${userCredits}/${cost}⚡ (${pct}% atteint — il te manque ${cost-userCredits}⚡)`;
      txt.style.color = userCredits >= cost ? 'var(--g3)' : 'var(--muted)';
    }
  });
}

let _shopBoostType=null, _shopBoostCost=0;
function shopBuy(item, cost){
  if(!currentUser){openModal('login-modal');return;}
  const boostItems = ['top-feed','vitrine-24h','notif-push','boost-7j'];
  if(boostItems.includes(item)){
    if(userCredits < cost){ toast(`⚡ Il te faut ${cost} crédits. Tu en as ${userCredits}.`,'error'); return; }
    const wrap = document.getElementById('shop-boost-select-wrap');
    wrap.style.display = 'block';
    _shopBoostType = item; _shopBoostCost = cost;
    loadBoostPostOptions();
    wrap.scrollIntoView({behavior:'smooth',block:'nearest'});
    return;
  }
  if(userCredits < cost){ toast(`⚡ Il te faut ${cost} crédits. Tu en as ${userCredits}.`,'error'); return; }
  spendCredits(cost);
  const labels={
    'cadre-or':'🖼️ Cadre Doré activé sur ton profil !',
    'badge-feu':'🔥 Badge Feu ajouté à ton profil !',
    'emoji-pack':'🎭 Pack Emojis+ débloqué !',
    'titre-vip':'💎 Titre VIP ajouté sous ton nom !',
    'ia-analyse':'🔬 Analyse IA lancée — check l\'onglet IA Boost !',
    'ia-hashtags':'📌 30 hashtags viraux générés — check IA Boost !',
    'ia-strategie':'🗺️ Stratégie 30 jours générée — check IA Boost !'
  };
  toast(labels[item]||'✅ Achat effectué !');
  // Sauvegarde l'achat
  const bought = JSON.parse(localStorage.getItem('vb_shop_items')||'[]');
  bought.push({item, date:new Date().toISOString()});
  localStorage.setItem('vb_shop_items', JSON.stringify(bought));
}

function confirmShopBoost(){
  const sel = document.getElementById('boost-post-select');
  if(!sel||!sel.value){ toast('Choisis une publication !','error'); return; }
  if(userCredits < _shopBoostCost){ toast(`⚡ Crédits insuffisants.`,'error'); return; }
  spendCredits(_shopBoostCost);
  document.getElementById('shop-boost-select-wrap').style.display='none';
  const labels={'top-feed':'🔝 Publication mise en top du fil pendant 2h !','vitrine-24h':'✨ Publication épinglée en vitrine 24h !','notif-push':'🔔 Notification envoyée à la communauté !','boost-7j':'🏆 Boost 7 jours activé !'};
  toast(labels[_shopBoostType]||'🚀 Boost activé !');
}

function addCredits(n){
  userCredits += n;
  localStorage.setItem('vb_credits', userCredits);
  updateCreditsDisplay();
}
function spendCredits(n){
  userCredits = Math.max(0, userCredits - n);
  localStorage.setItem('vb_credits', userCredits);
  updateCreditsDisplay();
}

// ── ACHETER UN PLAN AVEC DES CRÉDITS ──
const PLAN_CREDIT_COSTS = { starter: 800, pro: 3500, elite: 9000 };
function buyPlanWithCredits(planId){
  if(!currentUser){ openModal('login-modal'); return; }
  const cost = PLAN_CREDIT_COSTS[planId];
  if(!cost){ toast('Plan introuvable.','error'); return; }
  const planName = planId.toUpperCase();
  if(currentUser.plan === planId){ toast(`Tu as déjà le plan ${planName} !`,'error'); return; }
  if(userCredits < cost){
    const missing = cost - userCredits;
    toast(`⚡ Il te manque ${missing} crédits pour le plan ${planName}. Continue tes missions !`,'error');
    return;
  }
  if(!confirm(`Acheter le plan ${planName} pour ${cost}⚡ ViralCrédits (1 mois) ?`)) return;
  spendCredits(cost);
  const prevPlan = currentUser.plan;
  currentUser.plan = planId;
  currentUser._planBoughtWithCredits = (currentUser._planBoughtWithCredits||0) + 1;
  localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
  updateAppBar();
  checkNewBadges();
  toast(`🎉 Plan ${planName} activé pour 1 mois ! -${cost}⚡`);
  // Sync API
  try{ fetch('/api/register-user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentUser)}).catch(()=>{}); }catch(e){}
  // Refresh credits display
  updateCreditsDisplay();
}

function updateCreditsDisplay(){
  const val = userCredits;
  document.querySelectorAll('#user-credits').forEach(el=>el.textContent=val);
  const hc = document.getElementById('header-credits');
  if(hc) hc.textContent = val;
  const bnc = document.getElementById('bn-credits-val');
  if(bnc) bnc.textContent = val;
}
function bottomNavGoCredits(btn){
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  showAppTab('boost-credits', document.querySelector('.app-tab[onclick*="boost-credits"]'));
  switchCreditsTab('shop', document.getElementById('ctab-shop'));
}
function selectBoostOpt(el,type){
  document.querySelectorAll('.boost-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  selectedBoostOpt=type;
}
function buyCredits(amount,price){
  toast(`💳 Redirection paiement ${price}€ pour ${amount} crédits...`);
  setTimeout(()=>{
    addCredits(amount);
    toast(`⚡ ${amount} ViralCredits ajoutés !`);
  },1200);
}
function openBuyCredits(){ switchCreditsTab('packs', document.getElementById('ctab-packs')); }
function applyBoost(){
  const sel=document.getElementById('boost-post-select2');
  const costs={'top-feed':10,'vitrine-24h':25,'notif-push':50,'boost-7j':80};
  const cost=costs[selectedBoostOpt]||10;
  if(userCredits<cost){toast('⚡ Crédits insuffisants. Achète un pack !','error');return;}
  if(!sel||!sel.value){toast('Choisis une publication à booster !','error');return;}
  spendCredits(cost);
  toast('🚀 Boost activé ! Ta publication est mise en avant.');
}
function loadBoostPostOptions(){
  ['boost-post-select','boost-post-select2'].forEach(id=>{
    const sel=document.getElementById(id);
    if(!sel||!feedPosts)return;
    const myPosts=feedPosts.filter(p=>p.userId===currentUser?.email||p.author===currentUser?.name);
    sel.innerHTML='<option value="">Choisir une publication...</option>'+myPosts.map(p=>`<option value="${p.id}">${(p.text||'').substring(0,50)}…</option>`).join('');
  });
}

// ── LEADERBOARD ──
function loadLeaderboard(type='pubs'){
  const list=document.getElementById('leaderboard-list');
  if(!list)return;
  let items=[];
  if(type==='pubs'){
    items=feedPosts.sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,10)
      .map((p,i)=>({rank:i+1,name:(p.text||'').substring(0,55),sub:p.author||'?',score:(p.likes||0)+' réactions',plan:p.plan||'free'}));
  }else if(type==='createurs'){
    // Uniquement les vrais utilisateurs depuis l'API — pas de données fictives
    items=[];
  }else{
    items=vitrineData.sort((a,b)=>b.votes-a.votes).slice(0,8)
      .map((p,i)=>({rank:i+1,name:p.name,sub:p.type,score:p.votes+' votes'}));
  }
  if(!items.length){
    list.innerHTML='<div style="text-align:center;padding:40px;color:var(--muted)">Le classement se remplira avec les vraies publications de la communauté 🚀</div>';
    return;
  }
  const medals=['🥇','🥈','🥉'];
  list.innerHTML=items.map(item=>`
    <div class="lb-item${item.rank<=3?' top'+item.rank:''}">
      <div class="lb-rank">${item.rank}</div>
      ${item.rank<=3?`<div class="lb-medal">${medals[item.rank-1]}</div>`:''}
      <div class="lb-info"><div class="lb-name">${escHtml(item.name)}</div><div class="lb-sub">${item.sub||''}</div></div>
      <div class="lb-score">${item.score}</div>
    </div>`).join('');
}
function switchLeaderboard(type,btn){
  document.querySelectorAll('#tab-leaderboard .feed-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  loadLeaderboard(type);
}

// ── COLLABS MATCHING IA ──
async function loadCollabs(){
  const list=document.getElementById('collab-list');
  if(!list||!currentUser)return;
  list.innerHTML='<div style="text-align:center;padding:24px;color:var(--muted)"><span class="dots"><span></span><span></span><span></span></span> Analyse en cours...</div>';
  await new Promise(r=>setTimeout(r,900));
  // Chercher les vrais utilisateurs depuis l'API
  let candidates=[];
  try{
    const r=await fetchWithTimeout('/api/admin/all-users');
    const users=await r.json();
    candidates=(users||[])
      .filter(u=>u.email!==currentUser.email)
      .map(u=>({
        name:u.name||u.email.split('@')[0],
        avatar:u.avatar||'🙂',
        niche:u.niche||'Créateur',
        goal:u.goal||'',
        skills:u.skills||'',
        id:u.email,
        plan:u.plan||'free'
      }))
      .slice(0,10);
  }catch(e){}
  if(!candidates.length){
    list.innerHTML=`<div style="text-align:center;padding:48px 24px;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">🤝</div>
      <div style="font-size:14px;font-weight:700;color:var(--g5);margin-bottom:8px">Pas encore de créateurs à matcher</div>
      <div style="font-size:12px;line-height:1.8">Le matching IA se base sur les vrais profils de la communauté.<br>Complète ton profil et reviens quand la communauté grandira !</div>
    </div>`;
    return;
  }
  list.innerHTML=candidates.map(c=>`
    <div class="collab-card">
      <div class="collab-header">
        <div class="collab-ava" style="background:linear-gradient(135deg,var(--g1),var(--g3))">${c.avatar}</div>
        <div style="flex:1">
          <div style="font-size:14px;font-weight:700;margin-bottom:2px">${escHtml(c.name)}</div>
          <div style="font-size:11px;color:var(--muted)">${escHtml(c.niche)}${c.skills?' · '+escHtml(c.skills):''}</div>
          <span class="chat-msg-plan-badge plan-${c.plan}" style="margin-top:4px;display:inline-block">${(c.plan||'FREE').toUpperCase()}</span>
        </div>
      </div>
      ${c.goal?`<div class="collab-why">Objectif : <em>${escHtml(c.goal)}</em></div>`:''}
      <div style="display:flex;gap:8px">
        <button class="btn-collab" onclick="openDMToUser('${c.id}','${escHtml(c.name)}')">💬 Contacter</button>
        <button onclick="this.textContent='✓ Ignoré';this.disabled=true" style="background:transparent;border:1.5px solid var(--border2);border-radius:6px;padding:7px 14px;font-size:12px;cursor:pointer;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif">Ignorer</button>
      </div>
    </div>`).join('');
}

// ── CALENDRIER ÉDITORIAL ──
let calYear=new Date().getFullYear(),calMonth=new Date().getMonth();
const calPosts={};
function buildCalendar(){
  const grid=document.getElementById('cal-grid');
  const label=document.getElementById('cal-month-label');
  if(!grid)return;
  const months=['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];
  label.textContent=months[calMonth]+' '+calYear;
  const first=new Date(calYear,calMonth,1);
  const last=new Date(calYear,calMonth+1,0).getDate();
  let startDay=first.getDay()||7; // 1=lun
  const today=new Date();
  let html='';
  for(let i=1;i<startDay;i++) html+='<div class="cal-day" style="opacity:0.2"></div>';
  for(let d=1;d<=last;d++){
    const key=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday=d===today.getDate()&&calMonth===today.getMonth()&&calYear===today.getFullYear();
    const posts=calPosts[key]||[];
    html+=`<div class="cal-day${posts.length?' has-post':''}${isToday?' today':''}" onclick="calDayClick('${key}')">
      <div class="cal-num">${d}</div>
      ${posts.map(()=>'<span class="cal-post-dot"></span>').join('')}
    </div>`;
  }
  grid.innerHTML=html;
  // Optimal slots
  const slots=document.getElementById('optimal-slots');
  if(slots){
    const times=['Lun 18h','Mar 12h','Mer 19h','Jeu 9h','Ven 17h','Sam 11h','Dim 20h'];
    slots.innerHTML=times.map(t=>`<span class="slot-chip" onclick="this.classList.toggle('selected')" title="Cliquer pour programmer">⏰ ${t}</span>`).join('');
  }
}
function calNav(dir){
  calMonth+=dir;
  if(calMonth>11){calMonth=0;calYear++;}
  if(calMonth<0){calMonth=11;calYear--;}
  buildCalendar();
}
function calDayClick(key){
  const text=prompt('Titre de la publication planifiée :');
  if(!text)return;
  if(!calPosts[key])calPosts[key]=[];
  calPosts[key].push(text);
  buildCalendar();
  toast('📅 Publication planifiée le '+key+' !');
}

// ── A/B TEST IA ──
async function runABTest(){
  const a=document.getElementById('ab-text-a').value.trim();
  const b=document.getElementById('ab-text-b').value.trim();
  const goal=document.getElementById('ab-goal').value;
  if(!a||!b){toast('Remplis les deux versions !','error');return;}
  const btn=document.getElementById('btn-ab');
  btn.disabled=true;btn.innerHTML='<span class="dots"><span></span><span></span><span></span></span> Analyse en cours...';
  document.getElementById('ab-result').style.display='none';
  try{
    const res=await fetch('/api/ia-boost',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      type:'abtest',name:'A/B Test',description:`Analyse ces deux versions de pub pour l'objectif "${goal}".\n\nVERSION A:\n${a}\n\nVERSION B:\n${b}\n\nDonne : 1) quelle version est la meilleure et pourquoi, 2) score de conversion estimé pour chacune (sur 100), 3) 3 points forts et 1 point faible de chaque. Sois concis et direct.`
    })});
    const data=await res.json();
    const txt=data.strategy||data.result||'Analyse non disponible.';
    const winner=txt.toLowerCase().includes('version b')&&!txt.toLowerCase().includes('version a gagne')?'VERSION B GAGNE 🔵':'VERSION A GAGNE 🟢';
    document.getElementById('ab-winner-text').textContent=winner;
    document.getElementById('ab-analysis-text').textContent=txt;
    document.getElementById('ab-result').style.display='block';
  }catch(e){
    // Fallback offline
    const winner=a.length>b.length?'VERSION A':'VERSION B';
    document.getElementById('ab-winner-text').textContent=winner+' GAGNE';
    document.getElementById('ab-analysis-text').textContent=`Analyse hors-ligne :\n${winner} semble plus performante car elle est ${a.length>b.length?'plus détaillée':'plus concise et impactante'}.\n\nConseils généraux :\n• Commence toujours par le bénéfice client\n• Utilise des chiffres concrets\n• Termine par un appel à l'action clair\n• Évite le jargon technique`;
    document.getElementById('ab-result').style.display='block';
  }
  btn.disabled=false;btn.textContent='🔬 Analyser avec l\'IA';
}

// ── MOBILE PREVIEW — géré par updateMobilePreview() ci-dessus ──

// ── INIT NOUVELLES FEATURES au login ──
document.addEventListener('vb-user-logged-in', () => {
  updateCreditsDisplay();
  setTimeout(checkOnboarding, 800);
});

// Guide pub : ouverture via showAppTab() directement


const OFFER_LIMIT = 100;

async function checkAndShowOffer() {
  if (sessionStorage.getItem('vb_offer_closed')) return;
  if (localStorage.getItem('vb_offer_seen')) return;
  if (currentUser && (currentUser.plan === 'pro' || currentUser.plan === 'elite')) return;

  // Mettre à jour le compteur en temps réel
  try {
    const r = await fetchWithTimeout('/api/admin/all-users?key=viralboost-admin', {}, 3000);
    const users = r.ok ? await r.json() : [];
    const remaining = Math.max(0, OFFER_LIMIT - users.length);
    const el = document.getElementById('offer-remaining');
    if (el) el.textContent = remaining;

    if (remaining <= 0) {
      // Offre terminée — changer le contenu
      const wrap = document.getElementById('offer-box-wrap');
      wrap.innerHTML = `<div class="offer-full">
        <div style="font-size:40px;margin-bottom:10px">😔</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;color:#fbbf24;letter-spacing:2px">OFFRE TERMINÉE</div>
        <div style="font-size:13px;color:#4a7a58;margin-top:8px">Les 100 places gratuites ont été prises.<br>Découvre nos plans à partir de 3€/mois.</div>
        <button class="offer-cta" style="margin-top:18px;width:auto;padding:12px 28px" onclick="closeOffer()">Voir les plans →</button>
      </div>`;
    }
  } catch(e) {
    // API indisponible ou timeout — laisser le "—" ou mettre une valeur approx
    const el = document.getElementById('offer-remaining');
    if (el && el.textContent === '—') el.textContent = '< 100';
  }
}

// showOfferFallback supprimé — le popup est toujours visible par défaut

function claimOffer() {
  localStorage.setItem('vb_offer_seen', '1');
  localStorage.setItem('vb_offer_claimed', '1');
  localStorage.setItem('vb_offer_pending', '1');
  document.getElementById('offer-popup').classList.add('hidden');
  if (currentUser) {
    // Déjà connecté → upgrade direct
    currentUser.plan = 'pro';
    currentUser.offerClaimed = true;
    currentUser.offerExpiry = new Date(Date.now() + 365*24*60*60*1000).toISOString();
    localStorage.setItem('viralboost_user', JSON.stringify(currentUser));
    fetch('/api/register-user', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(currentUser)}).catch(()=>{});
    toast('🎉 Plan PRO activé gratuitement pour 1 an !');
    updateAppBar();
  } else {
    // Ouvrir directement le formulaire d'inscription
    openModal('signup-modal');
  }
}

function closeOffer() {
  // Marquer comme refusé définitivement — ne plus jamais afficher
  localStorage.setItem('vb_offer_seen', '1');
  document.getElementById('offer-popup').classList.add('hidden');
}



// Activer le plan PRO offert lors de la création de compte — intégré dans createUser ci-dessus

// ── COUNTDOWN OFFRE — expire le 01/03/2026 à 10h00 ──
const OFFER_EXPIRY = new Date('2026-03-01T10:00:00');

function updateCountdown() {
  const el = document.getElementById('offer-countdown');
  if (!el) return;
  const diff = OFFER_EXPIRY - Date.now();
  if (diff <= 0) {
    el.textContent = 'EXPIRÉE';
    el.style.color = '#f87171';
    return;
  }
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  el.textContent = (d > 0 ? d + 'j ' : '') + String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}
setInterval(updateCountdown, 1000);


// ── BOTTOM NAV ──
function bottomNavGo(tab, btn){
  // Sync avec l'app tab existant
  const appTabBtn = document.querySelector(`.app-tab[onclick="showAppTab('${tab}',this)"]`);
  if(appTabBtn) appTabBtn.click();
  // Mettre à jour l'actif bottom nav
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}
function syncBottomNav(tab){
  const map={'feed':'bn-feed','vitrine':'bn-vitrine','publier':'bn-publish','chat-global':'bn-chat','profil':'bn-profil','boost-credits':'bn-credits'};
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  const id=map[tab];
  if(id) document.getElementById(id)?.classList.add('active');
  const chatDot=document.getElementById('chat-notif');
  const bnDot=document.getElementById('bn-chat-dot');
  if(bnDot && chatDot) bnDot.className='bn-dot'+(chatDot.style.display!=='none'?' show':'');
}

// ── MOBILE MENU ──

function toggleMobileMenu(){
  const menu=document.getElementById('mobile-menu');
  const btn=document.getElementById('hamburger-btn');
  const open=menu.classList.toggle('open');
  btn.classList.toggle('open',open);
  document.body.style.overflow=open?'hidden':'';
}
function closeMobileMenu(){
  document.getElementById('mobile-menu').classList.remove('open');
  document.getElementById('hamburger-btn').classList.remove('open');
  document.body.style.overflow='';
}
// Fermer le menu si on clique ailleurs
document.addEventListener('click',function(e){
  const menu=document.getElementById('mobile-menu');
  const btn=document.getElementById('hamburger-btn');
  if(menu&&menu.classList.contains('open')&&!menu.contains(e.target)&&!btn.contains(e.target)){
    closeMobileMenu();
  }
});

// Afficher le popup après scroll 60% (plus naturel) ou 15 secondes
window.addEventListener('load', () => {
  const popup = document.getElementById('offer-popup');
  const expired = Date.now() > OFFER_EXPIRY;
  if (!localStorage.getItem('vb_offer_seen') && !expired) {
    updateCountdown();
    let shown = false;
    // Déclencher au scroll 60%
    const onScroll = () => {
      const scrollPct = window.scrollY / (document.body.scrollHeight - window.innerHeight);
      if (scrollPct > 0.6 && !shown) {
        shown = true;
        popup.classList.remove('hidden');
        checkAndShowOffer();
        window.removeEventListener('scroll', onScroll);
      }
    };
    window.addEventListener('scroll', onScroll);
    // Fallback après 15 secondes si pas de scroll
    setTimeout(() => {
      if (!shown) {
        shown = true;
        popup.classList.remove('hidden');
        checkAndShowOffer();
        window.removeEventListener('scroll', onScroll);
      }
    }, 15000);
  }
});
</script>

<!-- ═══════════════════════════════════════════
     GUIDE MODAL — Première création de pub
═══════════════════════════════════════════ -->
<div class="guide-overlay hidden" id="pub-guide-overlay" onclick="if(event.target===this)closePubGuide()">
  <div class="guide-box">
    <button class="guide-box-close" onclick="closePubGuide()">✕</button>
    <div class="guide-title" style="font-size:22px;margin-bottom:4px">CRÉE TA PUB EN 5 ÉTAPES</div>
    <div class="guide-subtitle" style="font-size:12px;margin-bottom:14px">Suis le wizard — chaque étape est guidée.</div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px">
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">1</span>🚀 Identité — nom & catégorie</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">2</span>✍️ Description — ce que tu proposes</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">3</span>🎯 Audience & tags</div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">4</span>🖼️ Visuel <strong style="color:var(--g3)">→ 3× plus de votes</strong></div>
      <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--g5)"><span style="width:20px;height:20px;border-radius:50%;background:var(--g2);color:var(--bg);font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">5</span>👁️ Aperçu & publication</div>
    </div>
    <button class="btn-guide-start" style="padding:12px;font-size:13px" onclick="closePubGuide()">✨ C'est parti !</button>
  </div>
</div>

<!-- MODAL PROJET -->
<div class="project-modal-overlay hidden" id="project-modal-overlay" onclick="if(event.target===this)closeProjectModal()">
  <div class="project-modal" id="project-modal-content">
    <!-- rempli dynamiquement -->
  </div>
</div>

<!-- BOTTOM NAV BAR (mobile) -->
<nav class="bottom-nav" id="bottom-nav" role="navigation" aria-label="Navigation principale">
  <button class="bn-item active" id="bn-feed" onclick="bottomNavGo('feed',this)">
    <span class="bn-icon">🏠</span>
    <span data-i18n="bn_feed">Fil</span>
  </button>
  <button class="bn-item" id="bn-vitrine" onclick="bottomNavGo('vitrine',this)">
    <span class="bn-icon">✨</span>
    <span data-i18n="bn_vitrine">Vitrine</span>
  </button>
  <button class="bn-item bn-publish" id="bn-publish" onclick="bottomNavGo('publier',this)" title="Publier">
    <span class="bn-icon">➕</span>
  </button>
  <button class="bn-item" id="bn-credits" onclick="bottomNavGoCredits(this)">
    <span class="bn-icon">⚡</span>
    <span class="bn-credits-val" id="bn-credits-val">0</span>
  </button>
  <button class="bn-item" id="bn-profil" onclick="bottomNavGo('profil',this)">
    <span class="bn-icon">👤</span>
    <span data-i18n="bn_profil">Profil</span>
  </button>
</nav>

</body>
</html>
